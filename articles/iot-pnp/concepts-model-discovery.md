---
title: 實現 IoT 隨插即用預覽模型發現 |微軟文檔
description: 作為解決方案開發人員，瞭解如何在解決方案中實現 IoT 隨插即用模型發現。
author: ChrisGMsft
ms.author: chrisgre
ms.date: 12/26/2019
ms.topic: conceptual
ms.custom: mvc
ms.service: iot-pnp
services: iot-pnp
manager: philmea
ms.openlocfilehash: 66da0321930ac38217a336380c9889963a433e67
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/27/2020
ms.locfileid: "75531355"
---
# <a name="implement-iot-plug-and-play-preview-model-discovery-in-an-iot-solution"></a>在 IoT 解決方案中實現 IoT 隨插即用預覽模型發現

本文介紹，作為解決方案開發人員，如何在 IoT 解決方案中實現 IoT 隨插即用預覽模型發現。  IoT 隨插即用模型發現是 IoT 隨插即用裝置如何識別其支援的功能模型和介面，以及 IoT 解決方案如何檢索這些功能模型和介面。

IoT 解決方案分為兩大類：專門構建的解決方案與一組已知的 IoT 隨插即用裝置配合使用，以及適用于任何 IoT 隨插即用裝置的模型驅動解決方案。

此概念文章介紹如何在這兩種類型的解決方案中實現模型發現。

## <a name="model-discovery"></a>模型探索

當 IoT 隨插即用裝置首次連接到 IoT 中心時，它會發送模型資訊遙測消息。 此消息包括設備實現的介面的 IT。 要使解決方案與設備配合使用，它必須解析這些 IT 並檢索每個介面的定義。

以下是 IoT 隨插即用裝置使用設備預配服務 （DPS） 連接到集線器時採取的步驟：

1. 打開設備後，它將連接到 DPS 的全域端點，並使用允許的方法之一進行身份驗證。
1. 然後，DPS 對設備進行身份驗證，並查找告知其將設備分配給哪個 IoT 中心的規則。 然後，DPS 將設備註冊到該集線器。
1. DPS 將 IoT 中心連接字串返回給設備。
1. 然後，設備向 IoT 中心發送發現遙測消息。 發現遙測消息包含設備實現的介面的 IT。
1. IoT 隨插即用裝置現已準備好使用使用 IoT 中心的解決方案。

如果設備直接連接到 IoT 中心，則使用嵌入在設備代碼中的連接字串進行連接。 然後，設備向 IoT 中心發送發現遙測消息。

請參閱[模型資訊](concepts-common-interfaces.md)介面，瞭解有關模型資訊遙測消息的詳細資訊。

### <a name="purpose-built-iot-solutions"></a>專門構建的物聯網解決方案

專門構建的 IoT 解決方案可與一組已知的 IoT 隨插即用裝置功能模型和介面配合使用。

您將獲得將提前連接到解決方案的設備的功能模型和介面。 使用以下步驟準備解決方案：

1. 將介面 JSON 檔存儲在 Azure 中，以便解決方案可以讀取它們。
1. 基於預期的 IoT 隨插即用功能模型和介面，在 IoT 解決方案中編寫邏輯。
1. 訂閱來自解決方案使用的 IoT 中心的通知。

收到新設備連接的通知時，請按照以下步驟操作：

1. 讀取發現遙測消息，以檢索設備實現的功能模型和介面的 I。
1. 將功能模型的 ID 與您提前存儲的功能模型的 ID 進行比較。
1. 現在，您知道已連接了哪種類型的設備。 使用您之前編寫的邏輯，使使用者能夠與設備進行適當的交互。

### <a name="model-driven-solutions"></a>模型驅動解決方案

模型驅動的 IoT 解決方案可用於任何 IoT 隨插即用裝置。 構建模型驅動的 IoT 解決方案更為複雜，但好處是您的解決方案適用于將來添加的任何設備。

要構建模型驅動的 IoT 解決方案，您需要根據 IoT 隨插即用介面基元構建邏輯：遙測、屬性和命令。 IoT 解決方案的邏輯通過組合多個遙測、屬性和命令功能來表示設備。

您的解決方案還必須訂閱來自它使用的 IoT 中心的通知。

當您的解決方案收到有關新設備連接的通知時，請按照以下步驟操作：

1. 讀取發現遙測消息，以檢索設備實現的功能模型和介面的 I。
1. 對於每個 ID，請閱讀完整的 JSON 檔以查找設備的功能。
1. 檢查每個介面是否存在於為存儲解決方案之前檢索的 JSON 檔而構建的任何緩存中。
1. 然後，檢查公共模型存儲庫中是否存在具有該 ID 的介面。 有關詳細資訊，請參閱[公共模型存儲庫](howto-manage-models.md)。
1. 如果公共模型存儲庫中不存在該介面，請嘗試在解決方案已知的任何公司模型存儲庫中查找該介面。 您需要一個連接字串來訪問公司模型存儲庫。 有關詳細資訊，請參閱[公司模型存儲庫](howto-manage-models.md)。
1. 如果在公共模型存儲庫或公司模型存儲庫中找不到所有介面，則可以檢查設備是否可以提供介面定義。 設備可以實現標準[ModelDefinition](concepts-common-interfaces.md)介面，以發佈有關如何使用命令檢索介面檔的資訊。
1. 如果找到設備實現的每個介面的 JSON 檔，則可以枚舉設備的功能。 使用您之前編寫的邏輯使使用者能夠與設備交互。
1. 您可以隨時調用數位孿生 API 來檢索設備的功能模型 ID 和介面 ID。

## <a name="next-steps"></a>後續步驟

現在，您已經瞭解了模型發現 IoT 解決方案，請詳細瞭解 Azure [IoT 平臺](overview-iot-plug-and-play.md)，以利用其他功能進行解決方案。
