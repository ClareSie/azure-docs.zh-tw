---
author: ccompy
ms.service: app-service-web
ms.topic: include
ms.date: 02/27/2020
ms.author: ccompy
ms.openlocfilehash: 652d42d6e2d9e909c3a03bd82a3a36f91bc73807
ms.sourcegitcommit: 7581df526837b1484de136cf6ae1560c21bf7e73
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/31/2020
ms.locfileid: "80419572"
---
該功能易於設置,但這並不意味著您的體驗將沒有問題。 如果在訪問所需終結點時遇到問題,可以使用一些實用程式從應用控制台測試連接。 有兩個您可以使用的主控台。 一個是庫杜控制台,另一個是 Azure 門戶中的主控台。 要從你的應用程式到達庫杜主控台,請轉到**工具** > **庫杜**。 您還可以在 [網站名稱]scm.azuresite.net 上訪問 Kudo 控制台。 網站載入後,轉到**調試主控台**選項卡。要從應用程式轉到 Azure 閘戶託管的主控台,請轉到**工具** > **主控台**。

#### <a name="tools"></a>工具
由於安全限制 **,ping、nslook****和** **tracert**的工具無法通過控制台工作。 為了填補空白,添加了兩個單獨的工具。 為了測試 DNS 功能,我們添加了一個名為**nameresolver.exe**的工具。 語法為：

    nameresolver.exe hostname [optional: DNS Server]

您可以使用 nameresolver 來檢查應用程式依賴的主機名稱。 這樣,您可以測試 DNS 中是否有錯誤配置或可能沒有對 DNS 伺服器的訪問許可權。 通過查看環境變數WEBSITE_DNS_SERVER和WEBSITE_DNS_ALT_SERVER,可以查看應用在控制台中使用的 DNS 伺服器。

您可以使用下一個工具測試與主機和埠組合的 TCP 連接。 此工具稱為 **tcpping**，語法如下：

    tcpping.exe hostname [optional: port]

**cpping**實用程式告訴您是否可以到達特定的主機和埠。 僅當有應用程式在主機和埠組合處偵聽,並且應用具有從應用到指定主機和埠的網路訪問許可權時,它才能顯示成功。

#### <a name="debug-access-to-virtual-network-hosted-resources"></a>除錯對虛擬網路託管資源的存取
許多因素會阻止你的應用到達特定的主機和埠。 大多數時候,這是這些事情之一:

* **路線中有防火牆。** 如果路上有防火牆,則達到 TCP 超時。 此案例中 TCP 逾時值就是 21 秒。 使用 **tcpping** 工具來測試連線能力。 TCP 超時可能由防火牆以外的許多因素引起,但從中開始。
* **DNS 無法存取。** DNS 超時為每個 DNS 伺服器 3 秒。 如果您有兩部 DNS 伺服器，逾時為 6 秒。 使用 nameresolver 來檢查 DNS 是否運作。 不能使用 nslookup,因為不使用虛擬網路配置的 DNS。 如果無法訪問,則可能會有防火牆或 NSG 阻止對 DNS 的訪問,或者該防火牆或 NSG 可能會關閉。

如果這些專案不能回答您的問題,請首先查找諸如:

**區域 VNet 整合**
* 您的目的地是否為非 RFC1918 位址,您沒有將WEBSITE_VNET_ROUTE_ALL設置為 1?
* 是否有 NSG 阻止來自整合子網的傳出?
* 如果要透過 Azure ExpressRoute 或 VPN,是否設定本地閘道將流量路由回 Azure? 如果可以到達虛擬網路中的終結點,但不能到達本地,請檢查路由。
* 您是否有足夠的許可權在整合子網上設置委派? 在區域 VNet 整合配置期間,整合子網將委派給 Microsoft.Web。 VNet 整合 UI 自動將子網委託給 Microsoft.Web。 如果您的帳戶沒有足夠的網路許可權來設置委派,則需要可以在集成子網上設置屬性的人員來委派子網。 要手動委派集成子網,請造訪 Azure 虛擬網路子網 UI 並為 Microsoft.Web 設置委派。

**閘道所需的 VNet 整合**
* RFC 1918 範圍(10.0.0.0-10.255.255/ 172.16.0.0-172.31.255.255 / 192.168.0-192.168.255.255)中的點到網站位址範圍?
* 閘道是否顯示在門戶中? 如果您的閘道已關閉，請重新啟動。
* 憑證是否顯示為同步,或者您懷疑網路配置已更改?  如果您的憑證不同步,或者您懷疑對未與 ASP 同步的虛擬網路配置進行了更改,請選擇 **『同步網路**』。
* 如果要透過 VPN,是否設定本地閘道將流量路由回 Azure? 如果可以到達虛擬網路中的終結點,但不能到達本地,請檢查路由。
* 您是否正在嘗試使用同時支援指向網站和 ExpressRoute 的共存閘道? VNet 整合不支援共存閘道。

除錯網路問題是一個挑戰,因為您看不到阻止存取特定主機:埠組合的內容。 一些原因包括:

* 主機上安裝了防火牆,阻止從點對點 IP 範圍訪問應用程式埠。 跨越子網通常需要公共訪問。
* 目標主機已關閉。
* 您的應用程式已關閉。
* 您擁有錯誤的 IP 或主機名稱。
* 您的應用程式偵聽的埠與預期不同。 您可以在端點主機上使用 "netstat -aon"，將處理序識別碼與接聽連接埠進行比對。
* 網路安全組的配置方式使它們無法從點對點 IP 範圍訪問應用程式主機和埠。

你不知道你的應用實際使用的位址。 它可以是整合子網或點對點位址範圍內的任何位址,因此您需要允許從整個位址範圍進行訪問。

其他偵錯步驟包括：

* 連接到虛擬網路中的 VM,並嘗試從那裡訪問資源主機:埠。 若要測試 TCP 存取，請使用 PowerShell 命令 **test-netconnection**。 語法為：

      test-netconnection hostname [optional: -Port]

* 在 VM 上啟動應用程式,並使用**tcpping**從應用從控制台測試對該主機和埠的訪問。

#### <a name="on-premises-resources"></a>內部部署資源 ####

如果應用無法到達本地資源,請檢查是否可以從虛擬網路到達資源。 使用 **test-netconnection** PowerShell 命令來檢查是否有 TCP 存取權。 如果您的 VM 無法訪問本地資源,則 VPN 或 ExpressRoute 連接可能未正確配置。

如果虛擬網路託管的 VM 可以到達本地系統,但應用無法到達,則原因可能是以下原因之一:

* 您的路由未配置與本地閘道中的子網或點對點位址範圍。
* 您的網路安全組正在阻止對點到網站 IP 範圍的訪問。
* 本地防火牆正在阻止來自點到網站 IP 範圍的流量。
* 您正在嘗試使用區域 VNet 整合功能存取非 RFC 1918 位址。