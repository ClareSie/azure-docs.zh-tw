---
title: 容器運行狀況監視器配置的 Azure 監視器 |微軟文檔
description: 本文提供描述容器 Azure 監視器中運行狀況監視器的詳細配置的內容。
ms.topic: conceptual
ms.date: 12/01/2019
ms.openlocfilehash: 99ea6e96f5a8a486784cb3d633a6e031b60eaad7
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/28/2020
ms.locfileid: "80055707"
---
# <a name="azure-monitor-for-containers-health-monitor-configuration-guide"></a>容器運行狀況監視器配置指南的 Azure 監視器

監視器是測量容器 Azure 監視器中的運行狀況和檢測錯誤的主要元素。 本文可説明您瞭解如何測量運行狀況的概念，以及構成運行狀況模型的元素，以便使用["運行狀況（預覽"](container-insights-health.md)功能）監視和報告 Kubernetes 群集的運行狀況。

>[!NOTE]
>此時，"運行狀況"功能處於公共預覽版中。
>

## <a name="monitors"></a>監視器

監視會測量受管理物件某方面的健全狀況。 監視各有兩到三種健全狀況狀態。 在任何特定時間，監視都將處於一種 (且只限一種) 可能的狀態。 當容器化代理載入的監視器時，它將初始化為正常狀態。 僅當檢測到另一種狀態的指定條件時，狀態才會更改。

特定物件的整體健全狀況是由其各個監視的健全狀況所決定。 此層次結構在容器 Azure 監視器中的"運行狀況層次結構"窗格中進行了說明。 如何匯總運行狀況的策略是聚合監視器配置的一部分。

## <a name="types-of-monitors"></a>監視器類型

|監視 | 描述 | 
|--------|-------------|
| 單位監視 |單元監視器測量資源或應用程式的某些方面。 這可能檢查效能計數器以確定資源的性能或其可用性。 |
|彙總監視器 | 聚合監視器對多個監視器進行分組，以提供單個運行狀況聚合運行狀況狀態。 單元監視器通常配置在特定聚合監視器下。 例如，節點聚合監視器會匯總節點 CPU 利用率、記憶體利用率和節點狀態的狀態。
 |

### <a name="aggregate-monitor-health-rollup-policy"></a>聚合監視器運行狀況匯總策略

每個聚合監視器定義運行狀況匯總策略，這是用於根據監視器下監視器的運行狀況確定聚合監視器運行狀況的邏輯。 聚合監視器的可能運行狀況匯總策略如下所示：

#### <a name="worst-state-policy"></a>最差國家政策

聚合監視器的狀態將子監視器的狀態與最差的運行狀況狀態匹配。 這是聚合監視器最常用的策略。

![聚合監視器匯總最差狀態的示例](./media/container-insights-health-monitoring-cfg/aggregate-monitor-rollup-worstof.png)

### <a name="percentage-policy"></a>百分比策略

源物件匹配處於最佳狀態的目標物件的指定百分比的單個成員的最壞狀態。 當目標物件的一定百分比必須正常，目標物件必須被視為正常時，使用此策略。 百分比策略按狀態嚴重性降冪對監視器進行排序，聚合監視器的狀態計算為最差狀態 N%（N 由配置參數*StateThreshold%* 決定）。

例如，假設容器映射有五個容器實例，並且其各自的狀態是 **"嚴重**、**警告**、**健康**、**健康、健康"。""。"** **Healthy**  容器 CPU 利用率監視器的狀態將**至關重要**，因為在按嚴重性降冪排序時，90% 的容器的最壞狀態**是"關鍵**"。

## <a name="understand-the-monitoring-configuration"></a>瞭解監視配置

容器的 Azure 監視器包括許多關鍵監視方案，這些方案配置如下。

### <a name="unit-monitors"></a>單元監視器

|**監視名稱** | 監視類型 | **描述** | **參數** | **價值** |
|-----------------|--------------|-----------------|---------------|-----------|
|節點記憶體利用率 |單位監視 |此監視器使用 cadvisor 報告的資料，每分鐘評估節點的記憶體利用率。 |狀態轉換的連續樣本<br> 失敗，如果大於百分比<br> 警告如果大於百分比 | 3<br> 90<br> 80  ||
|節點 CPU 利用率 |單位監視 |此監視器使用 cadvisor 報告的資料每分鐘檢查節點的 CPU 利用率。 | 狀態轉換的連續樣本<br> 失敗，如果大於百分比<br> 警告如果大於百分比 | 3<br> 90<br> 80  ||
|節點狀態 |單位監視 |此監視器檢查庫伯內斯報告的節點條件。<br> 當前檢查以下節點條件：磁片壓力、記憶體壓力、PID 壓力、磁片外、網路不可用、節點就緒狀態。<br> 在上述條件下，如果 *"磁片不足*"或 *"網路不可用"***為 true，** 則監視器將更改為 **"嚴重"** 狀態。<br> 如果任何其他條件等於**true**，但 **"就緒"** 狀態之外，監視器將更改為**警告**狀態。 | 節點條件類型 用於失敗狀態 | 磁片外，網路不可用 ||
|容器記憶體利用率 |單位監視 |此監視器報告容器實例的記憶體利用率 （RSS） 的組合運行狀況。<br> 它執行一個簡單的比較，將每個示例與單個閾值進行比較，並由配置參數 **"連續採樣ForState轉換**"指定。<br> 其狀態計算為容器 （StateThresholdB%）實例的最差狀態 90%，按容器運行狀況狀態嚴重性（即"嚴重"、"警告"、"正常"）的降冪排序。<br> 如果未從容器實例接收任何記錄，則容器實例的運行狀況狀態將報告為 **"未知**"，並且排序次序中的優先順序高於 **"嚴重"** 狀態。<br> 使用配置中指定的閾值計算每個單獨的容器實例的狀態。 如果使用量超過臨界閾值 （90%），則實例處於**嚴重**狀態，如果小於關鍵閾值 （90%）但大於警告閾值 （80%），則實例處於**警告**狀態。 否則，它處於 **"正常狀態**"。 |狀態轉換的連續樣本<br> 失敗，百分比<br> 狀態閾值百分比<br> 警告如果大於百分比| 3<br> 90<br> 90<br> 80 ||
|容器 CPU 利用率 |單位監視 |此監視器報告容器實例的 CPU 利用率合併運行狀況。<br> 它執行一個簡單的比較，將每個示例與單個閾值進行比較，並由配置參數 **"連續採樣ForState轉換**"指定。<br> 其狀態計算為容器 （StateThresholdB%）實例的最差狀態 90%，按容器運行狀況狀態嚴重性（即"嚴重"、"警告"、"正常"）的降冪排序。<br> 如果未從容器實例接收任何記錄，則容器實例的運行狀況狀態將報告為 **"未知**"，並且排序次序中的優先順序高於 **"嚴重"** 狀態。<br> 使用配置中指定的閾值計算每個單獨的容器實例的狀態。 如果使用量超過臨界閾值 （90%），則實例處於**嚴重**狀態，如果小於關鍵閾值 （90%）但大於警告閾值 （80%），則實例處於**警告**狀態。 否則，它處於 **"正常狀態**"。 |狀態轉換的連續樣本<br> 失敗，百分比<br> 狀態閾值百分比<br> 警告如果大於百分比| 3<br> 90<br> 90<br> 80 ||
|系統工作負載窗格已準備就緒 |單位監視 |此監視器根據給定工作負載中處於就緒狀態的 pod 的百分比報告狀態。 如果少於 100% 的窗格處於 **"正常**狀態"，則其狀態設置為 **"嚴重"** |狀態轉換的連續樣本<br> 失敗，百分比 |2<br> 100 ||
|庫貝 API 狀態 |單位監視 |此監視器報告庫貝 API 服務的狀態。 如果 Kube API 終結點不可用，監視器處於嚴重狀態。 對於此特定監視器，通過查詢 kube-api 伺服器的"節點"終結點來確定狀態。 除了 OK 回應代碼之外，任何其他內容都將監視器更改為 **"嚴重"** 狀態。 | 無配置屬性 |||

### <a name="aggregate-monitors"></a>聚合監視器

|**監視名稱** | **描述** | **演算法** |
|-----------------|-----------------|---------------|
|節點 |此監視器是所有節點監視器的聚合。 它將子監視器的狀態與最差的運行狀況狀態相匹配：<br> 節點 CPU 利用率<br> 節點記憶體利用率<br> 節點狀態 | 最差|
|節點池 |此監視器報告節點池*代理池*中所有節點的組合運行狀況。 這是一個三種狀態監視器，其狀態基於節點池中 80% 的節點的最壞狀態，按節點狀態嚴重性（即嚴重、警告、正常）的降冪排序。|百分比 |
|節點（節點池的父節點） |這是所有節點池的聚合監視器。 其狀態基於其子監視器（即群集中存在的節點池）的最壞狀態。 |最差 |
|群集（節點的父節點/<br> 庫伯內特斯基礎設施） |這是將子監視器的狀態與最差運行狀況狀態（即庫伯奈斯基礎結構和節點）匹配的父監視器。 |最差 |
|庫伯內特斯基礎設施 |此監視器報告群集的託管基礎結構元件的組合運行狀況。 其狀態計算為"最差"的子監視器狀態，即 kube 系統工作負載和 API 伺服器狀態。 |最差|
|系統工作負載 |此監視器報告庫貝系統工作負載的運行狀況狀態。 此監視器將子監視器的狀態與最差的運行狀況狀態（即**處於就緒狀態的 Pods（** 監視器和工作負載中的容器）相匹配。 |最差 |
|容器 |此監視器報告給定工作負載中容器的總體運行狀況。 此監視器將子監視器的狀態與最差的運行狀況狀態（即**CPU 利用率**和**記憶體利用率**監視器）相匹配。 |最差 |

## <a name="next-steps"></a>後續步驟

查看[監視器群集運行狀況](container-insights-health.md)，瞭解查看 Kubernetes 群集的運行狀況。
