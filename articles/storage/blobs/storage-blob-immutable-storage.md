---
title: 不可改變的 Blob 存儲 - Azure 存儲
description: Azure 儲存體為 Blob 物件儲存體提供 WORM (一次寫入，多次讀取) 支援，可讓使用者在指定的間隔內以不可清除、不可修改的狀態儲存資料。
services: storage
author: tamram
ms.service: storage
ms.topic: conceptual
ms.date: 11/18/2019
ms.author: tamram
ms.reviewer: hux
ms.subservice: blobs
ms.openlocfilehash: a980c7bd068a463956191eece43ec1be233e7890
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/28/2020
ms.locfileid: "79367613"
---
# <a name="store-business-critical-blob-data-with-immutable-storage"></a>使用不可變存儲存儲業務關鍵型 Blob 資料

Azure Blob 存儲的不可變存儲使使用者能夠將業務關鍵型資料物件存儲在 WORM（一次寫入、讀取多個）狀態中。 此狀態讓資料在使用者指定的間隔內不可清除，也不可修改。 在保留間隔的持續時間內，可以創建和讀取 blob，但不能修改或刪除 Blob。 不可變存儲可用於所有 Azure 區域中的通用 v1、通用 v2、Blob 存儲和塊 Blob 存儲帳戶。

有關如何使用 Azure 門戶、PowerShell 或 Azure CLI 設置和管理不變性策略，有關如何設置和清除法律保留或創建基於時間的保留原則的資訊，請參閱[設置和管理 Blob 存儲的不變性策略](storage-blob-immutability-policies-manage.md)。

[!INCLUDE [updated-for-az](../../../includes/storage-data-lake-gen2-support.md)]

## <a name="about-immutable-blob-storage"></a>關於不可變 Blob 存儲

不可變存儲可説明醫療保健組織、金融機構和相關行業&mdash;，特別是經紀商組織&mdash;安全地存儲資料。 任何情況下，也可以利用不可變存儲來保護關鍵資料，防止修改或刪除。

典型應用包括：

- **法規遵循**：Azure Blob 儲存體的固定儲存體可協助組織處理 SEC 17a-4(f)、CFTC 1.31(d)、FINRA 和其他法規。 Cohasset Associates 的一份技術白皮書詳細介紹了不可改變存儲如何解決這些法規要求，可通過[Microsoft 服務信任門戶](https://aka.ms/AzureWormStorage)下載。 [Azure 信任中心](https://www.microsoft.com/trustcenter/compliance/compliance-overview)包含有關合規性認證的詳細資訊。

- **安全文檔保留**：Azure Blob 存儲的不可改變存儲可確保任何使用者（包括具有帳戶管理許可權的使用者）無法修改或刪除資料。

- **法定保留**：Azure Blob 存儲的不可改變存儲使使用者能夠在所需的持續時間內將對訴訟或業務使用至關重要的敏感資訊存儲在所需的持續時間內，直到刪除保留。 此功能不僅僅限於法律用例，還可被視為基於事件的保留或企業鎖，需要根據事件觸發器或公司策略保護資料。

不可變存儲支援以下功能：

- **[基於時間的保留原則支援](#time-based-retention-policies)**：使用者可以設置策略以在指定的時間間隔記憶體儲資料。 設置基於時間的保留原則時，可以創建和讀取 Blob，但不能修改或刪除 Blob。 保留期到期後，可以刪除但無法覆蓋的 Blob。

- **[法律保留原則支援](#legal-holds)**：如果保留間隔不為人所知，使用者可以設置法定保留以存儲不可變數據，直到清除法定保留。  設置法定保留原則時，可以創建和讀取 blob，但不能修改或刪除 Blob。 每個法定保留都與用作識別碼字串的使用者定義的字母數位標記（如案例 ID、事件名稱等）相關聯。 

- **所有 Blob 層都支援：** WORM 原則與 Azure Blob 儲存層無關，而且會套用至所有層：經常性存取層、非經常性存取層和封存存取層。 使用者可以將資料轉換到其工作負載的成本最佳化層中，同時維護資料不變性。

- **容器層級組態**：使用者可以在容器層級設定以時間為基礎的保留原則和合法保存標記。 使用簡單的容器層級設定，使用者可以建立及鎖定以時間為基礎的保留原則、延長保留間隔、設定和清除法務保存等等。 這些原則會套用到現有和新容器中的所有 Blob。

- **稽核記錄記錄支援**：每個容器都包含一個策略稽核記錄。 它最多顯示七個基於時間的保留命令，用於鎖定基於時間的保留原則，並包含使用者 ID、命令類型、時間戳記和保留間隔。 針對合法保存，此記錄包含使用者識別碼、命令類型、時間戳記及合法保存標記。 根據 SEC 17a-4（f） 監管準則，此日誌將保留在保單有效期內。 [Azure 活動日誌](../../azure-monitor/platform/platform-logs-overview.md)顯示所有控制平面活動的更全面的日誌;同時啟用[Azure 診斷日誌](../../azure-monitor/platform/platform-logs-overview.md)可保留並顯示資料平面操作。 基於法規需求或其他目的，使用者有責任持續不斷地儲存那些記錄。

## <a name="how-it-works"></a>運作方式

Azure Blob 儲存體的固定儲存體支援兩種 WORM 或固定原則：以時間為基礎的保留和合法保存。 當對容器應用基於時間的保留原則或法定保留時，所有現有 Blob 將在不到 30 秒內進入不可變的 WORM 狀態。 上載到該策略保護容器的所有新 Blob 也將進入不可變狀態。 一旦所有 Blob 處於不可變狀態，將確認不可變策略，並且不允許不可變容器中的任何覆蓋或刪除操作。

如果容器中有任何受合法保留或鎖定基於時間的策略保護的 Blob，也不允許刪除容器和存儲帳戶。 合法的保留原則將防止 Blob、容器和存儲帳戶刪除。 已解鎖和鎖定的基於時間的策略將防止在指定時間內刪除 Blob。 僅當容器中存在至少一個 Blob 時，已解鎖和鎖定的基於時間的策略將防止容器刪除。 只有具有*鎖定*基於時間的策略的容器才能防止存儲帳戶刪除;具有未鎖定時間策略的容器不提供存儲帳戶刪除保護或合規性。

有關如何設置和鎖定基於時間的保留原則的詳細資訊，請參閱[為 Blob 存儲設置和管理不變性策略](storage-blob-immutability-policies-manage.md)。

## <a name="time-based-retention-policies"></a>基於時間的保留原則

> [!IMPORTANT]
> 必須*鎖定*基於時間的保留原則，才能將 Blob 處於符合的不可變（寫入和刪除受保護）狀態，以便 SEC 17a-4（f） 和其他法規遵從性。 我們建議您在合理的時間內鎖定策略，通常不到 24 小時。 應用基於時間的保留原則的初始狀態*將解鎖*，允許您在鎖定該功能之前測試該功能並更改策略。 雖然*解鎖*狀態提供不變性保護，但我們不建議將*解鎖*狀態用於短期功能試驗以外的任何目的。 

若在容器上套用以時間為基礎的保留原則，在「有效」** 保留期限內，容器中的所有 Blob 都會保持固定狀態。 Blob 的有效保留期等於 Blob 的**創建時間和**使用者指定的保留間隔之間的差異。 因為使用者可以延長保留間隔，所以固定儲存體會使用使用者所指定保留間隔的最新值，計算有效的保留期限。

例如，假設使用者創建保留間隔為五年的基於時間的保留原則。 該容器中的現有 blob _testblob1_是一年前創建的;因此，_測試Blob1_的有效保留期為四年。 當將新的 blob _testblob2_上載到容器時 _，testblob2_的有效保留期為創建時五年。

建議僅針對功能測試使用未鎖定的基於時間的保留原則，並且必須鎖定策略，以便符合 SEC 17a-4（f） 和其他法規遵從性要求。 鎖定基於時間的保留原則後，將無法刪除該策略，並且最多允許將有效保留期增加到五個。

以下限制適用于保留原則：

- 對於存儲帳戶，具有鎖定基於時間的不可變策略的最大容器數為 10，000。
- 最短保留間隔為 1 天。 最長為 146，000 天（400 年）。
- 對於容器，延長鎖定基於時間的不可變策略的保留間隔的最大編輯數為 5。
- 對於容器，鎖定的策略最多保留七個基於時間的保留原則稽核記錄。

### <a name="allow-protected-append-blobs-writes"></a>允許受保護的追加 Blob 寫入

追加 Blob 由資料塊組成，並針對審核和日誌記錄方案所需的資料追加操作進行優化。 根據設計，追加 blob 只允許在 blob 的末尾添加新塊。 無論不變性，從根本上不允許修改或刪除追加 Blob 中的現有塊。 要瞭解有關追加 Blob 的更多，請參閱[有關追加 Blob。](https://docs.microsoft.com/rest/api/storageservices/understanding-block-blobs--append-blobs--and-page-blobs#about-append-blobs)

只有基於時間的保留原則具有允許`allowProtectedAppendWrites`將新塊寫入追加 Blob 同時保持不變性保護和合規性的設置。 如果啟用，則允許您直接在受策略保護的容器中創建追加 Blob，並使用*AppendBlock* API 繼續向現有追加 Blob 的末尾添加新資料塊。 只能添加新塊，並且無法修改或刪除任何現有塊。 保留時間不變性保護仍然適用，在有效保留期過後，防止刪除追加 Blob。 啟用此設置不會影響塊 Blob 或頁面 Blob 的不變性行為。

由於此設置是基於時間的保留原則的一部分，因此在*有效*保留期期間，追加 Blob 仍將處於不可變狀態。 由於可以在初始創建追加 Blob 之後追加新資料，因此確定保留期的方式略有不同。 有效的保留是追加 Blob**上次修改時間和**使用者指定的保留間隔之間的差異。 同樣，當保留間隔延長時，不可變存儲使用使用者指定的保留間隔的最新值來計算有效的保留期。

例如，假設使用者創建具有`allowProtectedAppendWrites`啟用的基於時間的保留原則，保留間隔為 90 天。 今天在容器中創建一個追加 blob，即_logblob1，_ 在接下來的 10 天內，新日誌將繼續添加到追加 Blob 中;因此 _，logblob1_的有效保留期從今天起為 100 天（其上次追加時間 = 90 天）。

已解鎖的基於時間的保留原則允許隨時`allowProtectedAppendWrites`啟用和禁用該設置。 鎖定基於時間的保留原則後，`allowProtectedAppendWrites`無法更改該設置。

法律保留原則無法啟用`allowProtectedAppendWrites`，任何合法保留都將取消"允許保護應用寫入"屬性。 如果合法保留應用於`allowProtectedAppendWrites`啟用的基於時間的保留原則，則*AppendBlock* API 將失敗，直到解除法定保留。

## <a name="legal-holds"></a>合法保存

法律保留是臨時保留，可用於法律調查目的或一般保護政策。 每個法定保留原則都需要與一個或多個標記關聯。 標記用作命名識別碼（如案例 ID 或事件）來對保留的用途進行分類和描述。

一個容器可以同時具有合法保存和以時間為基礎的保留原則。 該容器中的所有 Blob 都會保持固定狀態，直到所有合法保存都遭到清除為止 (即使其有效保留期限已過期)。 相反地，Blob 會保持固定狀態，直到有效保留週期到期為止 (即使已清除所有合法保存)。

以下限制適用于法定保留：

- 對於存儲帳戶，具有合法保留設置的最大容器數為 10，000。
- 若為容器，合法保存標記數目上限為 10。
- 法定保留標記的最小長度為三個字母數位字元。 最大長度為 23 個字母數位字元。
- 對於容器，在策略期間最多保留 10 個合法保留原則稽核記錄。

## <a name="scenarios"></a>案例
下表顯示了為不同的不可變方案禁用的 Blob 存儲操作的類型。 有關詳細資訊，請參閱 Azure [Blob 服務 REST API](https://docs.microsoft.com/rest/api/storageservices/blob-service-rest-api)文檔。

|狀況  |Blob 狀態  |Blob 操作被拒絕  |容器和帳戶保護
|---------|---------|---------|---------|
|Blob 上的有效保留間隔尚未過期及/或已設定合法保存     |固定：防刪與防寫保護         | 放置 Blob<sup>1</sup>， 放置塊<sup>1</sup>， 放置塊清單<sup>1</sup>， 刪除容器， 刪除 Blob， 設置 Blob 中繼資料， 放頁， 設置 Blob 屬性， 快照 Blob， 增量副本 Blob， 追加塊<sup>2</sup>         |容器刪除被拒絕;存儲帳戶刪除被拒絕         |
|Blob 上的有效保留間隔已過期，未設置合法保留    |僅限防寫保護 (允許刪除作業)         |放置 Blob<sup>1</sup>， 放置塊<sup>1</sup>， 放置塊清單<sup>1</sup>， 設置 Blob 中繼資料， 放頁， 設置 Blob 屬性， 快照 Blob， 增量複製 Blob， 追加塊<sup>2</sup>         |如果受保護容器中存在至少 1 個 blob，則拒絕刪除容器;存儲帳戶刪除僅針對*鎖定*的基於時間的策略被拒絕         |
|未應用 WORM 策略（沒有基於時間的保留，也沒有合法的保留標記）     |可變動         |None         |None         |

<sup>1</sup> blob 服務允許這些操作創建新 blob 一次。 不允許在不可變容器中的現有 blob 路徑上執行所有後續覆蓋操作。

<sup>2</sup>僅當啟用`allowProtectedAppendWrites`了該屬性時，才允許追加塊用於基於時間的保留原則。 有關詳細資訊，請參閱["允許受保護的追加 Blob 寫入"](#allow-protected-append-blobs-writes)部分。

## <a name="pricing"></a>定價

使用這項功能不需額外付費。 不可改變的資料的定價方式與可變數據相同。 有關 Azure Blob 存儲的定價詳細資訊，請參閱[Azure 存儲定價頁](https://azure.microsoft.com/pricing/details/storage/blobs/)。

## <a name="faq"></a>常見問題集

**您能否提供 WORM 合規性文檔？**

是。 為了記錄合規性，Microsoft 聘請了一家專門從事記錄管理和資訊治理的領先獨立評估公司 Cohasset Associates，以評估不可變 Blob 存儲及其是否符合特定要求。金融服務業。 Cohasset 驗證，當用於將基於時間的 Blob 保留為 WORM 狀態的 Blob 時，不可變 Blob 存儲符合 CFTC 規則 1.31（c）-（d）、FINRA 規則 4511 和 SEC 規則 17a-4 的相關存儲要求。 Microsoft 將這套規則作為目標，因為它們代表了全球對金融機構記錄保留的最規定性指導。 Cohasset 報告在 Microsoft[服務信任中心](https://aka.ms/AzureWormStorage)提供。 要請求 Microsoft 就 WORM 不變性合規性出具證明函，請聯繫 Azure 支援。

**該功能是否僅適用于阻止 Blob 和追加 Blob，還是也應用於頁面 blob？**

在容器級別設置不可變存儲時，可以使用任何 blob 類型，但我們建議您將 WORM 用於主要存儲塊 Blob 和追加 blob 的容器。 容器中的現有 blob 將由新設置的 WORM 策略保護。 但任何新的頁面 Blob 都需要在 WORM 容器外部創建，然後複製。 複製到 WORM 容器後，不允許對頁面 Blob 進行進一步更改。 不鼓勵在存儲任何活動虛擬機器的 VHD（頁面 blob）的容器上設置 WORM 策略，因為它將鎖定 VM 磁片。 我們建議您在鎖定任何基於時間的策略之前，仔細查看文檔並測試您的方案。

**是否需要創建新存儲帳戶才能使用此功能？**

否，您可以將不可變存儲用於任何現有或新創建的通用 v1、通用 v2、Blob 存儲或 BlockBlob 存儲帳戶。 通用 v1 存儲帳戶受支援，但我們建議升級到通用 v2，以便您利用更多功能。 有關升級現有通用 v1 存儲帳戶的資訊，請參閱[升級存儲帳戶](../common/storage-account-upgrade.md)。

**我可以同時應用法定保留和基於時間的保留原則嗎？**

是的，容器可以同時具有合法保留和基於時間的保留原則;因此，容器可以同時擁有合法保留和基於時間的保留原則。但是，"允許保護應用寫入"設置在清除法定保留之前將不適用。 該容器中的所有 Blob 都會保持固定狀態，直到所有合法保存都遭到清除為止 (即使其有效保留期限已過期)。 相反地，Blob 會保持固定狀態，直到有效保留週期到期為止 (即使已清除所有合法保存)。 

**法律保留政策是否僅適用于法律訴訟，還是存在其他使用方案？**

不可以，法律保留只是非基於時間的保留原則的一般術語。 它不需要僅用於與訴訟有關的訴訟。 法律保留原則可用於禁用覆蓋和刪除，以保護重要的企業 WORM 資料，其中保留期未知。 您可以將其用作企業策略來保護任務關鍵型 WORM 工作負載，或在自訂事件觸發器需要使用基於時間的保留原則之前將其用作暫存策略。 

**我可以刪除_鎖定_的基於時間的保留原則或法定保留嗎？**

只能從容器中刪除未鎖定的基於時間的保留原則。 鎖定基於時間的保留原則後，將無法將其刪除;只允許有效的保留期延長。 可以刪除合法保留標記。 刪除所有合法標記後，將刪除合法保留。

**如果我嘗試刪除具有基於時間的保留原則或法定保留的容器，會發生什麼情況？**

如果容器中至少有一個 Blob 存在鎖定或未鎖定的基於時間的保留原則，或者容器具有合法保留，則刪除容器操作將失敗。 僅當容器中沒有 Blob 並且沒有合法保留時，"刪除容器"操作才會成功。 

**如果我嘗試刪除具有基於時間的保留原則或法定保留的容器的存儲帳戶，會發生什麼情況？**

如果至少有一個容器具有合法保留集或**鎖定**的基於時間的策略，則存儲帳戶刪除將失敗。 具有未鎖定時間策略的容器不防止存儲帳戶刪除。 必須先刪除所有合法保留並刪除所有**鎖定**的容器，然後才能刪除存儲帳戶。 如需有關容器刪除的資訊，請參閱前面的問題。 您還可以使用[Azure 資源管理器鎖](../../azure-resource-manager/management/lock-resources.md)對存儲帳戶應用進一步的刪除保護。

**當 Blob 處於不可變狀態時，是否可以跨不同的 Blob 層（熱、酷、存檔）移動資料？**

可以，可以使用"設置 Blob 層"命令跨 Blob 層移動資料，同時將資料保持在符合的不可變狀態。 Blob 經常性存取層、非經常性存取層和封存存取層都支援固定儲存體。

**如果我付款失敗，而保留間隔尚未過期，則會發生什麼事？**

如果未付款，則會依照您與 Microsoft 簽訂的合約條款與條件規定，套用一般資料保留原則。 有關一般資訊，請參閱[Microsoft 的資料管理](https://www.microsoft.com/en-us/trust-center/privacy/data-management)。 

**您是否提供試用此功能的試用版或寬限期？**

是。 首次創建基於時間的保留原則時，該策略處於*解鎖*狀態。 在此狀態中，您可以對保留間隔進行任何所需的變更，例如增加或減少保留間隔，甚至刪除原則。 鎖定原則之後，會保持鎖定狀態，直到保留間隔到期為止。 此鎖定的策略可防止刪除和修改保留間隔。 我們強烈建議僅將「未鎖定」** 狀態使用於試用目的，並且在 24 小時期間內鎖定原則。 這些做法可協助您符合 SEC 17a-4(f) 和其他法規。

**是否可以將虛刪除與不可改變的 blob 策略一起使用？**

是，如果您的合規性要求允許啟用虛刪除。 [Azure Blob 存儲的虛刪除](storage-blob-soft-delete.md)適用于存儲帳戶中的所有容器，而不考慮法定保留或基於時間的保留原則。 我們建議在應用和確認任何不可變 WORM 策略之前啟用虛刪除以進行其他保護。

## <a name="next-steps"></a>後續步驟

- [設置和管理 Blob 存儲的不變性策略](storage-blob-immutability-policies-manage.md)
- [將規則設置為使用生命週期管理自動分層和刪除 Blob 資料](storage-lifecycle-management-concepts.md)
- [Azure 儲存體 Blob 的虛刪除](../blobs/storage-blob-soft-delete.md)
- [使用 Azure 資源管理器鎖保護訂閱、資源組和資源](../../azure-resource-manager/management/lock-resources.md)。
