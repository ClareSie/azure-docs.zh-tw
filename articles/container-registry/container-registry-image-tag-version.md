---
title: 圖像標記最佳實踐
description: 將映射推送到 Azure 容器註冊表並將圖像拉取時標記和版本控制 Docker 容器映射的最佳做法
author: stevelasker
ms.topic: article
ms.date: 07/10/2019
ms.author: stevelas
ms.openlocfilehash: b483317960409fe1fbea181706f12375606fe659
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/27/2020
ms.locfileid: "75445742"
---
# <a name="recommendations-for-tagging-and-versioning-container-images"></a>標記和版本控制容器映射的建議

將容器映射推送到容器註冊表，然後部署它們時，需要映射標記和版本控制的策略。 本文討論了兩種方法，以及每種方法在容器生命週期中適合的位置：

* **穩定標記**- 例如，您重用的標記以指示主要或次要版本（如*mycontainerimage：1.0*）。
* **唯一標記**- 將推送到註冊表的每個圖像的不同標記，例如*我的容器映射：abc123*。

## <a name="stable-tags"></a>穩定標籤

**建議**：使用穩定標記維護容器生成**的基本映射**。 避免使用穩定標記進行部署，因為這些標記將繼續接收更新，並可能在生產環境中引入不一致。

*穩定的標記*意味著開發人員或生成系統可以繼續提取特定的標記，該標記將繼續獲取更新。 穩定並不意味著內容被凍結。 相反，穩定意味著圖像應該穩定，以該版本的意圖。 為了保持"穩定"，可以服務應用安全修補程式或框架更新。

### <a name="example"></a>範例

框架團隊提供版本 1.0。 他們知道他們會發佈更新，包括次要更新。 為了支援給定主要版本和小版本的穩定標記，它們有兩組穩定標記。

* `:1`• 主要版本的穩定標籤。 `1`表示"最新"或"最新"1.*版本。
* `:1.0`- 版本 1.0 的穩定標記，允許開發人員綁定到 1.0 的更新，並在發佈時不會向前滾動到 1.1。

團隊還使用`:latest`該標記，該標記指向最新的穩定標籤，無論當前的主要版本是什麼。

當基本映射更新可用或框架的任何類型的服務版本時，具有穩定標記的圖像將更新到表示該版本最新穩定版本的最新摘要。

在這種情況下，主要標記和次要標記都在不斷得到服務。 從基本映射方案中，這允許映射擁有者提供服務映射。

### <a name="delete-untagged-manifests"></a>刪除未標記的清單

如果更新了具有穩定標記的圖像，則未標記以前標記的圖像，從而導致孤立圖像。 前一個圖像的清單和唯一圖層資料保留在註冊表中。 要保持註冊表大小，可以定期刪除由穩定映射更新產生的未標記清單。 例如，[自動清除](container-registry-auto-purge.md)未標記的清單早于指定持續時間，或為未標記的清單設置[保留原則](container-registry-retention-policy.md)。

## <a name="unique-tags"></a>唯一標記

**建議**：對**部署**使用唯一標記，尤其是在可以擴展到多個節點的環境中。 您可能需要有意部署一致的元件版本。 如果容器重新開機或協調器擴展了更多實例，則主機不會意外拉出較新版本，這與其他節點不一致。

唯一標記僅意味著推送到註冊表的每個圖像都有唯一標記。 標記不會重複使用。 可以遵循幾種模式來生成唯一標記，包括：

* **日期戳**- 此方法相當常見，因為您可以清楚地知道映射的生成時間。 但是，如何將其與生成系統關聯？ 您是否必須找到同時完成的生成？ 你在什麼時區？ 您的所有構建系統都校準到 UTC？
* **Git 提交**– 此方法在您開始支援基本映射更新之前有效。 如果發生基本映射更新，則生成系統將啟動與上一個生成相同的 Git 提交。 但是，基本映射具有新內容。 通常，Git 提交提供*半*穩定標記。
* **清單摘要**- 推送到容器註冊表的每個容器映射都與清單相關聯，該清單由唯一的 SHA-256 雜湊值或摘要標識。 摘要雖然獨一無二，但很長，難以閱讀，並且與生成環境無關。
* **生成 ID** - 此選項可能是最佳的，因為它可能是增量的，它允許您關聯回特定生成以查找所有專案和日誌。 然而，就像清單摘要一樣，人類可能很難閱讀。

  如果您的組織有多個生成系統，則使用生成系統名稱首碼標記是此選項的變體： `<build-system>-<build-id>`。 例如，可以將生成與 API 團隊的 Jenkins 生成系統和 Web 團隊的 Azure 管道生成系統區分開來。

### <a name="lock-deployed-image-tags"></a>鎖定已部署的圖像標記

作為最佳做法，我們建議您通過將任何已部署的圖像標記設置為`false`（） 來[鎖定](container-registry-image-lock.md)它`write-enabled`的屬性。 這種做法可防止您無意中從註冊表中刪除映射，並可能中斷部署。 您可以在發佈管道中包括鎖定步驟。

鎖定已部署的映射仍允許您使用 Azure 容器註冊表功能從註冊表中刪除其他未部署的圖像，以維護註冊表。 例如，[自動清除](container-registry-auto-purge.md)未標記的清單或未鎖定的映射，這些圖像早于指定持續時間，或者為未標記的清單設置[保留原則](container-registry-retention-policy.md)。

## <a name="next-steps"></a>後續步驟

有關本文中概念的更詳細討論，請參閱博客文章[Docker 標記：標記和版本控制 Docker 映射的最佳做法](https://stevelasker.blog/2018/03/01/docker-tagging-best-practices-for-tagging-and-versioning-docker-images/)。

為了説明最大化 Azure 容器註冊表的性能和成本效益，請參閱[Azure 容器註冊表的最佳做法](container-registry-best-practices.md)。

<!-- IMAGES -->


<!-- LINKS - Internal -->

