---
title: 了解 Azure IoT 中樞配額和節流 | Microsoft Docs
description: 開發人員指南 - 說明適用於 IoT 中樞的配額和預期的節流行為。
author: robinsh
ms.author: robinsh
ms.service: iot-hub
services: iot-hub
ms.topic: conceptual
ms.date: 08/08/2019
ms.openlocfilehash: 71a5737434e78bc39bccdfeb950e0dbc32ed0052
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/28/2020
ms.locfileid: "79284690"
---
# <a name="reference---iot-hub-quotas-and-throttling"></a>參考 - IoT 中樞配額和節流

本文介紹了 IoT 中心的配額，並提供有關説明您瞭解限制的工作原理的資訊。

## <a name="quotas-and-throttling"></a>配額和節流

每個 Azure 訂用帳戶最多可以有 50 個 IoT 中樞，以及最多 1 個可用中樞。

佈建每個 IoT 中樞時，都會為其佈建特定層級中的特定單位數。 層級和單位數會決定您每天可傳送的訊息配額上限。 對於免費層中樞，用來計算每日配額的訊息大小為 0.5 KB，而對於所有其他層的訊息大小則為 4 KB。 如需詳細資訊，請參閱 [Azure IoT 中樞價格](https://azure.microsoft.com/pricing/details/iot-hub/)。

層級也會決定「IoT 中樞」在所有作業上強制執行的節流限制。

### <a name="iot-plug-and-play"></a>IoT 隨插即用

在公共預覽期間，IoT 隨插即用裝置將每個介面發送單獨的消息，這可能會增加計入消息配額的消息數。

## <a name="operation-throttles"></a>作業節流

操作限制是在分鐘範圍內應用的速率限制，旨在防止濫用。 它們也受到[交通塑造](#traffic-shaping)的制約。

下表顯示強制執行的節流。 個別中心的值如下。

| 節流 | 免費、B1 及 S1 | B2 和 S2 | B3 和 S3 | 
| -------- | ------- | ------- | ------- |
| [標識註冊表操作](#identity-registry-operations-throttle)（創建、檢索、列出、更新、刪除） | 1.67/秒/單位 (100/分鐘/單位) | 1.67/秒/單位 (100/分鐘/單位) | 83.33/秒/單位（5，000/分鐘/單位） |
| [新設備連接](#device-connections-throttle)（此限制適用于_新連接_的速率，而不是連接總數） | 100/秒或 12/秒/單位較高者 <br/> 例如，兩個 S1 單位是 2\*12 = 24 個新連線/秒，但是您在所有單位上至少擁有 100 個新連線/秒。 如果有九個 S1 單位，您的全部單位就會擁有 108 個新連線/秒 (9\*12)。 | 120 個新連線/秒/單位 | 6，000 個新連接/秒/單元 |
| 裝置到雲端傳送 | 100 個發送操作/秒或 12 個發送操作/秒/單元的較高 <br/> 例如，兩個 S1 單位\*為 2 12 = 24/秒，但在整個單位中至少有 100 個發送操作/秒。 使用 9 個 S1 單元，您在整個單位中發送操作\*/秒（9 12）。 | 120 發送操作/秒/單元 | 6，000 次發送操作/秒/單元 |
| 雲端到裝置的傳送<sup>1</sup> | 1.67 發送操作/秒/單位（100 條消息/分鐘/單位） | 1.67 發送操作/秒/單元（100 個發送操作/分鐘/單元） | 83.33 發送操作/秒/單元（5，000 次發送操作/分鐘/單位） |
| 雲端到裝置的接收<sup>1</sup> <br/> (僅限裝置使用 HTTPS 時)| 16.67 接收操作/秒/單元（1，000 次接收操作/分鐘/單位） | 16.67 接收操作/秒/單元（1，000 次接收操作/分鐘/單位） | 833.33 接收操作/秒/單元（50，000 接收操作/分鐘/單位） |
| 檔案上傳 | 1.67 檔上傳啟動/秒/單元（100/分鐘/單位） | 1.67 檔上傳啟動/秒/單元（100/分鐘/單位） | 83.33 檔上傳啟動/秒/單位（5，000/分鐘/單位） |
| 直接方法<sup>1</sup> | 160 KB/秒/單位<sup>2</sup> | 480 KB/秒/單位<sup>2</sup> | 24 MB/秒/單位<sup>2</sup> | 
| 查詢 | 20/分鐘/單位 | 20/分鐘/單位 | 1，000/分鐘/單位 |
| 對應項 (裝置與模組) 讀取<sup>1</sup> | 100/秒 | 高於 100/秒或 10/秒/單位 | 500/秒/單位 |
| 對應項更新 (裝置與模組)<sup>1</sup> | 50/秒 | 高於 50/秒或 5/秒/單位 | 250/秒/單位 |
| 作業操作<sup>1</sup> <br/> (建立、更新、列出、刪除) | 1.67/秒/單位 (100/分鐘/單位) | 1.67/秒/單位 (100/分鐘/單位) | 83.33/秒/單位（5，000/分鐘/單位） |
| 作業裝置操作<sup>1</sup> <br/> (更新對應項，叫用直接方法) | 10/秒 | 10/秒或 1/秒/單位較高者 | 50/秒/單位 |
| 設定與 Edge 部署<sup>1</sup> <br/> (建立、更新、列出、刪除) | 0.33/秒/單位 (20/分鐘/單位) | 0.33/秒/單位 (20/分鐘/單位) | 0.33/秒/單位 (20/分鐘/單位) |
| 設備流啟動速率<sup>1</sup> | 5 個新串流/秒 | 5 個新串流/秒 | 5 個新串流/秒 |
| 併發連接的設備流的最大數量<sup>1</sup> | 50 | 50 | 50 |
| 最大設備流資料傳輸<sup>1（</sup>每天聚合量） | 300 MB | 300 MB | 300 MB |

<sup>1</sup>「IoT 中樞」的基本層中不提供此功能。 如需詳細資訊，請參閱[如何選擇適合的 IoT 中樞](iot-hub-scaling.md)。 <br/><sup>2</sup>限制儀錶大小為 4 KB。

### <a name="throttling-details"></a>限制詳細資訊

* 儀錶大小確定限制限制的增量。 如果直接呼叫的有效負載介於 0 到 4 KB 之間，則將其計為 4 KB。 在達到 160 KB/秒/單位的限制之前，您每秒最多可以撥打 40 個呼叫。

   同樣，如果有效負載介於 4 KB 和 8 KB 之間，則每個呼叫占 8 KB，在達到最大限制之前，每秒最多可以撥打 20 個呼叫。

   最後，如果有效負載大小介於 156KB 和 160 KB 之間，則在達到 160 KB/秒/單位的限制之前，中心內每單位只能撥打 1 次呼叫。

*  對於層 S2 的*Jobs 設備操作（更新孿生，調用直接方法），50/* 秒/單位僅適用于使用作業調用方法時。 如果直接調用直接方法，則原始限制限制為 24 MB/秒/單位（對於 S2）。

*  **配額**是每天*可以在中心發送*的郵件的總數。 您可以在[IoT 中心定價頁上](https://azure.microsoft.com/pricing/details/iot-hub/)的列 **"郵件總數/天**"下找到中心配額限制。

*  雲到設備和設備到雲限制確定發送消息的最大*速率*-- 消息數，而不考慮 4 KB 的區塊。 每條消息最多可為 256 KB，這是[最大消息大小](iot-hub-devguide-quotas-throttling.md#other-limits)。

*  最好限制呼叫，以免達到/超過限制限制。 如果達到限制，IoT 中心會使用錯誤代碼 429 進行回應，用戶端應退讓並重試。 這些限制是每個中心（或在某些情況下每個中心/單元）。 有關詳細資訊，請參閱[管理連接和可靠的消息/重試模式](iot-hub-reliability-features-in-sdks.md#retry-patterns)。

### <a name="traffic-shaping"></a>流量塑造

為了容納突發流量，IoT 中心在有限的時間內接受油門以上的請求。 這些請求中的前幾個將立即處理。 但是，如果請求數繼續違反限制，IoT 中心將開始將請求放入佇列中以限制速率進行處理。 這種效果稱為*流量整形*。 此外，此佇列的大小是有限的。 如果節流衝突繼續，最終佇列將填滿，IoT 中心將開始使用`429 ThrottlingException`拒絕請求。

例如，使用類比設備每秒向 S1 IoT 中心發送 200 條設備到雲的消息（其發送限制為 100/秒 D2C）。 對於第一兩分鐘，將立即處理消息。 但是，由於設備繼續發送的消息數超過限制，IoT 中心開始每秒僅處理 100 條消息，並將其餘消息放入佇列中。 您開始注意到延遲增加。 最終，隨著佇列填滿`429 ThrottlingException`，您開始獲得[，IoT 中心指標](iot-hub-metrics.md)中的"節流錯誤數"開始增加。

### <a name="identity-registry-operations-throttle"></a>標識註冊表操作限制

設備標識註冊表操作用於裝置管理和預配方案中的運行時使用。 透過[匯入和匯出作業](iot-hub-devguide-identity-registry.md#import-and-export-device-identities)，即可支援讀取或更新大量的裝置身分識別。

### <a name="device-connections-throttle"></a>設備連接限制

「裝置連線」** 節流會控制新裝置可與 IoT 中樞建立連線的速率。 「裝置連線」** 節流不會控制同時連線裝置的數目上限。 「裝置連線」** 速率節流受制於為 IoT 中樞佈建的單位數。

例如，若您購買單一 S1 單位，則得到每秒 100 個連線的節流。 因此，要連接 100，000 台設備，至少需要 1，000 秒（約 16 分鐘）。 不過，若您已將裝置登錄在您的身分識別登錄中，則可以有任意數量的同時連線裝置。

## <a name="other-limits"></a>其他限制

IoT 中樞會強制執行其他操作限制：

| 作業 | 限制 |
| --------- | ----- |
| 裝置 | 可以註冊到單個 IoT 中心的設備總數以及模組上限為 1，000，000。 增加此限制的唯一方法是聯繫[微軟支援](https://azure.microsoft.com/support/options/)。|
| 檔案上傳 | 每個設備 10 個併發檔上載。 |
| 作業<sup>1</sup> | 最大併發作業為 1（對於免費和 S1）、5（對於 S2）和 10（對於 S3）。 但是，所有層的最大併發[設備導入/匯出作業](iot-hub-bulk-identity-mgmt.md)為 1。 <br/>工作歷史記錄最多保留 30 天。 |
| 額外端點 | 付費 SKU 中樞包含 10 個額外端點。 免費 SKU 中樞包含 1 個額外端點。 |
| 消息路由查詢 | 付費 SKU 中心可能具有 100 個路由查詢。 免費 SKU 集線器可能有五個路由查詢。 |
| 訊息擴充 | 付費 SKU 中心最多可以具有 10 條消息擴充功能。 免費 SKU 集線器最多可具有 2 個消息擴充功能。|
| 裝置到雲端傳訊 | 訊息大小上限為 256 KB |
| 雲端到裝置的傳訊<sup>1</sup> | 訊息大小上限為 64 KB。 每台設備的最大掛起郵件為 50。 |
| 直接方法<sup>1</sup> | 直接方法承載的大小上限為 128 KB。 |
| 自動設備和模組配置<sup>1</sup> | 每個付費 SKU 中樞 100 項設定。 每個免費 SKU 中樞 20 項設定。 |
| IoT 邊緣自動部署<sup>1</sup> | 每次部署 50 個模組。 每個付費 SKU 中心部署 100 個部署（包括分層部署）。 每個空閒 SKU 中心有 10 個部署。 |
| 對應項<sup>1</sup> | 所需屬性和報告屬性部分的最大大小為 32 KB。 標記部分的最大大小為 8 KB。 |
| 共用存取原則 | 共用訪問策略的最大數量為 16 |

<sup>1</sup>「IoT 中樞」的基本層中不提供此功能。 如需詳細資訊，請參閱[如何選擇適合的 IoT 中樞](iot-hub-scaling.md)。

## <a name="increasing-the-quota-or-throttle-limit"></a>增加配額或油門限制

在任意給定時間，您可以通過[增加 IoT 中心中的預配單位數](iot-hub-upgrade.md)來增加配額或限制。

## <a name="latency"></a>Latency

IoT 中樞會努力地為所有作業提供低延遲的服務。 但是，由於網路條件和其他不可預知的因素，它不能保證一定的延遲。 設計您的解決方案時，您應該：

* 避免進行有關任何 IoT 中樞作業最大延遲的任何假設。
* 在與您的裝置最靠近的 Azure 區域中佈建 IoT 中樞。
* 考慮使用 Azure IoT Edge 在裝置或靠近裝置的閘道上執行無法容忍延遲的作業。

如先前所述，多個 IoT 中樞單位既會影響節流功能，又不會提供額外的延遲好處或保證。

如果您注意到作業的延遲時間莫名其妙增加，請連絡 [Microsoft 支援服務](https://azure.microsoft.com/support/options/)。

## <a name="next-steps"></a>後續步驟

如需有關 IoT 中樞節流行為的深入討論，請參閱 [IoT Hub throttling and you (IoT 中樞節流和您)](https://azure.microsoft.com/blog/iot-hub-throttling-and-you/) 部落格文章。

此 IoT 中樞開發人員指南中的其他參考主題包括︰

* [IoT 中樞端點](iot-hub-devguide-endpoints.md)
