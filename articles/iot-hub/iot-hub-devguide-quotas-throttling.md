---
title: 了解 Azure IoT 中樞配額和節流 | Microsoft Docs
description: 開發人員指南 - 說明適用於 IoT 中樞的配額和預期的節流行為。
author: robinsh
ms.author: robinsh
ms.service: iot-hub
services: iot-hub
ms.topic: conceptual
ms.date: 08/08/2019
ms.custom:
- 'Role: Cloud Development'
- 'Role: Operations'
- 'Role: Technical Support'
ms.openlocfilehash: 72aff2a2761d3aae695968bd5b4b9d07eab1697f
ms.sourcegitcommit: d767156543e16e816fc8a0c3777f033d649ffd3c
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/26/2020
ms.locfileid: "92547685"
---
# <a name="reference---iot-hub-quotas-and-throttling"></a>參考 - IoT 中樞配額和節流

本文說明 IoT 中樞的配額，並提供可協助您瞭解節流運作方式的資訊。

## <a name="quotas-and-throttling"></a>配額和節流

每個 Azure 訂用帳戶最多可以有 50 個 IoT 中樞，以及最多 1 個可用中樞。

佈建每個 IoT 中樞時，都會為其佈建特定層級中的特定單位數。 層級和單位數會決定您每天可傳送的訊息配額上限。 對於免費層中樞，用來計算每日配額的訊息大小為 0.5 KB，而對於所有其他層的訊息大小則為 4 KB。 如需詳細資訊，請參閱 [Azure IoT 中樞定價](https://azure.microsoft.com/pricing/details/iot-hub/)。

層級也會決定「IoT 中樞」在所有作業上強制執行的節流限制。

## <a name="iot-plug-and-play"></a>IoT 隨插即用

IoT 隨插即用裝置會針對每個介面至少傳送一個遙測訊息（包括根），這可能會增加針對您的訊息配額計數的訊息數目。

## <a name="operation-throttles"></a>作業節流

作業節流是在分鐘範圍內套用的速率限制，旨在防止濫用。 它們也受制于 [流量成形](#traffic-shaping)。

下表顯示強制執行的節流。 個別中心的值如下。

| 節流 | 免費、B1 及 S1 | B2 和 S2 | B3 和 S3 | 
| -------- | ------- | ------- | ------- |
| 身分[識別登錄作業](#identity-registry-operations-throttle) (建立、取出、列出、更新、刪除)  | 1.67/秒/單位 (100/分鐘/單位) | 1.67/秒/單位 (100/分鐘/單位) | 83.33/sec/unit (5000/分鐘/單位)  |
| [新的裝置](#device-connections-throttle) 連線 (此限制適用于 _新_ 連線的速率，而非連線總數)  | 100/秒或 12/秒/單位較高者 <br/> 例如，兩個 S1 單位是 2\*12 = 24 個新連線/秒，但是您在所有單位上至少擁有 100 個新連線/秒。 如果有九個 S1 單位，您的全部單位就會擁有 108 個新連線/秒 (9\*12)。 | 120 個新連線/秒/單位 | 6000新的連線數/秒/單位 |
| 裝置到雲端傳送 | 較高100傳送作業/秒或12個傳送作業/秒/單位 <br/> 例如，兩個 S1 單位是 2 \* 12 = 24/秒，但您的單位之間至少有100的傳送作業/秒。 有九個 S1 單位，您的每秒108傳送作業數 (9 \* 12) 單位。 | 120傳送作業/秒/單位 | 6000傳送作業/秒/單位 |
| 雲端到裝置的傳送<sup>1</sup> | 1.67 傳送作業/秒/單位 (100 訊息/分鐘/單位)  | 1.67 傳送作業/秒/單位 (100 傳送作業/分鐘/單位)  | 83.33 傳送作業/秒/單位 (5000 傳送作業/分鐘/單位)  |
| 雲端到裝置的接收<sup>1</sup> <br/> (僅限裝置使用 HTTPS 時)| 16.67 接收作業/秒/單位 (1000 接收作業/分鐘/單位)  | 16.67 接收作業/秒/單位 (1000 接收作業/分鐘/單位)  | 833.33 接收作業/秒/單位 (50000 接收作業/分鐘/單位)  |
| 檔案上傳 | 1.67 檔案上傳連線/秒/單位 (100/分鐘/單位)  | 1.67 檔案上傳連線/秒/單位 (100/分鐘/單位)  | 83.33 檔案上傳連線/秒/單位 (5000/分鐘/單位)  |
| 直接方法<sup>1</sup> | 160 KB/秒/單位<sup>2</sup> | 480 KB/秒/單位<sup>2</sup> | 24 MB/秒/單位<sup>2</sup> | 
| 查詢 | 20/分鐘/單位 | 20/分鐘/單位 | 1000/分鐘/單位 |
| 對應項 (裝置與模組) 讀取<sup>1</sup> | 100/秒 | 大於 100/秒或 10/秒/單位 | 500/秒/單位 |
| 對應項更新 (裝置與模組)<sup>1</sup> | 50/秒 | 高 50/秒或 5/秒/單位 | 250/秒/單位 |
| 作業操作<sup>1</sup> <br/> (建立、更新、列出、刪除) | 1.67/秒/單位 (100/分鐘/單位) | 1.67/秒/單位 (100/分鐘/單位) | 83.33/sec/unit (5000/分鐘/單位)  |
| 作業裝置操作<sup>1</sup> <br/> (更新對應項，叫用直接方法) | 10/秒 | 10/秒或 1/秒/單位較高者 | 50/秒/單位 |
| 設定與 Edge 部署<sup>1</sup> <br/> (建立、更新、列出、刪除) | 0.33/秒/單位 (20/分鐘/單位) | 0.33/秒/單位 (20/分鐘/單位) | 0.33/秒/單位 (20/分鐘/單位) |
| 裝置串流初始速率<sup>1</sup> | 5 個新串流/秒 | 5 個新串流/秒 | 5 個新串流/秒 |
| 同時連線的裝置資料流程數目上限<sup>1</sup> | 50 | 50 | 50 |
| 最大裝置串流資料傳輸<sup>1</sup> (每日匯總磁片區)  | 300 MB | 300 MB | 300 MB |

<sup>1</sup>「IoT 中樞」的基本層中不提供此功能。 如需詳細資訊，請參閱[如何選擇適合的 IoT 中樞](iot-hub-scaling.md)。 <br/><sup>2</sup>節流計量大小為 4 KB。 節流是根據要求承載大小而定。

### <a name="throttling-details"></a>節流詳細資料

* 計量大小會決定耗用節流限制的遞增量。 如果您的直接呼叫承載介於0到 4 KB 之間，則會計算為 4 KB。 在達到 160 KB/秒/單位的限制之前，每個單位最多可以進行40個呼叫。

   同樣地，如果您的承載介於 4 KB 和 8 KB 之間，每個呼叫帳戶為 8 KB，且每個單位每秒最多可以進行20個呼叫，才能達到最大限制。

   最後，如果您的承載大小介於156KB 和 160 KB 之間，則在達到 160 KB/秒/單位的限制之前，您只能在中樞內針對每個單位進行1次呼叫。

*  若為 *工作裝置作業 (更新對應項，請* 針對階層 S2 叫用直接方法) ，50/秒/單位只適用于使用作業叫用方法時。 如果您直接叫用直接方法，則會套用 S2) 之 24 MB/sec/單位 (的原始節流限制。

*  **配額** 是 *您每天可以在中樞傳送* 的訊息總數。 您可以在 [ [IoT 中樞定價] 頁面](https://azure.microsoft.com/pricing/details/iot-hub/)上/天的 [ **訊息總數** ] 資料行中找到中樞的配額限制。

*  您的雲端到裝置和裝置到雲端的節流會決定您可以傳送訊息的最大 *速率* --無論 4 KB 區塊的訊息數目。 每個訊息最多可以是 256 KB，也就是 [訊息大小上限](iot-hub-devguide-quotas-throttling.md#other-limits)。

*  最好是對您的呼叫進行節流，如此您就不會達到/超過節流限制。 如果您達到限制，IoT 中樞會以錯誤碼429回應，用戶端應該會重試，然後再試一次。 這些限制是針對每個中樞 (，或在某些案例中，每個中樞/單位) 。 如需詳細資訊，請參閱 [管理連線能力和可靠的訊息/重試模式](iot-hub-reliability-features-in-sdks.md#retry-patterns)。

### <a name="traffic-shaping"></a>流量成形

為了因應高載流量，IoT 中樞會在有限的時間，接受超過節流的要求。 這些要求的前幾個都會立即處理。 但是，如果要求數目繼續違反節流，IoT 中樞就會開始將要求放入佇列中，並以限制的速率處理。 此效果稱為「 *流量成形* 」。 此外，此佇列的大小會受到限制。 如果節流違規繼續進行，則佇列最後會填滿，且 IoT 中樞會開始拒絕要求 `429 ThrottlingException` 。

例如，您可以使用模擬裝置，將每秒200的裝置到雲端訊息傳送至您的 S1 IoT 中樞 (，其限制為 100/秒 D2C 傳送) 。 在第一分鐘或兩個訊息中，會立即處理訊息。 不過，因為裝置會繼續傳送比節流限制更多的訊息，所以 IoT 中樞開始只會處理每秒100的訊息，並將其餘部分放在佇列中。 您開始注意到延遲增加。 最後，您會在 `429 ThrottlingException` 佇列填滿時開始，而「 [節流錯誤數目」 IoT 中樞](monitor-iot-hub-reference.md#device-telemetry-metrics) 計量會開始增加。 若要瞭解如何根據計量建立警示和圖表，請參閱 [監視 IoT 中樞](monitor-iot-hub.md)。

### <a name="identity-registry-operations-throttle"></a>身分識別登錄作業節流

裝置身分識別登錄作業適用于在裝置管理和布建案例中使用的執行時間。 透過[匯入和匯出作業](iot-hub-devguide-identity-registry.md#import-and-export-device-identities)，即可支援讀取或更新大量的裝置身分識別。

### <a name="device-connections-throttle"></a>裝置連接節流

「裝置連線」  節流會控制新裝置可與 IoT 中樞建立連線的速率。 「裝置連線」  節流不會控制同時連線裝置的數目上限。 「裝置連線」  速率節流受制於為 IoT 中樞佈建的單位數。

例如，若您購買單一 S1 單位，則得到每秒 100 個連線的節流。 因此，若要連接100000裝置，至少需要1000秒 (約16分鐘的時間) 。 不過，若您已將裝置登錄在您的身分識別登錄中，則可以有任意數量的同時連線裝置。

## <a name="other-limits"></a>其他限制

IoT 中樞會強制執行其他操作限制：

| 作業 | 限制 |
| --------- | ----- |
| 裝置 | 裝置總數加上可註冊到單一 IoT 中樞的模組，其上限為1000000。 若要增加此限制，唯一的方法就是聯絡 [Microsoft 支援服務](https://azure.microsoft.com/support/options/)。|
| 檔案上傳 | 每一裝置10個並行檔案上傳。 |
| 作業<sup>1</sup> | 並行作業的最大值為 1 (適用于免費和 S1) 、適用于 S2) 的 5 (，以及適用于 S3 (的 10) 。 不過，所有層級的並行 [裝置匯入/匯出作業](iot-hub-bulk-identity-mgmt.md) 最大值為1。 <br/>作業歷程記錄最多會保留30天。 |
| 額外端點 | 付費 SKU 中樞包含 10 個額外端點。 免費 SKU 中樞包含 1 個額外端點。 |
| 訊息路由查詢 | 付費的 SKU 中樞可能會有100的路由查詢。 免費的 SKU 中樞可能有五個路由查詢。 |
| 訊息擴充 | 付費的 SKU 中樞最多可有10則訊息擴充。 免費的 SKU 中樞最多可有2個訊息擴充。|
| 裝置到雲端傳訊 | 訊息大小上限為 256 KB |
| 雲端到裝置的傳訊<sup>1</sup> | 訊息大小上限為 64 KB。 每個裝置的傳遞最大擱置訊息為50。 |
| 直接方法<sup>1</sup> | 直接方法承載的大小上限為 128 KB。 |
| 自動裝置和模組設定<sup>1</sup> | 每個付費 SKU 中樞 100 項設定。 每個免費 SKU 中樞 20 項設定。 |
| IoT Edge 自動部署<sup>1</sup> | 50每個部署的模組。 100部署 (包括每個付費 SKU 中樞) 的分層部署。 每個免費 SKU 中樞10次部署。 |
| 對應項<sup>1</sup> | 所需屬性和報告屬性區段的大小上限為 32 KB。 標記區段的大小上限為 8 KB。 |
| 共用存取原則 | 共用存取原則的最大數目為16。 |
| x509 CA 憑證 | 可以在 IoT 中樞上註冊的 x509 CA 憑證數目上限為25。 |

<sup>1</sup>「IoT 中樞」的基本層中不提供此功能。 如需詳細資訊，請參閱[如何選擇適合的 IoT 中樞](iot-hub-scaling.md)。

## <a name="increasing-the-quota-or-throttle-limit"></a>增加配額或節流限制

在任何指定的時間，您都可以藉由 [增加 IoT 中樞內的布建單位數目](iot-hub-upgrade.md)來增加配額或節流限制。

## <a name="latency"></a>Latency

IoT 中樞會努力地為所有作業提供低延遲的服務。 不過，由於網路狀況和其他無法預測的因素，它無法保證一定會有延遲。 設計您的解決方案時，您應該：

* 避免進行有關任何 IoT 中樞作業最大延遲的任何假設。
* 在與您的裝置最靠近的 Azure 區域中佈建 IoT 中樞。
* 考慮使用 Azure IoT Edge 在裝置或靠近裝置的閘道上執行無法容忍延遲的作業。

如先前所述，多個 IoT 中樞單位既會影響節流功能，又不會提供額外的延遲好處或保證。

如果您注意到作業的延遲時間莫名其妙增加，請連絡 [Microsoft 支援服務](https://azure.microsoft.com/support/options/)。

## <a name="next-steps"></a>下一步

如需有關 IoT 中樞節流行為的深入討論，請參閱 [IoT Hub throttling and you (IoT 中樞節流和您)](https://azure.microsoft.com/blog/iot-hub-throttling-and-you/) 部落格文章。

此 IoT 中樞開發人員指南中的其他參考主題包括︰

* [IoT 中樞端點](iot-hub-devguide-endpoints.md)
* [監視 IoT 中樞](monitor-iot-hub.md)
