---
title: 對應資料流程
description: Azure 資料工廠中的映射資料流程的概述
author: kromerm
ms.author: makromer
ms.reviewer: daperlov
ms.service: data-factory
ms.topic: conceptual
ms.custom: seo-lt-2019
ms.date: 12/19/2019
ms.openlocfilehash: 210c1814325e689dd70af9caa7fad08deed933e1
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/28/2020
ms.locfileid: "79243792"
---
# <a name="what-are-mapping-data-flows"></a>什麼是對應資料流程？

映射資料流程是在 Azure 資料工廠中直觀地設計的資料轉換。 資料流程允許資料工程師無需編寫代碼即可開發圖形資料轉換邏輯。 生成的資料流程在 Azure 資料工廠管道中執行，這些活動使用橫向擴展的 Spark 群集。 資料流程活動可以通過現有的資料工廠調度、控制、流和監視功能進行操作。

映射資料流程可提供完全可視的體驗，無需編碼。 您的資料流程將在您自己的執行群集上運行，用於擴展的資料處理。 Azure 資料工廠處理所有代碼轉換、路徑優化和資料流程作業的執行。

## <a name="getting-started"></a>開始使用

要創建資料流程，請在 **"工廠資源**"下選擇加號，然後選擇 **"資料流程**"。 

![新資料流程](media/data-flow/newdataflow2.png "新的資料流程")

這將帶您到資料流程畫布，您可以在其中創建轉換邏輯。 選擇 **"添加源**"以開始配置源轉換。 有關詳細資訊，請參閱[源轉換](data-flow-source.md)。

## <a name="data-flow-canvas"></a>資料流程畫布

資料流程畫布分為三個部分：頂部橫條圖、圖形和配置面板。 

![畫布](media/data-flow/canvas1.png "畫布")

### <a name="graph"></a>圖形

該圖顯示轉換流。 它顯示來源資料的沿線，因為它流入一個或多個接收器。 要添加新源，請選擇"**添加源**"。 要添加新轉換，請選擇現有轉換右下角的加號。

![畫布](media/data-flow/canvas2.png "畫布")

### <a name="azure-integration-runtime-data-flow-properties"></a>Azure 集成運行時資料流程屬性

![偵錯按鈕](media/data-flow/debugbutton.png "偵錯按鈕")

當您開始在 ADF 中處理資料流程時，您需要打開瀏覽器 UI 頂部的資料流程的"調試"開關。 這將啟動 Azure 資料磚塊群集，用於互動式調試、資料預覽和管道調試執行。 您可以通過選擇自訂[Azure 集成運行時](concepts-integration-runtime.md)來設置正在使用的群集的大小。 上次資料預覽或上次調試管道執行後，調試會話將保持生存狀態長達 60 分鐘。

使用資料流程活動操作管道時，ADF 將使用與"運行打開"屬性中[的活動](control-flow-execute-data-flow-activity.md)關聯的 Azure 集成運行時。

預設 Azure 集成運行時是一個小型的 4 核單輔助節點群集，旨在允許您預覽資料並以最低的成本快速執行調試管道。 如果要對大型資料集執行操作，則設置較大的 Azure IR 配置。

通過在 Azure IR 資料流程屬性中設置 TTL，可以指示 ADF 維護群集資源 （VM） 池。 這將導致後續活動的作業執行速度更快。

#### <a name="azure-integration-runtime-and-data-flow-strategies"></a>Azure 集成運行時和資料流程策略

##### <a name="execute-data-flows-in-parallel"></a>並存執行資料流程

如果在管道中並存執行資料流程，ADF 將根據附加到每個活動的 Azure 集成運行時中的設置為每個活動啟動單獨的 Azure 資料磚塊群集。 要在 ADF 管道中設計並存執行，請添加資料流程活動，而 UI 中沒有優先順序約束。

在這三個選項中，此選項可能在最短的時間內執行。 但是，每個並行資料流程將同時在單獨的群集上執行，因此事件的順序是非確定性的。

如果要在管道內並存執行資料流程活動，建議不要使用 TTL。 這是因為同時使用相同的 Azure 集成運行時並存執行資料流程將導致資料工廠的多個暖池實例。

##### <a name="overload-single-data-flow"></a>超載單資料流程

如果將所有邏輯放在單個資料流程中，ADF 都將在同一作業執行上下文中執行單個 Spark 群集實例。

此選項可能更難遵循和疑難排解，因為您的商務規則和業務邏輯將混雜在一起。 此選項也無法提供多少再使用性。

##### <a name="execute-data-flows-serially"></a>串列執行資料流程

如果在管道中串列執行資料流程活動，並且在 Azure IR 配置上設置了 TTL，則 ADF 將重用計算資源 （VM），從而加快後續執行時間。 您仍然會為每個執行接收新的 Spark 上下文。

在這三個選項中，執行端到端可能需要最長的時間。 但它確實提供了每個資料流程步驟中邏輯操作的完全分離。

### <a name="configuration-panel"></a>配置面板

配置面板顯示特定于當前所選轉換的設置。 如果未選擇轉換，則顯示資料流程。 在總體資料流程配置中，您可以在 **"常規**"選項卡下編輯名稱和說明，或通過 **"參數"** 選項卡添加參數。有關詳細資訊，請參閱[映射資料流程參數](parameters-data-flow.md)。

每個轉換至少有四個配置選項卡。

#### <a name="transformation-settings"></a>轉換設置

每個轉換的配置窗格中的第一個選項卡包含特定于該轉換的設置。 有關詳細資訊，請參閱該轉換的文檔頁。

![源設置選項卡](media/data-flow/source1.png "源設置選項卡")

#### <a name="optimize"></a>最佳化

"**優化**"選項卡包含用於配置分區方案的設置。

![優化](media/data-flow/optimize1.png "最佳化")

預設設置是 **"使用當前分區**"，它指示 Azure 資料工廠使用在 Spark 上運行的資料流程本機的分區方案。 在大多數情況下，我們建議此設置。

在某些情況下，您可能需要調整分區。 例如，如果要將轉換輸出到湖中的單個檔，請在接收器轉換中選擇 **"單個分區**"。

可能想要控制分區方案的另一個案例是優化性能。 調整分區可控制資料跨計算節點的分佈和資料局部優化，這些優化會對總體資料流程性能產生正和負面影響。 有關詳細資訊，請參閱[資料流程性能指南](concepts-data-flow-performance.md)。

要更改任何轉換上的分區，請選擇 **"優化**"選項卡並選擇"**設置分區**單選"按鈕。 然後，您將看到一系列分區選項。 最佳分區方法將因數據卷、候選鍵、空值和基數而異。 

最佳做法是從預設分區開始，然後嘗試不同的分區選項。 您可以使用管道調試運行進行測試，並從監視視圖查看每個轉換分組中的執行時間和分區使用方式。 有關詳細資訊，請參閱[監視資料流程](concepts-data-flow-monitoring.md)。

以下分區選項可用。

##### <a name="round-robin"></a>迴圈 

迴圈是一個簡單的分區，可在分區之間自動平均分配資料。 當您沒有良好的關鍵候選項時，請使用迴圈，以實現可靠的智慧分區策略。 您可以設定實體分割區的數目。

##### <a name="hash"></a>雜湊

Azure Data Factory 會產生資料行雜湊以產生統一的分割區，使具有相似值的資料列會落在相同的分割區中。 使用雜湊選項時，測試可能的分區偏斜。 您可以設定實體分割區的數目。

##### <a name="dynamic-range"></a>動態範圍

動態範圍將使用基於您提供的列或運算式的 Spark 動態範圍。 您可以設定實體分割區的數目。 

##### <a name="fixed-range"></a>固定範圍

生成為分區資料列中的值提供固定範圍的運算式。 為了避免分區偏斜，在使用此選項之前，應充分瞭解資料。 為運算式輸入的值將用作分區函數的一部分。 您可以設定實體分割區的數目。

##### <a name="key"></a>Key

如果您對資料基數有很好的瞭解，則金鑰分區可能是一個不錯的策略。 索引鍵資料分割將會針對資料行中的每個唯一值建立分割區。 無法設置分區數，因為該編號將基於資料中的唯一值。

#### <a name="inspect"></a>檢查

"**檢查"** 選項卡提供要轉換的資料流程的中繼資料的視圖。 您可以看到列計數、列更改、添加列、資料類型、列排序和列引用。 **檢查**是中繼資料的唯讀視圖。 無需啟用偵錯模式即可在 **"檢查"** 窗格中查看中繼資料。

![檢查](media/data-flow/inspect1.png "檢查")

通過轉換更改資料形狀時，您將在 **"檢查"** 窗格中看到中繼資料更改流。 如果源轉換中沒有定義的架構，則中繼資料在 **"檢查"** 窗格中不可見。 在架構漂移方案中，缺少中繼資料很常見。

#### <a name="data-preview"></a>資料預覽

如果偵錯模式處於打開狀態，"**資料預覽"** 選項卡將為您提供每個轉換時資料的互動式快照。 有關詳細資訊，請參閱[偵錯模式下的資料預覽](concepts-data-flow-debug-mode.md#data-preview)。

### <a name="top-bar"></a>頂端列

頂部欄包含影響整個資料流程的操作，如保存和驗證。 您還可以使用 **"顯示圖形**"和"**隱藏圖形**"按鈕在圖形和配置模式之間切換。

![隱藏圖形](media/data-flow/hideg.png "隱藏圖形")

如果隱藏圖形，則可以通過 **"上一步**"和 **"下一步**"按鈕橫向流覽轉換節點。

![上一個和下一個按鈕](media/data-flow/showhide.png "上一個和下一個按鈕")

## <a name="next-steps"></a>後續步驟

* 瞭解如何創建[源轉換](data-flow-source.md)。
* 瞭解如何在[偵錯模式下](concepts-data-flow-debug-mode.md)構建資料流程。
