---
title: 避免過度學習 & 使用 AutoML 不平衡資料
titleSuffix: Azure Machine Learning
description: 使用 Azure Machine Learning 的自動化機器學習解決方案，識別及管理 ML 模型的常見陷阱。
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: conceptual
ms.reviewer: nibaccam
author: nibaccam
ms.author: nibaccam
ms.date: 04/09/2020
ms.openlocfilehash: 76f920ad6aae68defb567a7a6623d1ffd488af5f
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/28/2020
ms.locfileid: "80874852"
---
# <a name="prevent-overfitting-and-imbalanced-data-with-automated-machine-learning"></a>使用自動化機器學習服務來防止過度學習和不平衡資料

當您建立機器學習模型時，過度調整和不平衡的資料是常見的陷阱。 根據預設，Azure Machine Learning 的自動化機器學習服務會提供圖表和計量，以協助您找出這些風險，並實行最佳作法以協助減輕這些風險。 

## <a name="identify-over-fitting"></a>識別過度調整

機器學習中的過度調整會在模型符合定型資料的情況下發生，因此無法精確預測未察覺的測試資料。 換句話說，此模型只是記下定型資料中的特定模式和雜訊，但是沒有足夠的彈性可以對實際資料進行預測。

請考慮下列已定型的模型及其對應的定型和測試精確度。

| 型號 | 定型精確度 | 測試精確度 |
|-------|----------------|---------------|
| A | 99.9% | 95% |
| B | 87% | 87% |
| C | 99.9% | 45% |

考慮模型**A**，有一個常見的誤解，如果未被看的資料上的測試精確度低於定型精確度，則模型會過度調整。 不過，測試精確度應該一律小於定型精確度，而配合大小調整與適當調整的差異，會降低到精確度較低*的程度。* 

比較模型**a**和**B**時，模型**a**是較佳的模型，因為它具有較高的測試精確度，而且雖然測試精確度在95% 稍微較低，但它並不是建議過度調整的重要差異。 您不只會選擇模型**B** ，因為定型和測試精確度比較接近在一起。

模型**C**代表明顯的過度調整案例;定型準確度非常高，但測試精確度不在接近高的位置。 這項區別是主觀的，但來自您的問題和資料的知識，以及可接受的錯誤巨量。

## <a name="prevent-over-fitting"></a>防止過度調整

在最缺陷還有嚴重的情況下，過度調整的模型會假設在定型期間所看到的功能值組合，一律會產生與目標完全相同的輸出。

避免過度調整的最佳方式，就是遵循 ML 最佳做法，包括：

* 使用更多訓練資料，並消除統計偏差
* 防止目標洩漏
* 使用較少的功能
* **正規化和超參數優化**
* **模型複雜性限制**
* **交叉驗證**

在自動化 ML 的內容中，上述前三個專案是**您所執行的最佳作法**。 最後三個粗體專案是**最佳做法自動化 ML**預設值，以防止過度調整。 在自動化 ML 以外的設定中，所有六個最佳做法都值得遵循，以避免過度調整模型。

### <a name="best-practices-you-implement"></a>您所實行的最佳作法

使用**更多資料**是防止過度調整的最簡單且最可能的方式，因為增加的額外優點通常會增加精確度。 當您使用更多資料時，模型會變得更難記住確切的模式，而且會強制觸及更有彈性的解決方案，以容納更多條件。 也請務必辨識**統計偏差**，以確保您的定型資料不會包含不存在於即時預測資料中的隔離模式。 這種情況很容易解決，因為您的定型和測試集之間可能不會過度調整，但相較于即時測試資料，可能會有過度調整。

目標洩漏是類似的問題，在此情況下，您可能不會看到定型/測試集的過度調整，而是在預測時間顯示。 當您的模型在定型期間「欺騙」時，如果您在預測時擁有不應正常擁有的資料存取權，就會發生目標洩漏。 例如，如果您的問題是要在星期一的星期五進行預測，但其中一項功能不小心包含來自星期四的資料，這就是模型在預測時不會有的資料，因為它不會出現在未來。 目標洩漏是很容易遺漏的錯誤，但通常是因為您的問題有異常的高準確度。 如果您嘗試預測股票價格，並以95% 的精確度來定型模型，則您的功能中可能會有目標洩漏。

移除功能也有助於過度調整，方法是防止模型有太多欄位用來記住特定模式，因而使其更具彈性。 這可能很難以測量數量，但如果您可以移除功能並維持相同的精確度，您可能會讓模型更有彈性，並降低過度調整的風險。

### <a name="best-practices-automated-ml-implements"></a>自動化 ML 實行的最佳做法

正規化是最小化成本函式以會複雜和過度調整模型的程式。 有不同類型的正規化函式，但在一般情況下，它們會會模型係數大小、變異數和複雜度。 自動化 ML 會以不同的組合使用 L1 （套索）、L2 （凸緣）和 ElasticNet （L1 和 L2），並具有可控制過度調整的不同模型超參數設定。 簡單地說，自動化 ML 會改變模型受管制的程度，並選擇最佳的結果。

自動化 ML 也會實行明確的模型複雜性限制，以防止過度調整。 在大部分情況下，此實作為明確適用于決策樹或樹系演算法，其中個別樹狀結構的最大深度有限，而樹系或集團技術所使用的樹狀結構總數則受到限制。

交叉驗證（CV）是一種程式，可取得完整訓練資料的許多子集，並在每個子集上定型模型。 其概念是，模型可能會「幸運」並具有一個子集的絕佳準確度，但使用許多子集時，此模型將不會每次都達到此高準確度。 執行 CV 時，您會提供驗證的維持資料集、指定 CV 折迭（子集數目）和自動化 ML 會定型您的模型並微調超參數，以將驗證集的錯誤降至最低。 一個 CV 折迭可以過度調整，但藉由使用許多，它可以降低您的最終模型過度調整的機率。 缺點是，CV 會導致較長的定型時間，因此成本較高，因為不會定型模型一次，所以您會針對每個*n* CV 子集進行一次訓練。 

> [!NOTE]
> 預設不會啟用交叉驗證;必須在自動化 ML 設定中設定。 不過，在設定交叉驗證並提供驗證資料集之後，系統會自動為您自動化程式。 請參閱 

<a name="imbalance"></a>

## <a name="identify-models-with-imbalanced-data"></a>識別具有不平衡資料的模型

不平衡資料通常會在機器學習分類案例的資料中找到，而則是指在每個類別中包含不相稱比例的觀察資料。 此不平衡可能會導致不正確地發現模型精確度的正面副作用，因為輸入資料有偏差到一個類別，這會導致定型的模型模擬該偏差。 

因為分類演算法通常會以精確度進行評估，所以檢查模型的精確度分數是識別它是否受到不平衡資料影響的好方法。 對於某些類別而言，它的精確度很高，還是精確度很低？

此外，自動化 ML 執行會自動產生下列圖表，這可協助您瞭解模型分類的正確性，並識別可能受到不平衡資料影響的模型。

圖表| 描述
---|---
[混淆矩陣](how-to-understand-automated-ml.md#confusion-matrix)| 針對資料的實際標籤，評估正確分類的標籤。 
[精確度-召回](how-to-understand-automated-ml.md#precision-recall-chart)| 根據找到的標籤實例的比率，評估正確標籤的比率 
[ROC 曲線](how-to-understand-automated-ml.md#roc)| 根據誤報標籤的比例，評估正確標籤的比率。

## <a name="handle-imbalanced-data"></a>處理不平衡資料 

自動化 ML 是在簡化機器學習工作流程的目標過程中，具備內建的功能，可協助處理不平衡資料，例如， 

- 加權資料**行**：自動化 ML 支援加權資料行做為輸入，導致資料中的資料列加權為相應增加或減少，這可能會讓類別變得更多或更少「重要」。

- 自動化 ML 所使用的演算法可以適當地處理最多20:1 的不平衡，這表示在資料中，最常見的類別可能會比最不常見的類別擁有20倍以上的資料列。

下列技術是在自動化 ML 外處理不平衡資料的其他選項。 

- 將較小的類別向上取樣或向下取樣較大的類別，即使類別不平衡，也會重新取樣。 這些方法需要專業知識來處理和分析。

- 使用效能標準，以更佳的方式處理不平衡資料。 例如，F1 分數是精確度和召回率的加權平均值。 精確度測量分類器的 exactness--低精確度表示大量的誤報--,，而召回量值則是測量分類器的完整性--低召回表示有大量的錯誤否定。 

## <a name="next-steps"></a>後續步驟

請參閱範例，並瞭解如何使用自動化機器學習來建立模型：

+ 遵循[教學課程：使用 Azure Machine Learning 自動定型回歸模型](tutorial-auto-train-models.md)

+ 設定自動訓練實驗的設定：
  + 在 Azure Machine Learning studio 中，請[使用下列步驟](how-to-use-automated-ml-for-ml-models.md)。
  + 透過 Python SDK，請[使用下列步驟](how-to-configure-auto-train.md)。


