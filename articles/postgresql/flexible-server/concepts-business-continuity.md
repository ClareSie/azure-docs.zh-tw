---
title: 使用適用於 PostgreSQL 的 Azure 資料庫彈性的伺服器來概述商務持續性
description: 透過適用於 PostgreSQL 的 Azure 資料庫彈性的伺服器瞭解商務持續性的概念
author: sr-msft
ms.author: srranga
ms.service: postgresql
ms.topic: conceptual
ms.date: 09/22/2020
ms.openlocfilehash: 341d3c6f0a2d84c2b7b725959db9f7e5dd80d3ff
ms.sourcegitcommit: d767156543e16e816fc8a0c3777f033d649ffd3c
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/26/2020
ms.locfileid: "92542959"
---
# <a name="overview-of-business-continuity-with-azure-database-for-postgresql---flexible-server"></a>使用適用於 PostgreSQL 的 Azure 資料庫彈性的伺服器來概述商務持續性

> [!IMPORTANT]
> 適用於 PostgreSQL 的 Azure 資料庫 - 彈性伺服器為預覽狀態

適用於 PostgreSQL 的 Azure 資料庫彈性的伺服器中的 **商務持續性** 是指可讓您的企業在發生中斷時繼續運作的機制、原則和程式，特別是其運算基礎結構。 在大部分的情況下，有彈性的伺服器會處理在雲端環境中可能發生的干擾性事件，並讓您的應用程式和商務程式持續執行。 不過，有一些無法自動處理的事件，例如：

- 使用者不小心刪除或更新資料表中的資料列。
- 地震會導致電源中斷並暫時停用資料中心或可用性區域。
- 修正 bug 或安全性問題所需的資料庫修補。

彈性伺服器提供的功能，可在發生規劃和未規劃的停機事件時，保護資料並減少任務關鍵性資料庫的停機時間。 以已提供強大復原和可用性的 Azure 基礎結構為基礎，具有彈性的伺服器具有商務持續性功能，可提供額外的容錯保護、解決復原時間需求，並減少資料遺失的風險。 當您設計應用程式架構時，您應該考慮停機容錯，也就是復原時間目標 (RTO) 和資料遺失風險，也就是復原點目標 (RPO) 。 例如，相較于測試資料庫，業務關鍵資料庫需要更嚴格的執行時間需求。  

> [!IMPORTANT]
> 預覽期間不提供執行時間% 服務等級協定 (SLA) 。 

下表說明彈性伺服器所提供的功能。


| **功能** | **描述** | **考量** |
| ---------- | ----------- | ------------ |
| **自動備份** | 彈性伺服器會自動執行資料庫檔案的每日備份，並持續備份交易記錄。 備份可以保留7天（最多35天）。 您將能夠將資料庫伺服器還原到備份保留期限內的任何時間點。 RTO 取決於要還原的資料大小，以及執行記錄復原的時間。 最多可有12小時的時間。 如需詳細資訊，請參閱 [概念-備份和還原](./concepts-backup-restore.md)。 |備份資料仍會保留在該區域內。 |
| **區域備援高可用性** | 有彈性的伺服器可以使用區域冗余高可用性進行部署 (HA) 設定，其中主要和待命伺服器部署在區域內的兩個不同可用性區域中。 此 HA 設定可保護您的資料庫不受區域層級的失敗影響，也有助於減少在規劃和未規劃的停機事件期間的應用程式停機時間。 主伺服器的資料會以同步模式複寫到待命複本。 當主伺服器發生任何中斷時，伺服器會自動容錯移轉到待命複本。 大部分情況下的 RTO 應該會在60秒-120s 內。 RPO 應為零 (不會) 資料遺失。 如需詳細資訊，請參閱 [概念-高可用性](./concepts-high-availability.md)。 | 在一般用途和記憶體優化計算層級中受到支援。 只有在有多個區域可用的區域中才可使用。 |
| **Premium 管理的磁片** | 資料庫檔案儲存在高度耐用且可靠的高階受控儲存體中。 這會提供資料複本，其中有三個複本儲存在具有自動資料復原功能的可用性區域內。 如需詳細資訊，請參閱 [受控磁片檔](../../virtual-machines/managed-disks-overview.md)。 | 儲存在可用性區域中的資料。 |
| **區域多餘備份** | 彈性的伺服器備份會自動並安全地儲存在區域內的區域冗余儲存體中。 在布建伺服器的區域層級失敗期間，如果您的伺服器未設定區域冗余，您仍然可以使用不同區域中的最新還原點來還原資料庫。 如需詳細資訊，請參閱 [概念-備份和還原](./concepts-backup-restore.md)。| 僅適用于可使用多個區域的區域。|


## <a name="planned-downtime-events"></a>規劃的停機事件
以下是一些規劃的維護案例。 這些事件通常會產生最多幾分鐘的停機時間，而不會遺失資料。

| **案例** | **處理**|
| ------------------- | ----------- | 
| <b>計算規模調整 (使用者起始的) | 在計算規模調整作業期間，允許使用中的檢查點完成、用戶端連線已清空、任何未認可的交易都已取消、儲存體已卸離，然後關閉。 具有相同資料庫伺服器名稱的新彈性伺服器會以調整的計算設定進行布建。 然後，儲存體會附加至新的伺服器，並在接受用戶端連線之前，視需要啟動資料庫以執行復原。 |
| <b>擴充儲存體 (使用者起始的)  | 當擴大儲存體作業開始時，允許使用中的檢查點完成，用戶端連線會清空，任何未認可的交易都會取消，然後關閉。 儲存體會調整為所需的大小，然後附加至新的伺服器。 在接受用戶端連線之前，需要進行復原。 請注意，不支援調整儲存體大小。 |
| <b> (Azure 起始) 的新軟體部署 | 新推出的功能或錯誤修正會在服務的規劃維護期間自動發生，而且您可以排程這些活動發生的時間。 如需詳細資訊，請檢查您的 [入口網站](https://aka.ms/servicehealthpm)。 | 
| <b> (Azure 起始) 的次要版本升級 | 適用於 PostgreSQL 的 Azure 資料庫會自動將資料庫伺服器修補為 Azure 所決定的次要版本。 它會在服務的已規劃維護過程中發生。 資料庫伺服器會自動以新的次要版本重新開機。 如需詳細資訊，請參閱[文件](../concepts-monitoring.md#planned-maintenance-notification)。 您也可以檢查您的 [入口網站](https://aka.ms/servicehealthpm)。| 

 當彈性伺服器設定了 **區域冗余高可用性** 時，有彈性的伺服器會先在待命伺服器上執行調整和維護作業。 如需詳細資訊，請參閱 [概念-高可用性](./concepts-high-availability.md)。

##  <a name="unplanned-downtime-mitigation"></a>非計畫的停機風險降低

未規劃的停機時間可能是因為發生未預期的中斷，例如基礎硬體錯誤、網路問題和軟體錯誤所導致。 如果設定高可用性的資料庫伺服器未預期地關閉，則會啟動待命複本，而且用戶端可以繼續執行作業。 如果未設定高可用性 (HA) ，則如果重新開機嘗試失敗，則會自動布建新的資料庫伺服器。 雖然無法避免非計畫的停機時間，但有彈性的伺服器可自動執行復原作業來減少停機時間，而不需要人為介入。 
   
### <a name="unplanned-downtime-failure-scenarios-and-service-recovery"></a>未計畫的停機時間：失敗案例和服務復原
以下是一些未計畫的失敗案例和復原程式。 

| **案例** | **復原進程 [非 HA]** | **復原程式 [HA]** |
| ---------- | ---------- | ------- |
| <B>資料庫伺服器失敗 | 如果資料庫伺服器已關閉，Azure 將會嘗試重新開機資料庫伺服器。 如果失敗，資料庫伺服器將會在另一個實體節點上重新開機。  <br /> <br /> 復原時間 (RTO) 取決於各種因素，包括發生錯誤時的活動（例如大型交易），以及資料庫伺服器啟動程式期間要執行的復原量。 <br /> <br /> 使用於 postgresql 資料庫的應用程式必須以其偵測和重試中斷的連接和失敗交易的方式來建立。 | 如果偵測到資料庫伺服器失敗，伺服器會容錯移轉至待命伺服器，進而減少停機時間。 如需詳細資訊，請參閱 [HA 概念頁面](./concepts-high-availability.md)。 RTO 應為 60 120s，不會遺失任何資料。 |
| <B>儲存體失敗 | 應用程式不會看到任何儲存體相關問題的影響，例如磁片故障或實體區塊損毀。 當資料儲存在三個複本中時，資料複本會由存活的儲存區提供服務。 系統會自動修復損毀的資料區塊，並自動建立新的資料複本。 | 對於任何罕見且無法復原的錯誤，例如整個儲存體無法存取，彈性伺服器會容錯移轉到待命複本，以減少停機時間。 如需詳細資訊，請參閱 [HA 概念頁面](./concepts-high-availability.md)。 |
| <b> 邏輯/使用者錯誤 | 若要從使用者錯誤（例如意外卸載的資料表或不正確的資料）復原，您必須執行 (PITR) 的 [時間點恢復](../concepts-backup.md) 。 執行還原作業時，您要指定自訂還原點，也就是發生錯誤之前的時間。<br> <br>  如果您只想要還原一部分的資料庫或特定的資料表，而不是資料庫伺服器中的所有資料庫，您可以在新的實例中還原資料庫伺服器，) 透過 [pg_dump](https://www.postgresql.org/docs/11/app-pgdump.html)將資料表匯出 (s，然後使用 [pg_restore](https://www.postgresql.org/docs/11/app-pgrestore.html) 將這些資料表還原至您的資料庫。 | 這些使用者錯誤不會受到高可用性的保護，因為所有變更都會以同步方式複寫到待命複本。 您必須執行時間點還原，才能從這類錯誤中復原。 |
| <b> 可用性區域失敗 | 若要從區域層級失敗中復原，您可以使用備份來執行時間點還原，然後選擇具有最新時間的自訂還原點來還原最新的資料。 新的彈性伺服器將會部署在另一個未受影響的區域中。 還原所需的時間取決於先前的備份和要復原的交易記錄量。 | 彈性伺服器會自動容錯移轉至 60 120s 內的待命伺服器，且不會遺失任何資料。 如需詳細資訊，請參閱 [HA 概念頁面](./concepts-high-availability.md)。 | 
| <b> 區域失敗 | 預覽版尚未支援跨區域讀取複本和備份功能的異地還原。 | |


> [!IMPORTANT]
> 已刪除的伺服器 **無法** 還原。 如果您刪除伺服器，所有屬於該伺服器的資料庫也會一併刪除，且無法復原。 使用 [Azure 資源鎖定](../../azure-resource-manager/management/lock-resources.md) 來協助防止意外刪除您的伺服器。


## <a name="next-steps"></a>下一步

-   深入瞭解 [區域冗余高可用性](./concepts-high-availability.md)
-   瞭解[備份和](./concepts-backup-restore.md)復原