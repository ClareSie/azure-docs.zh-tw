---
title: 儲存弱點評定掃描會導致儲存體帳戶可在防火牆和 Vnet 後存取
description: 提供如何在儲存體帳戶中儲存弱點評定（VA）掃描（可透過防火牆或 VNet 存取）的指示
services: sql-database
ms.service: sql-database
ms.subservice: security
ms.topic: conceptual
author: barmichal
ms.author: mibar
ms.reviewer: vanto
ms.date: 04/17/2020
ms.openlocfilehash: 36783c84acc22d6bc1084c2c13f455dedbfc77ca
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/28/2020
ms.locfileid: "81771855"
---
# <a name="store-vulnerability-assessment-scan-results-in-a-storage-account-accessible-behind-firewalls-and-vnets"></a>儲存弱點評定掃描會導致儲存體帳戶可在防火牆和 Vnet 後存取

如果您在 Azure 中針對特定 Vnet 或服務限制存取您的儲存體帳戶，您必須啟用適當的設定，讓 SQL 資料庫或受控實例的弱點評定（VA）掃描能夠存取該儲存體帳戶。

## <a name="enable-azure-sql-database-va-scanning-access-to-the-storage-account"></a>啟用儲存體帳戶的 Azure SQL Database VA 掃描存取

如果您已將 VA 儲存體帳戶設定為僅供特定網路或服務存取，您將需要確保 Azure SQL Database 的 VA 掃描能夠將掃描儲存在儲存體帳戶上。 若要找出正在使用的儲存體帳戶，請移至[Azure 入口網站](https://portal.azure.com)的 **[SQL server** ] 窗格中，在 [**安全性**] 底下，選取 [ **Advanced data Security**]。

:::image type="content" source="media/sql-database-vulnerability-assessment-storage/va-storage.png" alt-text="va-儲存體":::

您可以使用現有的儲存體帳戶，或建立新的儲存體帳戶來儲存 Azure SQL Server 上所有資料庫的 VA 掃描結果。

移至包含儲存體帳戶的**資源群組**，並存取 [**儲存體帳戶**] 窗格。 在 [**設定**] 底下，選取 [**防火牆和虛擬網路**]。

確定已核取 [**允許受信任的 Microsoft 服務存取此儲存體帳戶**]。

:::image type="content" source="media/sql-database-vulnerability-assessment-storage/storage-allow-microsoft-services.png" alt-text="儲存體-允許-microsoft 服務":::

## <a name="store-va-scan-results-for-azure-sql-managed-instance-in-a-storage-account-that-can-be-accessed-behind-a-firewall-or-vnet"></a>將適用于 Azure SQL 受控執行個體的 VA 掃描結果儲存在可在防火牆或 VNet 後方存取的儲存體帳戶

因為受控執行個體不是受信任的 Microsoft 服務，而且與儲存體帳戶有不同的 VNet，所以執行 VA 掃描將會導致錯誤。

若要支援受控實例上的 VA 掃描，請遵循下列步驟：

1. 在 [ **SQL 受控實例**] 窗格的 [**總覽**] 標題底下，按一下 [**虛擬網路/子網**] 連結。 這會帶您前往 [**虛擬網路**] 窗格。

   :::image type="content" source="media/sql-database-managed-instance-public-endpoint-configure/mi-overview.png" alt-text="mi-overview2":::

1. 在 [**設定**] 底下，選取 [**子網**]。 按一下 [新增] 窗格中的 [**子網**] 來新增子網，並將其委派給*sql\managedInstance*。 如需詳細資訊，請參閱[管理子網](../virtual-network/virtual-network-manage-subnet.md)。

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/mi-subnets.png" alt-text="mi-子網":::

1. 在您的 [**虛擬網路**] 窗格中，選取 [**設定**] 底下的 [**服務端點**]。 在新的窗格**中按一下 [新增]** ，然後將 [ *Microsoft 儲存體*] 服務新增為新的服務端點。 請確定已選取*ManagedInstance*子網。 按一下 [加入]  。

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/mi-service-endpoint.png" alt-text="mi-服務端點":::

1. 移至您已選取用來儲存 VA 掃描的**儲存體帳戶**。 在 [**設定**] 底下，選取 [**防火牆和虛擬網路**]。 按一下 [新增現有的虛擬網路]****。 選取您的受控實例 [虛擬網路] 和 [子網]，然後按一下 [**新增**]。

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/storage-firewall.png" alt-text="儲存體-防火牆":::

您現在應該能夠將您的「受控實例」的 VA 掃描儲存在儲存體帳戶中。

## <a name="next-steps"></a>後續步驟

- [弱點評估](sql-vulnerability-assessment.md)
- [建立 Azure 儲存體帳戶](../storage/common/storage-account-create.md)
- [Azure SQL Database 的 Advanced data security](sql-database-advanced-data-security.md)