---
title: 連接體系結構 - MySQL 的 Azure 資料庫
description: 描述 MySQL 伺服器 Azure 資料庫的連接體系結構。
author: kummanish
ms.author: manishku
ms.service: mysql
ms.topic: conceptual
ms.date: 03/16/2020
ms.openlocfilehash: e7098056356c84469d3dc6bd4e3222fbb5b7f908
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/28/2020
ms.locfileid: "79474283"
---
# <a name="connectivity-architecture-in-azure-database-for-mysql"></a>MySQL Azure 資料庫中的連接體系結構
本文介紹了 MySQL 連接體系結構的 Azure 資料庫，以及如何從 Azure 內外的用戶端將流量定向到 MySQL 實例的 Azure 資料庫。

## <a name="connectivity-architecture"></a>連線架構
MySQL 的 Azure 資料庫連接是通過閘道建立的，閘道負責將傳入連接路由到群集中伺服器的物理位置。 下圖說明瞭流量流。

![連接體系結構概述](./media/concepts-connectivity-architecture/connectivity-architecture-overview-proxy.png)

當用戶端連接到資料庫時，它們會收到連接到閘道的連接字串。 此閘道具有偵聽埠 3306 的公共 IP 位址。 在資料庫群集中，流量將轉發到 MySQL 的相應 Azure 資料庫。 因此，為了連接到您的伺服器（例如來自公司網路），必須打開用戶端防火牆，以便出站流量能夠到達我們的閘道。 下面您可以找到我們每個區域的閘道使用的 IP 位址的完整清單。

## <a name="azure-database-for-mysql-gateway-ip-addresses"></a>MySQL 閘道 IP 位址的 Azure 資料庫
下表列出了 MySQL 閘道的 Azure 資料庫的主 IP 和輔助 IP，用於所有資料區域。 主 IP 位址是閘道的當前 IP 位址，第二個 IP 位址是主位址發生故障時容錯移轉 IP 位址。 如前所述，客戶應允許向外站到兩個 IP 位址。 第二個 IP 位址不會偵聽任何服務，直到 Azure 資料庫啟動它，以便 MySQL 接受連接。

| **地區名稱** | **閘道 IP 位址** |
|:----------------|:-------------|
| 澳大利亞中部| 20.36.105.0     |
| 澳大利亞中部2     | 20.36.113.0     |
| 澳大利亞東部 | 13.75.149.87, 40.79.161.1     |
| 澳大利亞東南部 |191.239.192.109, 13.73.109.251     |
| 巴西南部 | 104.41.11.5, 191.233.201.8, 191.233.200.16     |
| 加拿大中部 |40.85.224.249     |
| 加拿大東部 | 40.86.226.166     |
| 美國中部 | 23.99.160.139, 13.67.215.62     |
| 中國東部 | 139.219.130.35     |
| 中國東部 2 | 40.73.82.1     |
| 中國北部 | 139.219.15.17     |
| 中國北部 2 | 40.73.50.0     |
| 東亞 | 191.234.2.139, 52.175.33.150, 13.75.33.20, 13.75.33.21     |
| 美國東部 | 40.121.158.30, 191.238.6.43     |
| 美國東部 2 |40.79.84.180, 191.239.224.107, 52.177.185.181     |
| 法國中部 | 40.79.137.0, 40.79.129.1     |
| 德國中部 | 51.4.144.100     |
| 德國東北部 | 51.5.144.179     |
| 印度中部 | 104.211.96.159     |
| 印度南部 | 104.211.224.146     |
| 印度西部 | 104.211.160.80     |
| 日本東部 | 13.78.61.196, 191.237.240.43     |
| 日本西部 | 104.214.148.156, 191.238.68.11, 40.74.96.7, 40.74.96.6 |
| 南韓中部 | 52.231.32.42     |
| 南韓南部 | 52.231.200.86     |
| 美國中北部 | 23.96.178.199, 23.98.55.75, 52.162.104.35, 52.162.104.36     |
| 北歐 | 40.113.93.91, 191.235.193.75     |
| 南非北部  | 102.133.152.0     |
| 南非西部    | 102.133.24.0     |
| 美國中南部 |13.66.62.124, 23.98.162.75, 104.214.16.39, 20.45.120.0     |
| 東南亞 | 104.43.15.0, 23.100.117.95, 40.78.233.2, 23.98.80.12     |
| 阿拉伯聯合大公國中部 | 20.37.72.64     |
| 阿拉伯聯合大公國北部 | 65.52.248.0     |
| 英國南部 | 51.140.184.11     |
| 英國西部 | 51.141.8.11     |
| 美國中西部 | 13.78.145.25     |
| 西歐 | 40.68.37.158, 191.237.232.75     |
| 美國西部 | 104.42.238.205, 23.99.34.75     |
| 美國西部 2 | 13.66.226.202     |
||||

## <a name="connection-redirection"></a>連接重定向

MySQL 的 Azure 資料庫支援一個額外的連接策略**重定向**，它有助於減少用戶端應用程式和 MySQL 伺服器之間的網路延遲。 使用此功能，在將初始 TCP 會話建立到 MySQL 伺服器的 Azure 資料庫後，伺服器將承載 MySQL 伺服器的節點的後端位址返回給用戶端。 此後，所有後續資料包直接流向伺服器，繞過閘道。 當資料包直接流向伺服器時，延遲和輸送量提高了性能。

具有引擎版本 5.6、5.7 和 8.0 的 MySQL 伺服器的 Azure 資料庫支援此功能。

對重定向的支援在由 Microsoft 開發的 PHP [mysqlnd_azure](https://github.com/microsoft/mysqlnd_azure)擴展中提供，並且可在[PECL](https://pecl.php.net/package/mysqlnd_azure)上提供。 有關如何在應用程式中使用重定向的詳細資訊，請參閱[配置重定向](./howto-redirection.md)一文。

> [!IMPORTANT]
> 對 PHP [mysqlnd_azure](https://github.com/microsoft/mysqlnd_azure)擴展中重定向的支援當前處於預覽狀態。

## <a name="next-steps"></a>後續步驟

* [使用 Azure 門戶為 MySQL 防火牆規則創建和管理 Azure 資料庫](./howto-manage-firewall-using-portal.md)
* [使用 Azure CLI 建立和管理適用於 MySQL 的 Azure 資料庫防火牆規則](./howto-manage-firewall-using-cli.md)
* [使用 MySQL 的 Azure 資料庫配置重定向](./howto-redirection.md)