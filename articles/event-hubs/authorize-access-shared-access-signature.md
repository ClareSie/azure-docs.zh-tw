---
title: 使用 Azure 事件中樞中的共用存取簽章來授與存取權
description: 本文提供的資訊說明如何使用 (SAS) 的共用存取簽章，來授權 Azure 事件中樞資源的存取權。
ms.topic: conceptual
ms.date: 06/23/2020
ms.openlocfilehash: 6a2d7385f82864e8d378055333377fb9c3f73c19
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/09/2020
ms.locfileid: "85323129"
---
# <a name="authorizing-access-to-event-hubs-resources-using-shared-access-signatures"></a>使用共用存取簽章來授權事件中樞資源的存取權
 (SAS) 的共用存取簽章可讓您將有限的存取權授與事件中樞命名空間中的資源。 SAS 會根據授權規則來保護事件中樞資源的存取權。 您可以在命名空間或實體 (事件中樞或主題) 上設定這些規則。 本文提供 SAS 模型的總覽，並回顧 SAS 的最佳作法。

## <a name="what-are-shared-access-signatures"></a>什麼是共用存取簽章？
 (SAS) 的共用存取簽章會根據授權規則，提供事件中樞資源的委派存取權。 授權規則具有名稱、與特定權限相關聯，並且承載了密碼編譯金鑰組。 您可以透過事件中樞用戶端或您自己的程式碼，使用規則的名稱和金鑰來產生 SAS 權杖。 然後，用戶端可以將權杖傳遞至事件中樞，以證明所要求作業的授權。

SAS 是使用簡單權杖的宣告式授權機制。 使用 SAS 時，金鑰一律不會透過網路傳遞。 金鑰可用來以密碼編譯方式簽署稍後可由服務驗證的資訊。 SAS 的作用可類似於用戶端直接擁有授權規則名稱和相符金鑰的使用者名稱和密碼。 SAS 可以類似于同盟的安全性模型，其中用戶端會從安全性權杖服務收到有時間限制且經過簽署的存取權杖，而不會擁有簽署金鑰。

> [!NOTE]
> Azure 事件中樞使用 Azure Active Directory (Azure AD) 支援對事件中樞資源的授權。 使用 Azure AD 所傳回 OAuth 2.0 權杖的授權使用者或應用程式，可提供更高的安全性，並透過 (SAS) 的共用存取簽章更容易使用。 使用 Azure AD 時，不需要在程式碼中儲存權杖，也不需要風險潛在的安全性弱點。
>
> Microsoft 建議您盡可能使用 Azure AD 搭配您的 Azure 事件中樞應用程式。 如需詳細資訊，請參閱 [使用 Azure Active Directory 授權存取 Azure 事件中樞資源](authorize-access-azure-active-directory.md)。

> [!IMPORTANT]
> SAS (共用存取簽章) 權杖對保護您的資源而言是不可或缺的。 提供細微的資料細微性時，SAS 會授與用戶端事件中樞資源的存取權。 不應公開共用。 共用時，如果基於疑難排解原因需要，請考慮使用精簡版的任何記錄檔，或刪除 SAS 權杖 (如果有來自記錄檔的) ，請確定螢幕擷取畫面不包含 SAS 資訊。

## <a name="shared-access-authorization-policies"></a>共用存取授權原則
每個事件中樞命名空間和每個事件中樞實體 (事件中樞實例或 Kafka 主題) 具有由規則組成的共用存取授權原則。 命名空間層級的原則會套用至命名空間內的所有實體，無論其個別的原則組態為何。
對於每個授權原則規則，您會決定三項資訊：名稱、範圍和權限。 名稱是該範圍內的唯一名稱。 範圍是有問題之資源的 URI。 針對事件中樞命名空間，範圍是 (FQDN) 的完整功能變數名稱，例如 `https://<yournamespace>.servicebus.windows.net/` 。

原則規則提供的許可權可以是下列各項的組合：
- **傳送** –提供將訊息傳送至實體的許可權
- **接聽** –提供接聽或接收實體的許可權
- **管理** –提供管理命名空間拓撲的許可權，包括建立和刪除實體

> [!NOTE]
> [ **管理** 許可權] 包含 [ **傳送** ] 和 [ **接聽** ] 許可權。

命名空間或實體原則最多可保存12個共用存取授權規則，提供三組規則的空間，分別涵蓋基本許可權，以及傳送和接聽的組合。 這會限制 SAS 原則存放區不適合作為使用者或服務帳戶存放區。 如果您的應用程式需要根據使用者或服務身分識別來授與事件中樞資源的存取權，則應在驗證和存取檢查之後，執行會發出 SAS 權杖的安全性權杖服務。

系統會為授權規則指派一個 **主要金鑰** 和 **次要金鑰**。 這些金鑰是密碼編譯的增強金鑰。 別遺失或洩漏它們。 它們一律會出現在 Azure 入口網站中。 您可以使用其中一個產生的金鑰，以及您可以隨時重新產生它們。 如果您重新產生或變更原則中的金鑰，所有先前根據該金鑰發行的權杖都將立即無效。 不過，根據這類權杖建立的作用中連線會繼續運作，直到權杖到期。

當您建立事件中樞命名空間時，系統會自動為命名空間建立名為 **RootManageSharedAccessKey** 的原則規則。 此原則具有整個命名空間的 **管理** 許可權。 建議您將此規則視為系統管理根帳號，不要在應用程式中使用。 您可以在入口網站中命名空間的 [ **設定** ] 索引標籤中，透過 PowerShell 或 Azure CLI 來建立額外的原則規則。

## <a name="best-practices-when-using-sas"></a>使用 SAS 時的最佳做法
當您在應用程式中使用共用存取簽章時，您必須留意兩個潛在風險：

- 如果 SAS 洩漏，則任何取得該 SAS 的人都可以使用它，可能會危害您的事件中樞資源。
- 如果提供給用戶端應用程式的 SAS 到期，而且應用程式無法從您的服務取得新的 SAS，則可能會妨礙運作應用程式的功能。

下列關於使用共用存取簽章的建議，將可協助您平衡這些風險：

- **如果有需要，用戶端會自動更新 sas**：用戶端應在到期前更新 sas，以在提供 SAS 的服務無法使用時，允許重試的時間。 如果您的 SAS 適用于少數的立即存留期作業，這些作業預期會在到期期間內完成，則可能不需要更新，因為 SAS 預期不會更新。 不過，如果您有定期透過 SAS 做出要求的用戶端，則到期的可能性便有可能發生。 重要的考慮是平衡 SAS 的需要存留期 (，如先前所述) 需要確保用戶端 (提早要求續約，以避免由於 SAS 在成功更新) 之前過期所造成的中斷。
- **請小心使用 SAS 開始時間**：如果您將 sa 的開始時間設定為 [ **現在**]，則由於時鐘誤差 (根據不同的電腦) 的目前時間有所差異，因此在前幾分鐘內可能會間歇性觀察到失敗。 一般而言，請將開始時間設為至少 15 分鐘之前的時間。 或者，完全不要設定，這會在所有情況下立即生效。 同樣的情況也同樣適用于到期時間。 請記住，您可能會在任何要求的任一方向觀察到最多15分鐘的時鐘誤差。 
- **請特別針對要存取的資源**提供：安全性最佳作法是為使用者提供最低的必要許可權。 如果使用者只需要單一實體的讀取存取權，則授與他們該單一實體的讀取存取權，而非授與他們所有實體的讀取/寫入/刪除存取權。 此外，如果 SAS 遭到入侵，它也有助於降低損毀的損毀，因為 SAS 的能力較低。
- **請勿一律使用 sas**：有時與事件中樞的特定作業相關聯的風險，會超過 SAS 的優點。 針對這類作業，建立仲介層服務，在商務規則驗證、驗證和審核之後，寫入至您的事件中樞。
- **一律使用 HTTPs**：一律使用 HTTPs 來建立或散發 SAS。 如果 SAS 透過 HTTP 傳遞，並被攔截，執行攔截式連接的攻擊者能夠讀取 SAS，然後如同預期的使用者一樣使用它，可能會危及敏感性資料或允許惡意使用者損毀資料。

## <a name="conclusion"></a>結論
共用存取簽章對於將事件中樞資源的有限許可權提供給用戶端很有用。 它們是使用 Azure 事件中樞之任何應用程式之安全性模型的重要部分。 如果您遵循這篇文章中所列的最佳作法，您可以使用 SAS 來提供更大的彈性來存取資源，而不會危及應用程式的安全性。

## <a name="next-steps"></a>後續步驟
請參閱下列相關文章： 

- [使用 Azure Active Directory 驗證從應用程式 Azure 事件中樞的要求](authenticate-application.md)
- [使用 Azure Active Directory 來驗證受控識別，以存取事件中樞資源](authenticate-managed-identity.md)
- [使用共用存取簽章驗證 Azure 事件中樞的要求](authenticate-shared-access-signature.md)
- [使用 Azure Active Directory 授權存取事件中樞資源](authorize-access-azure-active-directory.md)


