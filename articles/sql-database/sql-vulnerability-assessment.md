---
title: SQL 弱點評定
description: 瞭解如何在 Azure SQL Database 上設定 SQL 弱點評定，並解讀評量報告。
services: sql-database
ms.service: sql-database
ms.subservice: security
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: mibar
ms.author: mibar
ms.reviewer: vanto, carlrab
ms.date: 04/19/2020
tags: azure-synapse
ms.openlocfilehash: 80629898b56f81fc738cb30df63766ea39adea6d
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/28/2020
ms.locfileid: "81684260"
---
# <a name="sql-vulnerability-assessment-helps-you-identify-database-vulnerabilities"></a>SQL 弱點評估可協助您識別資料庫弱點

SQL 弱點評定是一種容易設定的服務，可探索、追蹤及協助您修復潛在的資料庫弱點。 使用此工具可主動改進您的資料庫安全性。

弱點評估是[先進的資料安全性](sql-database-advanced-data-security.md)供應專案的一部分，它是先進 SQL 安全性功能的整合套件。 您可以透過中央 SQL Advanced Data Security 入口網站來存取及管理弱點評定。

> [!NOTE]
> Azure SQL Database、Azure SQL Database 受控實例和 Azure Synapse 分析都支援弱點評估。 為了簡單起見，在本文中提到任何受控資料庫服務時都會使用 SQL Database。

## <a name="vulnerability-assessment"></a>弱點評量

SQL 弱點評定是一種服務，可讓您看到您的安全性狀態。 弱點評估包含解決安全性問題和增強資料庫安全性的可行步驟。 它可協助您： 

- 符合要求資料庫掃描報告的合規性需求。
- 符合資料隱私權標準。
- 監視難以追蹤變更的動態資料庫環境。

弱點評估是 Azure SQL Database 內建的掃描服務。 服務會採用旗標安全性弱點的規則知識庫。 它會反白顯示與最佳作法的偏差，例如錯誤配置、過多的許可權，以及未受保護的敏感性資料。

這些規則是以 Microsoft 的最佳作法為基礎，並著重于對資料庫和其重要資料帶來最大風險的安全性問題。 其中涵蓋資料庫層級的問題和伺服器層級的安全性問題，例如伺服器防火牆設定和伺服器層級的許可權。 這些規則也代表各種不同管理機構要符合其合規性標準的要求。

掃描結果包含可以解決個別問題的可操作步驟，並於合適的情況下提供自訂的補救指令碼。 您可以藉由設定可接受的基準，為您的環境自訂評量報告：
* 許可權設定。
* 功能設定。
* 資料庫設定。

## <a name="implement-vulnerability-assessment"></a>實行弱點評估

下列步驟會在 SQL Database 上執行弱點評估。

### <a name="1-run-a-scan"></a>1. 執行掃描

在 [Azure SQL Database] 窗格的 [**安全性**] 標題底下，選取 [ **Advanced Data Security**]。 然後按一下 [**弱點評估**] 窗格上的 [**選取存放裝置**]，開啟整個 SQL Server 的 [弱點評估設定] 窗格。

設定儲存體帳戶，將會儲存伺服器上所有資料庫的掃描結果。 如需儲存體帳戶的資訊，請參閱[關於 Azure 儲存體帳戶](../storage/common/storage-create-storage-account.md)。 設定儲存體之後，請選取 [**掃描**] 來掃描您的資料庫是否有弱點。

![掃描資料庫](./media/sql-vulnerability-assessment/pp_va_initialize.png)

  > [!NOTE]
  > 掃描是輕量且安全的。 這需要幾秒鐘的時間來執行，而且完全是唯讀的。 它不會對您的資料庫進行任何變更。

### <a name="2-view-the-report"></a>2.檢視報告

當掃描完成時，您的掃描報表會自動顯示在 Azure 入口網站中。 此報告會顯示您的安全性狀態總覽。 它會列出找到多少問題及其各自的嚴重性。 結果包括偏離最佳作法的警告和安全性相關設定的快照集，例如資料庫主體和角色及其相關聯的許可權。 掃描報告也會提供在資料庫中探索到的敏感性資料的對應。 其中包含使用[資料探索和分類](sql-database-data-discovery-and-classification.md)來分類該資料的建議。

![檢視報告](./media/sql-vulnerability-assessment/pp_main_getstarted.png)

### <a name="3-analyze-the-results-and-resolve-issues"></a>3. 分析結果並解決問題

檢閱您的結果，並判斷報告中的哪些調查結果是環境中真正的安全性問題。 向下鑽研至每個失敗的結果，了解調查結果的影響，以及每個安全性檢查失敗的原因。 使用報告提供的可操作補救資訊來解決問題。

![分析報告](./media/sql-vulnerability-assessment/pp_fail_rule_show_remediation.png)

### <a name="4-set-your-baseline"></a>4. 設定基準

當您檢查評估結果時，您可以將特定結果標示為您環境中可接受的*基準*。 基準本質上就是自訂報告結果的方式。 在後續的掃描中，會將符合基準的結果視為通過。 建立基準安全性狀態之後，弱點評估只會報告偏離基準的情況。 如此一來，您就可以將注意力放在相關的問題上。

![設定基準](./media/sql-vulnerability-assessment/pp_fail_rule_show_baseline.png)

### <a name="5-run-a-new-scan-to-see-your-customized-tracking-report"></a>5. 執行新的掃描，以查看您的自訂追蹤報告

完成設定**規則基準**之後，請執行新的掃描，以查看自訂的報告。 弱點評估現在只會報告偏離您核准基準狀態的安全性問題。

![檢視您的自訂報告](./media/sql-vulnerability-assessment/pp_pass_main_with_baselines.png)

弱點評量現在可用來監視您的資料庫，隨時維護高度安全性並符合組織原則。 如果需要合規性報告，弱點評估報告有助於達成合規性流程。

### <a name="6-set-up-periodic-recurring-scans"></a>6. 設定週期性週期性掃描

移至 [弱點評估] 設定，以開啟**週期性週期性掃描**。 此設定會將弱點評定設為每週自動在您的資料庫上執行掃描。 掃描結果摘要會傳送到您提供的電子郵件地址。

![檢視您的自訂報告](./media/sql-vulnerability-assessment/pp_recurring_scans.png)

### <a name="7-export-an-assessment-report"></a>7. 匯出評量報告

選取 [**匯出掃描結果**] 以建立掃描結果的可下載 Excel 報表。 此報表包含 [摘要] 索引標籤，可顯示評量的摘要。 此報表包含所有失敗的檢查。 它也包含 [**結果**] 索引標籤，其中包含掃描的完整結果集。 結果包括所有已執行的檢查，以及每個的結果詳細資料。

### <a name="8-view-scan-history"></a>8. 查看掃描歷程記錄

在 [弱點評估] 窗格中選取 [**掃描歷程記錄**]，以查看先前在此資料庫上執行之所有掃描的歷程記錄。 選取清單中的特定掃描，以檢視該掃描的詳細結果。

弱點評量現在可用來監視您的資料庫，隨時維護高度安全性並符合組織原則。 如果需要合規性報告，弱點評估報告有助於達成合規性流程。

## <a name="manage-vulnerability-assessments-by-using-azure-powershell"></a>使用 Azure PowerShell 管理弱點評定

[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]
> [!IMPORTANT]
> Azure SQL Database 仍然支援 PowerShell Azure Resource Manager 模組，但所有未來的開發都是針對 Az .Sql 模組。 如需這些 Cmdlet，請參閱[AzureRM](https://docs.microsoft.com/powershell/module/AzureRM.Sql/)。 Az 模組和 AzureRm 模組中命令的引數本質上完全相同。

您可以使用 Azure PowerShell Cmdlet，以程式設計方式管理您的弱點評定。 支援的 Cmdlet 如下：

| Cmdlet 名稱作為連結 | 描述 |
| :-------------------- | :---------- |
| [清除-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | 清除弱點評估規則基準。<br/>首先，請先設定基準，再使用此 Cmdlet 來清除它。 |
| [清除-AzSqlDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentSetting) | 清除資料庫的弱點評估設定。 |
| [轉換-AzSqlDatabaseVulnerabilityAssessmentScan](https://docs.microsoft.com/powershell/module/az.sql/Convert-azSqlDatabaseVulnerabilityAssessmentScan) | 將弱點評定掃描結果轉換成 Excel 檔案。 |
| [AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | 取得指定規則的弱點評估規則基準。 |
| [AzSqlDatabaseVulnerabilityAssessmentScanRecord](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentScanRecord) | 取得與指定資料庫相關聯的所有弱點評估掃描記錄。 |
| [AzSqlDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentSetting) | 傳回資料庫的弱點評定設定。 |
| [設定-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Set-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | 設定弱點評估規則基準。 |
| [開始-AzSqlDatabaseVulnerabilityAssessmentScan](https://docs.microsoft.com/powershell/module/az.sql/Start-azSqlDatabaseVulnerabilityAssessmentScan) | 觸發弱點評估掃描的啟動。 |
| [更新-AzSqlDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Update-azSqlDatabaseVulnerabilityAssessmentSetting) | 更新資料庫的弱點評定設定。 |
| &nbsp; | &nbsp; |

如需指令碼範例，請參閱 [Azure SQL 弱點評定的 PowerShell 支援](https://blogs.msdn.microsoft.com/sqlsecurity/20../../azure-sql-vulnerability-assessment-now-with-powershell-support/)。

## <a name="manage-vulnerability-assessment-baseline-rules-by-using-resource-manager-templates"></a>使用 Resource Manager 範本管理弱點評定基準規則

若要使用 Azure Resource Manager 範本來設定弱點評估基準，請`Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines`使用類型。

在新增基準之前， `vulnerabilityAssessments`請確定您已在執行 SQL Server 的電腦上啟用。

以下範例說明如何將基準規則 VA2065 定義為 masterdb 和 VA1143，以作為 Resource Manager 範本中的資源：

```json
   "resources": [
      {
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/master')]",
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "FirewallRuleName3",
                     "StartIpAddress",
                     "EndIpAddress"
                  ]
               },
               {
                  "result": [
                     "FirewallRuleName4",
                     "62.92.15.68",
                     "62.92.15.68"
                  ]
               }
            ]
         },
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA2130/Default')]",
         "dependsOn": [
            "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
         ],
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "dbo"
                  ]
               }
            ]
         }
      }
   ]
```

對於 master 資料庫和使用者資料庫，資源名稱的定義方式不同：

* Master 資料庫-"name"： "[concat （parameters （' server_name '），'/'，parameters （' database_name '），'/default/VA2065/<b>master</b>'）]"，
* 使用者資料庫-"name"： "[concat （parameters （' server_name '），'/'，parameters （' database_name '），'/default/VA2065/<b>default</b>'）]"，
 
 
 若要將布林類型處理為 true/false，請使用二進位輸入（例如 "1"/"0"）來設定基準結果。
 
```json
   {
      "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
      "apiVersion": "2018-06-01-preview",
      "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA1143/Default')]",

      "dependsOn": [
         "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
      ],

      "properties": {
         "baselineResults": [
            {
               "result": [
                  "1"
               ]
            }
         ]
      }

   }
```

## <a name="next-steps"></a>後續步驟  

- 深入瞭解[Advanced Data Security](sql-database-advanced-data-security.md)。
- 深入瞭解[資料探索與分類](sql-database-data-discovery-and-classification.md)。
