---
title: 在 Azure 監視器中建立具有動態閾值的警示
description: 建立警示，內含以機器學習為基礎的動態閾值
author: yanivlavi
ms.author: yalavi
ms.topic: conceptual
ms.date: 02/16/2020
ms.openlocfilehash: 1d21c7ed93ac2ce2ab61282707d57fbf43e0b71a
ms.sourcegitcommit: 8dc84e8b04390f39a3c11e9b0eaf3264861fcafc
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/13/2020
ms.locfileid: "81261069"
---
# <a name="metric-alerts-with-dynamic-thresholds-in-azure-monitor"></a>Azure 監視器中具有動態閾值的指標警報

「具有動態閾值的計量警示」偵測會利用進階的機器學習 (ML) 來學習計量的歷史行為，以及識別模式和可能表示服務有問題的異常狀況。 它可讓使用者以完全自動化的方式透過 Azure Resource Manager API 設定警示規則，因此對於簡單的 UI 和大規模作業均提供支援。

警示規則建立後，只有在受監視的計量未依預期運作 (依據其專用的閾值) 時，才會引發。

我們很希望聽聽您的意見反應，來信請寄到 <azurealertsfeedback@microsoft.com>。

## <a name="why-and-when-is-using-dynamic-condition-type-recommended"></a>建議使用動態條件類型的原因和時機為何？

1. **可擴展警報**– 動態閾值警報規則可以一次為數百個指標系列創建量身定製的閾值,同時提供在單個指標上定義警報規則的同樣容易性。 它們可為您提供更少的警報來創建和管理。 可以使用 Azure 門戶或 Azure 資源管理器 API 來創建它們。 在處理指標維度或應用於多個資源(如所有訂閱資源)時,可擴展方法特別有用。  [深入了解如何使用範本設定具有動態閾值的計量警示](alerts-metric-create-templates.md)。

1. **智慧指標模式識別**– 使用我們的 ML 技術,我們能夠自動檢測指標模式並適應指標隨時間的變化,這通常包括季節性(每小時/每天/每周)。 適應指標隨時間而過的行為,並根據偏離其模式的警報減輕了瞭解每個指標的"正確"閾值的負擔。 動態閾值中使用的 ML 演算法可防止不具備預期模式的雜訊 (低精確度) 或廣泛 (低召回率) 閾值。

1. **直觀配置**– 動態閾值允許使用高級概念設置指標警報,從而減輕了對指標有廣泛域知識的需求。

## <a name="how-to-configure-alerts-rules-with-dynamic-thresholds"></a>如何設定具有動態閾值的警示規則？

具有動態閾值的警示可透過 Azure 監視器中的計量警示來設定。 [深入了解如何設定計量警示](alerts-metric.md)。

## <a name="how-are-the-thresholds-calculated"></a>閾值的計算方式為何？

「動態閾值」會持續學習計量序列的資料，並嘗試使用一組演算法和方法來建立其模型。 它會偵測資料中的模式 (例如每小時/每天/每週之類的季節性)，並且能夠處理雜訊計量 (例如電腦 CPU 或記憶體) 以及具有低離散程度的計量 (例如可用性和錯誤率)。

選取閾值的方式，是偏離這些閾值的程度必須表示計量行為出現異常。

> [!NOTE]
> 季節性模式檢測設置為小時、天或周間隔。 這意味著其他模式(如兩小時模式或半週一次)可能無法檢測到。

## <a name="what-does-sensitivity-setting-in-dynamic-thresholds-mean"></a>動態閾值中的「敏感度」設定有何意義？

警示閾值敏感度是一項基本概念，可控制須偏離計量行為達何種程度才會觸發警示。
此選項不像靜態閾值那麼需要計量領域相關知識。 可用的選項如下︰

- 高 – 閾值會嚴格且接近計量序列模式。 警報規則將在最小的偏差時觸發,從而導致更多的警報。
- 中 – 較不嚴格而較為中庸的閾值，產生的警示會比高敏感度少 (預設值)。
- 低 – 閾值會寬鬆且偏離計量序列模式較遠。 警報規則只會觸發大偏差,從而導致警報更少。

## <a name="what-are-the-operator-setting-options-in-dynamic-thresholds"></a>動態閾值中有哪些「運算子」設定選項？

動態閾值警示規則可根據計量行為，針對使用相同警示規則的上限和下限建立自訂的閾值。
您可以選擇在符合下列三個條件之一時觸發警示：

- 大於閾值上限或低於閾值下限 (預設值)
- 大於閾值上限
- 低於閾值下限。

## <a name="what-do-the-advanced-settings-in-dynamic-thresholds-mean"></a>動態閾值中的進階設定有何意義？

**故障期間**- 動態閾值還允許您配置"觸發警報的數量衝突",即系統在一定時間範圍內提高警報所需的最小偏差數(默認時間視窗為 20 分鐘內的四個偏差)。 使用者可以設定失敗期間，並藉由變更失敗期間和時間範圍來選擇要警示的標的。 這項功能可減少暫時性尖峰所產生的警示雜訊。 例如：

若要在問題持續 20 分鐘、在 5 分鐘的指定期間分組內連續發生 4 次時觸發警示，請使用下列設定：

![問題持續 20 分鐘、在 5 分鐘的指定期間分組內連續發生 4 次的失敗期間設定](media/alerts-dynamic-thresholds/0008.png)

若要以 5 分鐘為期間，在過去 30 分鐘內有 20 分鐘發生違反動態閾值的情況時觸發警示，請使用下列設定：

![以 5 分鐘為期間分組，在過去 30 分鐘內有 20 分鐘發生問題的失敗期間設定](media/alerts-dynamic-thresholds/0009.png)

**忽略資料 (以下時間之前)** - 使用者也可以選擇性地定義系統應開始計算閾值的開始日期。 如果資源先前執行於測試模式中，而現已升級供生產工作負載之用，因此應忽略任何計量在測試階段的行為，就可能會發生常見的使用案例。

## <a name="how-do-you-find-out-why-a-dynamic-thresholds-alert-was-triggered"></a>如何找出觸發動態閾值警報的原因?

您可以通過按一下電子郵件或文本訊息中的連結或瀏覽器查看 Azure 入口中的警報檢視,瀏覽警報檢視中觸發的警報實例。 [瞭解有關警報檢視的更多](alerts-overview.md#alerts-experience)。

警示檢視顯示:

- 觸發動態閾值警報時的所有指標詳細資訊。
- 觸發警報的時間段的圖表,包括該時間點使用的動態閾值。
- 能夠提供有關動態閾值警報和警報視圖體驗的反饋,從而改進未來的檢測。

## <a name="will-slow-behavior-changes-in-the-metric-trigger-an-alert"></a>指標中的緩慢行為更改是否會觸發警報?

大概沒有。 動態閾值適合用於偵測明顯的偏差，而不是緩慢發展的問題。

## <a name="how-much-data-is-used-to-preview-and-then-calculate-thresholds"></a>會有多少資料用來預覽並計算閾值？

首次創建警報規則時,圖表中顯示的閾值將基於足夠的歷史數據計算,以計算小時或每日季節模式(10天)。 創建警報規則后,動態閾值將使用所有可用的所需歷史數據,並將根據新數據不斷學習和調整,以使閾值更準確。 這意味著,在此計算后,圖表還將顯示每周模式。

## <a name="how-much-data-is-needed-to-trigger-an-alert"></a>觸發警報需要多少數據?

如果您有新資源或缺少指標數據,動態閾值不會在三天之前觸發警報,並且至少有 30 個指標數據樣本可用,以確保閾值準確。
對於具有足夠指標數據的現有資源,動態閾值可以立即觸發警報。

## <a name="dynamic-thresholds-best-practices"></a>動態閾值最佳做法

「動態閾值」可以套用至任何平台或「Azure 監視器」中的自訂計量，而且它也已針對常見的應用程式和基礎結構計量進行過調整。
下列項目是有關如何使用「動態閾值」來設定這其中一些計量相關警示的最佳做法。

### <a name="dynamic-thresholds-on-virtual-machine-cpu-percentage-metrics"></a>虛擬機器 CPU 百分比計量的相關動態閾值

1. 在[Azure 門戶](https://portal.azure.com)中,按下**監視器**。 [監視] 檢視會將您的所有監視設定與資料合併在一個檢視中。

2. 按一下 [警示]****，然後按一下 [+ 新增警示規則]****。

    > [!TIP]
    > 大部分的資源刀鋒視窗也都有 [警示]**** (位於 [監視]**** 下的資源功能表)，您也可以從該處建立警示。

3. 在載入的內容窗格中，按一下 [選取目標]****，選取您要發出警示的目標資源。 請使用 [訂用帳戶]**** 與 ['虛擬機器' 資源類型]**** 下拉式清單來尋找您想要監視的資源。 您也可以使用搜尋列來尋找您的資源。

4. 選取目標資源之後，請按一下 [新增準則]****。

5. 選取 [CPU 百分比]****。

6. (選擇性) 藉由調整 [期限]**** 和 [彙總]**** 來精簡計量。 針對此計量類型，不建議使用 [最大值] 彙總類型，因為它比較無法代表行為。 就 [最大值] 彙總類型而言，靜態閾值可能較為適當。

7. 您會看到過去 6 小時的計量圖表。 定義警示參數：
    1. **條件類型** - 選擇 [動態] 選項。
    1. **敏感度** - 選擇 [中]/[低] 敏感度以減少警示干擾。
    1. **運算子** - 除非行為代表應用程式使用量，否則請選擇 [大於]。
    1. **頻率** - 請考慮根據警示的業務影響降低頻率。
    1. **失敗期間** (進階選項) - 回顧時間範圍應該至少為 15 分鐘。 例如，如果期間設定為 5 分鐘，則失敗期間應該至少為 3 個以上。

8. 計量圖表會顯示以最近資料為基礎的計算臨界值。

9. 按一下 [完成]****。

10. 填寫 [警示詳細資料]****，例如 [警示規則名稱]****、[描述]**** 及 [嚴重性]****。

11. 透過選取現有動作群組或建立新的動作群組，將動作群組新增至警示。

12. 按一下 [完成]**** 以儲存計量警示規則。

> [!NOTE]
> 透過入口網站建立的計量警示規則，會在與目標資源相同的資源群組中建立。

### <a name="dynamic-thresholds-on-application-insights-http-request-execution-time"></a>Application Insights HTTP 要求執行時間的相關動態閾值

1. 在[Azure 門戶](https://portal.azure.com)中,按下**監視器**。 [監視] 檢視會將您的所有監視設定與資料合併在一個檢視中。

2. 按一下 [警示]****，然後按一下 [+ 新增警示規則]****。

    > [!TIP]
    > 大部分的資源刀鋒視窗也都有 [警示]**** (位於 [監視]**** 下的資源功能表)，您也可以從該處建立警示。

3. 在載入的內容窗格中，按一下 [選取目標]****，選取您要發出警示的目標資源。 使用 [訂用帳戶]**** 和 ['Application Insights' 資源類型]**** 下拉式清單來尋找您想要監視的資源。 您也可以使用搜尋列來尋找您的資源。

4. 選取目標資源之後，請按一下 [新增準則]****。

5. 選取 [HTTP 要求執行時間]****。

6. (選擇性) 藉由調整 [期限]**** 和 [彙總]**** 來精簡計量。 針對此計量類型，不建議使用 [最大值] 彙總類型，因為它比較無法代表行為。 就 [最大值] 彙總類型而言，靜態閾值可能較為適當。

7. 您會看到過去 6 小時的計量圖表。 定義警示參數：
    1. **條件類型** - 選擇 [動態] 選項。
    1. **運算子** - 選擇 [大於] 以減少在持續期間內針對改善而引發的警示。
    1. **頻率** - 請考慮根據警示的業務影響降低頻率。

8. 計量圖表會顯示以最近資料為基礎的計算臨界值。

9. 按一下 [完成]****。

10. 填寫 [警示詳細資料]****，例如 [警示規則名稱]****、[描述]**** 及 [嚴重性]****。

11. 透過選取現有動作群組或建立新的動作群組，將動作群組新增至警示。

12. 按一下 [完成]**** 以儲存計量警示規則。

> [!NOTE]
> 透過入口網站建立的計量警示規則，會在與目標資源相同的資源群組中建立。

## <a name="interpreting-dynamic-threshold-charts"></a>解釋動態閾值圖表

下面是一個圖表,顯示指標、其動態閾值限制,以及當值超出允許閾值時觸發的某些警報。

![瞭解有關如何設定指標警報的更多](media/alerts-dynamic-thresholds/threshold-picture-8bit.png)

使用以下信息解釋上一個圖表。

- **藍線**- 隨時間而測量的實際指標。
- **藍色陰影區域**- 顯示指標的允許範圍。 只要指標值保持在此範圍內,將不會發生警報。
- **藍點**- 如果向左單擊圖表的一部分,然後懸停在藍線上,則會在游標下方顯示一個藍點,顯示單個聚合指標值。
- **帶藍點的彈出視窗**- 顯示測量的指標值(藍點)以及允許範圍的上限和下部值。  
- **帶黑色圓圈的紅點**- 顯示允許範圍外的第一個指標值。 這是觸發指標警報並將其置於活動狀態的值。
- **紅點**- 指示超出允許範圍的其他測量值。 他們不會觸發其他指標警報,但警報將保持在活動狀態。
- **紅色區域**- 顯示指標值超出允許範圍的時間。 只要後續測量值超過允許的範圍,但未觸發任何新警報,警報將保持活動狀態。
- **紅色區域的末端**- 當藍線回到允許的值內時,紅色區域將停止,測量值線變為藍色。 設置為解析紅點時觸發的指標警報的狀態,並帶有黑色輪廓。 
