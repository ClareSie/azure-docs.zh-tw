---
title: 資料備援
titleSuffix: Azure Storage
description: 系統會 複製Microsoft Azure 儲存體帳戶中的資料，以維持持久性和高可用性。 冗餘配置包括本地冗餘存儲 (LRS)、區域冗餘存儲 (ZRS)、異地冗餘存儲 (GRS)、讀取存取異地冗餘存儲 (RA-GRS)、地理區域冗餘存儲 (GZRS) (預覽)和讀取存取地理區域冗餘存儲 (RA-GZRS)(預覽)。
services: storage
author: tamram
ms.service: storage
ms.topic: conceptual
ms.date: 02/25/2020
ms.author: tamram
ms.reviewer: artek
ms.subservice: common
ms.openlocfilehash: 78f7c935e64276e7f4862dad966b99bff6bd246d
ms.sourcegitcommit: b55d7c87dc645d8e5eb1e8f05f5afa38d7574846
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/16/2020
ms.locfileid: "81481947"
---
# <a name="azure-storage-redundancy"></a>Azure 儲存體備援

Azure 儲存始終存儲數據的多個副本,以便防止其免受計劃內和計劃外事件的影響,包括暫態硬體故障、網路或斷電以及大規模自然災害。 冗餘可確保儲存帳戶符合 Azure[儲存的服務級別協定 (SLA),](https://azure.microsoft.com/support/legal/sla/storage/)即使在發生故障時也是如此。

在決定哪種冗餘選項最適合您的方案時,請考慮降低成本和更高的可用性和耐用性之間的權衡。 幫助確定應選擇哪些冗餘選項的因素包括:  

- 如何複製在主區複製資料
- 您的資料是否複製到地理位置與主要區域距離的第二個位置,以防止區域災難
- 如果主區域因任何原因不可用,應用程式是否需要對輔助區域中的複製資料的讀取存取

## <a name="redundancy-in-the-primary-region"></a>主要區域的冗餘

Azure 儲存帳戶中的數據始終在主區域中複製三次。 Azure 儲存提供兩個選項,用於在主區中複製資料的方式:

- **本地冗餘儲存 (LRS)** 在主區域的單個實體位置同步複製數據三次。 LRS 是最便宜的複製選項,但不建議對於需要高可用性的應用程式。
- **區域冗餘儲存 (ZRS)** 在主區域中的三個 Azure 可用性區域同步複製數據。 對於需要高可用性的應用程式,Microsoft 建議在主區域中使用 ZRS,並複製到輔助區域。

### <a name="locally-redundant-storage"></a>本地備援儲存體

本地冗餘儲存 (LRS) 在主區域的單個實體位置內複製數據三次。 LRS 在給定年份中至少提供99.99999999%(11 9s)的物體耐久性。

LRS 是成本最低的冗餘選項,與其他選項相比,其耐用性最低。 LRS 可保護您的數據免受伺服器機架和驅動器故障的影響。 但是,如果資料中心內發生火災或洪水等災難,則使用 LRS 的存儲帳戶的所有副本可能丟失或無法恢復。 為了降低此風險,Microsoft 建議使用[區域冗餘存儲](#zone-redundant-storage)(ZRS)、[異地冗餘存儲](#geo-redundant-storage)(GRS) 或[地理區域冗餘存儲 (預覽)(GZRS)。](#geo-zone-redundant-storage-preview)

對使用 LRS 的儲存帳戶的寫入請求同步發生。 寫入操作僅在將數據寫入所有三個副本后才能成功返回。

LRS 是以下機制的最佳選擇:

- 如果您的應用程式儲存的資料，可在發生資料遺失時輕鬆重新建構，則您可以選擇使用 LRS。
- 如果應用程式由於數據治理要求而僅限於在國家或地區複製數據,則可以選擇 LRS。 在某些情況下,數據進行地理複製的配對區域可能位於另一個國家或地區。 如需配對區域的詳細資訊，請參閱 [Azure 區域](https://azure.microsoft.com/regions/)。

### <a name="zone-redundant-storage"></a>區域備援儲存體

區域冗餘儲存 (ZRS) 在主區域中的三個 Azure 可用性區域同步複製 Azure 儲存資料。 每個可用性區域都是一個獨立的物理位置,具有獨立的電源、冷卻和網路。 ZRS 為 Azure 儲存數據物件提供的持久性在給定年份中至少為 99.999999999%(12 9)。

使用 ZRS,即使區域不可用,讀取和寫入操作仍可存取您的資料。 如果區域不可用,Azure 將進行網路更新,如 DNS 重新指向。 如果在更新完成之前訪問數據,這些更新可能會影響應用程式。 在為 ZRS 設計應用程式時,請遵循瞬態故障處理實踐,包括使用指數回退實現重試策略。

對使用 ZRS 的儲存帳戶的寫入請求同步發生。 寫入操作僅在將數據寫入三個可用性區域中的所有副本后才能成功返回。

Microsoft 建議在主區域中使用 ZRS,以便進行需要一致性、耐用性和高可用性的方案。 如果數據暫時不可用,ZRS可為數據提供出色的性能、低延遲和彈性。 但是,ZRS 本身可能無法保護數據免受區域災難的影響,因為區域區域受到永久影響。 為了防禦區域災難,Microsoft 建議使用[地理區域冗餘存儲](#geo-zone-redundant-storage-preview)(GZRS),該存儲在主區域中使用 ZRS,並將資料異地複製到輔助區域。

下表顯示了哪些類型的儲存帳戶支援 ZRS,其中區域:

|    儲存體帳戶類型    |    支援區域    |    支援的服務    |
|----------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------|
|    通用 v2<sup>1</sup>    | 東南亞<br /> 澳大利亞東部<br /> 北歐<br />  西歐<br /> 法國中部<br /> 日本東部<br /> 南非北部<br /> 英國南部<br /> 美國中部<br /> 美國東部<br /> 美國東部 2<br /> 美國西部 2    |    區塊 Blob<br /> 頁面 blob<sup>2</sup><br /> 檔案共享(標準)<br /> 資料表<br /> 佇列<br /> |
|    區塊<sup>1</sup>    | 西歐<br /> 美國東部    |    僅限區塊 Blob    |
|    檔案儲存    | 西歐<br /> 美國東部    |    只是 Azure 檔案    |

<sup>1</sup> ZRS 帳戶當前不支援存檔層。<br />
<sup>2</sup>包含虛擬機 Azure 託管磁碟的儲存帳戶始終使用 LRS。 Azure 非託管磁碟也應使用 LRS。 可以為使用 GRS 的 Azure 非託管磁碟創建存儲帳戶,但由於異步異地複製可能存在一致性問題,因此不建議這樣做。 託管磁碟和非託管磁碟都不支援 ZRS 或 GZRS。 有關託管磁碟的詳細資訊,請參閱 Azure[託管磁碟的定價](https://azure.microsoft.com/pricing/details/managed-disks/)。

有關哪些區域支援 ZRS 的資訊,請參閱[Azure 可用性區域中的](../../availability-zones/az-overview.md)**按區域提供的服務支援**?

## <a name="redundancy-in-a-secondary-region"></a>次要區域的冗餘

對於需要高可用性的應用程式,您可以選擇將存儲帳戶中的數據另一步複製到距離主區域數百英里的輔助區域。 如果存儲帳戶被複製到輔助區域,則即使出現完全的區域中斷或主區域無法恢復的災難,您的數據也是持久的。

建立儲存體帳戶時，您可以為帳戶選取主要區域。 配對的次要區域會視主要區域而定，且無法變更。 有關 Azure 支援的區域的詳細資訊,請參閱[Azure 區域](https://azure.microsoft.com/global-infrastructure/regions/)。

Azure 儲存提供兩種資料複製到輔助區域的選項:

- 使用 LRS 在主區域的單個物理位置同步複製數據三次的**異地冗餘存儲 (GRS)。** 然後,它會非同步將資料複製到輔助區域中的單個物理位置。
- 使用 ZRS 在主區域的三個 Azure 可用性區域同步複製資料地理**區域冗餘儲存 (GZRS)** (預覽)。 然後,它會非同步將資料複製到輔助區域中的單個物理位置。

GRS 和 GZRS 之間的主要區別是如何在主區域中複製數據。 在輔助位置內,數據始終使用 LRS 同步複製三次。

使用 GRS 或 GZRS 時,輔助位置中的數據不能用於讀取或寫入訪問,除非對輔助區域進行故障轉移。 對於對輔助位置的讀取訪問,請將儲存帳戶配置為使用讀取存取異地冗餘存儲 (RA-GRS) 或讀取存取地理區域冗餘存儲 (RA-GZRS)。 有關詳細資訊,請參閱[讀取對輔助區域中的資料的存取](#read-access-to-data-in-the-secondary-region)。

如果主區域不可用,您可以選擇故障轉移到輔助區域(預覽)。 容錯移至後,輔助區域將成為主區域,您可以再次讀取和寫入資料。 有關災難恢復的詳細資訊以及如何故障轉移到輔助區域,請參閱[災難恢復和帳戶故障轉移(預覽)。](storage-disaster-recovery-guidance.md)

> [!IMPORTANT]
> 由於數據以異步方式複製到輔助區域,因此如果無法恢復主區域,則影響主區域的故障可能會導致數據丟失。 最近寫入主區域與最後寫入輔助區域之間的間隔稱為恢復點目標 (RPO)。 RPO 表示可復原資料的時間點。 Azure 儲存的 RPO 通常少於 15 分鐘,儘管當前沒有 SLA 用於將數據複製到輔助區域所需的時間。

### <a name="geo-redundant-storage"></a>異地備援儲存體

使用 LRS 在主區域的單個物理位置同步複製數據三次的異地冗餘存儲 (GRS)。 然後,它會非同步將資料複製到距離主區域數百英里的輔助區域中的單個物理位置。 GRS 為 Azure 存儲數據物件提供的持久性至少為 99.999999999999999999999999999999%的給定年份。

寫入操作首先提交到主位置並使用 LRS 進行複製。 然後,更新非同步複製到輔助區域。 當資料寫入次要位置時，也會使用 LRS 在該位置中複寫。

### <a name="geo-zone-redundant-storage-preview"></a>地理區域冗餘記憶體(預覽)

地理區域冗餘存儲 (GZRS) (預覽)將跨可用性區域的冗餘提供的高可用性與異地複製提供的區域中斷保護相結合。 GZRS 儲存帳戶中的數據在主區域的三個[Azure 可用性區域](../../availability-zones/az-overview.md)中複製,並且也會複製到輔助地理區域,以防止區域災難。 Microsoft 建議對需要最大一致性、耐用性和可用性、卓越性能和災難恢復恢復能力的應用程式使用 GZRS。

使用 GZRS 儲存帳戶,如果可用性區域不可用或無法恢復,則可以繼續讀取和寫入數據。 此外,如果出現完全的區域中斷或主區域無法恢復的災難,您的數據也是持久的。 GZRS 旨在提供至少99.999999999999999%的物體在給定年份的耐久性。

只有通用 v2 儲存帳戶支援 GZRS 和 RA-GZRS。 如需有關儲存體帳戶類型的詳細資訊，請參閱 [Azure 儲存體帳戶概觀](storage-account-overview.md)。 GZRS 和 RA-GZRS 支援塊 blob、頁面 blob(VHD 磁碟除外)、檔案、表和佇列。

GZRS 和 RA-GZRS 目前可用於以下區域的預覽:

- 東南亞
- 北歐
- 西歐
- 日本東部
- 英國南部
- 美國東部
- 美國東部 2
- 美國中部
- 美國西部 2

Microsoft 繼續在其他 Azure 區域中啟用 GZRS 和 RA-GZRS。 定期查看[Azure 服務更新](https://azure.microsoft.com/updates/)頁,瞭解有關受支援區域的資訊。

有關預覽定價的資訊,請參閱[Blob、](https://azure.microsoft.com/pricing/details/storage/blobs)[檔](https://azure.microsoft.com/pricing/details/storage/files/)、[佇列](https://azure.microsoft.com/pricing/details/storage/queues/)和[表](https://azure.microsoft.com/pricing/details/storage/tables/)的 GZRS 預覽定價。

> [!IMPORTANT]
> Microsoft 建議不要對生產工作負載使用預覽功能。

## <a name="read-access-to-data-in-the-secondary-region"></a>讀取對輔助區域中的資料存取

異地冗餘儲存(使用 GRS 或 GZRS)將資料複製到輔助區域中的另一個物理位置,以防止區域中斷。 但是,僅當客戶或Microsoft從主區域啟動故障轉移時,才能讀取該數據。 啟用對輔助區域的讀取訪問時,如果主區域不可用,您的數據可供讀取。 對於對輔助區域的讀取訪問,啟用讀取訪問異地冗餘存儲 (RA-GRS) 或讀取存取地理區域冗餘存儲 (RA-GZRS)。

### <a name="design-your-applications-for-read-access-to-the-secondary"></a>設計應用程式以讀取對輔助資料庫的存取

如果您的存儲帳戶配置為對輔助區域的讀取訪問,則可以設計應用程式,以無縫地切換到從輔助區域讀取數據(如果主區域因任何原因不可用)。 輔助區域始終可用於讀取訪問,因此您可以測試應用程式,以確保在發生故障時從輔助區域讀取該應用程式。 有關如何為高可用性設計應用程式的詳細資訊,請參閱[使用讀取存取異地冗餘儲存設計高可用性應用程式](storage-designing-ha-apps-with-ragrs.md)。

啟用對輔助端的讀取訪問后,可以從輔助終結點以及存儲帳戶的主終結點讀取數據。 輔助終結點將後綴 *— 輔助*終結點追加到帳戶名稱。 例如,如果 Blob 儲存的主終結`myaccount.blob.core.windows.net`點為 ,則輔助`myaccount-secondary.blob.core.windows.net`終結點為 。 對於主終結點和輔助終結點,存儲帳戶的帳戶訪問密鑰相同。

### <a name="check-the-last-sync-time-property"></a>檢查上次同步時間屬性

由於數據以異步方式複製到輔助區域,因此輔助區域通常位於主區域後面。 如果主區域發生故障,則很可能尚未將所有寫入主項的寫入都複製到輔助區域。

要確定哪些寫入操作已複製到輔助區域,應用程式可以檢查存儲帳戶**的「上次同步時間」** 屬性。 在上次同步時間之前寫入主區域的所有寫入操作已成功複製到輔助區域,這意味著可從輔助區域讀取它們。 在上次同步時間之後寫入主區域的任何寫入操作可能已複製到輔助區域,也可能未複製到輔助區域,這意味著它們可能不適用於讀取操作。

可以使用 Azure PowerShell、Azure CLI 或其中一個 Azure 儲存用戶端庫查詢 **「上次同步時間」** 屬性的值。 **"上次同步時間"** 屬性是 GMT 日期/時間值。 有關詳細資訊,請參閱[檢視儲存帳戶的最後同步時間屬性](last-sync-time-get.md)。

## <a name="summary-of-redundancy-options"></a>冗餘選項摘要

下表顯示了資料在給定方案中的持久性和可用程度,具體取決於存儲帳戶有效的冗餘類型:

| 狀況                                                                                                 | LRS                             | ZRS                              | GRS/RA-GRS                                  | GZRS/RA-GZRS(預覽版)                              |
| :------------------------------------------------------------------------------------------------------- | :------------------------------ | :------------------------------- | :----------------------------------- | :----------------------------------- |
| 資料中心內的節點無法使用                                                                 | 是                             | 是                              | 是                                  | 是                                  |
| 整個資料中心 (區域或非區域) 變成無法供使用                                           | 否                              | 是                              | 是                                  | 是                                  |
| 發生區域範圍的中斷                                                                                     | 否                              | 否                               | 是                                  | 是                                  |
| 如果主區域不可用,則讀取對輔助區域中的訪問 | 否                              | 否                               | 是(使用 RA-GRS)                                   | 是(使用 RA-GZRS)                                 |
| 給定年份<sup>1</sup>中物件的持久性百分比                                          | 至少 99.999999999% (11 個 9) | 至少 99.9999999999% (12 個 9) | 至少 99.99999999999999% (16 個 9) | 至少 99.99999999999999% (16 個 9) |
| 受支援的儲存帳戶類型<sup>2</sup>                                                                   | GPv2, GPv1, 區塊, Blob 儲存, 檔案儲存                | GPv2,區塊執行,檔案儲存                             | GPv2,GPv1,Blob 儲存                     | GPv2                     |
| 讀取要求的可用性 SLA<sup>1</sup>  | 至少 99.9% (非經常性存取層為 99%) | 至少 99.9% (非經常性存取層為 99%) | GRS 至少 99.9% (99% 表示冷存取層)<br /><br />RA-GRS 至少 99.99%(冷存取層為 99.9%) | GZRS 至少 99.9% (99% 表示冷存取層)<br /><br />RA-GZRS 至少 99.99%(冷存取層為 99.9%) |
| 寫入要求的可用性 SLA<sup>1</sup>  | 至少 99.9% (非經常性存取層為 99%) | 至少 99.9% (非經常性存取層為 99%) | 至少 99.9% (非經常性存取層為 99%) | 至少 99.9% (非經常性存取層為 99%) |

<sup>1</sup>有關 Azure 儲存保證的持久性和可用的資訊,請參閱[Azure 儲存 SLA](https://azure.microsoft.com/support/legal/sla/storage/)。

<sup>2</sup>有關儲存帳戶類型的資訊,請參閱[儲存帳戶概述](storage-account-overview.md)。

根據存儲帳戶的冗餘選項複製所有類型的存儲帳戶[和所有層(包括存檔)](../blobs/storage-blob-storage-tiers.md)的所有數據。 將複製物件,包括塊 Blob、追加 Blob、頁面 Blob、佇列、表和檔。

有關每個冗餘選項的定價資訊,請參閱[Azure 儲存定價](https://azure.microsoft.com/pricing/details/storage/)。

> [!NOTE]
> Azure 進階磁碟儲存目前僅支援本地冗餘儲存 (LRS)。 塊 Blob 儲存帳戶支援特定區域的本地冗餘存儲 (LRS) 和區域冗餘存儲 (ZRS)。

## <a name="data-integrity"></a>資料完整性

Azure 儲存定期驗證使用循環冗餘檢查 (CRC) 儲存的資料的完整性。 如果檢測到數據損壞,則使用冗餘數據進行修復。 Azure 儲存還計算所有網路流量上的校驗和,以檢測存儲或檢索數據時數據包的損壞。

## <a name="see-also"></a>另請參閱

- [檢查儲存帳戶的「上次同步時間」屬性](last-sync-time-get.md)
- [變更儲存帳戶的冗餘選項](redundancy-migration.md)
- [使用 RA-GRS 儲存設計高可用應用程式](../storage-designing-ha-apps-with-ragrs.md)
- [災害復原和帳戶故障轉移(預覽)](storage-disaster-recovery-guidance.md)
