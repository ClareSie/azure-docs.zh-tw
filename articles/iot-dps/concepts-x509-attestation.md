---
title: Azure IoT 中樞裝置布建服務-x.509 憑證證明
description: 說明使用 x.509 憑證證明搭配裝置布建服務 (DPS) 和 IoT 中樞的特定概念
author: wesmc7777
ms.author: wesmc
ms.date: 09/14/2020
ms.topic: conceptual
ms.service: iot-dps
services: iot-dps
ms.openlocfilehash: 911f819343f675ebe0a2604d912e6e26aa646eb5
ms.sourcegitcommit: 03662d76a816e98cfc85462cbe9705f6890ed638
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/15/2020
ms.locfileid: "90533037"
---
# <a name="x509-certificate-attestation"></a>X.509 憑證證明

本文概述使用 x.509 憑證證明布建裝置時所牽涉到的概念。 本文與為裝置進行部署準備工作的所有角色相關。

X.509 憑證可以存放在硬體安全性模組 HSM 中。

> [!TIP]
> 強烈建議您在生產環境中的裝置上，使用 HSM 搭配裝置安全地儲存秘密，例如 x.509 憑證。


## <a name="x509-certificates"></a>X.509 憑證

使用 X.509 憑證作為證明機制是調整生產環境並簡化裝置佈建的絕佳方式。 X.509 憑證通常會排列在信任鏈結中，其中每個憑證是由下一個較高憑證的私密金鑰簽署，依此類推，於自我簽署的根憑證終止。 這種方式會從受信任根憑證授權單位 (CA) 產生的根憑證，透過每個中繼 CA 將委派的信任鏈結建立至裝置上安裝之終端實體「分葉」憑證。 若要深入了解，請參閱[使用 X.509 CA 憑證進行裝置驗證](/azure/iot-hub/iot-hub-x509ca-overview)。 

通常憑證鏈結代表與裝置相關聯的某些邏輯或實體階層。 例如，製造商可能：
- 發出自我簽署根 CA 憑證
- 使用根憑證來產生每個處理站的唯一中繼 CA 憑證
- 使用每個處理站的憑證來產生工廠中每個生產線的唯一中繼 CA 憑證
- 最後使用生產線憑證來產生該生產線上所製造之每個裝置的唯一裝置 (終端實體) 憑證。 

若要深入了解，請參閱[概念性了解 IoT 產業中的 X.509 CA 憑證](/azure/iot-hub/iot-hub-x509ca-concept)。 

### <a name="root-certificate"></a>根憑證

根憑證是自我簽署 X.509 憑證，代表憑證授權單位 (CA)。 它是憑證鏈結的終點或信任錨點。 根憑證可以由組織自我發行，或是向根憑證授權單位購買。 若要深入了解，請參閱[取得 X.509 CA 憑證](/azure/iot-hub/iot-hub-security-x509-get-started#get-x509-ca-certificates)。 根憑證也可以稱為根 CA 憑證。

### <a name="intermediate-certificate"></a>中繼憑證

中繼憑證是根憑證 (或其鏈結中具有根憑證的另一個中繼憑證) 簽署的一種 X.509 憑證。 鏈結中的最後一個中繼憑證會用來簽署分葉憑證。 中繼憑證也可以稱為中繼 CA 憑證。

### <a name="end-entity-leaf-certificate"></a>終端實體「分葉」憑證

分葉憑證 (或終端實體憑證) 會識別憑證持有者。 它在其憑證鏈結中有根憑證，以及零或多個中繼憑證。 分葉憑證無法用來簽署其他任何憑證。 它會唯一識別裝置來佈建服務，且有時稱為裝置憑證。 在驗證期間，裝置會使用與此憑證相關聯的私密金鑰，回應以證明來自服務的持有挑戰。

與 [個別註冊](./concepts-service.md#individual-enrollment) 專案搭配使用的分葉憑證，需要 **主體名稱** 必須設定為個別註冊專案的註冊識別碼。 搭配 [註冊群組](./concepts-service.md#enrollment-group) 專案使用的分葉憑證應該將 [ **主體名稱** ] 設為所需的裝置識別碼，並顯示在註冊群組中已驗證裝置的 **註冊記錄** 中。

若要深入了解，請參閱[驗證以 X.509 CA 憑證簽署的裝置](/azure/iot-hub/iot-hub-x509ca-overview#authenticating-devices-signed-with-x509-ca-certificates)。

## <a name="controlling-device-access-to-the-provisioning-service-with-x509-certificates"></a>使用 X.509 憑證控制對於佈建服務的裝置存取

佈建服務會公開兩種類型的註冊項目，您可以用來控制對於使用 X.509 證明機制之裝置的存取：  

- [個別註冊](./concepts-service.md#individual-enrollment)項目是以與特定裝置相關聯的裝置憑證來設定的。 這些項目會控制特定裝置的註冊。
- [註冊群組](./concepts-service.md#enrollment-group)項目是與特定的中繼或根 CA 憑證相關聯的。 這些項目會控制所有裝置的註冊，這些裝置在其憑證鏈結中具有中繼或根憑證。 

當裝置連線到佈建服務時，服務會給予更特定註冊項目比起較不特定註冊項目更高的優先順序。 也就是說，如果有裝置的個別註冊存在，佈建服務會套用該項目。 如果沒有裝置的任何個別註冊，且裝置的憑證鏈結中有第一個中繼憑證的註冊群組存在，則服務會套用該項目，依此類推到根目錄鏈結。 服務會套用它所找到的第一個適用項目，例如：

- 如果找到的第一個註冊項目已啟用，則服務會佈建裝置。
- 如果找到的第一個註冊項目已停用，則服務不會佈建裝置。  
- 如果在裝置的憑證鏈結中找不到任何憑證的註冊項目，則服務不會佈建裝置。 

這項機制和憑證鏈結的階層式結構提供功能強大具彈性的方式，讓您可以控制個別裝置以及裝置群組的存取。 例如，假設有五個裝置具有下列憑證鏈結： 

- 裝置 1**：根憑證 -> 憑證 A -> 裝置 1 憑證
- 裝置 2**：根憑證 -> 憑證 A -> 裝置 2 憑證
- 裝置 3**：根憑證 -> 憑證 A -> 裝置 3 憑證
- 裝置 4**：根憑證 -> 憑證 B -> 裝置 4 憑證
- 裝置 5**：根憑證 -> 憑證 B -> 裝置 5 憑證

一開始，您可以為根憑證建立單一已啟用群組註冊項目，以啟用所有五個裝置的存取。 如果憑證 B 稍後洩露，您可以為憑證 B 建立已停用註冊群組項目，以防止裝置 4** 和裝置 5** 註冊。 如果稍後裝置 3** 也遭到入侵，您可以針對其憑證建立已停用個別註冊項目。 這樣會撤銷裝置 3** 的存取權，但是仍然允許裝置 1** 和裝置 2** 註冊。