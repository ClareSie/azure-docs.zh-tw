---
title: 針對 Azure 檔案共用備份進行移難排解
description: 本文說明如何排解您在保護 Azure 檔案共用時所發生的問題。
ms.date: 08/20/2019
ms.topic: troubleshooting
ms.openlocfilehash: 050df5b96c265e468346535ff011e1baf7d86ad5
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/28/2020
ms.locfileid: "79252385"
---
# <a name="troubleshoot-problems-backing-up-azure-file-shares"></a>針對備份 Azure 檔案共用的問題進行疑難排解

您可以使用下列表格中所列的資訊，針對使用 Azure 檔案共用備份時所發生的問題和錯誤進行疑難排解。

## <a name="limitations-for-azure-file-share-backup-during-preview"></a>預覽期間的 Azure 檔案共用備份限制

Azure 檔案共用的備份處於預覽狀態。 支援一般用途 v1 和一般用途 v2 儲存體帳戶中的 Azure 檔案共用。 Azure 檔案共用不支援下列備份案例︰

- 無法透過 CLI 使用 Azure 備份來保護 Azure 檔案。
- 每天的排程備份次數上限為 1 次。
- 每天的隨選備份次數上限為 4 次。
- 使用存儲帳戶上的[資源鎖](https://docs.microsoft.com/cli/azure/resource/lock?view=azure-cli-latest)，以防止意外刪除恢復服務保存庫中的備份。
- 請勿刪除 Azure 備份所建立的快照集。 刪除快照集可能會導致遺失復原點和/或還原失敗。
- 請勿刪除由 Azure 備份所保護的檔案共用。 目前的解決方案會在刪除檔案共用後，刪除 Azure 備份使用的所有快照集，並因此失去所有還原點

在儲存體帳戶中使用[區域備援儲存體](../storage/common/storage-redundancy-zrs.md) (ZRS) 複寫功能來備份 Azure 檔案共用，目前僅適用於美國中部 (CUS)、美國東部 (EUS)、美國東部 2 (EUS2)、北歐 (NE)、東南亞 (SEA)、西歐 (WE) 和西歐 2 (WUS2)。

## <a name="configuring-backup"></a>設定備份

下表適用於設定備份：

| 錯誤訊息 | 因應措施或解決方案祕訣 |
| ------------------ | ----------------------------- |
| 找不到可用來設定 Azure 檔案共用備份的儲存體帳戶 | <ul><li>請等候探索完成。 <li>檢查是否已使用另一個復原服務保存庫來保護儲存體帳戶中的任何檔案共用。 **請注意**：只能在一個復原服務保存庫之下保護儲存體帳戶中的所有檔案共用。 <li>請確定檔案共用不是存在於任何不支援的儲存體帳戶中。<li> 請確定已在儲存體帳戶中核取 [允許受信任的 Microsoft 服務存取此儲存體帳戶]**** 核取方塊。[深入了解。](../storage/common/storage-network-security.md)|
| 入口網站中的錯誤陳述儲存體帳戶探索失敗。 | 如果您的訂用帳戶是夥伴 (已啟用 CSP)，請忽略此錯誤。 如果您的訂用帳戶未啟用 CSP，而且找不到儲存體帳戶，請連絡支援人員。|
| 選取的儲存體帳戶驗證或註冊失敗。| 請重試此作業。若問題持續發生，請連絡支援人員。|
| 無法在選取的儲存體帳戶中列出或尋找檔案共用。 | <ul><li> 確定儲存體帳戶存在於資源群組中 (而且上次在保存庫中驗證/註冊之後並未遭到刪除或移動)。<li>確定您想要保護的檔案共用尚未遭到刪除。 <li>確定儲存體帳戶是檔案共用備份支援的儲存體帳戶。<li>請檢查檔案共用是否已在相同的復原服務保存庫中受到保護。|
| 備份檔案共用設定 (或保護原則設定) 發生失敗。 | <ul><li>請重試此作業，查看問題是否持續發生。 <li> 確定您想要保護的檔案共用尚未遭到刪除。 <li> 如果您嘗試同時保護多個檔案共用，而且有些檔案共用發生失敗，請再次重新設定失敗檔案共用的備份。 |
| 無法在取消保護檔案共用之後刪除復原服務保存庫。 | 在 Azure 門戶中，打開保存庫>**備份基礎結構** > **存儲帳戶**，然後按一下 **"取消註冊**"以從恢復服務保存庫中刪除存儲帳戶。|

## <a name="error-messages-for-backup-or-restore-job-failures"></a>備份或還原作業失敗的錯誤訊息

| 錯誤訊息 | 因應措施或解決方案祕訣 |
| -------------- | ----------------------------- |
| 作業失敗，因為找不到檔案共用。 | 確定您想要保護的檔案共用尚未遭到刪除。|
| 找不到或不支援儲存體帳戶。 | <ul><li>確定儲存體帳戶存在於資源群組中，而且上次驗證之後並未從資源群組中刪除或移動。 <li> 確定儲存體帳戶是檔案共用備份支援的儲存體帳戶。|
| 您已達到此檔案共用的快照集上限，一旦較舊的快照集過期，您就能夠產生更多快照集。 | <ul><li> 當您為一個檔案建立多個隨選備份時，就會發生此錯誤。 <li> 每個檔案共用有 200 個快照集的限制，其中包含 Azure 備份所產生的快照集。 系統會自動清除較舊的排定備份 (或快照集)。 如果已到達限制上限，則必須刪除隨選備份 (或快照集)。<li> 從 Azure 檔案服務入口網站中刪除隨選備份 (Azure 檔案共用快照集)。 **注意**：如果您刪除 Azure 備份所建立的快照集，則會遺失復原點。 |
| 檔案共用備份或還原因為儲存體服務節流而失敗。 這可能是因為儲存體服務正忙於處理指定儲存體帳戶的其他要求。| 請在一段時間之後重試此作業。 |
| 還原失敗，因為找不到目標檔案共用。 | <ul><li>確定選取的儲存體帳戶存在，而且目標檔案共用並未刪除。 <li> 確定儲存體帳戶是檔案共用備份支援的儲存體帳戶。 |
| 備份或還原作業失敗，因為儲存體帳戶處於鎖定狀態。 | 移除儲存體帳戶上的鎖定，或使用刪除鎖定而不是讀取鎖定，然後重試此作業。 |
| 復原失敗，因為失敗的檔案數目超過閾值。 | <ul><li> 復原失敗原因會列在檔案中 (作業詳細資料中提供的路徑)。 請解決失敗狀況，然後只針對失敗的檔案重試還原作業。 <li> 檔案還原失敗的常見原因： <br/> - 確定目前並未使用失敗的檔案， <br/> - 與失敗檔案同名的目錄存在於上層目錄中。 |
| 復原失敗，因為無法復原任何檔案。 | <ul><li> 復原失敗原因會列在檔案中 (作業詳細資料中提供的路徑)。 請解決失敗狀況，然後只針對失敗的檔案重試還原作業。 <li> 檔案還原失敗的常見原因： <br/> - 確定目前並未使用失敗的檔案。 <br/> - 與失敗檔案同名的目錄存在於上層目錄中。 |
| 還原失敗，因為來源中的其中一個檔案不存在。 | <ul><li> 選取的項目不存在於復原點資料中。 若要復原檔案，請提供正確的檔案清單。 <li> 已手動刪除復原點對應的檔案共用快照集。 選取不同的復原點，然後重試還原作業。 |
| 復原作業正處理至相同的目的地。 | <ul><li>檔案共用備份不支援平行復原至相同的目標檔案共用。 <li>等待現有的復原完成，然後再試一次。 如果您在復原服務保存庫中找不到復原作業，請檢查相同訂用帳戶中的其他復原服務保存庫。 |
| 還原作業因為目標檔案共用已滿而失敗。 | 增加目標檔案共用大小配額以容納還原資料，然後重試此作業。 |
| 還原作業失敗，因為在檔案同步服務資源 (與目標檔案共用相關聯) 上執行還原前置作業時發生錯誤。 | 請稍待片刻後再重試，如果問題持續發生，請連絡 Microsoft 支援。 |
| 無法成功復原一或多個檔案。 如需詳細資訊，請檢查上述路徑中的失敗檔案清單。 | <ul> <li> 復原失敗原因會列在檔案中 (作業詳細資料中提供的路徑)，請解決這些原因，且只針對失敗的檔案重試還原作業。 <li> 檔案還原失敗的常見原因： <br/> - 確定失敗的檔案目前不在使用中。 <br/> - 與失敗檔案同名的目錄存在於上層目錄中。 |

## <a name="modify-policy"></a>修改原則

| 錯誤訊息 | 因應措施或解決方案祕訣 |
| ------------------ | ----------------------------- |
| 此項目的另一個設定保護作業正在進行中。 | 請等候上一個修改原則作業完成，稍後再重試。|
| 選取的項目上有其他作業正在進行中。 | 請等候其他進行中的作業完成，稍後再重試 |

## <a name="next-steps"></a>後續步驟

如需備份 Azure 檔案共用的更多資訊，請參閱︰

- [備份 Azure 檔共用](backup-afs.md)
- [備份 Azure 檔案共用常見問題集](backup-azure-files-faq.md)
