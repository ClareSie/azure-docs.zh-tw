---
title: 管理作業概觀
titleSuffix: Azure SQL Managed Instance
description: 了解 Azure SQL 受控執行個體管理作業持續時間和最佳做法。
services: sql-database
ms.service: sql-managed-instance
ms.subservice: operations
ms.custom: ''
ms.devlang: ''
ms.topic: overview
author: urosmil
ms.author: urmilano
ms.reviewer: sstein, MashaMSFT
ms.date: 07/10/2020
ms.openlocfilehash: 2da7311e61aa39be69a6a0a29eff686baaad7ebf
ms.sourcegitcommit: 32c521a2ef396d121e71ba682e098092ac673b30
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/25/2020
ms.locfileid: "91323187"
---
# <a name="overview-of-azure-sql-managed-instance-management-operations"></a>Azure SQL 受控執行個體管理作業概觀
[!INCLUDE[appliesto-sqlmi](../includes/appliesto-sqlmi.md)]

Azure SQL 受控執行個體提供管理作業，可讓您在不再需要時，用來自動部署新的受控執行個體、更新執行個體屬性和刪除執行個體。

## <a name="what-are-management-operations"></a>什麼是管理作業？

所有管理作業都可以分類如下：

- 執行個體部署 (建立新執行個體)
- 執行個體更新 (變更執行個體屬性，例如虛擬核心、保留的儲存體)
- 執行個體刪除

為了支援 [Azure 虛擬網路內的部署](../../virtual-network/virtual-network-for-azure-services.md)，並為客戶提供隔離和安全性，SQL 受控執行個體會依賴[虛擬叢集](connectivity-architecture-overview.md#high-level-connectivity-architecture)。 虛擬叢集代表一組在客戶的虛擬網路子網路內部署的專屬獨立虛擬機器。 基本上，每個部署至空白子網路中的受控執行個體都會產生新的虛擬叢集增建。

受控執行個體上的後續管理作業可能會影響基礎虛擬叢集。 影響基礎虛擬叢集的變更可能會影響管理作業的持續時間，因為部署額外的虛擬機器時會有額外負荷，當您規劃新的部署或更新現有受控執行個體時，需要加以考量。


## <a name="duration"></a>持續時間

虛擬叢集上的作業持續時間可能會有所不同，但通常會有最長的持續時間。 

以下是您通常可以根據現有服務遙測資料預期的值：

- **虛擬叢集建立**：建立是執行個體管理作業中的同步步驟。 <br/> **90% 的作業在 4 小時內完成**。
- **虛擬叢集調整大小 (擴充或縮小)** ：擴充是同步步驟，而縮小是以非同步方式執行 (不會影響執行個體管理作業的持續時間)。 <br/>**90% 的叢集擴充在 2.5 小時內完成**。
- **虛擬叢集刪除**：刪除是非同步步驟，但是也可以在空的虛擬叢集上[手動起始](virtual-cluster-delete.md)，在此情況下，會以同步方式執行。 <br/>**90% 的虛擬叢集刪除在 1.5 小時內完成**。

此外，執行個體的管理也可能包含託管資料庫上的其中一項作業，這會導致較長的持續時間：

- **從 Azure 儲存體附加資料庫檔案**：同步步驟，例如調整計算 (虛擬核心)，或在一般用途服務層級中增加或相應減少儲存體。 <br/>**90% 的作業在 5 分鐘內完成**。
- **Always On 可用性群組植入**：同步步驟，例如計算 (虛擬核心)，或商務關鍵性服務層級中的儲存體調整，以及將服務層級從一般用途變更為商務關鍵性 (反之亦然)。 這項作業的持續時間與資料庫大小總計以及目前資料庫活動 (使用中交易數目) 成正比。 更新執行個體時的資料庫活動會對持續時間總計產生明顯的差異。 <br/>**90% 的作業以 220 GB/小時或更高速率執行**。

下表根據作業的類別，摘要說明作業和一般的整體持續時間：

**類別：部署**

|作業  |長時間執行的區段  |預估的持續時間  |
|---------|---------|---------|
|空白子網路中的第一個執行個體|虛擬叢集建立|90% 的作業在 4 小時內完成。|
|非空白子網路中另一個硬體世代的第一個執行個體 (例如，第一個 Gen 5 執行個體位於具有 Gen 4 執行個體的子網路中)|虛擬叢集建立<sup>1</sup>|90% 的作業在 4 小時內完成。|
|在非空白子網路內的後續執行個體建立 (第二個、第三個等等的執行個體)|虛擬叢集調整大小|90% 的作業在 2.5 小時內完成。|
| | | 

<sup>1</sup> 虛擬叢集會根據硬體世代建置。

**類別：更新**

|作業  |長時間執行的區段  |預估的持續時間  |
|---------|---------|---------|
|執行個體屬性變更 (管理員密碼、Azure AD 登入、Azure Hybrid Benefit 旗標)|N/A|最多 1 分鐘。|
|執行個體儲存體相應增加/減少 (一般用途服務層級)|附加資料庫檔案|90% 的作業在 5 分鐘內完成。|
|執行個體儲存體相應增加/減少 (商務關鍵性服務層級)|- 虛擬叢集調整大小<br>- Always On 可用性群組植入|90% 的作業在 2.5 小時加上植入所有資料庫 (220 GB/小時) 的時間內完成。|
|執行個體計算 (虛擬核心) 相應增加和減少 (一般用途)|- 虛擬叢集調整大小<br>- 附加資料庫檔案|90% 的作業在 2.5 小時內完成。|
|執行個體計算 (虛擬核心) 相應增加和減少 (商務關鍵性)|- 虛擬叢集調整大小<br>- Always On 可用性群組植入|90% 的作業在 2.5 小時加上植入所有資料庫 (220 GB/小時) 的時間內完成。|
|執行個體服務層級變更 (一般用途到商務關鍵性，反之亦然)|- 虛擬叢集調整大小<br>- Always On 可用性群組植入|90% 的作業在 2.5 小時加上植入所有資料庫 (220 GB/小時) 的時間內完成。|
| | | 

**類別：刪除**

|作業  |長時間執行的區段  |預估的持續時間  |
|---------|---------|---------|
|執行個體刪除|針對所有資料庫進行記錄結尾備份|90% 的作業在 1 分鐘內完成。<br>注意：如果刪除子網路中的最後一個執行個體，此作業會在 12 小時後排程虛擬叢集刪除。<sup>1</sup>|
|虛擬叢集刪除 (作為使用者起始的作業)|虛擬叢集刪除|90% 的作業在最多 1.5 小時內完成。|
| | | 

<sup>1</sup>12 小時是目前的設定，但未來可能會變更。 如果您需要提早刪除虛擬叢集 (例如，為了釋放子網路)，請參閱[刪除受控執行個體之後刪除子網路](virtual-cluster-delete.md)。

## <a name="instance-availability"></a>執行個體可用性

**在更新作業期間可以使用** SQL 受控執行個體，但是在更新結束時發生的容錯移轉所造成的短暫停機時間除外。 因為[加速的資料庫復原](../accelerated-database-recovery.md)，所以即使長時間執行的交易中斷，通常持續最多 10 秒。

在部署和刪除作業期間，用戶端應用程式無法使用 SQL 受控執行個體。

> [!IMPORTANT]
> 不建議您調整 Azure SQL 受控執行個體的計算或儲存體，或在執行長時間執行交易 (資料匯入、資料處理作業、索引重建等) 的同時變更服務層級。 在作業結束時，資料庫的容錯移轉會取消所有進行中的交易。 

## <a name="management-operations-steps"></a>管理作業步驟

管理作業包含多個步驟。 [引進作業 API 之後](management-operations-monitor.md)，這些步驟會公開給作業的子集 (部署和更新)。 部署作業包含三個步驟，而更新作業會在六個步驟中執行。 如需作業持續時間的詳細資料，請參閱＜[管理作業持續時間](#duration)＞一節。 步驟會依執行順序列出。

### <a name="managed-instance-deployment-steps"></a>受控執行個體部署步驟

|步驟名稱  |步驟描述  |
|----|---------|
|要求驗證 |已驗證提交的參數。 萬一設定作業失敗並發生錯誤。 |
|虛擬叢集調整大小/建立 |視子網的狀態而定，虛擬叢集會進入建立或調整大小。 |
|新的 SQL 執行個體啟動 |已部署的虛擬叢集上已啟動 SQL 程序。 |

### <a name="managed-instance-update-steps"></a>受控執行個體更新步驟

|步驟名稱  |步驟描述  |
|----|---------|
|要求驗證 | 已驗證提交的參數。 萬一設定作業失敗並發生錯誤。 |
|虛擬叢集調整大小/建立 |視子網的狀態而定，虛擬叢集會進入建立或調整大小。 |
|新的 SQL 執行個體啟動 | 已部署的虛擬叢集上已啟動 SQL 程序。 |
|植入資料庫檔案/附加資料庫檔案 |視更新作業的類型而定，會執行資料庫植入或附加資料庫檔案。 |
|準備容錯移轉和容錯移轉 |植入資料或重新附加資料庫檔案之後，系統會準備好進行容錯移轉。 當所有項目都設定好時，就會**在短暫的停機時間內**執行容錯移轉。 |
|舊版 SQL 執行個體清除 |從虛擬叢集移除舊版 SQL 程序 |

> [!NOTE]
> 由於調整執行個體的結果，基礎虛擬叢集會進行釋放未使用的容量和可能的容量磁碟重組程序，這可能會影響未參與建立/調整作業的執行個體。 


## <a name="management-operations-cross-impact"></a>管理作業交互影響

受控執行個體上的管理作業會影響放在相同虛擬叢集中執行個體的其他管理作業：

- 虛擬叢集中的**長時間執行還原作業**會讓相同子網路中的其他執行個體建立或調整作業擱置。<br/>**範例︰** 如果有長時間執行還原作業，且在相同的子網路中有建立或調整要求，此要求需要更久的時間才能完成，因為會等待還原作業完成，再繼續進行。

- **後續執行個體建立或調整**作業會因為先前起始的執行個體建立或執行個體調整 (起始虛擬叢集調整大小) 而擱置。<br/>**範例︰** 如果相同虛擬叢集下相同子網路中有多個建立和/或調整要求，而且其中一個要求會起始虛擬叢集調整大小，則在初始作業要求之後提交 5+ 分鐘的所有要求將會持續超過預期的時間，因為這些要求必須等待調整大小完成，然後才能繼續。

- **在 5 分鐘時間範圍內提交的建立/調整作業**將會以平行方式進行批次處理和執行。<br/>**範例︰** 在 5 分鐘時間範圍內提交的所有作業，只會執行一次虛擬叢集調整大小 (從執行第一個作業要求的那一刻開始測量)。 如果另一個要求在提交第一個要求之後超過 5 分鐘才提交，則會等待虛擬叢集調整大小完成，然後才開始執行。

> [!IMPORTANT]
> 因為有另一個作業進行中所以擱置的管理作業，會在符合繼續的條件之後，自動繼續執行。 不需要使用者採取任何動作，即可繼續暫時暫停的管理作業。

## <a name="monitoring-management-operations"></a>監視管理作業

若要了解如何監視管理作業的進度和狀態，請參閱[監視管理作業](management-operations-monitor.md)。

## <a name="canceling-management-operations"></a>取消管理作業

若要了解如何取消管理作業，請參閱[取消管理作業](management-operations-cancel.md)。


## <a name="next-steps"></a>後續步驟

- 若要了解如何建立您的第一個受控執行個體，請參閱[快速入門指南](instance-create-quickstart.md)。
- 如需功能與比較清單，請參閱[常見的 SQL 功能](../database/features-comparison.md)。
- 如需 VNet 組態的詳細資訊，請參閱 [SQL 受控執行個體 VNet 組態](connectivity-architecture-overview.md)。
- 如需建立受控執行個體，並從備份檔案還原資料庫的快速入門，請參閱[建立受控執行個體](instance-create-quickstart.md)。
- 如需使用 Azure 資料庫移轉服務進行移轉的教學課程，請參閱[使用資料庫移轉服務的 SQL 受控執行個體移轉](../../dms/tutorial-sql-server-to-managed-instance.md)。
