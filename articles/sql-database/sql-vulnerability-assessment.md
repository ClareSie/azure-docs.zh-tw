---
title: SQL 弱點評定
description: 瞭解如何在 Azure SQL 資料庫上配置 SQL 漏洞評估並解釋評估報告。
services: sql-database
ms.service: sql-database
ms.subservice: security
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: mibar
ms.author: mibar
ms.reviewer: vanto, carlrab
ms.date: 02/05/2020
tags: azure-synapse
ms.openlocfilehash: a54cbb017e85ec10e142ffae8981bc839aac37f4
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/28/2020
ms.locfileid: "80061671"
---
# <a name="sql-vulnerability-assessment-helps-you-identify-database-vulnerabilities"></a>SQL 漏洞評估可説明您識別資料庫漏洞

SQL 漏洞評估是一種易於配置的服務，可以發現、跟蹤並説明您修復潛在的資料庫漏洞。 使用此工具可主動改進您的資料庫安全性。

漏洞評估是[高級資料安全](sql-database-advanced-data-security.md)產品（用於高級 SQL 安全功能的統一包）的一部分。 可通過中央 SQL 高級資料安全門戶訪問和管理漏洞評估。

> [!NOTE]
> Azure SQL 資料庫、Azure SQL 資料庫託管實例和 Azure 突觸分析都支援漏洞評估。 為了簡單起見，在本文中提到任何受控資料庫服務時都會使用 SQL Database。

## <a name="vulnerability-assessment"></a>弱點評量

SQL 漏洞評估是一項服務，提供對安全狀態的可見度。 漏洞評估包括可操作的步驟，以解決安全問題並增強資料庫安全性。 它可協助您： 

- 符合要求資料庫掃描報告的合規性需求。
- 符合資料隱私權標準。
- 監視難以追蹤變更的動態資料庫環境。

漏洞評估是內置於 Azure SQL 資料庫中的掃描服務。 該服務使用標記安全性漏洞的規則知識庫。 它突出顯示了與最佳實踐的偏差，例如配置錯誤、許可權過多和未受保護的敏感性資料。

這些規則基於 Microsoft 的最佳做法，並側重于對資料庫及其寶貴資料構成最大風險的安全問題。 它們涵蓋資料庫級問題和伺服器級安全問題，如伺服器防火牆設置和伺服器級許可權。 這些規則也代表各種不同管理機構要符合其合規性標準的要求。

掃描結果包含可以解決個別問題的可操作步驟，並於合適的情況下提供自訂的補救指令碼。 您可以通過為以下環境設置可接受的基線來自訂環境的評估報告：
* 許可權配置。
* 功能配置。
* 資料庫設置。

## <a name="implement-vulnerability-assessment"></a>實施漏洞評估

以下步驟在 SQL 資料庫上實現漏洞評估。

### <a name="1-run-a-scan"></a>1. 運行掃描

在 Azure SQL 資料庫窗格中，在 **"安全**"標題下，選擇**高級資料安全性**。 然後按一下"**漏洞評估**"窗格上的 **"選擇存儲**"以打開整個 SQL 伺服器的漏洞評估設置窗格。

配置存儲帳戶，其中將存儲伺服器上所有資料庫的掃描結果。 如需儲存體帳戶的資訊，請參閱[關於 Azure 儲存體帳戶](../storage/common/storage-create-storage-account.md)。 配置存儲後，選擇 **"掃描"** 以掃描資料庫中的漏洞。

![掃描資料庫](./media/sql-vulnerability-assessment/pp_va_initialize.png)

  > [!NOTE]
  > 掃描是輕量且安全的。 運行需要幾秒鐘，並且完全唯讀。 它不會對資料庫進行任何更改。

### <a name="2-view-the-report"></a>2. 查看報告

掃描完成後，掃描報告將自動顯示在 Azure 門戶中。 該報告概述了您的安全狀態。 它列出了發現的問題有多少及其各自的分量。 結果包括偏離最佳實踐的警告以及安全相關設置（如資料庫主體和角色及其關聯許可權）的快照。 掃描報告還提供資料庫中發現的敏感性資料的映射。 它包括使用[資料發現和分類](sql-database-data-discovery-and-classification.md)對資料進行分類的建議。

![檢視報告](./media/sql-vulnerability-assessment/pp_main_getstarted.png)

### <a name="3-analyze-the-results-and-resolve-issues"></a>3. 分析結果並解決問題

檢閱您的結果，並判斷報告中的哪些調查結果是環境中真正的安全性問題。 向下鑽研至每個失敗的結果，了解調查結果的影響，以及每個安全性檢查失敗的原因。 使用報告提供的可操作補救資訊來解決問題。

![分析報告](./media/sql-vulnerability-assessment/pp_fail_rule_show_remediation.png)

### <a name="4-set-your-baseline"></a>4. 設置基線

在查看評估結果時，可以將特定結果標記為環境中可接受的*基線*。 基準本質上就是自訂報告結果的方式。 在後續的掃描中，會將符合基準的結果視為通過。 建立基線安全狀態後，漏洞評估僅報告與基線的偏差。 通過這種方式，您可以專注于相關問題。

![設定基準](./media/sql-vulnerability-assessment/pp_fail_rule_show_baseline.png)

### <a name="5-run-a-new-scan-to-see-your-customized-tracking-report"></a>5. 運行新的掃描以查看自訂的跟蹤報告

設置完**規則基線**後，運行新的掃描以查看自訂報表。 漏洞評估現在僅報告偏離已批准的基準狀態的安全問題。

![檢視您的自訂報告](./media/sql-vulnerability-assessment/pp_pass_main_with_baselines.png)

弱點評量現在可用來監視您的資料庫，隨時維護高度安全性並符合組織原則。 如果需要合規性報告，漏洞評估報告有助於簡化合規性流程。

### <a name="6-set-up-periodic-recurring-scans"></a>6. 設置定期定期掃描

轉到漏洞評估設置以打開**定期定期掃描**。 此設置將漏洞評估配置為每週在資料庫上自動運行一次掃描。 掃描結果摘要將發送到您提供的電子郵件地址。

![檢視您的自訂報告](./media/sql-vulnerability-assessment/pp_recurring_scans.png)

### <a name="7-export-an-assessment-report"></a>7. 匯出評估報告

選擇 **"匯出掃描結果**"以創建掃描結果的可下載 Excel 報表。 此報表包含顯示評估摘要的摘要選項卡。 該報告包括所有失敗的檢查。 它還包括一個 **"結果"** 選項卡，其中包含掃描的完整結果集。 結果包括運行的所有檢查以及每個檢查的結果詳細資訊。

### <a name="8-view-scan-history"></a>8. 查看掃描歷史記錄

在"漏洞評估"窗格中選擇 **"掃描歷史記錄**"以查看以前在此資料庫上運行的所有掃描的歷史記錄。 選取清單中的特定掃描，以檢視該掃描的詳細結果。

弱點評量現在可用來監視您的資料庫，隨時維護高度安全性並符合組織原則。 如果需要合規性報告，漏洞評估報告有助於簡化合規性流程。

## <a name="manage-vulnerability-assessments-by-using-azure-powershell"></a>使用 Azure PowerShell 管理漏洞評估

[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]
> [!IMPORTANT]
> Azure SQL 資料庫仍然支援 PowerShell Azure 資源管理器模組，但所有後續開發都針對 Az.Sql 模組。 有關這些 Cmdlet，請參閱[AzureRM.Sql](https://docs.microsoft.com/powershell/module/AzureRM.Sql/)。 Az 模組和 AzureRm 模組中命令的參數基本相同。

您可以使用 Azure PowerShell Cmdlet，以程式設計方式管理您的弱點評定。 支援的 Cmdlet 如下：

- [更新-AzSql資料庫漏洞評估設置](https://docs.microsoft.com/powershell/module/az.sql/Update-azSqlDatabaseVulnerabilityAssessmentSetting)

  更新資料庫的漏洞評估設置。
- [獲取 AzSql 資料庫漏洞評估設置](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentSetting)

  返回資料庫的漏洞評估設置。
- [清除-AzSql資料庫漏洞評估設置](https://docs.microsoft.com/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentSetting)

  清除資料庫的漏洞評估設置。
- [設置-AzSql資料庫漏洞評估規則基線](https://docs.microsoft.com/powershell/module/az.sql/Set-azSqlDatabaseVulnerabilityAssessmentRuleBaseline)

  設置漏洞評估規則基線。
- [獲取 AzSql 資料庫漏洞評估規則基線](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentRuleBaseline)

  獲取給定規則的漏洞評估規則基線。
- [清除-AzSql資料庫漏洞評估規則基線](https://docs.microsoft.com/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentRuleBaseline)

  清除漏洞評估規則基線。 首先，在使用此 Cmdlet 清除基線之前設置基線。
- [啟動-AzSql 資料庫漏洞評估掃描](https://docs.microsoft.com/powershell/module/az.sql/Start-azSqlDatabaseVulnerabilityAssessmentScan)

  觸發漏洞評估掃描的開始。
- [獲取 AzSql 資料庫漏洞評估掃描記錄](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentScanRecord)

   獲取與給定資料庫關聯的所有漏洞評估掃描記錄。
- [轉換-AzSql 資料庫漏洞評估掃描](https://docs.microsoft.com/powershell/module/az.sql/Convert-azSqlDatabaseVulnerabilityAssessmentScan)

  將漏洞評估掃描結果轉換為 Excel 檔。

如需指令碼範例，請參閱 [Azure SQL 弱點評定的 PowerShell 支援](https://blogs.msdn.microsoft.com/sqlsecurity/20../../azure-sql-vulnerability-assessment-now-with-powershell-support/)。

## <a name="manage-vulnerability-assessment-baseline-rules-by-using-resource-manager-templates"></a>使用資源管理器範本管理漏洞評估基準規則

要使用 Azure 資源管理器範本配置漏洞評估基線，請使用類型`Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines`。

在添加基線之前，`vulnerabilityAssessments`請確保在運行 SQL Server 的電腦上啟用了該資料庫。

下面是將基線規則 VA2065 定義為 masterdb 和 VA1143 到 userdb 作為資源管理器範本中的資源的示例：

```json
    "resources": [
        {
            "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
            "apiVersion": "2018-06-01-preview",
            "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/master')]",
            "properties": {
                "baselineResults": [
                    {
                        "result": [
                                "FirewallRuleName3",
                                "StartIpAddress",
                                "EndIpAddress"
                                  ]
                    },{
                         "result": [
                                "FirewallRuleName4",
                                "62.92.15.68",
                                "62.92.15.68"
                            ]
                        
                    }
                ]
            },
        {
            "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
            "apiVersion": "2018-06-01-preview",
            "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA2130/Default')]",
            "dependsOn": [
                "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
            ],
            "properties": {
                "baselineResults": [
                    {
                        "result": [
                            "dbo"
                        ]
                    }
                ]
            }
        }
    ]
}   
```

對於主資料庫和使用者資料庫，資源名稱的定義不同：

* 主資料庫 - "名稱"：""concat（參數（server_name'"/'，"參數"（database_name"），"/預設/VA2065/<b>主</b>"）"，"
* 使用者資料庫 - "名稱"：""concat（參數（server_name'"，"/"，"參數"（database_name'），"/預設/VA2065/<b>預設</b>"）"，"
 
 
 要將布林類型處理為真/假，使用二進位輸入（如"1"/"0"）設置基線結果。
 
 ```json
        {
            "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
            "apiVersion": "2018-06-01-preview",
            "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA1143/Default')]",
            "dependsOn": [
                "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
            ],
            "properties": {
                "baselineResults": [
                    {
                        "result": [
                            "1"
                        ]
                    }
                ]
            }
        }
    ]
}   
```
 
 
## <a name="next-steps"></a>後續步驟  

- 瞭解有關[高級資料安全性](sql-database-advanced-data-security.md)的更多。
- 瞭解有關[資料發現和分類](sql-database-data-discovery-and-classification.md)的更多。
