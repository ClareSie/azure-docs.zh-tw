---
title: 什麼是 Azure 專用連結服務？
description: 瞭解 Azure 專用連結服務。
services: private-link
author: sumeetmittal
ms.service: private-link
ms.topic: conceptual
ms.date: 09/16/2019
ms.author: sumi
ms.openlocfilehash: 2cc6c577abdb3698ef6aca1f1f04d239f09d119c
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/28/2020
ms.locfileid: "79280426"
---
# <a name="what-is-azure-private-link-service"></a>什麼是 Azure 專用連結服務？

Azure Private Link 服務是由 Azure Private Link 所支援的自有服務參考。 可以啟用在 Azure[標準負載等化器](../load-balancer/load-balancer-standard-overview.md)後面運行的服務，以便服務消費者可以從自己的 VNet 私下訪問該服務。 您的客戶可以在其 VNet 中創建專用終結點，並將其映射到此服務。 本文介紹了與服務提供者方面相關的概念。 

## <a name="workflow"></a>工作流程

![專用連結服務工作流](media/private-link-service-overview/private-link-service-workflow.png)

### <a name="create-your-private-link-service"></a>創建您的專用連結服務

- 將應用程式佈建為在虛擬網路中的標準負載等化器後面運行。 如果應用程式已在標準負載等化器後面配置，則可以跳過此步驟。   
- 創建引用上述負載等化器的專用鏈路服務。 在負載等化器選擇過程中，選擇要接收流量的前端 IP 配置。 為專用鏈路服務的 NAT IP 位址選擇子網。 建議子網中至少有八個 NAT IP 位址可用。 所有消費者流量似乎都源自此服務提供者的私人 IP 位址池。 為專用連結服務選擇適當的屬性/設置。    

    > [!NOTE]
    > Azure 專用鏈路服務僅在標準負載等化器上支援。 
    
### <a name="share-your-service"></a>共用您的服務

創建專用連結服務後，Azure 將根據為服務提供的名稱生成名為"別名"的全球唯一名稱。 您可以離線與客戶共用服務的別名或資源 URI。 消費者可以使用別名或資源 URI 啟動專用連結連接。
 
### <a name="manage-your-connection-requests"></a>管理連接請求

消費者啟動連接後，服務提供者可以接受或拒絕連接請求。 所有連接請求都將列在專用連結服務上的**專用終結點連接**屬性下。
 
### <a name="delete-your-service"></a>刪除服務

如果專用連結服務不再使用，則可以將其刪除。 但是，在刪除服務之前，請確保沒有與其關聯的專用終結點連接。 您可以拒絕所有連接並刪除服務。

## <a name="properties"></a>屬性

專用連結服務指定以下屬性： 

|屬性 |說明  |
|---------|---------|
|預配狀態（預配國）  |列出專用連結服務的當前預配狀態的唯讀屬性。 適用的預配狀態是："刪除;失敗;成功;更新"。 當預配狀態為"成功"時，您已成功預配專用連結服務。        |
|別名（別名）     | 別名是服務全域唯一的唯讀字串。 它可以説明您為服務遮罩客戶資料，同時為服務創建易於共用的名稱。 創建專用連結服務時，Azure 會為服務生成別名，以便與客戶共用該服務。 您的客戶可以使用此別名請求連接到您的服務。          |
|可見度（可見度）     | 可見度是控制專用連結服務曝光設置的屬性。 服務提供者可以選擇將對其服務的風險限制為具有基於角色的存取控制 （RBAC） 許可權、受限訂閱集或所有 Azure 訂閱的訂閱。          |
|自動核准（自動核准）    |   自動核准控制對專用鏈路服務的自動訪問。 當從這些訂閱中的專用終結點請求連接時，自動核准清單中指定的訂閱將自動獲得批准。          |
|負載等化器前端 IP 配置（負載平衡器前端 Ip 配置）    |    專用鏈路服務綁定到標準負載等化器的前端 IP 位址。 所有發往該服務的流量都將到達 SLB 的前端。 您可以配置 SLB 規則，以將此流量定向到應用程式運行的相應後端池。 負載等化器前端 IP 配置不同于 NAT IP 配置。      |
|NAT IP 配置（ip 配置）    |    此屬性是指專用鏈路服務的 NAT（網路位址轉譯）IP 配置。 NAT IP 可以從服務提供者虛擬網路中的任何子網中選擇。 專用鏈路服務在專用鏈路流量上執行目標端 NAT-ing。 這可確保源（消費者端）和目標（服務提供者）位址空間之間沒有 IP 衝突。 在目標端（服務提供者端），NAT IP 位址將顯示為服務接收的所有資料包的源 IP，以及服務發送的所有資料包的目標 IP 的源 IP。       |
|專用終結點連接（專用終結點連接）     |  此屬性列出連接到專用連結服務的專用終結點。 多個專用終結點可以連接到同一專用連結服務，服務提供者可以控制單個專用終結點的狀態。        |
|TCP 代理 V2（啟用代理協定）     |  此屬性允許服務提供者使用 tcp 代理 v2 檢索有關服務消費者的連接資訊。 服務提供者負責設置接收器配置，以便能夠解析代理協定 v2 標頭。        |
|||


### <a name="details"></a>詳細資料

- 可以從同一區域中的已批准專用終結點訪問專用連結服務。 可以從同一虛擬網路、區域對等 VNet、全域對等 VNet 以及使用專用 VPN 或 ExpressRoute 連接在本地內到達專用終結點。 
 
- 創建專用連結服務時，會為資源的生命週期創建網路介面。 此介面不受客戶管理。
 
- 專用鏈路服務必須部署在虛擬網路和標準負載等化器相同的區域中。  
 
- 單個專用連結服務可以從屬於不同 VNet、訂閱和/或活動目錄租戶的多個專用終結點訪問。 連接是通過連接工作流建立的。 
 
- 可使用不同的前端 IP 配置在同一標準負載等化器上創建多個專用鏈路服務。 您可以根據標準負載等化器和每個訂閱創建的專用連結服務的數量是有限制的。 有關詳細資訊，請參閱 [Azure 限制](https://docs.microsoft.com/azure/azure-resource-manager/management/azure-subscription-service-limits#networking-limits)。
 
- 專用鏈路服務可以有多個 NAT IP 配置連結到它。 選擇多個 NAT IP 配置可説明服務提供者擴展。 如今，服務提供者每個專用鏈路服務最多可分配 8 個 NAT IP 位址。 使用每個 NAT IP 位址，您可以為 TCP 連接分配更多埠，從而橫向擴展。將多個 NAT IP 位址添加到專用連結服務後，無法刪除 NAT IP 位址。 這樣做是為了確保在刪除 NAT IP 位址時活動連接不受影響。


## <a name="alias"></a>Alias

**別名**是服務的全球唯一名稱。 它可以説明您為服務遮罩客戶資料，同時為服務創建易於共用的名稱。 創建專用連結服務時，Azure 會為服務生成別名，以便與客戶共用該服務。 您的客戶可以使用此別名請求連接到您的服務。

別名由三部分組成：*首碼*。*GUID*.*尾碼*

- 首碼是服務名稱。 您可以選擇自己的首碼。 創建"Alias"後，無法更改它，因此請適當選擇首碼。  
- GUID 將由平臺提供。 這有助於使名稱在全球唯一。 
- 尾碼由 Azure 追加：*區域*.azure.私有連結服務 

完整別名：*首碼*。 [GUID]。*區域*.azure.私人連結服務  

## <a name="control-service-exposure"></a>控制服務暴露

專用連結服務為您提供了通過"可見度"設置控制服務暴露的選項。 您可以將服務從您擁有的不同 VNet（僅限 RBAC 許可權）進行專用使用，限制對信任的有限訂閱集的暴露，或將其公開，以便所有 Azure 訂閱都可以請求私有連結上的連接服務。 您的可見度設置決定了消費者是否可以連接到您的服務。 

## <a name="control-service-access"></a>控制服務訪問

對專用連結服務具有曝光（由可見度設置控制）的消費者可以在其 VNet 中創建專用終結點，並請求連接到您的專用連結服務。 私有終結點連接將以私有連結服務物件上的"掛起"狀態創建。 服務提供者負責對連接請求進行代理。 您可以批准連接、拒絕連接或刪除連接。 只有已批准的連接才能將流量發送到專用鏈路服務。

通過使用專用連結服務上的自動核准屬性，可以自動批准連接的操作。 自動核准是服務提供者預先批准一組訂閱以自動訪問其服務的能力。 客戶需要離線共用其訂閱，以便服務提供者添加到自動核准清單中。 自動核准是可見度陣列的子集。 可見度控制曝光設置，而自動核准控制服務的批准設置。 如果客戶從自動核准清單中的訂閱請求連接，則該連接將自動獲得批准並建立連接。 服務提供者不再需要手動批准請求。 另一方面，如果客戶請求來自可見度陣列中的訂閱而不是自動核准陣列中的連接，則請求將到達服務提供者，但服務提供者必須手動批准連接。

## <a name="getting-connection-information-using-tcp-proxy-v2"></a>使用 TCP 代理 v2 獲取連接資訊

使用專用鏈路服務時，來自專用終結點的資料包的源 IP 位址是使用從供應商虛擬網路分配的 NAT 在服務提供者端轉換 （NAT） 的網路位址。 因此，應用程式接收分配的 NAT IP 位址，而不是服務消費者的實際源 IP 位址。 如果應用程式需要來自消費者方面的實際源 IP 位址，則可以在服務上啟用代理協定並從代理協定標頭中檢索資訊。 除了源 IP 位址之外，代理協定標頭還攜帶專用終結點的 LinkID。 源 IP 位址和 LinkID 的組合可説明服務提供者唯一地識別其消費者。 有關代理協定的詳細資訊，請訪問[此處](https://www.haproxy.org/download/1.8/doc/proxy-protocol.txt)。 

此資訊使用自訂類型長度值 （TLV） 向量進行編碼，如下所示：

自訂 TLV 詳細資訊：

|欄位 |長度（八進位）  |描述  |
|---------|---------|----------|
|類型  |1        |PP2_TYPE_AZURE （0xEE）|
|長度  |2      |值長度|
|值  |1     |PP2_SUBTYPE_AZURE_PRI加值稅EENDPOINT_LINKID （0x01）|
|  |4        |UINT32（4 位元組），表示私有終結點的 LINKID。 以小端形式編碼。|

 > [!NOTE]
 > 服務提供者負責確保標準負載等化器後面的服務配置為在私有鏈路服務上啟用代理協定時按照[規範](https://www.haproxy.org/download/1.8/doc/proxy-protocol.txt)解析代理協定標頭。 如果在專用鏈路服務上啟用了代理協定設置，但服務提供者的服務未配置為解析標頭，則請求將失敗。 同樣，如果服務提供者的服務在專用鏈路服務上未啟用該設置時，請求將失敗。 啟用代理協定設置後，代理協定標頭也將包含在從主機到後端虛擬機器的 HTTP/TCP 運行狀況探測中，即使標頭中沒有用戶端資訊也是如此。 

## <a name="limitations"></a>限制

以下是使用專用連結服務時的已知限制：
- 僅在標準負載等化器上支援 
- 僅支援 IPv4 流量
- 僅支援 TCP 流量

## <a name="next-steps"></a>後續步驟
- [使用 Azure PowerShell 創建專用連結服務](create-private-link-service-powershell.md)
- [使用 Azure CLI 創建專用連結服務](create-private-link-service-cli.md)
