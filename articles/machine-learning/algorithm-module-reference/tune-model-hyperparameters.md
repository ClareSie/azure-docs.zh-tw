---
title: 調整模型超參數
titleSuffix: Azure Machine Learning
description: 瞭解如何使用 Azure Machine Learning 中的 [微調模型超參數] 模組，在模型上執行參數清理，以判斷最佳參數設定。
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: reference
author: likebupt
ms.author: keli19
ms.date: 10/10/2020
ms.openlocfilehash: 2ec1726056c7ab223f7d3de70a715a8254e95db4
ms.sourcegitcommit: 541bb46e38ce21829a056da880c1619954678586
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/11/2020
ms.locfileid: "91940204"
---
# <a name="tune-model-hyperparameters"></a>調整模型超參數

本文描述如何使用 Azure Machine Learning 設計工具中的 [微調模型超參數] 模組。 目標是要判斷機器學習模型的最佳超參數。 此模組會使用不同的設定組合來建立及測試多個模型。 它會比較所有模型的計量，以取得設定的組合。 

詞彙 *參數* 和 *超參數* 可能會造成混淆。 模型的參數是您在模組右窗格中設定的 *參數* 。 基本上，此模組會對指定的參數設定執行 *參數* 清除。 它會學習一組最佳的 _超參數_，這對每個特定決策樹、資料集或回歸方法可能會有所不同。 尋找最佳設定的程式有時也稱為 *微調*。 

模組支援下列方法來尋找模型的最佳設定： *整合式定型和調整。* 在這個方法中，您可以設定一組要使用的參數。 接著，您可以讓模組逐一查看多個組合。 此模組會測量精確度，直到找到「最佳」模型為止。 使用大部分的學習模組模組時，您可以選擇在定型程式期間應變更的參數，而且應該保持固定。

根據您想要執行微調程式的時間長度，您可能會決定要徹底測試所有組合。 或者，您可以藉由建立參數組合的格線，並測試參數方格的隨機子集，來縮短流程。

這個方法會產生定型的模型，讓您可以儲存以供重複使用。  

> [!TIP] 
> 您可以進行相關的工作。 開始微調之前，請套用特徵選取來判斷具有最高資訊值的資料行或變數。

## <a name="how-to-configure-tune-model-hyperparameters"></a>如何設定微調模型超參數  

瞭解機器學習模型的最佳超參數需要大量使用管線。

### <a name="train-a-model-by-using-a-parameter-sweep"></a>使用參數清理來定型模型  

本節說明如何執行基本參數清除，這會使用 [微調模型超參數] 模組來訓練模型。

1.  在設計工具中，將微調模型超參數模組新增至您的管線。

2.  將未定型的模型連接到最左邊的輸入。 

    > [!NOTE] 
    > **微調模型超參數** 只能連接到內建的機器學習演算法模組，而且無法支援建立 **Python 模型**內建的自訂模型。


3.  新增您想要用於定型的資料集，並將它連接到微調模型超參數的中間輸入。  

    （選擇性）如果您有已加上標籤的資料集，您可以將它連接到最右邊的輸入埠， (**選用的驗證資料集**) 。 這可讓您在定型和調整時測量精確度。

4.  在 [微調模型超參數] 的右窗格中，選擇 [ **參數清除模式]** 的值。 此選項會控制參數的選取方式。

    - **整個方格**：當您選取此選項時，模組會在系統所預先定義的方格上進行迴圈，以嘗試不同的組合，並找出最佳的學習模組。 當您不知道最佳參數設定，而且想要嘗試所有可能的值組合時，這個選項就很有用。

    - **隨機**清除：當您選取此選項時，模組將會隨機選取系統定義範圍的參數值。 您必須指定要讓模組執行的執行數目上限。 當您想要使用所選的度量來提高模型效能，但仍節省運算資源時，此選項非常有用。    

5.  針對 [ **標籤**] 資料行，開啟 [資料行選取器] 以選擇單一標籤資料行。

6.  選擇執行次數：

    - **隨機清除的執行數目上限**：如果您選擇隨機清除，您可以使用參數值的隨機組合來指定要將模型定型多少次。

7.  針對 [ **排名**]，選擇要用來排名模型的單一度量。

    當您執行參數清除時，此模組會計算模型類型的所有適用計量，並在 [清除 **結果** ] 報表中傳回它們。 此模組會針對回歸和分類模型使用不同的度量。

    不過，您所選擇的計量會決定如何排列模型的等級。 只有最上層模型（依所選度量等級）會輸出為定型的模型，以用於計分。

8.  針對 [ **隨機種子**]，輸入要用來啟動參數清除的數位。 

9. 提交管線。

## <a name="results-of-hyperparameter-tuning"></a>超參數微調的結果

定型完成時：

+ 若要查看清除的結果，您可以在模組上按一下滑鼠右鍵，然後選取 [ **視覺化**]，或以滑鼠右鍵按一下模組的 [左方輸出埠] 以視覺化方式呈現。

    清除 **結果** 包含適用于模型類型的所有參數清除和精確度度量，而您為排名選取的計量會決定哪一個模型被視為「最佳」。

+ 若要儲存定型模型的快照集，請在 [**定型模型**] 模組的右面板中，選取 [**輸出 + 記錄**] 索引標籤。 選取 [ **註冊資料集** ] 圖示，將模型儲存為可重複使用的模組。


## <a name="technical-notes"></a>技術說明

本節包含執行詳細資料和秘訣。

### <a name="how-a-parameter-sweep-works"></a>參數清理的運作方式

當您設定參數掃描時，您會定義搜尋範圍。 搜尋可能會使用隨機選取的有限數目參數。 或者，它可能是您定義之參數空間的詳盡搜尋。

+ **隨機**清除：此選項會使用一組反復專案來訓練模型。 

  您可以指定要逐一查看的值範圍，而且此模組會使用隨機播放的這些值子集。 系統會選擇 [取代] 值，表示先前隨機播放的數位不會從可用數目的集區中移除。 因此選取任何值的機率在所有行程中都保持不變。  

+ **整個方格**：使用整個方格的選項表示會測試每個組合。 此選項是最徹底的，但需要最多的時間。 

### <a name="controlling-the-length-and-complexity-of-training"></a>控制定型的長度和複雜性

反復查看許多設定組合可能會很耗時，因此模組會提供數種方式來限制進程：

+ 限制用來測試模型的反覆運算次數。
+ 限制參數空間。
+ 同時限制反覆運算次數和參數空間。

建議您與設定管線，以決定最有效率的方法來定型特定資料集和模型。

### <a name="choosing-an-evaluation-metric"></a>選擇評估度量

在測試結束時，此模型會呈現一份報告，其中包含每個模型的精確度，讓您可以查看度量結果：

- 所有二元分類模型都會使用一組統一的度量。
- 精確度用於所有多類別分類模型。
- 回歸模型會使用一組不同的計量。 

不過，在定型期間，您必須選擇 *單一* 計量，以用於對調整程式期間產生的模型進行排名。 您可能會發現最佳計量會根據您的商務問題以及誤報和誤否定的成本而有所不同。

#### <a name="metrics-used-for-binary-classification"></a>用於二元分類的計量

-   **精確度** 是真正結果占總案例的比例。  

-   **精確度** 是真正結果與正面結果的比例。  

-   **回想** 是所有結果的所有正確結果的分數。  

-   **F 分數** 是可平衡精確度和召回率的量值。  

-   **AUC** 是一個值，表示在 X 軸上繪製誤報時，曲線下的區域，而在 y 軸上繪製的是真陽性。  

-   **平均記錄遺失** 是兩個機率分佈之間的差異： true 個分佈和模型中的兩者之間的差異。  

#### <a name="metrics-used-for-regression"></a>用於回歸的計量

-   **平均絕對值誤差** 平均表示模型中的所有錯誤，其中 *錯誤* 表示預測值與 true 值的距離。 它通常縮寫為 *MAE*。  

-   **Mean 平方誤差的平方根** 會測量誤差平方的平均值，然後採用該值的根。 它通常縮寫為 *RMSE*。  

-   **相對絕對錯誤** 表示錯誤，以真正值的百分比表示。  

-   **相對平方誤差** 會除以預測值的總平方誤差，以標準化總平方誤差。  

-   **決定係數** 是單一數位，表示資料符合模型的程度。 值為1時，表示模型完全符合資料。 值為零表示資料是隨機的，否則無法符合模型。 它通常稱為 *r<sup>2</sup>*、 *r<sup>2</sup>* 或 *r 平方*。  

### <a name="modules-that-dont-support-a-parameter-sweep"></a>不支援參數清理的模組

Azure Machine Learning 中，幾乎所有的學習都支援透過整合式參數清除進行交叉驗證，讓您選擇要與管線搭配使用的參數。 如果學習模組不支援設定某個範圍的值，您仍然可以在交叉驗證中使用它。 在此情況下，會為清除選取允許的值範圍。 


## <a name="next-steps"></a>後續步驟

請參閱 Azure Machine Learning 的[可用模組集](module-reference.md)。 

