---
title: 儲存漏洞評估掃描會導致在防火牆和 VNet 後存取儲存帳戶
description: 提供有關如何將漏洞評估 (VA) 掃描儲存在可透過防火牆或 VNet 存取的儲存帳戶中的說明
services: sql-database
ms.service: sql-database
ms.subservice: security
ms.topic: conceptual
author: barmichal
ms.author: mibar
ms.reviewer: vanto
ms.date: 04/17/2020
ms.openlocfilehash: 36783c84acc22d6bc1084c2c13f455dedbfc77ca
ms.sourcegitcommit: d57d2be09e67d7afed4b7565f9e3effdcc4a55bf
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/22/2020
ms.locfileid: "81771855"
---
# <a name="store-vulnerability-assessment-scan-results-in-a-storage-account-accessible-behind-firewalls-and-vnets"></a>儲存漏洞評估掃描會導致在防火牆和 VNet 後存取儲存帳戶

如果要限制對某些 VNet 或服務的 Azure 中的儲存帳戶的訪問許可權,則需要啟用適當的配置,以便針對 SQL 資料庫或託管實例進行漏洞評估 (VA) 掃描才能存取該存儲帳戶。

## <a name="enable-azure-sql-database-va-scanning-access-to-the-storage-account"></a>開啟 Azure SQL 資料庫 VA 掃描存取儲存帳戶的存取

如果已將 VA 儲存帳戶配置為僅由某些網路或服務訪問,則需要確保 Azure SQL 資料庫的 VA 掃描能夠將掃描儲存在儲存帳戶上。 要瞭解使用哪些儲存帳戶,請轉到[Azure 門戶](https://portal.azure.com)中的**SQL 伺服器**窗格,在 **'安全'** 下,選擇**進階資料安全性**。

:::image type="content" source="media/sql-database-vulnerability-assessment-storage/va-storage.png" alt-text="va 儲存":::

您可以使用現有儲存帳戶,或創建新的儲存帳戶來存儲 Azure SQL Server 上所有資料庫的 VA 掃描結果。

轉到包含儲存帳戶**的資源群組**並存取 **「儲存帳戶」** 窗格。 在 **「設定」** 下,選擇**防火牆和虛擬網路**。

確保選擇**允許受信任的 Microsoft 服務存取此儲存帳戶**。

:::image type="content" source="media/sql-database-vulnerability-assessment-storage/storage-allow-microsoft-services.png" alt-text="儲存允許-微軟服務":::

## <a name="store-va-scan-results-for-azure-sql-managed-instance-in-a-storage-account-that-can-be-accessed-behind-a-firewall-or-vnet"></a>在使用防火牆或 VNet 後存取的儲存帳戶中儲存 Azure SQL 託管實例的 VA 掃描結果

由於託管實例不是受信任的 Microsoft 服務,並且具有與儲存帳戶不同的 VNet,因此執行 VA 掃描將導致錯誤。

要支援託管實例上的 VA 掃描,請按照以下步驟操作:

1. 在**SQL 託管實例**窗格中,在 **「概述」** 標題下,單擊**虛擬網路/子網**連結。 這將帶您到**虛擬網路**窗格。

   :::image type="content" source="media/sql-database-managed-instance-public-endpoint-configure/mi-overview.png" alt-text="mi-概述2":::

1. 在 **「設定」** 下,選擇**子網**。 按下新窗格中的**子網**以新增子網,並將其委派給*Microsoft.sql_託管實例*。 有關詳細資訊,請參閱[管理子網](../virtual-network/virtual-network-manage-subnet.md)。

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/mi-subnets.png" alt-text="mi 子網":::

1. 在**虛擬網路**窗格中,**在「設定」** 下,選擇 **「服務終結點**」 。。 按下"在新窗格中**添加**",並將*Microsoft.儲存*服務添加為新的服務終結點。 確保選擇了*託管實例*子網。 按一下 [新增]  。

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/mi-service-endpoint.png" alt-text="mi 服務端點":::

1. 轉到已選擇的**儲存帳戶**以存儲 VA 掃描。 在 **「設定」** 下,選擇**防火牆和虛擬網路**。 按一下 [新增現有的虛擬網路]****。 選擇託管實例虛擬網路和子網,然後單擊"**添加**"。

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/storage-firewall.png" alt-text="儲存防火牆":::

現在,您應該能夠將託管實例的 VA 掃描儲存在儲存帳戶中。

## <a name="next-steps"></a>後續步驟

- [漏洞評估](sql-vulnerability-assessment.md)
- [建立 Azure 儲存體帳戶](../storage/common/storage-account-create.md)
- [Azure SQL 資料庫的進階資料安全性](sql-database-advanced-data-security.md)