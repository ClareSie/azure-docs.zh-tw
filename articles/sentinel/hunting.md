---
title: Azure Sentinel 中的尋獵功能*微軟文件
description: 本文介紹如何使用 Azure Sentinel 搜索功能。
services: sentinel
documentationcenter: na
author: yelevin
manager: rkarlin
editor: ''
ms.assetid: 6aa9dd27-6506-49c5-8e97-cc1aebecee87
ms.service: azure-sentinel
ms.subservice: azure-sentinel
ms.devlang: na
ms.topic: conceptual
ms.custom: mvc
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 09/10/2019
ms.author: yelevin
ms.openlocfilehash: 52af688917aa531d125f83844df29a988ed7cb7e
ms.sourcegitcommit: acb82fc770128234f2e9222939826e3ade3a2a28
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/21/2020
ms.locfileid: "81686641"
---
# <a name="hunt-for-threats-with-azure-sentinel"></a>使用 Azure 哨兵搜尋威脅

如果您是希望主動查找安全威脅的調查員,Azure Sentinel 會強大的搜索和查詢工具,以查找組織數據源的安全威脅。 但是,您的系統和安全設備會生成大量數據,這些數據可能難以解析和篩選到有意義的事件。 為了説明安全分析人員主動查找安全應用未檢測到的新異常,Azure Sentinel 的內置搜索查詢指導您提出正確的問題,以查找網路上已有的數據中的問題。 

例如,一個內置查詢提供有關在基礎結構上運行的最罕見進程的數據 - 您不希望每次運行這些進程時都發出警報,它們可能完全是無辜的,但您可能希望偶爾查看該查詢,以查看是否有異常情況。 



以 Azure Sentinel 搜尋,您可以利用以下功能:

- 內置查詢:為了入門,起始頁提供預載的查詢示例,旨在説明您入門並熟悉表和查詢語言。 這些內置的狩獵查詢由 Microsoft 安全研究人員持續開發,增加了新的查詢,並微調現有查詢,為您提供一個入口點來查找新檢測,並找出從何處開始尋找新的攻擊的開始。 

- 使用 IntelliSense 強大的查詢語言:構建在查詢語言之上,使您能夠靈活地將狩獵帶到一個新的水準。

- 建立自己的書籤:在狩獵過程中,您可能會遇到看起來異常或可疑的匹配項或發現、儀錶板或活動。 為了標記這些專案,以便將來可以返回這些專案,請使用書籤功能。 書籤允許您保存專案以供以後使用,用於創建事件以供調查。 有關書籤的詳細資訊,請參閱[在狩獵中使用書籤](hunting.md)。
- 使用筆記本自動調查:筆記本就像一步一步的劇本,您可以構建這些手冊來完成調查和搜索的步驟。  筆記本將所有狩獵步驟封裝在可重用的劇本中,這些步驟可以與組織中的其他人共用。 
- 查詢存儲的數據:數據可在表中訪問,可供您查詢。 例如,可以查詢進程創建、DNS 事件和許多其他事件類型。

- 指向社區的連結:利用大社區的力量來查找其他查詢和數據源。
 
## <a name="get-started-hunting"></a>開始打獵

1. 在 Azure Sentinel 門戶中,按一下 **「搜索**」 。
  ![Azure 哨兵開始狩獵](media/tutorial-hunting/hunting-start.png)

2. 打開 **「搜索」** 頁時,所有尋用查詢都顯示在單個表中。 該表列出了 Microsoft 安全分析團隊編寫的所有查詢以及您創建或修改的任何其他查詢。 每個查詢都提供它搜索的內容及其運行的數據類型的說明。 這些範本按其各種策略分組 - 右側的圖示對威脅類型進行分類,例如初始訪問、持久性和滲漏。 您可以使用任何欄位篩選這些狩獵查詢範本。 您可以將任何查詢儲存到我的最愛。 通過將查詢保存到收藏夾,查詢會在每次訪問 **「搜索」** 頁時自動運行。 您可以創建自己的狩獵查詢或克隆並自定義現有的狩獵查詢範本。 
 
2. 按下"狩獵查詢詳細資訊"頁中的 **"運行"查詢**,以在不離開搜索頁的情況下運行任何查詢。  匹配項數顯示在表中。 查看狩獵查詢及其匹配項的清單。 查看匹配關聯的終止鏈中的哪個階段。

3. 在查詢詳細資訊窗格中快速查看基礎查詢,或單擊「**查看查詢結果**」以在日誌分析中打開查詢。 在底部,查看查詢的匹配項。

4.    按下此行並選擇 **「添加書籤**」以添加要調查的行 - 您可以對任何看起來可疑的行執行此操作。 

5. 然後,返回主要 **「搜索」** 頁面,然後單擊 **「書籤」** 選項卡以查看所有可疑活動。 

6. 選擇書籤,然後單擊 **「調查」** 以打開調查體驗。 您可以篩選書籤。 例如,如果您正在調查市場活動,則可以為市場活動創建一個標記,然後根據市場活動篩選所有書籤。

1. 發現哪些狩獵查詢提供了對可能攻擊的高價值見解后,還可以基於查詢創建自定義檢測規則,並將這些見解呈現為對安全事件回應者的警報。

 

## <a name="query-language"></a>查詢語言 

Azure Sentinel 中的搜索基於 Kusto 查詢語言。 有關查詢語言和受支援的運算子的詳細資訊,請參閱[查詢語言參考](/azure/azure-monitor/log-query/get-started-queries)。

## <a name="public-hunting-query-github-repository"></a>公共狩獵查詢 GitHub 儲存庫

檢視[狩獵查詢儲存函式庫](https://github.com/Azure/Orion)。 貢獻和使用客戶共用的範例查詢。

 

## <a name="sample-query"></a>範例查詢

查詢通常以資料表名稱開頭，後面接著一連串以  隔開的「運算子」\|。

在上面的示例中,從表名稱 SecurityEvent 開始,並根據需要添加管道元素。

1. 定義時間篩選器以僅查看過去七天的記錄。

2. 在查詢中添加篩選器以僅顯示事件 ID 4688。

3. 在 CommandLine 上的查詢中添加篩選器,以僅包含 cscript.exe 的實例。

4. 只投影您感興趣的欄,並將結果限制為 1000,然後按**下「執行」 查詢**。
5. 單擊綠色三角形並運行查詢。 您可以測試查詢並運行它以查找異常行為。

## <a name="useful-operators"></a>實用運算子

查詢語言功能強大,具有許多可用的運算符,此處列出了一些有用的運算符號:

**其中**- 將表篩選為滿足謂詞的行子集。

**摘要**- 生成聚合輸入表內容的表。

**聯接**- 通過符合每個表中指定列的值,合併兩個表的行以形成新表。

**計數**- 傳回輸入記錄集中的記錄數。

**頂部**- 返回按指定列排序的前 N 條記錄。

**限制**- 返回最多指定數量的行。

**項目**- 選擇要包含、重新命名或刪除的欄,然後插入新的計算欄位。

**擴展**- 創建計算列並將其追加到結果集中。

**makeset** - 傳回 Expr 在群組中採用的一組不同值的動態 (JSON) 陣列

**尋找**- 尋找與一組表的謂詞匹配的行。

## <a name="save-a-query"></a>儲存查詢

您可以創建或修改查詢並將其保存為您自己的查詢,或與同一租戶中的使用者共享查詢。

   ![儲存查詢](./media/tutorial-hunting/save-query.png)

建立新的狩獵查詢:

1. 按下 **「新建」查詢**並選擇 **「儲存**」。
2. 填寫所有空白欄位,然後選擇 **"儲存**"。

   ![新增查詢](./media/tutorial-hunting/new-query.png)

克隆和修改現有的狩獵查詢:

1. 選擇要修改的表中的狩獵查詢。
2. 選擇要修改的查詢列中的省略號 (...),然後選擇 **「複製」 查詢**。

   ![隆隆查詢](./media/tutorial-hunting/clone-query.png)
 

3. 修改查詢並選擇 **"創建**」。

   ![自訂查詢](./media/tutorial-hunting/custom-query.png)

## <a name="next-steps"></a>後續步驟
在本文中,您學習了如何使用 Azure Sentinel 運行狩獵調查。 若要深入了解 Azure Sentinel，請參閱下列文章：


- [使用筆記本執行自動狩獵活動](notebooks.md)
- [使用書籤在狩獵時保存有趣的資訊](bookmarks.md)
