---
title: Azure SignalR Service 的效能指南
description: 概述 Azure SignalR Service 的效能和基準。 規劃容量時所要考慮的關鍵計量。
author: sffamily
ms.service: signalr
ms.topic: conceptual
ms.date: 11/13/2019
ms.author: zhshang
ms.openlocfilehash: 68cad32be177fa20794399157fca89e87c2f8f59
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/02/2020
ms.locfileid: "74157661"
---
# <a name="performance-guide-for-azure-signalr-service"></a>Azure SignalR Service 的效能指南

使用 Azure SignalR Service 的其中一個主要優點是能夠輕鬆調整 SignalR 應用程式。 在大規模的案例中，效能是重要的因素。 

在本指南中，我們將介紹影響 SignalR 應用程式效能的因素。 我們將在不同的使用案例中說明一般的效能。 最後，我們將介紹可用來產生效能報告的環境和工具。

## <a name="term-definitions"></a>詞彙定義

*輸入*：要 Azure SignalR Service 的傳入訊息。

*輸出*：來自 Azure SignalR Service 的外寄訊息。

*頻寬*：1秒內所有訊息的總大小。

*預設模式*：建立 Azure SignalR Service 實例時的預設工作模式。 Azure SignalR Service 預期應用程式伺服器在接受任何用戶端連線之前，先建立與它的連線。

*無伺服器模式*： Azure SignalR Service 只接受用戶端連接的模式。 不允許任何伺服器連接。

## <a name="overview"></a>總覽

Azure SignalR Service 會針對不同的效能容量定義七個標準層。 本指南會回答下列問題：

-   每一層的一般 Azure SignalR Service 效能為何？

-   Azure SignalR Service 符合我的訊息輸送量需求（例如，每秒傳送100000訊息）嗎？

-   針對我的特定案例，哪一層適合我？ 或者如何選取適當的層級？

-   哪種類型的應用程式伺服器（VM 大小）適合我？ 我應該部署多少個？

為了回答這些問題，本指南先提供會影響效能之因素的高階說明。 然後說明一般使用案例的每一層的輸入和輸出訊息上限：**回應**、**廣播**、**傳送到群組**，以及**傳送至**連線（點對點交談）。

本指南無法涵蓋所有案例（以及不同的使用案例、訊息大小、訊息傳送模式等等）。 但它提供一些方法來協助您：

- 評估輸入或輸出訊息的近似需求。
- 藉由檢查效能資料表來尋找適當的層級。

## <a name="performance-insight"></a>效能深入解析

本節說明效能評估方法，然後列出會影響效能的所有因素。 最後，它會提供方法來協助您評估效能需求。

### <a name="methodology"></a>方法

*輸送量*和*延遲*是效能檢查的兩個典型層面。 針對 Azure SignalR Service，每個 SKU 層都有自己的輸送量節流原則。 當99% 的訊息具有小於1秒的延遲時，原則會定義*允許的最大輸送量（輸入和輸出頻寬）* 做為最大達到的輸送量。

延遲是從傳送訊息到從 Azure SignalR Service 接收回應訊息之連接的時間範圍。 讓我們以「**回應**」做為範例。 每個用戶端連接都會在訊息中加入時間戳記。 應用程式伺服器的中樞會將原始訊息傳送回用戶端。 因此，每個用戶端連接都可以輕鬆地計算傳播延遲。 針對**廣播**中的每個訊息、[**傳送至群組**] 和 [**傳送至**連線]，會附加時間戳記。

為了模擬數以千計的並行用戶端連線，會在 Azure 的虛擬私人網路中建立多個 Vm。 所有這些 Vm 都連接到相同的 Azure SignalR Service 實例。

在 Azure SignalR Service 的預設模式中，應用程式伺服器 Vm 會部署在與用戶端 Vm 相同的虛擬私人網路中。 所有用戶端 Vm 和應用程式伺服器 Vm 都會部署在相同區域的相同網路中，以避免跨區域的延遲。

### <a name="performance-factors"></a>效能因素

理論上，Azure SignalR Service 容量受限於計算資源： CPU、記憶體和網路。 例如，Azure SignalR Service 的更多連接會導致服務使用更多的記憶體。 對於較大的訊息流量（例如，每則訊息大於2048個位元組），Azure SignalR Service 需要花更多的 CPU 週期來處理流量。 同時，Azure 網路頻寬也會對流量上限施加限制。

傳輸類型是會影響效能的另一個因素。 這三種類型分別是[WebSocket](https://en.wikipedia.org/wiki/WebSocket)、[伺服器傳送的事件](https://en.wikipedia.org/wiki/Server-sent_events)和[長時間輪詢](https://en.wikipedia.org/wiki/Push_technology)。 

WebSocket 是透過單一 TCP 連線的雙向和全雙工通訊協定。 伺服器傳送-事件是一個單向通訊協定，可將訊息從伺服器推送至用戶端。 長時間輪詢需要用戶端透過 HTTP 要求定期輪詢伺服器的資訊。 針對相同條件下的相同 API，WebSocket 具有最佳效能、伺服器傳送事件速度較慢，且長時間輪詢的速度最慢。 Azure SignalR Service 預設會建議 WebSocket。

訊息路由成本也會限制效能。 Azure SignalR Service 將角色視為訊息路由器，會將一組用戶端或伺服器的訊息路由傳送至其他用戶端或伺服器。 不同的案例或 API 需要不同的路由原則。 

對於**echo**，用戶端會將訊息傳送至其本身，而路由目的地也會是本身。 此模式具有最低的路由成本。 但針對**廣播**、**傳送至群組**和**傳送至連接**，Azure SignalR Service 需要透過內部分散式資料結構來查詢目標連接。 這種額外的處理會使用更多的 CPU、記憶體和網路頻寬。 因此，效能會變慢。

在預設模式下，應用程式伺服器可能也會成為特定案例的瓶頸。 Azure SignalR SDK 必須叫用中樞，而它會透過心跳信號來維持與每個用戶端的即時連線。

在無伺服器模式中，用戶端會透過 HTTP post 傳送訊息，這不像 WebSocket 那麼有效率。

另一個因素是通訊協定： JSON 和[MessagePack](https://msgpack.org/index.html)。 MessagePack 的大小較小，且提供的速度比 JSON 更快。 不過，MessagePack 可能不會改善效能。 Azure SignalR Service 的效能不會因為通訊協定而受到影響，因為它不會在從用戶端到伺服器的訊息轉送期間解碼訊息裝載，反之亦然。

總而言之，下列因素會影響輸入和輸出容量：

-   SKU 層（CPU/記憶體）

-   連線數目

-   訊息大小

-   訊息傳送速率

-   傳輸類型（WebSocket、伺服器傳送-事件或長時間輪詢）

-   使用案例（路由成本）

-   應用程式伺服器和服務連接（以伺服器模式）


### <a name="finding-a-proper-sku"></a>尋找適當的 SKU

如何評估輸入/輸出容量，或找出哪一層適用于特定的使用案例？

假設應用程式伺服器的功能強大，而且不是效能瓶頸。 然後，檢查每一層的輸入和輸出頻寬上限。

#### <a name="quick-evaluation"></a>快速評估

讓我們先藉由假設一些預設設定來簡化評估： 

- 傳輸類型為 WebSocket。
- 訊息大小為2048個位元組。
- 每隔1秒傳送一則訊息。
- Azure SignalR Service 處於預設模式。

每一層都有自己的最大輸入頻寬和輸出頻寬。 在輸入或輸出連線超過限制之後，不保證會有順暢的使用者體驗。

**Echo**會提供最大的輸入頻寬，因為它具有最低的路由成本。 **廣播**會定義最大的輸出訊息頻寬。

不要*超過下列*兩個數據表中反白顯示的值。

|       Echo                        | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|-----------------------------------|-------|-------|-------|--------|--------|--------|---------|
| 連接                       | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| **輸入頻寬** | **2 MBps**    | **4 MBps**    | **10 MBps**   | **20 MBps**    | **40 MBps**    | **100 MBps**   | **200 MBps**    |
| 輸出頻寬 | 2 MBps   | 4 MBps   | 10 MBps  | 20 MBps   | 40 MBps   | 100 MBps  | 200 MBps   |


|     廣播             | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| 連接               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000  | 100,000 |
| 輸入頻寬  | 4 KBps   | 4 KBps   | 4 KBps    | 4 KBps    | 4 KBps    | 4 KBps     | 4 KBps    |
| **輸出頻寬** | **4 MBps**    | **8 MBps**    | **20 MBps**    | **40 MBps**    | **80 MBps**    | **200 MBps**    | **400 MBps**   |

*輸入頻寬*和*輸出頻寬*是每秒的訊息大小總計。  其公式如下：
```
  inboundBandwidth = inboundConnections * messageSize / sendInterval
  outboundBandwidth = outboundConnections * messageSize / sendInterval
```

- *inboundConnections*：傳送訊息的連接數目。

- *outboundConnections*：接收訊息的連接數目。

- *messageSize*：單一訊息的大小（平均值）。 小於1024個位元組的小型訊息，會影響與1024位元組訊息類似的效能。

- *sendInterval*：傳送一則訊息的時間。 每則訊息通常是1秒，這表示每秒傳送一則訊息。 較小的間隔表示在一段時間內傳送更多訊息。 例如，每則訊息0.5 碼錶示每秒傳送兩則訊息。

- *連接*：每一層的 Azure SignalR Service 認可的最大閾值。 如果連接號碼進一步增加，就會受到連線節流的影響。

#### <a name="evaluation-for-complex-use-cases"></a>複雜使用案例的評估

##### <a name="bigger-message-size-or-different-sending-rate"></a>較大的訊息大小或不同的傳送速率

實際使用案例較複雜。 它可能會傳送大於2048個位元組的訊息，或傳送訊息速率不是每秒一則訊息。 讓我們將 Unit100's 廣播做為範例，以找出如何評估其效能。

下表顯示**廣播**的實際使用案例。 但是訊息大小、連接計數和訊息傳送速率與我們在上一節中假設的不同。 問題是，如果我們只知道其中兩個專案（訊息大小、連接計數或訊息傳送速率），我們可以如何推算其中的任何專案。

| 廣播  | 訊息大小 | 每秒輸入訊息數 | 連接 | 傳送間隔 |
|---|---------------------|--------------------------|-------------|-------------------------|
| 1 | 20 KB                | 1                        | 100,000     | 5 秒                      |
| 2 | 256 KB               | 1                        | 8,000       | 5 秒                      |

下列公式很容易根據先前的公式來推斷：

```
outboundConnections = outboundBandwidth * sendInterval / messageSize
```

針對 Unit100，上一個表格中的輸出頻寬上限是 400 MB。 若為 20 KB 的訊息大小，輸出連線的最大值應為 400 MB \* 5/20 KB = 100000，符合實際值。

##### <a name="mixed-use-cases"></a>混合使用案例

實際使用案例通常會將四個基本使用案例混合在一起： [**回應**]、[**廣播**]、[**傳送至群組**] 和 [**傳送至連接**]。 您用來評估容量的方法是：

1. 將混合使用案例分成四個基本使用案例。
1. 分別使用上述公式來計算輸入和輸出訊息頻寬的上限。
1. 加總頻寬計算，以取得最大的輸入/輸出頻寬。 

然後從最大的輸入/輸出頻寬資料表中挑選適當的層級。

> [!NOTE]
> 若要將訊息傳送到數百個或數千個小型群組，或數以千計的用戶端傳送訊息給彼此，則路由成本會變成主要。 請將這種影響納入考慮。

針對傳送訊息給用戶端的使用案例，請確定應用程式伺服器*不*是瓶頸。 下列「案例研究」一節提供您所需的應用程式伺服器數量，以及您應該設定多少伺服器連線的相關指導方針。

## <a name="case-study"></a>案例研究

下列各節將逐步解說 WebSocket 傳輸的四個典型使用案例： **echo**、**廣播**、**傳送到群組**，以及**傳送至**連線。 針對每個案例，區段會列出 Azure SignalR Service 的目前輸入和輸出容量。 它也會說明影響效能的主要因素。

在預設模式中，應用程式伺服器會使用 Azure SignalR Service 建立五個伺服器連接。 根據預設，應用程式伺服器會使用 Azure SignalR Service SDK。 在下列效能測試結果中，伺服器連接會增加到15（或更多），以廣播和傳送訊息至大群組。

不同的使用案例對應用程式伺服器具有不同的需求。 **廣播**需要少量的應用程式伺服器。 **Echo**或**send to connection**需要許多應用程式伺服器。

在所有使用案例中，預設訊息大小為2048個位元組，而訊息傳送間隔為1秒。

### <a name="default-mode"></a>預設模式

用戶端、web 應用程式伺服器和 Azure SignalR Service 都牽涉到預設模式。 每個用戶端都代表單一連接。

#### <a name="echo"></a>Echo

首先，web 應用程式會連接到 Azure SignalR Service。 其次，許多用戶端會連線到 web 應用程式，這會將用戶端重新導向至具有存取權杖和端點的 Azure SignalR Service。 然後，用戶端會使用 Azure SignalR Service 建立 WebSocket 連線。

在所有用戶端建立連線之後，它們會開始將包含時間戳記的訊息傳送至特定中樞（每秒）。 中樞會將訊息回顯回其原始用戶端。 每個用戶端會在接收回送回應訊息時計算延遲。

在下圖中，5到8（紅色反白顯示的流量）在迴圈中。 迴圈會在預設持續時間（5分鐘）內執行，並取得所有訊息延遲的統計資料。

![Echo 使用案例的流量](./media/signalr-concept-performance/echo.png)

**Echo**的行為會決定最大輸入頻寬等於輸出頻寬上限。 如需詳細資訊，請參閱下表。

|       Echo                        | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|-----------------------------------|-------|-------|-------|--------|--------|--------|---------|
| 連接                       | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 每秒輸入/輸出訊息數 | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 輸入/輸出頻寬 | 2 MBps   | 4 MBps   | 10 MBps  | 20 MBps   | 40 MBps   | 100 MBps  | 200 MBps   |

在此使用案例中，每個用戶端會叫用應用程式伺服器中定義的中樞。 中樞只會呼叫在原始用戶端中定義的方法。 這是最輕量的中樞，用於**回應**。

```
        public void Echo(IDictionary<string, object> data)
        {
            Clients.Client(Context.ConnectionId).SendAsync("RecordLatency", data);
        }
```

即使是這個簡單的中樞，應用程式伺服器上的流量壓力也會隨著**回應**輸入訊息的負載增加而明顯。 此流量壓力需要許多適用于大型 SKU 層的應用程式伺服器。 下表列出每個層級的應用程式伺服器計數。


|    Echo          | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 連接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 應用程式伺服器計數 | 2     | 2     | 2     | 3      | 3      | 10     | 20      |

> [!NOTE]
> 應用程式伺服器的用戶端連接編號、訊息大小、訊息傳送速度、SKU 層和 CPU/記憶體會影響**回應**的整體效能。

#### <a name="broadcast"></a>廣播

針對**廣播**，當 web 應用程式收到訊息時，它會廣播到所有用戶端。 有更多用戶端要廣播，所有用戶端的訊息流量就愈多。 請參閱下圖。

![廣播使用案例的流量](./media/signalr-concept-performance/broadcast.png)

大量的用戶端正在廣播中。 輸入訊息頻寬很小，但輸出頻寬很大。 輸出訊息頻寬會隨著用戶端連線或廣播速率增加而增加。

下表摘要說明用戶端連接、輸入/輸出訊息計數和頻寬的上限。

|     廣播             | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| 連接               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000  | 100,000 |
| 每秒輸入訊息數  | 2     | 2     | 2      | 2      | 2      | 2       | 2       |
| 每秒輸出訊息數 | 2,000 | 4,000 | 10,000 | 20,000 | 40,000 | 100,000 | 200,000 |
| 輸入頻寬  | 4 KBps   | 4 KBps   | 4 KBps    | 4 KBps    | 4 KBps    | 4 KBps     | 4 KBps     |
| 輸出頻寬 | 4 MBps   | 8 MBps   | 20 MBps   | 40 MBps   | 80 MBps   | 200 MBps   | 400 MBps   |

張貼訊息的廣播用戶端不超過四個。 相較于**回應**，它們所需的應用程式伺服器較少，因為輸入訊息數量很小。 兩個應用程式伺服器足以應付 SLA 和效能考慮。 但是，您應該增加預設的伺服器連接，以避免不平衡，特別是針對 Unit50 和 Unit100。

|   廣播      | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 連接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 應用程式伺服器計數 | 2     | 2     | 2     | 2      | 2      | 2      | 2       |

> [!NOTE]
> 在每部應用程式伺服器上，將預設伺服器連線增加5到40，以避免可能的不平衡伺服器連接 Azure SignalR Service。
>
> 用戶端連接編號、訊息大小、訊息傳送速率和 SKU 層會影響**廣播**的整體效能。

#### <a name="send-to-group"></a>傳送至群組

[**傳送至群組**] 使用案例與**廣播**的流量模式類似。 差別在於用戶端建立與 Azure SignalR Service 的 WebSocket 連線之後，他們必須先加入群組，才能將訊息傳送到特定群組。 下圖說明流量的流程。

![傳送到群組使用案例的流量](./media/signalr-concept-performance/sendtogroup.png)

群組成員和群組計數是影響效能的兩個因素。 為了簡化分析，我們定義了兩種群組：

- **小型群組**：每個群組都有10個連接。 群組編號等於（最大連接計數）/10。 例如，針對 Unit1，如果有1000連線計數，則我們有 1000/10 = 100 個群組。

- **大群組**：群組編號一律為10。 群組成員計數等於（最大連接計數）/10。 例如，對於 Unit1，如果有1000的連接計數，則每個群組都有 1000/10 = 100 成員。

[**傳送至群組**] 會為 Azure SignalR Service 增加路由成本，因為它必須透過分散式資料結構尋找目標連接。 隨著傳送連接的增加，成本也會增加。

##### <a name="small-group"></a>小型群組

路由成本非常重要，可將訊息傳送至多個小型群組。 目前，Azure SignalR Service 的執行會達到 Unit50 的路由成本限制。 新增更多的 CPU 和記憶體並不會有説明，因此 Unit100 無法藉由設計進一步改善。 如果您需要更多輸入頻寬，請聯絡客戶支援。

|   傳送至小型群組     | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50 | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|--------|---------|
| 連接               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000 | 100,000
| 群組成員計數        | 10    | 10    | 10     | 10     | 10     | 10     | 10 
| 群組計數               | 100   | 200   | 500    | 1,000  | 2,000  | 5,000  | 10,000 
| 每秒輸入訊息數  | 200   | 400   | 1,000  | 2,500  | 4,000  | 7,000  | 7,000   |
| 輸入頻寬  | 400 KBps  | 800 KBps  | 2 MBps     | 5 MBps     | 8 MBps     | 14 MBps    | 14 MBps     |
| 每秒輸出訊息數 | 2,000 | 4,000 | 10,000 | 25,000 | 40,000 | 70000 | 70000  |
| 輸出頻寬 | 4 MBps    | 8 MBps    | 20 MBps    | 50 MBps     | 80 MBps    | 140 MBps   | 140 MBps    |

許多用戶端連線都會呼叫中樞，因此，應用程式伺服器編號對於效能也是不可或缺的。 下表列出建議的應用程式伺服器計數。

|  傳送至小型群組   | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 連接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 應用程式伺服器計數 | 2     | 2     | 2     | 3      | 3      | 10     | 20      |

> [!NOTE]
> 應用程式伺服器的用戶端連接編號、訊息大小、訊息傳送速度、路由成本、SKU 層和 CPU/記憶體會影響**傳送至小型群組**的整體效能。

##### <a name="big-group"></a>大群組

針對 [**傳送至大型群組**]，輸出頻寬會在達到路由成本限制之前成為瓶頸。 下表列出最大輸出頻寬，這與**廣播**幾乎相同。

|    傳送至大群組      | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| 連接               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000  | 100,000
| 群組成員計數        | 100   | 200   | 500    | 1,000  | 2,000  | 5,000   | 10,000 
| 群組計數               | 10    | 10    | 10     | 10     | 10     | 10      | 10
| 每秒輸入訊息數  | 20    | 20    | 20     | 20     | 20     | 20      | 20      |
| 輸入頻寬  | 80 KBps   | 40 KBps   | 40 KBps    | 20 KBps    | 40 KBps    | 40 KBps     | 40 KBps     |
| 每秒輸出訊息數 | 2,000 | 4,000 | 10,000 | 20,000 | 40,000 | 100,000 | 200,000 |
| 輸出頻寬 | 8 MBps    | 8 MBps    | 20 MBps    | 40 MBps    | 80 MBps    | 200 MBps    | 400 MBps    |

傳送連接計數不超過40。 應用程式伺服器上的負擔很小，因此建議的 web 應用程式數目很小。

|  傳送至大群組  | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 連接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 應用程式伺服器計數 | 2     | 2     | 2     | 2      | 2      | 2      | 2       |

> [!NOTE]
> 在每部應用程式伺服器上，將預設伺服器連線增加5到40，以避免可能的不平衡伺服器連接 Azure SignalR Service。
> 
> 用戶端連接編號、訊息大小、訊息傳送速度、路由成本和 SKU 層會影響**傳送至大型群組**的整體效能。

#### <a name="send-to-connection"></a>傳送至連接

在 [**傳送至**連線] 使用案例中，當用戶端建立與 Azure SignalR Service 的連線時，每個用戶端都會呼叫一個特殊的中樞來取得自己的連接識別碼。 效能基準測試會收集所有連線識別碼、加以洗牌，然後將它們重新指派給所有用戶端，做為傳送目標。 用戶端會持續將訊息傳送至目標連接，直到效能測試完成為止。

![傳送到用戶端使用案例的流量](./media/signalr-concept-performance/sendtoclient.png)

[傳送**至連接**] 的路由成本與 [傳送**至小型群組**] 的成本類似。

當連接計數增加時，路由成本會限制整體效能。 Unit50 已達到限制。 因此，Unit100 無法進一步改善。

下表是執行**傳送至**連線基準測試的許多回合之後的統計摘要。

|   傳送至連接   | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50          | Unit100         |
|------------------------------------|-------|-------|-------|--------|--------|-----------------|-----------------|
| 連接                        | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000          | 100,000         |
| 每秒輸入/輸出訊息數 | 1,000 | 2,000 | 5,000 | 8,000  | 9,000  | 20,000 | 20,000 |
| 輸入/輸出頻寬 | 2 MBps    | 4 MBps    | 10 MBps   | 16 MBps    | 18 MBps    | 40 MBps       | 40 MBps       |

此使用案例需要應用程式伺服器端的高負載。 請參閱下表中建議的應用程式伺服器計數。

|  傳送至連接  | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 連接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 應用程式伺服器計數 | 2     | 2     | 2     | 3      | 3      | 10     | 20      |

> [!NOTE]
> 應用程式伺服器的用戶端連接編號、訊息大小、訊息傳送速度、路由成本、SKU 層和 CPU/記憶體會影響**傳送至**連線的整體效能。

#### <a name="aspnet-signalr-echo-broadcast-and-send-to-small-group"></a>ASP.NET SignalR echo、廣播和傳送至小型群組

Azure SignalR Service 為 ASP.NET SignalR 提供相同的效能容量。 

效能測試會使用適用于 ASP.NET SignalR 的[標準服務方案 S3](https://azure.microsoft.com/pricing/details/app-service/windows/)的 Azure Web Apps。

下表提供 ASP.NET SignalR **echo**的建議 web 應用程式計數。

|   Echo           | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 連接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 應用程式伺服器計數 | 2     | 2     | 4     | 4      | 8      | 32      | 40       |

下表提供 ASP.NET SignalR**廣播**的建議 web 應用程式計數。

|  廣播       | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 連接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 應用程式伺服器計數 | 2     | 2     | 2     | 2      | 2      | 2      | 2       |

下表提供建議的 web 應用程式計數，供 ASP.NET SignalR**傳送至小型群組**。

|  傳送至小型群組     | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 連接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 應用程式伺服器計數 | 2     | 2     | 4     | 4      | 8      | 32      | 40       |

### <a name="serverless-mode"></a>無伺服器模式

用戶端和 Azure SignalR Service 牽涉到無伺服器模式。 每個用戶端都代表單一連接。 用戶端會透過 REST API 將訊息傳送至另一個用戶端，或將訊息廣播到全部。

透過 REST API 傳送高密度訊息的效率不如使用 WebSocket。 您每次都需要建立新的 HTTP 連線，這是無伺服器模式的額外成本。

#### <a name="broadcast-through-rest-api"></a>透過 REST API 廣播
所有用戶端都會建立與 Azure SignalR Service 的 WebSocket 連線。 然後，部分用戶端會透過 REST API 來開始廣播。 傳送（輸入）訊息的全部都是透過 HTTP Post，相較于 WebSocket，這並不有效率。

|   透過 REST API 廣播     | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| 連接               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000  | 100,000 |
| 每秒輸入訊息數  | 2     | 2     | 2      | 2      | 2      | 2       | 2       |
| 每秒輸出訊息數 | 2,000 | 4,000 | 10,000 | 20,000 | 40,000 | 100,000 | 200,000 |
| 輸入頻寬  | 4 KBps    | 4 KBps    | 4 KBps     | 4 KBps     | 4 KBps     | 4 KBps      | 4 KBps      |
| 輸出頻寬 | 4 MBps    | 8 MBps    | 20 MBps    | 40 MBps    | 80 MBps    | 200 MBps    | 400 MBps    |

#### <a name="send-to-user-through-rest-api"></a>透過 REST API 傳送給使用者
基準測試會先將使用者名稱指派給所有用戶端，然後才開始連接到 Azure SignalR Service。 在用戶端建立與 Azure SignalR Service 的 WebSocket 連線之後，他們會透過 HTTP Post 開始將訊息傳送給其他人。

|   透過 REST API 傳送給使用者 | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| 連接               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000  | 100,000 |
| 每秒輸入訊息數  | 300   | 600   | 900    | 1300  | 2,000  | 10,000  | 18,000  |
| 每秒輸出訊息數 | 300   | 600   | 900    | 1300  | 2,000  | 10,000  | 18,000 |
| 輸入頻寬  | 600 KBps  | 1.2 MBps  | 1.8 MBps   | 2.6 MBps   | 4 MBps     | 10 MBps     | 36 MBps    |
| 輸出頻寬 | 600 KBps  | 1.2 MBps  | 1.8 MBps   | 2.6 MBps   | 4 MBps     | 10 MBps     | 36 MBps    |

## <a name="performance-test-environments"></a>效能測試環境

針對稍早列出的所有使用案例，我們已在 Azure 環境中執行效能測試。 我們最多會使用50用戶端 Vm 和20個應用程式伺服器 Vm。 以下是一些詳細資料：

- 用戶端 VM 大小： StandardDS2V2 （2 vCPU，7G memory）

- 應用程式伺服器 VM 大小： StandardF4sV2 （4 vCPU，8G memory）

- Azure SignalR SDK 伺服器連線數：15

## <a name="performance-tools"></a>效能工具

您可以在[GitHub](https://github.com/Azure/azure-signalr-bench/)上找到 Azure SignalR Service 的效能工具。

## <a name="next-steps"></a>後續步驟

在本文中，您會大致瞭解一般使用案例中的 Azure SignalR Service 效能。

若要取得服務內部和規模調整的詳細資料，請參閱下列指南：

* [Azure SignalR Service 內部項目](signalr-concept-internals.md)
* [Azure SignalR Service 調整](signalr-howto-scale-multi-instances.md)
