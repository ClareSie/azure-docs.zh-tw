---
title: 製造商的安全性做法-Azure IoT 裝置布建服務
description: 概述 Oem 和裝置製造商的常見安全性作法，這些做法會準備要在 Azure IoT 裝置布建服務（DPS）中註冊的裝置。
author: timlt
ms.author: timlt
ms.date: 3/02/2020
ms.topic: conceptual
ms.service: iot-dps
ms.custom: iot-p0-scenario, iot-devices-deviceOEM
ms.reviewer: nberdy
ms.openlocfilehash: 3854f353e4ea0b78c0162681e0b89d37419105d8
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/02/2020
ms.locfileid: "80529530"
---
# <a name="security-practices-for-azure-iot-device-manufacturers"></a>Azure IoT 裝置製造商的安全性作法
當有更多製造商發行 IoT 裝置時，識別有關常見實務的指引會很有説明。 本文摘要說明當您製造裝置以與 Azure IoT 裝置布建服務（DPS）搭配使用時，所應考慮的建議安全性做法。  

> [!div class="checklist"]
> * 選取裝置驗證選項
> * 在 IoT 裝置上安裝憑證
> * 將信賴平臺模組（TPM）整合到製造程式

## <a name="selecting-device-authentication-options"></a>選取裝置驗證選項
任何 IoT 裝置安全性措施的最終目標，是要建立安全的 IoT 解決方案。 但是硬體限制、成本和安全性專長等問題都會影響您選擇的選項。 此外，您的安全性方法會影響 IoT 裝置連接到雲端的方式。 雖然要考慮[的 IoT 安全性有數個元素](https://www.microsoft.com/research/publication/seven-properties-highly-secure-devices/)，但每個客戶遇到的一個關鍵元素就是要使用的驗證類型。 

有三種廣泛使用的驗證類型分別是 x.509 憑證、可信賴平臺模組（TPM）和對稱金鑰。 雖然有其他驗證類型存在，但在 Azure IoT 上建立解決方案的大部分客戶都會使用這三種類型的其中一種。 本文的其餘部分會調查使用每種驗證類型的優缺點。

### <a name="x509-certificate"></a>X.509 憑證
X.509 憑證是一種您可以用於驗證的數位身分識別。 X.509 憑證標準記載于[IETF RFC 5280](https://tools.ietf.org/html/rfc5280)中。 在 Azure IoT 中，有兩種方式可驗證憑證：
- 特徵. 指紋演算法會在憑證上執行，以產生十六進位字串。 產生的字串是憑證的唯一識別碼。 
- 以完整鏈為基礎的 CA 驗證。 憑證鏈是驗證終端實體（EE）憑證所需的所有憑證的階層式清單。 若要驗證 EE 憑證，必須驗證鏈中的每個憑證，包括信任的根 CA。 

X.509 的專業人員：
- X.509 是最安全的 Azure IoT 支援的驗證類型。
- X.509 允許高層級控制憑證管理的用途。
- 許多廠商都有提供以 x.509 為基礎的驗證解決方案。

X.509 的缺點：
- 許多客戶可能需要依賴外部廠商來取得其憑證。
- 憑證管理可能會耗費大量成本，並增加整體解決方案成本。
- 如果未妥善考慮物流，則憑證生命週期管理可能會很棘手。 

### <a name="trusted-platform-module-tpm"></a>信賴平台模組 (TPM)
TPM （也稱為[ISO/IEC 11889](https://www.iso.org/standard/66510.html)）是安全產生和儲存密碼編譯金鑰的標準。 TPM 也指的是虛擬或實體的 i/o 裝置，它會與執行標準的模組互動。 TPM 裝置可以當作離散硬體、整合式硬體、以固件為基礎的模組，或以軟體為基礎的模組來存在。 

Tpm 和對稱金鑰之間有兩個主要差異： 
- TPM 晶片也可以儲存 x.509 憑證。
- DPS 中的 TPM 證明會使用 TPM 簽署金鑰（EK），這是一種非對稱式驗證形式。 使用非對稱式驗證時，會使用公開金鑰進行加密，並使用個別的私密金鑰進行解密。 相反地，對稱金鑰會使用對稱式驗證，其中私密金鑰會用於加密和解密。 

TPM 的優點：
- Tpm 在許多 Windows 裝置上都是以標準硬體的形式包含，內含作業系統的內建支援。 
- TPM 證明比共用存取簽章（SAS）以權杖為基礎的對稱金鑰證明更容易受到保護。
- 您可以輕鬆地將裝置認證到期和續約或換用。 每當 TPM 裝置重新布建時，DPS 就會自動匯總 IoT 中樞認證。

TPM 的缺點： 
- Tpm 很複雜，而且可能很容易使用。 
- 除非您有實體 TPM 或品質模擬器，否則使用 Tpm 進行應用程式開發很容易。
- 您可能必須重新設計裝置的面板，以在硬體中包含 TPM。 
- 如果您在 TPM 上變換 EK，它會終結 TPM 的身分識別，並建立一個新的。 雖然實體晶片維持不變，但在您的 IoT 解決方案中會有新的身分識別。

### <a name="symmetric-key"></a>對稱金鑰
使用對稱金鑰時，會使用相同的金鑰來加密和解密訊息。 因此，裝置和用來驗證它的服務都知道相同的金鑰。 Azure IoT 支援以 SAS 權杖為基礎的對稱金鑰連接。 對稱金鑰驗證需要大量擁有者負責保護金鑰，並透過 x.509 authentication 達到同等的安全性等級。 如果您使用對稱金鑰，建議的作法是使用硬體安全性模組（HSM）來保護金鑰。

對稱金鑰的優缺點：
- 使用對稱金鑰是開始使用驗證的最簡單、最低成本方式。
- 使用對稱金鑰可簡化您的程式，因為沒有任何額外的產生。 

對稱金鑰的缺點： 
- 對稱金鑰需要大量的工作來保護金鑰。 裝置與雲端之間會共用相同的金鑰，這表示金鑰必須在兩個地方受到保護。 相較之下，TPM 和 x.509 憑證的挑戰是證明擁有公開金鑰，而不會洩漏私密金鑰。
- 對稱金鑰可讓您輕鬆遵循不良的安全性做法。 對稱金鑰的常見傾向在於將裝置上未加密的金鑰硬式編碼。 雖然這種做法很方便，但它會讓金鑰容易受到攻擊。 您可以將對稱金鑰安全地儲存在裝置上，以降低部分風險。 不過，如果您的優先順序最終是安全性而不是便利性，請使用 x.509 憑證或 TPM 進行驗證。 

### <a name="shared-symmetric-key"></a>共用對稱金鑰
有一種對稱金鑰驗證的變化，稱為共用對稱金鑰。 此方法牽涉到在所有裝置上使用相同的對稱金鑰。 建議避免在您的裝置上使用共用對稱金鑰。 

共用對稱金鑰的 Pro：
- 容易實行，而且成本低廉而產生大規模。 

共用對稱金鑰的缺點： 
- 非常容易遭受攻擊。 輕鬆實行的好處是風險的遠遠超過。 
- 任何人都可以在取得共用金鑰時，模擬您的裝置。
- 如果您依賴遭到入侵的共用對稱金鑰，您可能會失去裝置的控制權。 

### <a name="making-the-right-choice-for-your-devices"></a>為您的裝置做出正確的選擇
若要選擇驗證方法，請務必考慮您獨特製造程式的每種方法的優點和成本。  就裝置驗證而言，指定方法的安全程度和其便利程度之間，通常會有反向關聯性。  

## <a name="installing-certificates-on-iot-devices"></a>在 IoT 裝置上安裝憑證
如果您使用 x.509 憑證來驗證您的 IoT 裝置，本節提供如何將憑證整合到您的製造程式的指引。 您將需要進行數個決策。  其中包括一般憑證變數的決定、何時產生憑證，以及安裝的時機。 

如果您使用密碼，您可能會詢問為何無法在所有裝置上使用相同的憑證，其方式與您在所有裝置上都能使用相同的密碼相同。 首先，在所有位置使用相同的密碼都是危險的。 這種作法已將公司公開到重大的 DDoS 攻擊，包括在美國東部 Coast 的幾年前，將 DNS 帶往下。 千萬不要在任何地方使用相同的密碼，即使使用個人帳戶也一樣。 第二，憑證不是密碼，它是唯一的身分識別。 密碼就像秘密代碼，可供任何人用來在安全的大樓開放大門。  這是您知道的東西，您可以將密碼提供給任何人以取得進入。  憑證就像是驅動程式的相片和其他詳細資料，您可以向防護人員顯示，以取得安全大樓。 它會系結至您的身分。  假設此防護能正確地比對具有驅動程式授權的人員，您只能使用您的授權（身分識別）來取得進入。 

### <a name="variables-involved-in-certificate-decisions"></a>與憑證決策相關的變數
請考慮下列變數，以及每一個變數對整體製造程式的影響。 

#### <a name="where-the-certificate-root-of-trust-comes-from"></a>信任的憑證根來自何處
管理公開金鑰基礎結構（PKI）可能會很昂貴且複雜。  特別是如果您的公司沒有任何管理 PKI 的經驗。 選項包括：
- 使用協力廠商 PKI。 您可以向協力廠商憑證廠商購買中繼簽署憑證。 或者，您可以使用私人憑證授權單位單位（CA）。 
- 使用自我管理的 PKI。 您可以維護自己的 PKI 系統，並產生您自己的憑證。
- 使用[Azure Sphere](https://azure.microsoft.com/services/azure-sphere/)的安全性服務。 此選項只適用于 Azure Sphere 裝置。 

#### <a name="where-certificates-are-stored"></a>憑證的儲存位置
有幾個因素會影響儲存憑證的決策。 這些因素包括裝置類型、預期的收益邊界（不論您是否可以承受保護儲存體）、裝置功能，以及您可以使用的裝置上現有的安全性技術。 請考慮下列選項：
- 在硬體安全模組（HSM）中。 強烈建議使用 HSM。 檢查裝置的控制板是否已安裝 HSM。 如果您知道您沒有 HSM，請與您的硬體製造商合作，找出符合您需求的 HSM。
- 在磁片上的安全位置，例如信任的執行環境（t）。
- 在本機檔案系統或憑證存放區中。 例如，Windows 憑證存放區。 

#### <a name="connectivity-at-the-factory"></a>Factory 的連線能力
Factory 的連線會決定您要如何及何時取得要在裝置上安裝的憑證。 連接選項如下所示：
- 技術. 連線能力最佳，它會簡化在本機產生憑證的程式。 
- 無連線能力。 在此情況下，您會使用 CA 的已簽署憑證，在本機和離線時產生裝置憑證。 
- 無連線能力。 在此情況下，您可以取得之前產生的憑證。 或者，您可以使用離線 PKI 在本機產生憑證。

#### <a name="audit-requirement"></a>Audit 需求
視您產生的裝置類型而定，您可能會有法規需求，以建立裝置上如何安裝裝置身分識別的審核記錄。 審核會增加大量的生產成本。 因此在大部分情況下，只有在必要時才執行此動作。 如果您不確定是否需要進行審核，請洽詢貴公司的法律部門。 審核選項包括： 
- 不是敏感性產業。 不需要進行任何審核。
- 敏感性產業。 根據合規性認證需求，應將憑證安裝在安全室。 如果您需要安全的空間來安裝憑證，您可能已經知道憑證如何安裝在您的裝置上。 而且您可能已經準備好一個 audit 系統。 

#### <a name="length-of-certificate-validity"></a>憑證有效性的長度
如同驅動程式的授權，憑證的到期日會在建立時設定。 以下是憑證有效性長度的選項：
- 不需要更新。  這個方法會使用長時間更新，因此您永遠不需要在裝置的存留期間更新憑證。 雖然這種方法很方便，但也有風險。  您可以使用安全儲存體（如裝置上的 HSM）來降低風險。 不過，建議的作法是避免使用長期存留的憑證。
- 需要更新。  您必須在裝置的存留期間更新憑證。 憑證有效性的長度取決於內容，而您將需要一個更新策略。  策略應該包含您取得憑證的位置，以及您的裝置必須在更新程式中使用的無線功能類型。 

### <a name="when-to-generate-certificates"></a>何時產生憑證
您的工廠中的網際網路連線能力會影響產生憑證的進程。 您有數個選項可供產生憑證的時機： 

- 預先載入的憑證。  有些 HSM 廠商提供一項 premium 服務，HSM 廠商會在其中安裝客戶的憑證。 首先，客戶會授與 HSM 廠商對簽署憑證的存取權。 然後，HSM 廠商會將該簽署憑證所簽署的憑證安裝到客戶購買的每個 HSM 上。 所有客戶都必須在裝置上安裝 HSM。 雖然此服務增加了成本，但有助於簡化您的製造流程。  而且它會解決何時安裝憑證的問題。
- 裝置產生的憑證。  如果您的裝置在內部產生憑證，則必須從裝置解壓縮公用的 x.509 憑證，以在 DPS 中進行註冊。 
- 連線的處理站。  如果您的 factory 具有連線能力，您可以在需要時產生裝置憑證。
- 使用您自己的 PKI 的離線 factory。 如果您的工廠沒有連線能力，而且您使用自己的 PKI 搭配離線支援，您可以在需要時產生憑證。
- 具有協力廠商 PKI 的離線 factory。 如果您的 factory 沒有連線能力，而且您使用的是協力廠商 PKI，則必須預先產生憑證。 而且需要從具有連線能力的位置產生憑證。 

### <a name="when-to-install-certificates"></a>安裝憑證的時機
為 IoT 裝置產生憑證之後，您可以將它們安裝在裝置上。 

如果您使用預先載入的憑證搭配 HSM，則會簡化此程式。 在裝置上安裝 HSM 之後，裝置程式碼就可以存取它。 接著，您將呼叫 HSM Api 來存取儲存在 HSM 中的憑證。 這種方法最方便您的製造流程。 

如果您不使用預先載入的憑證，您必須在生產過程中安裝憑證。 最簡單的方法是在您閃爍初始固件映射的同時，同時在 HSM 中安裝憑證。 您的程式必須新增在每部裝置上安裝映射的步驟。 在此步驟之後，您可以執行最終品質檢查和任何其他步驟，然後再封裝和寄送裝置。 

有一些軟體工具可讓您在單一步驟中執行安裝程式和最終品質檢查。 您可以修改這些工具來產生憑證，或從預先產生的憑證存放區提取憑證。 然後軟體就可以安裝您需要安裝的憑證。 這種類型的軟體工具可讓您大規模執行生產環境品質的製造。 

在您的裝置上安裝憑證之後，下一步就是了解如何使用[DPS](about-iot-dps.md)註冊裝置。 

## <a name="integrating-a-tpm-into-the-manufacturing-process"></a>將 TPM 整合到製造程式
如果您使用 TPM 來驗證您的 IoT 裝置，本節會提供指引。 本指南涵蓋廣泛使用的 TPM 2.0 裝置，其具有雜湊式訊息驗證碼（HMAC）金鑰支援。 TPM 晶片的 TPM 規格是由受信任計算群組維護的 ISO 標準。 如需 TPM 的詳細資訊，請參閱[tpm 2.0](https://trustedcomputinggroup.org/tpm-library-specification/)和[ISO/IEC 11889](https://www.iso.org/standard/66510.html)的規格。 

### <a name="taking-ownership-of-the-tpm"></a>取得 TPM 的擁有權
使用 TPM 晶片製造裝置的重要步驟是取得 TPM 的擁有權。 這是必要步驟，讓您可以為裝置擁有者提供金鑰。 第一個步驟是從裝置解壓縮簽署金鑰（EK）。 下一步是實際宣告擁有權。 完成此作業的方式取決於您所使用的 TPM 和作業系統。 如有需要，請洽詢 TPM 製造商或裝置作業系統的開發人員，以判斷如何宣告擁有權。 

在您的製造過程中，您可以在不同的時間解壓縮 EK 和宣告擁有權，這會增加彈性。 許多製造商藉由新增硬體安全性模組（HSM）來強化其裝置的安全性，以利用此彈性。 本節提供何時解壓縮 EK、何時宣告 TPM 擁有權，以及將這些步驟整合到製造時間軸的考慮等指引。 

> [!IMPORTANT]
> 下列指導方針假設您使用的是獨立、固件或整合的 TPM。 在適用的地方，指導方針會新增使用非離散或軟體 TPM 的附注。 如果您使用軟體 TPM，可能會有本指南未包含的其他步驟。 軟體 Tpm 有各種不同的實作為，不在本文的討論範圍內。  一般來說，您可以將軟體 TPM 整合到下列一般製造時程表。 不過，當軟體模擬 TPM 適用于原型設計和測試時，它無法提供與獨立、固件或整合式 TPM 相同層級的安全性。 一般的作法是避免在生產環境中使用軟體 TPM。

### <a name="general-manufacturing-timeline"></a>一般製造時程表
下列時間軸會顯示 TPM 如何通過生產進程，並在裝置中結束。 每個製造程式都是唯一的，此時間軸會顯示最常見的模式。 時間軸提供有關何時採取特定動作來處理金鑰的指引。 

#### <a name="step-1-tpm-is-manufactured"></a>步驟1： TPM 已製造
- 如果您向製造商購買 Tpm 以用於您的裝置，請查看他們是否會為您解壓縮公開簽署金鑰（EK_pubs）。 如果製造商提供隨附裝置的 EK_pubs 清單，這會很有説明。 
    > [!NOTE]
    > 您可以使用布建服務中的共用存取原則，將您註冊清單的寫入權限授與 TPM 製造商。  這種方法可讓他們將 Tpm 新增至您的註冊清單。  但這在製造過程中是早期的，而且需要 TPM 製造商的信任。 請自行承擔風險。 

- 如果您製造 Tpm 以向裝置製造商銷售，請考慮為客戶提供一份 EK_pubs 清單及其實體 Tpm。  為客戶提供 EK_pubs 在其程式中節省步驟。 
- 如果您製造 Tpm 以與您自己的裝置搭配使用，請識別您的程式中哪一個點最方便用來解壓縮 EK_pub。 您可以在時間軸中的任何剩餘點解壓縮 EK_pub。 

#### <a name="step-2-tpm-is-installed-into-a-device"></a>步驟2： TPM 已安裝到裝置中
在生產過程中，您應該知道裝置將使用哪個 DPS 實例。 因此，您可以將裝置新增至自動布建的註冊清單。 如需自動裝置布建的詳細資訊，請參閱[DPS 檔](about-iot-dps.md)。
- 如果您尚未解壓縮 EK_pub，現在是很好的時機。 
- 視 TPM 的安裝程式而定，此步驟也是取得 TPM 擁有權的好時機。 

#### <a name="step-3-device-has-firmware-and-software-installed"></a>步驟3：裝置已安裝固件和軟體
此時，請安裝 DPS 用戶端以及識別碼範圍和全域 URL 以進行布建。
- 現在是解壓縮 EK_pub 的最後機會。 如果協力廠商會將軟體安裝在您的裝置上，最好先將 EK_pub 解壓縮。
- 在製造過程中，這一點很適合取得 TPM 的擁有權。  
    > [!NOTE]
    > 如果您使用的是軟體 TPM，可以立即進行安裝。  同時解壓縮 EK_pub。

#### <a name="step-4-device-is-packaged-and-sent-to-the-warehouse"></a>步驟4：裝置已封裝並傳送至倉儲
在部署之前，裝置可以在倉儲中等待6-12 個月。 

#### <a name="step-5-device-is-installed-into-the-location"></a>步驟5：裝置已安裝到位置
裝置抵達其最終位置之後，會經歷使用 DPS 進行自動布建。

如需詳細資訊，請參閱[自動布建概念](concepts-auto-provisioning.md)和[TPM 證明](concepts-tpm-attestation.md)。 

## <a name="resources"></a>資源

除了本文中的建議安全性做法以外，Azure IoT 還提供資源，協助您選取安全的硬體並建立安全的 IoT 部署： 
- Azure IoT[安全性建議](../iot-fundamentals/security-recommendations.md)，以引導部署程式。 
- [Azure 資訊安全中心](https://azure.microsoft.com/services/security-center/)提供一種服務，可協助建立安全的 IoT 部署。 
- 如需評估硬體環境的協助，請參閱[評估您的 IoT 安全性](https://download.microsoft.com/download/D/3/9/D3948E3C-D5DC-474E-B22F-81BA8ED7A446/Evaluating_Your_IOT_Security_whitepaper_EN_US.pdf)白皮書。 
- 如需有關選取安全硬體的說明，請參閱[適用于 IoT 部署的正確安全硬體](https://download.microsoft.com/download/C/0/5/C05276D6-E602-4BB1-98A4-C29C88E57566/The_right_secure_hardware_for_your_IoT_deployment_EN_US.pdf)。 