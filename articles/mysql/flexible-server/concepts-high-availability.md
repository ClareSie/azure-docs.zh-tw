---
title: 使用適用於 MySQL 的 Azure 資料庫彈性伺服器的區域冗余高可用性總覽
description: 瞭解適用於 MySQL 的 Azure 資料庫彈性伺服器的區域冗余高可用性概念
author: kummanish
ms.author: manishku
ms.service: mysql
ms.topic: conceptual
ms.date: 09/21/2020
ms.openlocfilehash: 9db5776a4d2395baf03a5ed7cf05db49de8d0321
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/09/2020
ms.locfileid: "90933872"
---
# <a name="high-availability-concepts-in-azure-database-for-mysql-flexible-server-preview"></a>適用於 MySQL 的 Azure 資料庫彈性的伺服器 (預覽) 的高可用性概念

> [!IMPORTANT] 
> 適用於 MySQL 的 Azure 資料庫 - 彈性伺服器目前處於公開預覽狀態。

適用於 MySQL 的 Azure 資料庫彈性的伺服器 (預覽版) ，可讓您使用 **區域冗余** 高可用性選項來設定具有自動容錯移轉的高可用性。 部署於區域備援設定時，彈性伺服器會自動在不同的可用性區域中佈建和管理待命複本。 使用儲存體層級複寫時，資料會以 **同步** 方式複寫至次要區域中的待命伺服器，以在容錯移轉之後啟用零資料遺失。 用戶端應用程式的容錯移轉完全透明，不需要任何使用者動作。 待命伺服器無法供任何讀取或寫入作業使用，而是被動待命，以啟用快速容錯移轉。 容錯移轉時間通常的範圍是60-120 秒。

區域冗余高可用性設定可在規劃的事件期間啟用自動容錯移轉，例如，基礎硬體和軟體錯誤、網路失敗，甚至是可用性區域失敗。

:::image type="content" source="./media/concepts-high-availability/1-flexible-server-overview-zone-redundant-ha.png" alt-text="區域冗余高可用性的觀點":::

## <a name="zone-redundancy-architecture"></a>區域冗余架構

主伺服器會部署在區域和特定的可用性區域中。 選擇高可用性時，會自動部署與主伺服器具有相同設定的待命複本伺服器，包括計算層、計算大小、儲存體大小和網路設定。 記錄資料會以同步方式複寫到待命複本，以確保任何失敗狀況中的資料不會遺失。 自動備份（快照集和記錄備份）會從主資料庫伺服器執行。 

HA 的健康情況會持續受到監視，並在 [總覽] 頁面上報告。

以下列出各種複寫狀態：

| **狀態** | **描述** |
| :----- | :------ |
| <b>NotEnabled | 未啟用區域冗余 HA |
| <b>CreatingStandby | 在建立新待命的過程中 |
| <b>ReplicatingData | 待命建立之後，就會與主伺服器趕上。 |
| <b>FailingOver | 資料庫伺服器正在從主伺服器容錯移轉到待命。 |
| <b>Healthy | 區域冗余 HA 處於穩定狀態且狀況良好。 |
| <b>RemovingStandby | 根據使用者動作，待命複本正在刪除中。| 

## <a name="advantages"></a>優點

以下是使用區域冗余 HA 功能的一些優點： 

-   待命複本將會部署在與主要 VM 設定相同的 VM 設定中，例如虛擬核心、儲存體、網路設定 (VNET、防火牆) 等。
-   藉由停用高可用性來移除待命複本的能力。
-   自動備份是以快照集為基礎，從主資料庫伺服器執行，並儲存在區域多餘的儲存體中。
-   如果有容錯移轉事件，會在原始主要可用性區域中布建新的待命複本。
-   用戶端一律會連接到主資料庫伺服器。
-   如果發生資料庫損毀或節點失敗，將會在相同節點上先嘗試重新開機。 如果失敗，則會觸發自動容錯移轉。
-   重新開機伺服器以挑選任何靜態伺服器參數變更的能力。

## <a name="steady-state-operations"></a>穩定狀態作業

應用程式會使用資料庫伺服器名稱連接到主伺服器。 待命複本資訊不會公開以供直接存取。 只有在記錄檔是以同步方式保存在主伺服器的磁片和待命複本上時，才會認可和寫入至應用程式。 由於這項額外的來回行程需求，應用程式可能會預期寫入和認可的延遲較高。 您可以在入口網站上監視高可用性的健全狀況。

## <a name="failover-process"></a>容錯移轉程序 
針對商務持續性，您需要有規劃和未規劃事件的容錯移轉程式。 

### <a name="planned-events"></a>規劃的事件

規劃的停機事件包含 Azure 所排程的活動，例如定期軟體更新、次要版本升級或客戶所起始的活動，例如調整計算和調整儲存體作業。 這些變更會先套用至待命複本。 在這段期間，應用程式會繼續存取主伺服器。 一旦更新待命複本之後，就會清空主伺服器連線，並觸發容錯移轉，以藉由更新 DNS 記錄，將待命複本啟用為具有相同資料庫伺服器名稱的主要複本。 用戶端連接已中斷連線，而且必須重新連線，並可繼續其作業。 新的待命伺服器將會在與舊的主資料庫相同的區域中建立。 整體容錯移轉時間應為 60-120 s。 

>[!NOTE]
> 在計算調整作業的情況下，我們會調整次要複本伺服器，後面接著主伺服器。 沒有相關的容錯移轉。

### <a name="failover-process---unplanned-events"></a>容錯移轉程式-非計畫的事件
未計畫的服務停機時間包含軟體錯誤，或基礎結構錯誤（例如計算、網路、儲存體失敗或電源中斷）會影響資料庫的可用性。 如果資料庫無法使用，就會中斷對待命複本的複寫，並啟用待命複本作為主資料庫。 DNS 會更新，然後用戶端會重新連線到資料庫伺服器，並繼續其作業。 整體容錯移轉時間預期會採用60-120 秒。 不過，根據主資料庫伺服器在容錯移轉時的活動（例如大型交易和復原時間），容錯移轉可能需要較長的時間。

## <a name="schedule-maintenance-window"></a>排程維護時段 

彈性伺服器提供維護排程功能，您可以在其中選擇30分鐘的時間範圍，在這段期間內，Azure 維護的運作方式，例如修補或次要版本升級。 針對以高可用性設定的彈性伺服器，這些維護活動會先在待命複本上執行。 

## <a name="point-in-time-restore"></a>時間點還原 
隨著高可用性設定的彈性伺服器會以同步方式複寫資料，待命伺服器會與主要複本保持在最新狀態。 在主要複本上的任何使用者錯誤（例如意外卸載資料表或不正確的更新），會忠實地複寫到待命。 因此，您無法使用待命來從這類邏輯錯誤中復原。 若要從這些邏輯錯誤中復原，您必須在發生錯誤之前執行時間點還原。 使用彈性伺服器的時間點還原功能時，當您還原以高可用性設定的資料庫時，會以使用者提供的名稱，將新的資料庫伺服器還原為新的彈性伺服器。 然後，您可以從資料庫伺服器匯出物件，並將它匯入實際執行的資料庫伺服器。 同樣地，如果您想要複製您的資料庫伺服器以供測試和開發之用，或想要針對任何其他用途進行還原，您可以選擇最新的還原點或自訂還原點。 還原作業將會建立單一區域彈性的伺服器。

## <a name="mitigate-downtime"></a>減少停機時間 
當您未使用區域冗余 HA 功能時，您仍然必須能夠減少應用程式的停機時間。 規劃的服務停機時間（例如排程的修補程式、次要版本升級或使用者起始的作業）可作為排程維護期間的一部分來執行。 規劃的服務停機時間（例如排程的修補程式、次要版本升級或使用者起始的作業，例如調整計算）會造成停機時間。 若要降低 Azure 起始維護工作的應用程式影響，您可以選擇在一周的哪一天以及最不影響應用程式的時間進行排程。 

在非計畫的停機事件（例如資料庫損毀或伺服器失敗）期間，受影響的伺服器將在相同區域內重新開機。 雖然很罕見，如果整個區域受到影響，您可以在該區域內的另一個區域還原資料庫。 

## <a name="things-to-know-with-zone-redundancy"></a>區域冗余的須知事項 

當您使用區域冗余高可用性時，請注意以下幾個考慮： 

-   高可用性 **只能** 在彈性的伺服器建立時間進行設定。
-   高載計算層級不支援高可用性。
-   由於同步複寫到另一個可用性區域，主資料庫伺服器可能會遇到較高的寫入和認可延遲。
-   待命複本無法用於唯讀查詢。
-   根據主伺服器上的活動在容錯移轉時，最多可能需要60-120 秒或更長的時間才能完成容錯移轉。
-   重新開機主資料庫伺服器來挑選靜態參數變更也會重新開機待命複本。
-   不支援設定區域冗余高可用性伺服器的讀取複本。
-   設定客戶起始的管理工作無法在受控維護期間自動執行。
-   規劃的事件（例如調整計算和次要版本升級）會同時在主要和待命中進行。 


## <a name="next-steps"></a>後續步驟

-   瞭解 [商務持續性](./concepts-business-continuity.md)
-   深入瞭解 [區域冗余高可用性](./concepts-high-availability.md)
-   瞭解[備份和](./concepts-backup-restore.md)復原
