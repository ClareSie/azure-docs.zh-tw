---
title: 診斷圖形效能問題遠端桌面-Azure
description: 本文說明如何在遠端桌面通訊協定會話中使用 RemoteFX 圖形計數器，以診斷 Windows 虛擬桌面圖形的效能問題。
author: Heidilohr
ms.topic: troubleshooting
ms.date: 05/23/2019
ms.author: helohr
manager: lizross
ms.openlocfilehash: dc5c6499fa47a1e32a517032d5cc2a97b3f2677f
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/09/2020
ms.locfileid: "88007161"
---
# <a name="diagnose-graphics-performance-issues-in-remote-desktop"></a>診斷遠端桌面的圖形效能問題

為了診斷遠端會話的體驗品質問題，效能監視器的 RemoteFX 圖形區段下提供了計數器。 本文可協助您在使用這些計數器的遠端桌面通訊協定 (RDP) 會話期間，找出並修正圖形相關的效能瓶頸。

## <a name="find-your-remote-session-name"></a>尋找您的遠端會話名稱

您將需要遠端會話名稱以識別圖形效能計數器。 遵循本節中的指示來識別每個計數器的實例。

1. 從遠端會話開啟 Windows 命令提示字元。
2. 執行 **qwinsta** 命令，並尋找您的會話名稱。
    - 如果您的會話裝載于多會話的虛擬機器 (VM) ：您的每個計數器實例的尾碼會與您的會話名稱後置詞相同，例如 "rdp-tcp 37"。
    - 如果您的會話裝載于支援虛擬圖形處理單元的 VM (vGPU) ：每個計數器的實例會儲存在伺服器上，而不是儲存在您的 VM 中。 您的計數器實例包含 VM 名稱，而不是會話名稱中的數位，例如「Win8 Enterprise VM」。

>[!NOTE]
> 雖然計數器的名稱中有 RemoteFX，但它們也包含了在 vGPU 案例中的遠端桌面圖形。

## <a name="access-performance-counters"></a>存取效能計數器

確定您的遠端會話名稱之後，請依照下列指示收集遠端會話的 RemoteFX 圖形效能計數器。

1. 選取 [**啟動**系統  >  **管理工具**  >  **效能監視器**]。
2. 在 [ **效能監視器** ] 對話方塊中，展開 [ **監視工具**]，選取 [ **效能監視器**]，然後選取 [ **新增**]。
3. 在 [ **新增計數器** ] 對話方塊中，從 [ **可用的計數器** ] 清單中展開 [RemoteFX 圖形] 區段。
4. 選取要監視的計數器。
5. 在 [ **選取的物件實例** 清單] 清單中，選取要監視的特定實例，然後選取 [ **加入**]。 若要選取所有可用的計數器實例，請選取 [ **所有實例**]。
6. 新增計數器之後，請選取 **[確定]**。

選取的效能計數器會出現在效能監視器畫面上。

>[!NOTE]
>主機上的每個作用中會話都有自己的每個效能計數器實例。

## <a name="diagnose-issues"></a>診斷問題

圖形相關的效能問題通常分為四類：

- 低畫面播放速率
- 隨機停止
- 高輸入延遲
- 畫面格品質不佳

### <a name="addressing-low-frame-rate-random-stalls-and-high-input-latency"></a>解決低畫面播放速率、隨機停止和高輸入延遲

先檢查輸出框架/秒計數器。 它會測量可供用戶端使用的框架數目。 如果這個值小於輸入框架/秒計數器，則會略過框架。 若要找出瓶頸，請使用略過的框架/秒計數器。

略過三種類型的框架/第二個計數器：

- 略過的框架/秒 (伺服器資源不足) 
- 略過的框架/秒 (網路資源不足) 
- 略過的框架/秒 (用戶端資源不足) 

任何略過的框架/秒計數器的值很高，表示問題與計數器追蹤的資源有關。 例如，如果用戶端未以伺服器提供框架的相同速率來解碼和呈現畫面格，則略過的框架/秒 (的用戶端資源不足) 計數器將會很高。

如果輸出畫面格/第二個計數器符合輸入框架/第二個計數器，但您仍發現不尋常的延遲或拖延，則平均編碼時間可能是可能的原因。 編碼是在單一會話中的伺服器上發生的同步程式 (vGPU) 案例，以及在多會話案例中的 VM 上發生。 平均編碼時間應低於33毫秒。 如果平均編碼時間低於33毫秒，但您仍有效能問題，您所使用的應用程式或作業系統可能發生問題。

如需診斷應用程式相關問題的詳細資訊，請參閱 [使用者輸入延遲效能計數器](/windows-server/remote/remote-desktop-services/rds-rdsh-performance-counters/)。

因為 RDP 支援平均編碼時間33毫秒，所以支援最多每秒30個畫面格的輸入畫面播放速率。 請注意，33 ms 是支援的畫面播放速率上限。 在許多情況下，使用者所經歷的畫面播放速率將會較低，視來源提供給 RDP 的畫面頻率而定。 例如，監看影片的工作需要每秒30個畫面格的完整輸入畫面播放速率，但較不常進行大量運算的工作（例如不常編輯檔）會導致輸入畫面的值更低，而不會降低使用者的體驗品質。

### <a name="addressing-poor-frame-quality"></a>解決框架品質不良的情況

使用 [框架品質] 計數器診斷畫面格品質問題。 此計數器會以來源框架品質的百分比表示輸出框架的品質。 品質損失可能是因為 RemoteFX，也可能是圖形來源的固有原因。 如果 RemoteFX 導致品質遺失，問題可能是缺少網路或伺服器資源，因此無法傳送較高的內容。

## <a name="mitigation"></a>降低

如果伺服器資源造成瓶頸，請嘗試下列其中一種方法來改善效能：

- 減少每個主機的會話數目。
- 增加伺服器上的記憶體和計算資源。
- 捨棄連接的解析度。

如果網路資源造成瓶頸，請嘗試下列其中一種方法來改善每個會話的網路可用性：

- 減少每個主機的會話數目。
- 使用較高頻寬的網路。
- 捨棄連接的解析度。

如果用戶端資源造成瓶頸，請嘗試下列其中一種方法來改善效能：

- 安裝最新的遠端桌面用戶端。
- 增加用戶端電腦上的記憶體和計算資源。

> [!NOTE]
> 我們目前不支援來源框架/秒計數器。 目前，來源框架/秒計數器一律會顯示0。

## <a name="next-steps"></a>後續步驟

- 若要建立 GPU 優化的 Azure 虛擬機器，請參閱 [設定圖形處理單元 (gpu) 加速 Windows 虛擬桌面環境](configure-vm-gpu.md)。
- 如需疑難排解和擴大追蹤的總覽，請參閱 [疑難排解總覽、意見反應和支援](troubleshoot-set-up-overview.md)。
- 若要深入瞭解此服務，請參閱 [Windows 桌面環境](environment-setup.md)。
