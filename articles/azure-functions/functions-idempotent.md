---
title: 為相同的輸入設計 Azure 函數
description: 構建 Azure 函數以具有冪等功能
author: craigshoemaker
ms.author: cshoe
ms.date: 9/12/2019
ms.topic: article
ms.openlocfilehash: 15af60ac5a862e6fb20e65ba6fbb92482420b7c0
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/27/2020
ms.locfileid: "74226864"
---
# <a name="designing-azure-functions-for-identical-input"></a>為相同的輸入設計 Azure 函數

事件驅動和基於消息的體系結構的現實要求需要接受相同的請求，同時保持資料完整性和系統穩定性。

為了說明這一點，請考慮使用電梯呼叫按鈕。 當你按下按鈕時，它亮起，電梯被發送到你的地板。 幾分鐘後，其他人加入你到大廳。 這個人對你微笑，第二次按下發光按鈕。 當你被提醒說叫電梯的命令是冪等的時，你微笑著對自己咯咯地笑。

第二次、第三次或第四次按下電梯呼叫按鈕與最終結果無關。 當您按下按鈕時，無論多次，電梯都會發送到您的樓層。 冪等系統，如電梯，無論發出多少次相同的命令，都會產生相同的結果。

在構建應用程式時，請考慮以下方案：

- 如果您的庫存控制應用程式嘗試多次刪除同一產品，會發生什麼情況？
- 如果有多個請求為同一個人創建員工記錄，您的人力資源應用程式如何執行？
- 如果你的銀行應用程式收到100個相同的提款請求，錢會到哪裡去？

在有許多情況下，對函數的請求可能會收到相同的命令。 在某些情況下，包括：

- 重試多次發送相同請求的策略
- 重新播放到應用程式的緩存命令
- 發送多個相同請求的應用程式錯誤

為了保護資料完整性和系統運行狀況，冪等應用程式包含可能包含以下行為的邏輯：

- 在嘗試執行刪除之前驗證資料是否存在
- 在嘗試執行創建操作之前檢查是否存在資料
- 協調邏輯，創建資料的最終一致性
- 併發控制
- 重複檢測
- 資料新鮮度驗證
- 保護邏輯以驗證輸入資料

最終，通過確保給定的行動成為可能，並且只執行一次，從而達到效力。
