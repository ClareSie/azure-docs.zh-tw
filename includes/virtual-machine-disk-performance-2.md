---
title: 包含檔案
description: 包含檔案
services: virtual-machines
author: albecker1
ms.service: virtual-machines
ms.topic: include
ms.date: 09/25/2020
ms.author: albecker1
ms.custom: include file
ms.openlocfilehash: e5a6dae98e786bf55dc17d8fabe42f84e9927442
ms.sourcegitcommit: ffa7a269177ea3c9dcefd1dea18ccb6a87c03b70
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/30/2020
ms.locfileid: "91606066"
---
![Dsv3 檔](media/vm-disk-performance/dsv3-documentation.jpg)

最大未快取 **的磁片輸送量** 是虛擬機器能夠處理的預設儲存體上限。 當您啟用主機快取時， **最大快** 取儲存體輸送量限制是個別的限制。 主機快取的運作方式是讓儲存體更接近可供寫入或讀取的 VM。 適用于主機快取的 VM 可用的儲存體數量是在檔中。 例如，您可以看到 Standard_D8s_v3 隨附于200快取儲存體 GiB。

建立虛擬機器並連接磁片時，可以完成啟用主機快取。 您也可以調整以開啟和關閉主機快取在現有 VM 上的磁片。

![主機快取](media/vm-disk-performance/host-caching.jpg)

您可以調整主機快取，以符合每個磁片的工作負載需求。 您可以將主機快取設定為唯讀的工作負載，這些工作負載只會針對讀取和寫入作業進行平衡的工作負載進行讀取作業和讀取/寫入工作負載。 如果您的工作負載不符合任何一種模式，則不建議使用「使用主機快取」。 

讓我們執行一些不同主機快取設定的範例，並查看它如何影響資料流程和效能。 在第一個範例中，我們將探討當主機快取設定設為 **唯讀**時，IO 要求會發生什麼事。

設定：
- Standard_D8s_v3 
    - 快取的 IOPS：16000
    - 未快取的 IOPS：12800
- P30 資料磁片 
    - IOPS：5000
    - **主機快取：唯讀** 

當執行讀取且快取上有所需的資料時，快取會傳回要求的資料，而且不需要從磁片讀取。 這項讀取會計算 VM 的快取限制。

![讀取主機快取讀取點擊次數](media/vm-disk-performance/host-caching-read-hit.jpg)

當執行讀取，且快取上 **未** 提供所需的資料時，會將讀取要求轉送到磁片，然後將它呈現給快取和 VM。 這項讀取會計算 VM 的未快取限制和 VM 的快取限制。

![讀取主機快取讀取遺漏](media/vm-disk-performance/host-caching-read-miss.jpg)

執行寫入時，必須先將寫入寫入至快取和磁片，然後才會被視為已完成。 此寫入會計算 VM 的未快取限制和 VM 的快取限制。

![讀取主機快取寫入](media/vm-disk-performance/host-caching-write.jpg)

在下一個範例中，讓我們看看當主機快取設定為 [ **讀取/寫入**] 時，IO 要求會發生什麼事。

設定：
- Standard_D8s_v3 
    - 快取的 IOPS：16000
    - 未快取的 IOPS：12800
- P30 資料磁片 
    - IOPS：5000
    - **主機快取：讀取/寫入** 

讀取的處理方式與唯讀完全相同，寫入是唯一不同于讀取/寫入快取的內容。 當寫入主機快取設定為讀取/寫入時，寫入只需要寫入主機快取，才能被視為已完成。 然後寫入會以背景進程的形式，延遲寫入磁片。 這表示寫入至快取時，將會計算寫入至快取 IO 的數量，而且當它延遲寫入磁片時，會計算到未快取的 IO。

![讀取/寫入主機快取寫入](media/vm-disk-performance/host-caching-read-write.jpg)

讓我們繼續進行 Standard_D8s_v3 虛擬機器的範例。 但這次我們將在磁片上啟用主機快取，而現在 VM 的 IOPS 限制為 16000 IOPS。 連接至 VM 的三個基礎 P30 磁片可以處理 5000 IOPS。

設定：
- Standard_D8s_v3 
    - 快取的 IOPS：16000
    - 未快取的 IOPS：12800
- P30 OS 磁片 
    - IOPS：5000
    - 主機快取：讀取/寫入 
- 2 P30 資料磁片
    - IOPS：5000
    - 主機快取：讀取/寫入

![主機快取範例](media/vm-disk-performance/host-caching-example-without-remote.jpg)

現在，在啟用快取的情況下使用此 Standard_D8s_v3 虛擬機器的應用程式，會提出 15000 IOPS 的要求。 這些要求會細分為每個連接的基礎磁片的 5000 IOPS，且不會發生效能上限。

## <a name="combined-uncached-and-cached-limits"></a>結合未快取和快取的限制

虛擬機器的快取限制與其未快取的限制不同。 這表示您可以在連結至 vm 的磁片上啟用主機快取，同時也不會啟用其他磁片上的主機快取，讓您的虛擬機器能夠取得快取限制的總儲存體 IO 加上未快取的限制。 讓我們執行這項作業的範例，以協助鞏固這些限制的運作方式，我們將繼續進行 Standard_D8s_v3 的虛擬機器和高階磁片連接設定。

設定：
- Standard_D8s_v3 
    - 快取的 IOPS：16000
    - 未快取的 IOPS：12800
- P30 OS 磁片 
    - IOPS：5000
    - 主機快取：讀取/寫入
- 2 P30 資料磁片 X 2
    - IOPS：5000
    - 主機快取：讀取/寫入
- 2 P30 資料磁片 X 2
    - IOPS：5000
    - 主機快取：已停用

![使用遠端存放的主機快取範例](media/vm-disk-performance/host-caching-example-with-remote.jpg)

現在，在 Standard_D8s_v3 虛擬機器上執行的應用程式會提出 25000 IOPS 的要求。 此要求會細分為每個連接的基礎磁片的 5000 IOPS，其中3個磁片使用主機快取，而2個磁片不是。 由於使用主機快取的3是在16000的快取限制內，因此這些要求已順利完成，而且不會發生儲存體效能上限。 此外，由於2個未使用主機快取的磁片是在未快取的限制12800內，因此這些要求也會成功完成，而且不會發生任何上限。

## <a name="metrics-for-disk-performance"></a>磁片效能的計量
我們在 Azure 上有一些計量，可讓您深入瞭解虛擬機器和磁片的執行情況。 您可以透過 Azure 入口網站以視覺化方式觀看這些計量，或透過 API 呼叫來抓取這些計量。 計量會以一分鐘的間隔計算。 下列計量可讓您深入瞭解 VM 和磁片 IO 和輸送量效能：
- **Os 磁片佇列深度** –等候讀取或寫入 OS 磁片的目前未完成 IO 要求數目。
- **Os Disk Read Bytes/Sec** –從 OS 磁片讀取的位元組數目。
- **Os Disk Read operations/Sec** –從 OS 磁片讀取的輸入作業數（秒）。
- **Os Disk Write Bytes/Sec** –以秒為單位從 os 磁片寫入的位元組數目。
- **Os 磁片寫入作業數/秒** –從 OS 磁片以秒數寫入的輸出作業數目。
- **資料磁片佇列深度** –等候讀取或寫入資料磁片 (s 的目前未完成 IO 要求數目) 。
- **資料磁片讀取位元組數/秒** –從資料磁片 (s) 讀取的位元組數目。
- **資料磁片讀取作業數/秒** –從資料磁片 () 讀取的輸入作業數。
- **資料磁片寫入位元組數/秒** –從資料磁片 (s) 以秒為單位寫入的位元組數目。
- **資料磁片寫入作業數/秒** –從資料磁片 (s) 寫入的輸出作業數目。
- **磁片讀取位元組數/秒** –從所有連接到 VM 的磁片讀取的位元組總數。
- **磁片讀取作業數/秒** –從所有連接至 VM 的磁片讀取的輸入作業數目。
- **磁片寫入位元組數/秒** –從連接至 VM 的所有磁片以秒為單位寫入的位元組數目。
- **磁片寫入作業數/秒–每** 秒從連結至 VM 的所有磁片寫入的輸出作業數目。

## <a name="storage-io-utilization-metrics"></a>儲存體 IO 使用量計量
協助診斷磁片 IO 上限的計量：
- **資料磁片 Iops 耗用百分比** -透過布建的資料磁片 iops 完成的資料磁片 iops 所計算的百分比。 如果此數量為100%，則您的應用程式執行將會從您的資料磁片的 IOPS 限制，以 IO 為上限。
- **使用的資料磁片頻寬百分比** -透過布建的資料磁片輸送量完成的資料磁片輸送量所計算的百分比。 如果此數量為100%，則您的應用程式執行將會從您的資料磁片的頻寬限制，以 IO 為上限。
- **作業系統磁片 Iops 耗用百分比** -透過布建的 OS 磁片 iops 完成的 OS 磁片 iops 所計算的百分比。 如果此數量為100%，則您的應用程式將會從您的 OS 磁片的 IOPS 限制，以 IO 為上限。
- **作業系統磁片頻寬耗用百分比** -透過布建的 os 磁片輸送量完成的 os 磁片輸送量所計算的百分比。 如果此數量為100%，則您的應用程式執行將會是作業系統磁片的頻寬限制的 IO。

協助診斷 VM IO 上限的計量：
- VM 快取的**Iops 耗用百分比**-以已完成的 iops 總數計算的百分比，超過最大快取的虛擬機器 iops 限制。 如果此數量為100%，則執行中的應用程式將會是 VM 的快取 IOPS 限制的 IO。
- VM 快取的**頻寬使用量百分比**-以最大快取的虛擬機器輸送量完成的總磁片輸送量所計算的百分比。 如果此數量為100%，則您的應用程式執行將會是 VM 的快取頻寬限制的 IO。
- VM 未快取的已**耗用 IOPS 百分比**-虛擬機器上的總 IOPS 所計算的百分比，以超過最大未快取的虛擬機器 iops 限制來完成。 如果此數量為100%，則您的應用程式執行將會是 VM 未快取的 IOPS 限制的 IO。
- VM 未快取的**頻寬百分比**-在虛擬機器上的總磁片輸送量所計算的百分比（以已布建的虛擬機器輸送量上限完成）。 如果此數量為100%，則您的應用程式執行將會是 VM 未快取頻寬限制的 IO。

