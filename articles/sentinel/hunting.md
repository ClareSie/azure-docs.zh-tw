---
title: Azure Sentinel 中的搜尋功能 |Microsoft Docs
description: 使用 Azure Sentinel 內建的搜尋查詢，引導您詢問正確的問題，以找出資料中的問題。
services: sentinel
documentationcenter: na
author: yelevin
manager: rkarlin
editor: ''
ms.assetid: 6aa9dd27-6506-49c5-8e97-cc1aebecee87
ms.service: azure-sentinel
ms.subservice: azure-sentinel
ms.devlang: na
ms.topic: conceptual
ms.custom: mvc
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 09/10/2019
ms.author: yelevin
ms.openlocfilehash: ca483d993290e4d66ba257d4cb5de7fc3c952405
ms.sourcegitcommit: 8e7316bd4c4991de62ea485adca30065e5b86c67
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/17/2020
ms.locfileid: "94660826"
---
# <a name="hunt-for-threats-with-azure-sentinel"></a>使用 Azure Sentinel 尋找威脅

如果您是想要主動找出安全性威脅的調查員，Azure Sentinel 強大的搜尋搜尋和查詢工具，以在組織的資料來源中尋找安全性威脅。 但是您的系統和安全性設備會產生山脈的資料，這些資料可能難以剖析並篩選成有意義的事件。 為了協助安全性分析師主動查看您的安全性應用程式未偵測到的新異常狀況，Azure Sentinel 內建的搜尋查詢會引導您詢問正確的問題，以找出您的網路上已有的資料問題。 

例如，一個內建查詢會提供在您的基礎結構上執行之最罕見進程的相關資料，您不需要每次執行時都有警示，它們可能是無害的，但您可能會想要查看是否有任何異常情況的查詢。 



利用 Azure Sentinel 搜尋，您可以利用下列功能：

- 內建查詢：為了讓您開始使用，起始頁面提供預先載入的查詢範例，旨在協助您開始使用，並熟悉資料表和查詢語言。 這些內建的搜尋查詢是由 Microsoft 安全性研究人員持續開發、加入新的查詢，以及微調現有的查詢，以提供您尋找新偵測的進入點，並找出開始新攻擊的起點。 

- 使用 IntelliSense 的強大查詢語言：以查詢語言為基礎，可讓您以更具彈性的方式取得下一個層級。

- 建立您自己的書簽：在搜尋過程中，您可能會遇到看起來不尋常或可疑的相符專案、儀表板或活動。 為了標示這些專案，以便日後可以回頭使用書簽功能。 書簽可讓您儲存專案以供稍後用來建立調查的事件。 如需書簽的詳細資訊，請參閱 [在搜尋中使用書簽](hunting.md)。
- 使用筆記本來自動化調查：筆記本就像逐步解說的逐步解說，您可以建立這些程式來逐步解說調查和搜尋的步驟。  筆記本會將所有搜尋步驟封裝在可重複使用的腳本中，以與組織中的其他人共用。 
- 查詢儲存的資料：可在資料表中存取資料，供您查詢。 例如，您可以查詢進程建立、DNS 事件，以及許多其他事件種類。

- 連結至社區：利用更大的社區功能來尋找其他查詢和資料來源。
 
## <a name="get-started-hunting"></a>開始搜尋

1. 在 Azure Sentinel 入口網站中，按一下 [ **搜尋**]。
  ![Azure Sentinel 開始搜尋](media/tutorial-hunting/hunting-start.png)

2. 當您開啟 [ **搜尋** ] 頁面時，所有搜尋查詢都會顯示在單一資料表中。 資料表會列出由 Microsoft 的安全性分析師小組所撰寫的所有查詢，以及您所建立或修改的任何其他查詢。 每個查詢都會提供它所 digger 的內容，以及其執行的資料類型的描述。 這些範本會依各種策略分組，右邊的圖示會將威脅類型分類，例如初始存取、持續性和遭到外泄。 您可以使用任何欄位篩選這些搜尋查詢範本。 您可以將任何查詢儲存至 [我的最愛]。 藉由將查詢儲存到我的最愛，查詢會在每次存取 **搜尋** 頁面時自動執行。 您可以建立自己的搜尋查詢，或複製和自訂現有的搜尋查詢範本。 
 
2. 按一下 [搜尋查詢詳細資料] 頁面中的 [ **執行查詢** ]，在不離開搜尋頁面的情況下執行任何查詢。  相符專案的數目會顯示在資料表中。 檢查搜尋查詢及其相符專案的清單。 查看與所關聯之終止鏈中的哪個階段。

3. 在 [查詢詳細資料] 窗格中，快速查看基礎查詢，或按一下 [ **視圖查詢結果** ]，以在 Log Analytics 中開啟查詢。 在底部，檢查查詢的相符專案。

4.    按一下資料列，然後選取 [ **加入書簽** ] 來加入要調查的資料列，您可以針對任何看似可疑的事項進行此作業。 

5. 然後，返回 [主要 **搜尋** ] 頁面，然後按一下 [ **書簽** ] 索引標籤，以查看所有可疑的活動。 

6. 選取書簽，然後按一下 [ **調查** ] 以開啟調查體驗。 您可以篩選書簽。 例如，如果您要調查活動，您可以建立活動的標記，然後根據活動篩選所有書簽。

1. 在您探索到哪些搜尋查詢提供高價值的深入解析至可能的攻擊之後，您也可以根據您的查詢建立自訂偵測規則，並將這些深入解析視為安全性事件回應者的警示。

 

## <a name="query-language"></a>查詢語言 

Azure Sentinel 中的搜尋是以 Kusto 查詢語言為基礎。 如需查詢語言和支援之運算子的詳細資訊，請參閱 [查詢語言參考](../azure-monitor/log-query/get-started-queries.md)。

## <a name="public-hunting-query-github-repository"></a>公開搜尋查詢 GitHub 儲存機制

查看 [搜尋查詢存放庫](https://github.com/Azure/Orion)。 參與並使用我們的客戶共用的範例查詢。

 

## <a name="sample-query"></a>範例查詢

查詢通常以資料表名稱開頭，後面接著一連串以  隔開的「運算子」\|。

在上述範例中，請從 [資料表名稱] SecurityEvent 開始，並視需要新增管道專案。

1. 定義時間篩選，只檢查過去七天的記錄。

2. 在查詢中加入篩選器，只顯示事件識別碼4688。

3. 在命令列上的查詢中加入篩選準則，以只包含 cscript.exe 的實例。

4. 只投影您感興趣的資料行，並將結果限制為1000，然後按一下 [ **執行查詢**]。
5. 按一下綠色三角形，然後執行查詢。 您可以測試查詢並加以執行，以尋找異常行為。

## <a name="useful-operators"></a>實用運算子

查詢語言的功能強大，而且有許多可用的運算子，如下所列的一些實用運算子：

**where** -將資料表篩選為滿足述詞的資料列子集。

**摘要** -產生可匯總輸入資料表內容的資料表。

**聯結** -合併兩個數據表的資料列，藉由比對每個資料表中指定之資料行 (s) 來形成新的資料表。

**count** -傳回輸入記錄集內的記錄數目。

**top** -傳回依指定資料行排序的前 N 筆記錄。

**限制** -傳回指定的資料列數目。

**專案** -選取要包含、重新命名或卸載的資料行，然後插入新的計算資料行。

**擴充** -建立計算結果欄，並將其附加至結果集。

**makeset** -傳回運算式在群組中採用之相異值集合的動態 (JSON) 陣列

**尋找** -尋找在一組資料表中符合述詞的資料列。

## <a name="save-a-query"></a>儲存查詢

您可以建立或修改查詢，並將它儲存為您自己的查詢，或與相同租使用者中的使用者共用。

   ![儲存查詢](./media/tutorial-hunting/save-query.png)

建立新的搜尋查詢：

1. 按一下 [追加 **查詢** ]，然後選取 [ **儲存**]。
2. 填寫所有空白欄位，然後選取 [ **儲存**]。

   ![新增查詢](./media/tutorial-hunting/new-query.png)

複製並修改現有的搜尋查詢：

1. 選取您要修改之資料表中的搜尋查詢。
2. 選取您要修改之查詢行中的省略號 ( ... ) ，然後選取 [ **複製查詢**]。

   ![複製查詢](./media/tutorial-hunting/clone-query.png)
 

3. 修改查詢並選取 [ **建立**]。

   ![自訂查詢](./media/tutorial-hunting/custom-query.png)

## <a name="next-steps"></a>後續步驟
在本文中，您已瞭解如何使用 Azure Sentinel 來執行搜尋調查。 若要深入了解 Azure Sentinel，請參閱下列文章：


- [使用筆記本來執行自動化搜尋活動](notebooks.md)
- [搜捕時使用書籤來儲存感興趣的資訊](bookmarks.md)