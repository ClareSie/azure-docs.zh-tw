---
title: 遠端桌面通訊協定頻寬需求 Windows 虛擬桌面-Azure
titleSuffix: Azure
description: 瞭解 Windows 虛擬桌面的 RDP 頻寬需求。
author: gundarev
ms.topic: conceptual
ms.date: 11/16/2020
ms.author: denisgun
ms.openlocfilehash: 708ffce014f417f3794e59e1f79a3fcf9cba3f23
ms.sourcegitcommit: 18046170f21fa1e569a3be75267e791ca9eb67d0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/16/2020
ms.locfileid: "94639163"
---
# <a name="remote-desktop-protocol-rdp-bandwidth-requirements"></a>遠端桌面通訊協定 (RDP) 頻寬需求

遠端桌面通訊協定 (RDP) 是一種精密的技術，使用各種技術來將伺服器的遠端圖形傳遞到用戶端裝置。 RDP 會根據使用案例、運算資源的可用性和網路頻寬來動態調整各種參數，以提供最佳的使用者體驗。

遠端桌面通訊協定將分離信號多個動態虛擬通道 (DVCs) 至透過不同網路傳輸傳送的單一資料通道。 遠端圖形、輸入、裝置重新導向、列印和其他各有不同的 DVCs。 WVD 合作夥伴也可以實行使用 DVC 介面的延伸模組。
透過 RDP 傳送的資料量取決於使用者活動。 例如，使用者可能會針對大部分的會話使用基本的文字內容，並使用最短的頻寬，但接著會在本機印表機上產生200頁檔的列印結果。 此列印工作將使用大量的網路頻寬。

使用遠端會話時，您網路的可用頻寬會大幅影響您的體驗品質。 不同的應用程式和顯示解析度需要不同的網路設定，因此務必要確定您的網路設定符合您的需求。

## <a name="estimating-bandwidth-utilization"></a>估計頻寬使用率

RDP 針對不同類型的資料使用不同的壓縮演算法。 下表將引導您估計資料傳輸：

| 資料類型 | 方向 | 如何預估 |
|---|---|---|
| 遠端圖形 | 工作階段主機至用戶端 | [請參閱詳細的指導方針](#estimating-bandwidth-used-by-remote-graphics) |
| 心跳 | 雙向 | 每5秒大約20個位元組  |
| 輸入 | 用戶端對工作階段主機 | 資料量是以使用者活動為基礎，大部分的作業都小於100個位元組  |
| 檔案傳輸 | 雙向 | 檔案傳輸使用大量壓縮。 使用 .zip 壓縮來取得近似值 |
| 列印 | 工作階段主機至用戶端 | 列印工作傳輸取決於驅動程式和使用大量壓縮，請使用 .zip 壓縮來取得近似值 |

其他案例可能會根據您的使用方式而有不同的頻寬需求，例如：

* 語音或視訊會議
* 即時通訊
* 4k 串流視訊

## <a name="estimating-bandwidth-used-by-remote-graphics"></a>估計遠端圖形所使用的頻寬

您很難預測遠端桌面使用的頻寬。 使用者活動會產生大部分的遠端桌面流量。 每位使用者都是唯一的，而且其工作模式的差異可能會大幅改變網路使用。

若要瞭解頻寬需求，最好的方式是監視實際的使用者連接。 監視可以由內建的效能計數器或網路設備來執行。

不過，在許多情況下，您可以藉由瞭解遠端桌面通訊協定的運作方式，以及分析使用者的工作模式，來估計網路使用量。

遠端通訊協定會傳遞遠端伺服器所產生的圖形，以將其顯示在本機監視器上。 更具體來說，它會提供完全由伺服器組成的桌面點陣圖。
在第一次使用時，傳送桌面點陣圖的方式似乎是簡單的工作，因此需要大量的資源。 例如，以未壓縮格式的1080p 桌面映射，大小約為 8 Mb。 在本機連線的監視器上顯示此映射，其螢幕重新整理率為 30 Hz，需要大約 237 MB/秒的頻寬。

為了減少透過網路傳輸的資料量，RDP 使用多種技術的組合，包括但不限於

* 畫面播放速率優化
* 螢幕內容分類
* 特定內容編解碼器
* 漸進式影像編碼
* 用戶端快取

若要進一步瞭解遠端圖形，請考慮下列事項：

* 圖形愈豐富，將會有更多頻寬
  * 文字、視窗 UI 專案和純色區域所耗用的頻寬比其他任何的頻寬少。
  * 自然映射是頻寬使用的最重要參與者。 但是用戶端快取有助於降低。
* 只會傳送螢幕上已變更的部分。 如果畫面上沒有可見的更新，則不會傳送任何更新。
* 影片播放和其他的高框架速率內容基本上是影像投影片。 RDP 會動態使用適當的視頻編解碼器，以接近原始畫面播放速率來傳遞它們。 不過，它仍然是圖形，而且也是頻寬使用率最重要的參與者。
* 遠端桌面的空閒時程表示無或最小量的螢幕更新;因此，在閒置時間內，網路使用會很短。
* 當 [遠端桌面用戶端] 視窗最小化時，不會從工作階段主機傳送任何圖形更新。

請記住，網路承受的壓力取決於應用程式工作負載的輸出畫面播放速率和顯示器解析度。 如果畫面播放速率或顯示器解析度增加，頻寬需求也會隨之上升。 例如，使用高解析度顯示器執行輕量工作負載時，所需的可用頻寬會使用一般或低解析度執行輕量工作負載時更高。 不同的顯示器解析度需要不同的可用頻寬。

下表參考不同圖形案例所使用的資料。 這些數位適用于具有1920x1080 解析度的單一監視設定，以及預設的圖形模式和 h.264/AVC 444 圖形模式。

| 案例 | 預設模式 | H.264/AVC 444 模式 | 縮圖 | 案例的描述 |
|:---|---:|---:|---|---|
| 閒置 | 0.3 Kbps | 0.3 Kbps |:::image type="content" source="media/idle.png" alt-text="閒置連接的螢幕擷取畫面":::| 使用者已暫停其工作，且沒有任何作用中的螢幕更新 |
| Microsoft Word | 100-150 Kbps | 200-300 Kbps |:::image type="content" source="media/word.gif" alt-text="Microsoft Word 的動畫":::| 使用者正在使用 Microsoft Word、輸入、貼上圖形及在檔之間切換 |
| Microsoft Excel | 150-200 Kbps | 400-500 Kbps |:::image type="content" source="media/excel.gif" alt-text="Microsoft Excel 的動畫":::| 使用者正在使用 Microsoft Excel，以公式和圖表同時更新多個資料格 |
| Microsoft PowerPoint | 4-4.5 Mbps | 1.6-1.8 Mbps |:::image type="content" source="media/powerpoint.gif" alt-text="Microsoft PowerPoint 的動畫":::| 使用者正在積極使用 Microsoft PowerPoint、輸入、貼上。 使用者也修改了豐富的圖形，並使用投影片轉換效果 |
| 網頁流覽 | 6-6.5 Mbps | 0.9-1 Mbps |:::image type="content" source="media/web.gif" alt-text="網頁流覽的動畫":::| 使用者正在主動處理包含多個靜態和動畫影像的圖形化豐富網站。 使用者以水準和垂直方式滾動頁面 |
| 映射庫 | 3.3-3.6 Mbps | 0.7-0.8 Mbps |:::image type="content" source="media/image-gallery.gif" alt-text="影像庫的動畫":::| 使用者正積極使用映射庫應用程式。 流覽、縮放、調整大小和旋轉影像 |
| 影片播放 | 8.5-9.5 Mbps | 2.5-2.8 Mbps |:::image type="content" source="media/video.gif" alt-text="影片播放的動畫":::| 使用者正在觀賞耗用1/2 螢幕的 30 FPS 影片 |
| 全螢幕影片播放 | 7.5-8.5 Mbps | 2.5-3.1 Mbps |:::image type="content" source="media/fullscreen-video.gif" alt-text="全螢幕影片播放的動畫":::| 使用者觀賞最大化為全螢幕的 30 FPS 影片 |

## <a name="dynamic-bandwidth-allocation"></a>動態頻寬配置

遠端桌面通訊協定是新式的通訊協定，其設計目的是要動態調整變更的網路狀況。
RDP 會使用持續的網路偵測，以主動監視可用的網路頻寬和封包來回時間，而不是使用硬性限制的頻寬使用率。 根據結果，RDP 會動態選取圖形編碼選項，並配置裝置重新導向和其他虛擬通道的頻寬。  
這項技術可讓 RDP 在需要網路時，使用完整的網路管道。
如果有其他應用程式要求網路，RDP 會偵測並調整影像品質、畫面播放速率或壓縮演算法。

## <a name="limit-network-bandwidth-use-with-throttle-rate"></a>使用節流速率來限制網路頻寬使用

在大部分的情況下，不需要限制頻寬使用率，因為限制可能會影響使用者體驗。 但在受限制的網路中，您可能會想要限制網路使用率。 另一個範例是針對使用的流量付費的租用網路。

在這種情況下，您可以藉由指定 QoS 原則中的節流閥速率來限制 RDP 輸出網路流量。

  >[!NOTE]
  > [請確定已啟用 RDP Shortpath](./shortpath.md) ，反向連接傳輸不支援節流速率限制。

### <a name="implement-throttle-rate-limiting-on-session-host-using-group-policy"></a>使用群組原則在工作階段主機上實施節流速率限制

您可以在群組原則中使用以原則為基礎的服務品質 (QoS) 來設定預先定義的節流閥速率。

若要為已加入網域的工作階段主機建立 QoS 原則，請先登入已安裝群組原則管理的電腦。 開啟群組原則管理] (選取 [開始]，指向 [系統管理工具]，然後選取 [群組原則管理]) ，然後完成下列步驟：

1. 在群組原則管理] 中，找出應該在其中建立新原則的容器。 例如，如果所有的會話主機電腦都位於名為 **工作階段主機** 的 OU 中，則應該在會話主控 ou 中建立新的原則。

2. 以滑鼠右鍵按一下適當的容器，然後選取 [ **在這個網域中建立 GPO 並連結** 到]。

3. 在 [ **新增 GPO** ] 對話方塊的 [ **名稱** ] 方塊中，輸入新群組原則物件的名稱，然後選取 **[確定]** 。

4. 在新建立的原則上按一下滑鼠右鍵，然後選取 [ **編輯** ]。

5. 在 [群組原則管理編輯器] 中，依序展開 [ **電腦** 設定]、[ **Windows 設定** ]、[以 **原則為基礎的 QoS** ]，然後選取 [ **建立新原則** ]。

6. 在 [以 **原則為基礎的 QoS** ] 對話方塊中，于 [開啟] 頁面的 [ **名稱** ] 方塊中輸入新原則的名稱。 選取 [ **指定輸出節流速率** ]，並設定必要的值，然後選取 **[下一步]** 。

7. 在下一個頁面上，選取 [ **只有具有這個可執行檔名稱的應用程式** ] 並輸入 **svchost.exe** 的名稱，然後選取 **[下一步]** 。 此設定會指示原則只優先處理與遠端桌面服務相符的流量。

8. 在第三個頁面上，請確定已選取 [ **任何來源 ip 位址** ] 和 [ **任何目的地 ip 位址** ]。 選取 [下一步]。 這兩個設定可確保封包會受到管理，不論哪一部電腦 (IP 位址) 傳送封包，以及哪個電腦 (IP 位址) 將接收封包。

9. 在第四頁上，從 [ **選取此 QoS 原則套用的通訊協定** ] 下拉式清單選取 [ **UDP** ]。

10. 在 [ **指定來源埠號碼** ] 標題底下，選取 [ **從這個來源埠] 或 [範圍** ]。 在隨附的文字方塊中，輸入 **3390** 。 選取 [完成]。

您所建立的新原則將不會生效，直到您的會話主機電腦上的群組原則重新整理為止。 雖然群組原則會定期重新整理，但您可以依照下列步驟強制立即重新整理：

1. 在您想要重新整理群組原則的每個工作階段主機上，以系統管理員身分 ([ *以系統管理員身分執行* ]) 開啟命令提示字元。

2. 在命令提示字元中，輸入

   ```console
   gpupdate /force
   ```

### <a name="implement-throttle-rate-limiting-on-session-host-using-powershell"></a>使用 PowerShell 在工作階段主機上執行節流速率限制

您可以使用下列 PowerShell Cmdlet 來設定 RDP Shortpath 的節流閥速率：

```powershell
New-NetQosPolicy -Name "RDP Shortpath" -AppPathNameMatchCondition "svchost.exe" -IPProtocolMatchCondition UDP -IPSrcPortStartMatchCondition 3390 -IPSrcPortEndMatchCondition 3390 -DSCPAction 46 -NetworkProfile All
```

## <a name="next-steps"></a>後續步驟

* 若要深入瞭解 Windows 虛擬桌面的頻寬需求，請參閱 [瞭解遠端桌面通訊協定 (RDP) Windows 虛擬桌面的頻寬需求](rdp-bandwidth.md)。
* 若要深入瞭解 Windows 虛擬桌面網路連線能力，請參閱 [瞭解 Windows 虛擬桌面網路連線能力](network-connectivity.md)。
* 若要開始使用適用于 Windows 虛擬桌面的服務品質 (QoS) ，請參閱 [為 Windows 虛擬桌面 (qos) 執行服務品質](rdp-quality-of-service-qos.md)。
