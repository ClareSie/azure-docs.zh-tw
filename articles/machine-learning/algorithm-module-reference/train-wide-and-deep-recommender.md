---
title: 使用訓練寬 & Deep 推薦模組
titleSuffix: Azure Machine Learning
description: 瞭解如何使用「整個訓練 & 深度推薦」模組來定型建議模型。
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: reference
author: likebupt
ms.author: keli19
ms.date: 06/12/2020
ms.openlocfilehash: bb213776d41c07238fcaba1ccdd4e06f5d5bbb5f
ms.sourcegitcommit: e71da24cc108efc2c194007f976f74dd596ab013
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/29/2020
ms.locfileid: "87420884"
---
# <a name="train-wide--deep-recommender"></a>& 深度推薦訓練寬
本文說明如何使用 Azure Machine Learning 設計工具（預覽）中的 [**定型寬 & Deep 推薦**] 模組來定型建議模型。 此課程模組是以 Google 所提議的寬 & 深度學習為基礎。

[**訓練寬 & Deep 推薦**] 模組會讀取使用者-專案-評等三合一的資料集，並選擇性地讀取某些使用者和專案功能。 它會傳回已定型的寬 & 深度推薦。  接著，您可以使用已定型的模型來產生分級預測或建議，方法是使用「[分數寬」和「深度推薦](score-wide-and-deep-recommender.md)」模組。  

## <a name="more-about-recommendation-models-and-the-wide--deep-recommender"></a>深入瞭解建議模型和寬 & 深層推薦  

建議系統的主要目的是建議系統*使用者*的一個或多個*專案*。 項目的範例可能是電影、餐廳、書籍或歌曲。 使用者可以是個人、人員群組或具有項目喜好設定的其他實體。  

Recommender 系統有兩種主要方法。 

+ 第一種是**以內容為基礎的**方法，其利用使用者和項目的特徵。 使用年齡和性別等屬性可描述使用者，而使用作者和製造者可以描述項目。 在社交配對網站上可以找到以內容為基礎的建議系統的典型範例。 
+ 第二種方法是**協同篩選**，該方法僅使用使用者和項目的識別項，並從使用者提供的項目評等 (疏鬆) 矩陣取得有關這些實體的隱含資訊。 我們可以從使用者所評等的項目以及從已評等相同項目的其他使用者了解使用者。  

寬 & 深度推薦結合了這些方法，並使用以內容為基礎的方法進行共同篩選。 因此被視為**混合 Recommender**。 

運作方式：當使用者對系統而言較新時，會利用使用者的功能資訊來改善預測，進而解決知名的「冷啟動」問題。 不過，一旦向特定使用者收集足量的評等時，就可能根據其特定評比 (而不只是根據其特徵) 進行完全個人化的預測。 因此，可從以內容為基礎的建議順利轉換成以協同篩選為基礎的建議。 即使使用者或專案功能無法使用，寬 & Deep 推薦仍會在其共同作業篩選模式下運作。  

如需有關寬 & 深入推薦及其基礎概率演算法的詳細資訊，請參閱相關的研究檔：[適用于推薦系統的廣泛 & 深度學習](https://arxiv.org/pdf/1606.07792.pdf)。  

## <a name="how-to-configure-train-wide--deep-recommender"></a>如何設定 & 深度推薦的整部訓練  

+ [準備定型資料](#prepare-data)
+ [訓練模型](#train-the-model)

### <a name="prepare-data"></a>準備資料

在嘗試使用模組之前，您必須先以建議模型所需的格式來表示您的資料。 需要**使用者-專案-評等三**合一的訓練資料集，但您也可以在個別的資料集中包含使用者功能和專案功能（如果有的話）。

#### <a name="required-dataset-of-user-item-ratings"></a>使用者-專案-評等的必要資料集

用於定型的輸入資料必須以正確的格式包含適當的資料類型： 

+ 第一個資料行必須包含使用者識別碼。
+ 第二個數據行必須包含專案識別碼。
+ 第三個數據行包含使用者-專案組的評等。 評等值必須是數數值型別。 

例如，一般的使用者-專案評等集合可能如下所示：

|UserId|MovieId|分級|
|------------|-------------|------------|
|1|68646|10|
|223|31381|10|

#### <a name="user-features-dataset-optional"></a>使用者功能資料集（選擇性）

**使用者特徵**的資料集必須包含使用者的識別碼，並使用在使用者-專案-評等資料集的第一欄中所提供的相同識別碼。 其餘的資料行可以包含可描述使用者的任意數目功能。  

例如，典型的一組使用者功能看起來可能像這樣： 

|UserId|年齡|性別|Interest|Location|
|------------|--------------|-----------------------|---------------|------------|
|1|25|male| 戲劇    |歐洲|
|223|40|female|羅馬|Asia|

#### <a name="item-features-dataset-optional"></a>專案功能資料集（選擇性）

項目特徵的資料集必須包含其第一個資料行中的項目識別碼。 其餘的資料行可以包含專案的任意數目的描述性功能。  

例如，典型的專案功能集可能如下所示：  

|MovieId|標題|原始語言|流派|年|
|-------------|-------------|-------------------|-----------|---------------|
|68646|Godfather|英文|戲劇|1972|
|31381|走了風|英文|記錄|1939|

### <a name="train-the-model"></a>將模型定型

1.  將「**訓練寬」和「深度推薦**」模組新增至您在設計工具中的實驗（預覽），並將它連接到訓練資料集。  
  
2. 如果您有使用者功能和（或）專案功能的個別資料集，請將其連接到「**訓練寬」和「深度推薦**」模組。  
  
    - **使用者功能資料集**：將描述使用者的資料集連接到第二個輸入。
    - **專案功能資料集**：將描述專案的資料集連接到第三個輸入。  
    
3.  **Epoch**：指出演算法應該處理整個定型資料的次數。 

    這個數位愈高，訓練就愈好了;不過，定型成本會更多，而且可能會導致過度學習。

4. **批次大小**：輸入在一個訓練步驟中使用的定型範例數目。 

     此超參數可能會影響定型速度。 較高的批次大小會產生較少的時間成本 epoch，但可能會增加聚合時間。 而且，如果批次太大而無法容納 GPU/CPU，可能會引發記憶體錯誤。

5.  **寬部分優化**工具：選取一個優化工具，將漸層套用至模型的寬部分。

6.  **寬優化工具學習速率**：輸入介於0.0 和2.0 之間的數位，以定義寬部分優化工具的學習速率。

    此超參數會決定每個定型步驟的步驟大小，同時移至最少的損失函式。 過大的學習速率可能會導致學習跳躍 minima，而太小的學習率可能會導致聚合問題。

7.  **交叉功能維度**：輸入所需的 [使用者識別碼] 和 [專案識別碼] 功能來輸入維度。 

    寬 & 深度推薦預設會執行跨產品的轉換，而不是依使用者識別碼和專案識別碼功能。 交叉的結果將會根據此數位進行雜湊，以確保維度的大小。

8.  **深度元件優化器**：選取一個優化工具，將漸層套用至模型的深層部分。

9.  **深度優化工具學習速率**：輸入介於0.0 和2.0 之間的數位，以定義深度部分優化工具的學習速率。

10.  **使用者內嵌維度**：輸入整數來指定使用者識別碼內嵌的維度。

     寬 & Deep 推薦會針對寬部分和深層元件建立共用使用者識別碼內嵌和專案識別碼內嵌。

11.  **專案內嵌維度**：輸入整數來指定專案識別碼內嵌的維度。

12.  **分類功能內嵌維度**：輸入整數來指定類別功能內嵌的維度。

     在寬 & 深層推薦的深層元件中，會針對每個類別功能學會內嵌向量。 而這些內嵌向量會共用相同的維度。

13.  **隱藏單位**：輸入深層元件的隱藏節點數目。 每個圖層中的節點數目會以逗號分隔。 例如，藉由類型 "1000500100"，您可以指定 deep 元件有三個層級，而第一個圖層分別具有1000節點、500節點和100節點。

14.  **啟用**函式：選取套用到每個圖層的一個啟用函式，預設值為 ReLU。

15.  **跌落**：輸入介於0.0 和1.0 之間的數位，以判斷在定型期間，輸出將會在每一層中捨棄的機率。

     「跌落」是一種正規化方法，可防止類神經網路過度學習。 此值的一個常見決策是從0.5 開始，這似乎接近各種網路和工作的最佳狀態。

16.  **Batch**正規化：選取此選項，以在深層元件中的每個隱藏層之後使用 Batch 正規化。

     Batch 正規化是在網路定型期間對抗內部 covariate 轉移問題的技術。 一般來說，這有助於改善網路的速度、效能和穩定性。 

17.  執行管道。

##  <a name="technical-notes"></a>技術說明

寬 & 深度共同訓練寬線性模型和深度類神經網路，以結合記住需求和一般化的優勢。 寬元件會接受一組原始功能和功能轉換，以記住功能互動。 而在特徵工程較少的情況下，深度元件則是透過低維度密集功能內嵌，一般化成看不見的功能組合。 

在 Wide & 深層推薦的執行中，此模組會使用預設的模型結構。 寬元件會採用使用者內嵌、專案內嵌，以及使用者識別碼和專案識別碼的交叉乘積轉換做為輸入。 針對模型的深層部分，會針對每個類別特徵學會內嵌向量。 除了其他數值特徵向量外，這些向量也會轉送給深入的向前饋送類神經網路。 寬部分和深度部分的結合，是將其最終輸出記錄檔的總和與預測做比對，最後進入共同訓練的一個常見損失函數。


## <a name="next-steps"></a>後續步驟

請參閱 Azure Machine Learning[可用的模組集合](module-reference.md)。 
