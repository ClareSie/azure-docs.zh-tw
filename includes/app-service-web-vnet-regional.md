---
author: ccompy
ms.service: app-service-web
ms.topic: include
ms.date: 02/27/2020
ms.author: ccompy
ms.openlocfilehash: c731e2a7d4da1a66aabb50b335d526fbb6a0a302
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/28/2020
ms.locfileid: "78671483"
---
使用區域 VNet 集成使應用可以訪問：

* VNet 中與您集成的同一區域中的資源 
* VNet 中與 VNet 中位於同一區域中的資源
* 服務終結點安全服務
* 跨快速路由連接的資源
* 連接到的 VNet 中的資源
* 跨對等連接的資源，包括快速路由連接
* 專用終結點 

在同一區域中使用 VNet 集成時，可以使用以下 Azure 網路功能：

* 網路安全性群組 （NSG） - 您可以使用放置在集成子網上的網路安全性群組阻止出站流量。 入站規則不適用，因為您不能使用 VNet 集成來提供對應用的入站存取權限。
* 路由表 （UDR） - 您可以將路由表放置在集成子網上，以便將出站流量發送到所需的位置。 

預設情況下，你的應用只會將 RFC1918 流量路由到您的 VNet 中。 如果要將所有出站流量路由到 VNet 中，請應用應用應用WEBSITE_VNET_ROUTE_ALL應用。 要配置應用設置：

1. 轉到應用門戶中的"配置 UI"。 選擇 **"新建應用程式"設置**
1. 在"名稱"欄位中鍵入**WEBSITE_VNET_ROUTE_ALL，** 在"值"欄位中鍵入**1**

   ![提供應用程式設定][4]

1. 選取 [確定]****
1. 選擇 **"保存"**

如果將所有出站流量路由到 VNet，則它將受應用於集成子網的 NSG 和 UDR 的約束。 當您將所有出站流量路由到 VNet 時，您的出站位址仍將是應用屬性中列出的出站位址，除非您提供路由將流量發送到其他位置。 

在同一區域中使用 VNet 集成與 VNet 存在一些限制：

* 無法跨全域對等互連連接到達資源
* 此功能僅可從支援高級 V2 應用服務方案的較新的應用服務規模單位獲得。
* 集成子網只能由一個應用服務方案使用
* 此功能不能由應用服務環境中的隔離計畫應用使用
* 此功能需要一個未使用的子網，該子網是具有 32 個位址或資源管理器 VNet 中更大的 /27
* 應用程式和 VNet 必須位於相同的區域
* 您無法刪除具有整合式應用程式的 VNet。 刪除 VNet 之前刪除集成。 
* 您只能與 VNet 集成在與應用相同的訂閱中
* 每個應用服務方案只能有一個區域 VNet 集成。 同一應用服務方案中的多個應用可以使用相同的 VNet。 
* 當有一個應用使用區域 VNet 集成時，您不能更改應用或計畫的訂閱

每個計畫實例使用一個位址。 如果將應用縮放為五個實例，則使用五個位址。 由於子網大小在分配後無法更改，因此必須使用足夠大的子網，以適應應用可能達到的任何比例。 建議的尺寸是帶 64 個位址的 /26。 帶 64 個位址的 /26 將容納包含 30 個實例的高級計畫。 向上或向下擴展計畫時，需要在短時間內使用兩倍的位址。 

如果希望其他計畫中的應用訪問已由另一個計畫中的應用連接到的 VNet，則需要選擇與預先存在的 VNet 集成所使用的子網不同的子網。  

此功能在 Linux 預覽中。 該功能的 Linux 形式僅支援對 RFC 1918 位址（10.0.0.0/8、172.16.0.0/12、192.168.0.0/16） 進行調用。

### <a name="web--function-app-for-containers"></a>容器的 Web / 功能應用程式

如果您在 Linux 上使用內置映射託管應用，則區域 VNet 集成無需其他更改即可工作。 如果對容器使用 Web/函數應用，則需要修改 Docker 映射才能使用 VNet 集成。 在 docker 映射中，使用 PORT 環境變數作為主 Web 服務器的偵聽埠，而不是使用硬編碼埠號。 PORT 環境變數由平臺在容器啟動時自動設置。 如果使用 SSH，則必須將 SSH 守護進程配置為在使用區域 VNet 集成時偵聽 SSH_PORT 環境變數指定的埠號。  在 Linux 上不支援閘道所需的 VNet 集成。 

### <a name="service-endpoints"></a>服務端點

區域 VNet 集成使您能夠使用服務終結點。  要將服務終結點與應用一起使用，請使用區域 VNet 集成連接到選定的 VNet，然後在用於集成的子網上佈建服務終結點。 

### <a name="network-security-groups"></a>網路安全性群組

網路安全性群組使您能夠阻止 VNet 中資源的入站和出站流量。 使用區域 VNet 集成的應用可以使用[網路安全性群組][VNETnsg]來阻止向外出流量到 VNet 或 Internet 中的資源。 要阻止公共位址的流量，必須將應用程式設定WEBSITE_VNET_ROUTE_ALL設置為 1。 NSG 中的入站規則不適用於你的應用，因為 VNet 集成僅影響來自應用的出站流量。 要控制應用的入站流量，請使用"訪問限制"功能。 無論應用於集成子網的任何路由，應用於集成子網的 NSG 都將有效。 如果WEBSITE_VNET_ROUTE_ALL設置為 1，並且集成子網上沒有任何影響公共位址流量的路由，則所有出站流量仍將受分配給集成子網的 NSG 的約束。 如果未設置WEBSITE_VNET_ROUTE_ALL，則 NSG 將僅應用於 RFC1918 流量。

### <a name="routes"></a>路由

路由表使您能夠將出站流量從應用路由到所需的任何位置。 預設情況下，路由表僅會影響 RFC1918 目標流量。  如果將WEBSITE_VNET_ROUTE_ALL設置為 1，則所有出站呼叫都將受到影響。 在集成子網上設置的路由不會影響對入站應用請求的回復。 常見目標可以包括防火牆設備或閘道。 如果要路由本地所有出站流量，可以使用路由表將所有出站流量發送到 ExpressRoute 閘道。 如果確實將流量路由到閘道，請確保在外部網路中設置路由以發送回任何答覆。

邊境閘道協定 （BGP） 路由也會影回應用流量。 如果您有來自快速路由閘道等內容的 BGP 路由，則應用出站流量將受到影響。 預設情況下，BGP 路由僅會影響您的 RFC1918 目標流量。 如果WEBSITE_VNET_ROUTE_ALL設置為 1，則所有出站流量都可能受 BGP 路由的影響。 


<!--Image references-->
[4]: ../includes/media/web-sites-integrate-with-vnet/vnetint-appsetting.png

<!--Links-->
[VNETnsg]: https://docs.microsoft.com/azure/virtual-network/security-overview/