---
title: 製造商的安全性做法-Azure IoT 裝置布建服務
description: 概述 Oem 和裝置製造商的常見安全性作法，這些做法可準備裝置以在 Azure IoT 裝置布建服務中註冊 (DPS) 。
author: timlt
ms.author: timlt
ms.date: 3/02/2020
ms.topic: conceptual
ms.service: iot-dps
ms.custom: iot-p0-scenario, iot-devices-deviceOEM
ms.reviewer: nberdy
ms.openlocfilehash: 788738082cbf9995fb2f7282bc3f574903275528
ms.sourcegitcommit: 03662d76a816e98cfc85462cbe9705f6890ed638
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/15/2020
ms.locfileid: "90527202"
---
# <a name="security-practices-for-azure-iot-device-manufacturers"></a>Azure IoT 裝置製造商的安全性作法
當更多製造商發行 IoT 裝置時，識別常見實務的指引是很有説明的。 本文摘要說明當您製造裝置以搭配 Azure IoT 裝置布建服務使用 (DPS) 時，所應考慮的建議安全性作法。  

> [!div class="checklist"]
> * 選取裝置驗證選項
> * 在 IoT 裝置上安裝憑證
> * 將信賴平臺模組 (TPM) 整合到製造流程中

## <a name="selecting-device-authentication-options"></a>選取裝置驗證選項
任何 IoT 裝置安全性措施的最終目標是要建立安全的 IoT 解決方案。 但是硬體限制、成本和安全性專業領域等問題都會影響您所選擇的選項。 此外，您的安全性方法會影響 IoT 裝置連接到雲端的方式。 雖然有 [幾個要考慮的 IoT 安全性元素](https://www.microsoft.com/research/publication/seven-properties-highly-secure-devices/) ，但每個客戶遇到的重要元素是要使用的驗證類型。 

有三種廣泛使用的驗證類型是 x.509 憑證、可信賴平臺模組 (TPM) 和對稱金鑰。 雖然有其他驗證類型存在，但在 Azure IoT 上建立解決方案的大部分客戶都使用這三種類型的其中一種。 本文的其餘部分將調查使用每種驗證類型的優缺點。

### <a name="x509-certificate"></a>X.509 憑證
X.509 憑證是一種您可以用來進行驗證的數位身分識別。 X.509 憑證標準記載于 [IETF RFC 5280](https://tools.ietf.org/html/rfc5280)中。 在 Azure IoT 中，有兩種方式可以驗證憑證：
- 指紋。 憑證指紋演算法會在憑證上執行，以產生十六進位字串。 產生的字串是憑證的唯一識別碼。 
- 以完整鏈為基礎的 CA 驗證。 憑證鏈是驗證終端實體 (EE) 憑證所需的所有憑證階層式清單。 若要驗證 EE 憑證，必須驗證鏈中的每個憑證，包括受信任的根 CA。 

X.509 的專業人員：
- X.509 是 Azure IoT 中支援的最安全驗證類型。
- X.509 可讓您針對憑證管理的目的，提供高層級的控制。
- 許多廠商都有提供以 x.509 為基礎的驗證解決方案。

X.509 的缺點：
- 許多客戶可能需要依賴外部廠商的憑證。
- 憑證管理的成本可能很高，並增加了總解決方案成本。
- 如果未妥善考慮物流，憑證生命週期管理可能會很困難。 

### <a name="trusted-platform-module-tpm"></a>信賴平台模組 (TPM)
TPM （也稱為 [ISO/IEC 11889](https://www.iso.org/standard/66510.html)）是安全地產生和儲存密碼編譯金鑰的標準。 TPM 也會參考虛擬或實體 i/o 裝置，該裝置會與執行標準的模組互動。 TPM 裝置可作為離散硬體、整合式硬體、以固件為基礎的模組，或以軟體為基礎的模組存在。 

Tpm 和對稱金鑰有兩個主要差異： 
- TPM 晶片也可以儲存 x.509 憑證。
- DPS 中的 TPM 證明使用 TPM 簽署金鑰 (EK) 是一種非對稱式驗證的形式。 使用非對稱式驗證時，會使用公開金鑰進行加密，並使用個別的私密金鑰進行解密。 相反地，對稱金鑰會使用對稱式驗證，其中私密金鑰會用於加密和解密。 

TPM 的專業人員：
- Tpm 會以標準硬體的形式包含在許多 Windows 裝置上，並內建作業系統支援。 
- TPM 證明比共用存取簽章更容易安全， (SAS) 權杖型對稱金鑰證明。
- 您可以輕鬆地過期和更新（或變換）裝置認證。 每當 TPM 裝置重新布建時，DPS 都會自動匯總 IoT 中樞認證。

TPM 的缺點： 
- Tpm 很複雜，而且可能很難使用。 
- 除非您有實體 TPM 或品質模擬器，否則使用 Tpm 的應用程式開發會很困難。
- 您可能必須重新設計裝置的面板，才能在硬體中包含 TPM。 
- 如果您在 TPM 上將 EK 擲出，它會終結 TPM 的身分識別，並建立一個新的 TPM。 雖然實體晶片保持不變，但它在您的 IoT 解決方案中會有新的身分識別。

### <a name="symmetric-key"></a>對稱金鑰
使用對稱金鑰時，會使用相同的金鑰來加密和解密訊息。 如此一來，裝置和用來驗證它的服務都知道相同的金鑰。 Azure IoT 支援 SAS 權杖型對稱金鑰連接。 對稱金鑰驗證需要擁有大量的擁有者責任，才能使用 x.509 authentication 來保護金鑰，並達到相同層級的安全性。 如果您使用對稱金鑰，建議的作法是使用硬體安全模組 (HSM) 來保護金鑰。

對稱金鑰的專家：
- 使用對稱金鑰是開始進行驗證的最簡單、最低成本方式。
- 使用對稱金鑰可簡化您的流程，因為沒有額外的專案可產生。 

對稱金鑰的缺點： 
- 對稱金鑰會耗費大量的精力來保護金鑰。 相同的金鑰會在裝置與雲端之間共用，這表示金鑰必須在兩個地方受到保護。 相反地，TPM 和 x.509 憑證的挑戰是證明擁有公開金鑰，而不會洩漏私密金鑰。
- 對稱金鑰可讓您輕鬆遵循不佳的安全性做法。 對稱金鑰的常見傾向是在裝置上對未加密的金鑰進行硬式編碼。 雖然這種作法很方便，但它會讓金鑰變得很容易受到攻擊。 您可以安全地將對稱金鑰儲存在裝置上，以降低一些風險。 但是，如果您的優先順序最終是安全性，而不是便利性，請使用 x.509 憑證或 TPM 進行驗證。 

### <a name="shared-symmetric-key"></a>共用的對稱金鑰
有一種對稱金鑰驗證的變化，稱為共用的對稱金鑰。 此方法牽涉到在所有裝置上使用相同的對稱金鑰。 建議您避免在您的裝置上使用共用的對稱金鑰。 

共用對稱金鑰的 Pro：
- 大規模地產生和成本低廉的簡化。 

共用對稱金鑰的缺點： 
- 極容易遭受攻擊。 輕鬆執行的好處是風險遠遠超過。 
- 任何人都可以在取得共用金鑰時模擬您的裝置。
- 如果您依賴遭入侵的共用對稱金鑰，您可能會失去裝置的控制權。 

### <a name="making-the-right-choice-for-your-devices"></a>為您的裝置做出正確的選擇
若要選擇驗證方法，請務必考慮每個方法的優點和成本，以用於您的獨特製造流程。  針對裝置驗證，在指定的方法之間的安全，以及它的方便程度之間，通常會有反向關聯性。  

## <a name="installing-certificates-on-iot-devices"></a>在 IoT 裝置上安裝憑證
如果您使用 x.509 憑證來驗證您的 IoT 裝置，本節提供如何將憑證整合至製造程式的指引。 您必須做出幾項決策。  其中包括有關一般憑證變數、何時產生憑證，以及何時安裝憑證的決策。 

如果您使用密碼，您可能會問：為什麼您無法在所有裝置上使用相同的憑證，就像您在所有裝置上都能使用相同的密碼一樣。 首先，在所有位置使用相同的密碼都是危險的。 這項實務已將公司公開給重大 DDoS 攻擊，包括在美國東部海岸的幾年前進行 DNS 的攻擊。 千萬不要在任何地方使用相同的密碼，即使是使用個人帳戶也一樣。 其次，憑證不是密碼，它是唯一的身分識別。 密碼就像秘密碼，可讓任何人用來在安全的大樓中開啟門。  這是您知道的內容，而且您可以將密碼提供給任何人，以獲得進入。  憑證就像是具有相片的驅動程式授權，以及其他詳細資料，您可以向保護大樓取得安全的大樓。 它會系結至您的身分。  假設此防護能準確地比對具有驅動程式授權的人員，則只有您可以使用您的授權 (身分識別) 來獲得進入。 

### <a name="variables-involved-in-certificate-decisions"></a>與憑證決策相關的變數
請考慮下列變數，以及每一個變數如何影響整體製造流程。 

#### <a name="where-the-certificate-root-of-trust-comes-from"></a>信任的憑證根目錄來自
管理公開金鑰基礎結構 (PKI) 可能會耗費大量成本和複雜性。  尤其是貴公司沒有管理 PKI 的任何體驗。 選項包括：
- 使用協力廠商 PKI。 您可以從協力廠商憑證廠商購買中繼簽署憑證。 或者，您可以使用私人憑證授權單位單位 (CA) 。 
- 使用自我管理的 PKI。 您可以維護自己的 PKI 系統，並產生您自己的憑證。
- 使用 [Azure Sphere](https://azure.microsoft.com/services/azure-sphere/) 的安全性服務。 此選項只適用于 Azure Sphere 裝置。 

#### <a name="where-certificates-are-stored"></a>憑證的儲存位置
有幾個因素會影響儲存憑證的決策。 這些因素包括裝置類型、預期的利潤邊界 (您是否可以在您可以使用的裝置上承受安全的儲存體) 、裝置功能和現有的安全性技術。 請考慮下列選項：
- 在硬體安全模組中 (HSM) 。 強烈建議使用 HSM。 檢查裝置的控制板是否已安裝 HSM。 如果您知道您沒有 HSM，請與硬體製造商合作，找出符合您需求的 HSM。
- 在磁片上的安全位置，例如受信任的執行環境 (t) 。
- 在本機檔案系統或憑證存放區中。 例如，Windows 憑證存放區。 

#### <a name="connectivity-at-the-factory"></a>工廠的連線能力
工廠的連線決定您將在裝置上安裝憑證的方式和時間。 連接選項如下：
- 連接。 連接能力最佳，可簡化在本機產生憑證的程式。 
- 沒有連線能力。 在此情況下，您可以使用 CA 的已簽署憑證，在本機和離線產生裝置憑證。 
- 沒有連線能力。 在此情況下，您可以取得事先產生的憑證。 或者，您可以使用離線 PKI 在本機產生憑證。

#### <a name="audit-requirement"></a>Audit 需求
根據您產生的裝置類型而定，您可能會有法規需求，以建立裝置身分識別安裝方式的審核記錄。 審核會增加大量的生產成本。 因此，在大部分情況下，只有在必要時才執行。 如果您不確定是否需要進行審核，請洽詢貴公司的法律部門。 審核選項如下： 
- 不是敏感性產業。 不需要進行任何審核。
- 敏感性產業。 憑證應該根據合規性認證需求安裝在安全的房間內。 如果您需要安全的空間來安裝憑證，您可能已經知道憑證如何安裝到您的裝置。 而且您可能已經有一個 audit 系統。 

#### <a name="length-of-certificate-validity"></a>憑證有效性的長度
如同驅動程式的授權，憑證的到期日會在建立時設定。 以下是憑證有效性長度的選項：
- 不需要更新。  這種方法會使用長時間的更新，因此您永遠不需要在裝置的存留期內更新憑證。 雖然這種方法很方便，但它也是有風險的。  您可以使用安全的儲存體（例如您裝置上的 HSM）來降低風險。 不過，建議的作法是避免使用長期的憑證。
- 需要更新。  您必須在裝置的存留期內更新憑證。 憑證有效性的長度取決於內容，您將需要更新的策略。  策略應包括您取得憑證的位置，以及裝置在續約程式中必須使用的無線功能類型。 

### <a name="when-to-generate-certificates"></a>何時產生憑證
您工廠的網際網路連線能力會影響您產生憑證的流程。 有幾個選項可供您產生憑證： 

- 預先載入的憑證。  有些 HSM 廠商會提供一個 premium 服務，HSM 廠商會在此服務中安裝客戶的憑證。 首先，客戶會為 HSM 廠商提供簽署憑證的存取權。 然後，HSM 廠商會將簽署憑證所簽署的憑證安裝到客戶購買的每個 HSM 上。 所有客戶都必須在裝置上安裝 HSM。 雖然此服務增加了成本，但它有助於簡化您的製造流程。  並解決安裝憑證的問題。
- 裝置產生的憑證。  如果您的裝置在內部產生憑證，則必須從裝置解壓縮公用的 x.509 憑證，才能在 DPS 中註冊它。 
- 連線的工廠。  如果您的工廠有連線能力，您可以在需要時產生裝置憑證。
- 使用您自己的 PKI 的離線 factory。 如果您的工廠沒有連線能力，且您使用自己的 PKI 搭配離線支援，您可以在需要時產生憑證。
- 具有協力廠商 PKI 的離線 factory。 如果您的處理站沒有連線能力，而您使用的是協力廠商 PKI，則必須事先產生憑證。 而且需要從具有連線能力的位置產生憑證。 

### <a name="when-to-install-certificates"></a>安裝憑證的時機
為您的 IoT 裝置產生憑證之後，您就可以將它們安裝在裝置上。 

如果您使用預先載入的憑證搭配 HSM，則會簡化此程式。 在裝置上安裝 HSM 之後，裝置程式碼就可以存取它。 然後，您將呼叫 HSM Api 來存取儲存在 HSM 中的憑證。 這種方法對於您的製造流程而言最方便。 

如果您未使用預先載入的憑證，則必須在生產過程中安裝該憑證。 最簡單的方法是在您快閃初始的固件映射時，在 HSM 中安裝憑證。 您的進程必須加入在每部裝置上安裝映射的步驟。 在這個步驟之後，您可以在封裝和寄送裝置之前，執行最終品質檢查和任何其他步驟。 

有一些可用的軟體工具，可讓您在單一步驟中執行安裝程式和最終品質檢查。 您可以修改這些工具來產生憑證，或從預先產生的憑證存放區提取憑證。 然後，軟體可以安裝需要安裝的憑證。 這種類型的軟體工具可讓您大規模地執行生產環境品質製造。 

在裝置上安裝憑證後，下一個步驟是瞭解如何使用 [DPS](about-iot-dps.md)註冊裝置。 

## <a name="integrating-a-tpm-into-the-manufacturing-process"></a>將 TPM 整合到製造流程
如果您使用 TPM 來驗證 IoT 裝置，本節提供指引。 本指南涵蓋廣泛使用的 TPM 2.0 裝置，這些裝置具有以雜湊為基礎的訊息驗證碼 (HMAC) 金鑰支援。 TPM 晶片的 TPM 規格是受信任的計算群組所維護的 ISO 標準。 如需 TPM 的詳細資訊，請參閱 [tpm 2.0](https://trustedcomputinggroup.org/tpm-library-specification/) 和 [ISO/IEC 11889](https://www.iso.org/standard/66510.html)的規格。 

### <a name="taking-ownership-of-the-tpm"></a>取得 TPM 的擁有權
使用 TPM 晶片製造裝置的重要步驟是取得 TPM 的擁有權。 這是必要步驟，可讓您提供金鑰給裝置擁有者。 第一個步驟是將簽署金鑰從裝置解壓縮 (EK) 。 下一步是實際索取擁有權。 完成此動作的方式取決於您使用的 TPM 和作業系統。 如有需要，請聯繫 TPM 製造商或裝置作業系統的開發人員，以判斷如何宣告擁有權。 

在您的製造過程中，您可以將 EK 解壓縮並在不同的時間宣告擁有權，以增加彈性。 許多製造商都利用這種彈性，方法是新增硬體安全模組 (HSM) 以增強其裝置的安全性。 本節提供有關何時解壓縮 EK、何時宣告 TPM 擁有權的指引，以及將這些步驟整合至製造時程表的考慮。 

> [!IMPORTANT]
> 下列指導方針假設您使用離散、固件或整合式 TPM。 在適用的地方，本指南會新增使用非離散或軟體 TPM 的附注。 如果您使用軟體 TPM，則本指南可能不包含其他步驟。 Software Tpm 有各種不同的執行方式，不在本文的討論範圍內。  一般情況下，您可以將軟體 TPM 整合到下列一般製造時程表中。 不過，雖然軟體模擬 TPM 適用于原型設計和測試，但它無法提供與離散、固件或整合式 TPM 相同等級的安全性。 一般作法是避免在生產環境中使用軟體 TPM。

### <a name="general-manufacturing-timeline"></a>一般製造時程表
下列時間軸顯示 TPM 如何完成生產進程，並在裝置上結束。 每個製造程式都是唯一的，而此時間軸會顯示最常見的模式。 時間軸會提供有關何時使用金鑰採取特定動作的指引。 

#### <a name="step-1-tpm-is-manufactured"></a>步驟1：製造 TPM
- 如果您是從製造商購買 Tpm，以便在裝置上使用，請查看他們是否會將公開簽署金鑰解壓縮 (EK_pubs) 。 如果製造商提供隨附裝置的 EK_pubs 清單，這會很有説明。 
    > [!NOTE]
    > 您可以使用布建服務中的共用存取原則，將您註冊清單的寫入權限授與 TPM 製造商。  這種方法可讓他們將 Tpm 新增至您的註冊清單。  但在製造過程中，它需要信賴的 TPM 製造商。 請自行承擔風險。 

- 如果您製造 Tpm 來銷售給裝置製造商，請考慮提供客戶一份 EK_pubs 清單及其實體 Tpm。  為客戶提供 EK_pubs 在其過程中節省了一個步驟。 
- 如果您製造 Tpm 來與您自己的裝置搭配使用，請找出您程式中的哪個點是解壓縮 EK_pub 的最便利方式。 您可以在時間軸中的任何剩餘點解壓縮 EK_pub。 

#### <a name="step-2-tpm-is-installed-into-a-device"></a>步驟2：將 TPM 安裝到裝置
在實際執行的程式中，您應該知道裝置將使用哪一個 DPS 實例。 因此，您可以將裝置新增至自動布建的註冊清單。 如需自動裝置布建的詳細資訊，請參閱 [DPS 檔](about-iot-dps.md)。
- 如果您還沒有解壓縮 EK_pub，現在就是很好的時機。 
- 視 TPM 的安裝程式而定，此步驟也是取得 TPM 擁有權的好時機。 

#### <a name="step-3-device-has-firmware-and-software-installed"></a>步驟3：裝置已安裝固件和軟體
在此程式中的這個階段，請安裝 DPS 用戶端以及識別碼範圍和全域 URL 以進行布建。
- 現在是最後一個解壓縮 EK_pub 的機會。 如果協力廠商將在您的裝置上安裝軟體，最好先將 EK_pub 解壓縮。
- 在製造過程中，這一點非常適合用來取得 TPM 的擁有權。  
    > [!NOTE]
    > 如果您使用的是軟體 TPM，您現在可以安裝它。  同時將 EK_pub 解壓縮。

#### <a name="step-4-device-is-packaged-and-sent-to-the-warehouse"></a>步驟4：裝置已封裝並傳送至倉儲
在部署之前，裝置可以在倉儲中使用6-12 個月。 

#### <a name="step-5-device-is-installed-into-the-location"></a>步驟5：裝置已安裝至位置
裝置抵達其最終位置之後，就會透過 DPS 進行自動化布建。

如需詳細資訊， [請參閱布](about-iot-dps.md#provisioning-process) 建和 [TPM 證明](concepts-tpm-attestation.md)。 

## <a name="resources"></a>資源

除了本文中建議的安全性作法，Azure IoT 還提供資源來協助您選取安全的硬體和建立安全的 IoT 部署： 
- 引導部署程式的 Azure IoT [安全性建議](../iot-fundamentals/security-recommendations.md) 。 
- [Azure 資訊安全中心](https://azure.microsoft.com/services/security-center/)提供了一種服務，可協助建立安全的 IoT 部署。 
- 如需評估硬體環境的協助，請參閱 [評估 IoT 安全性](https://download.microsoft.com/download/D/3/9/D3948E3C-D5DC-474E-B22F-81BA8ED7A446/Evaluating_Your_IOT_Security_whitepaper_EN_US.pdf)的白皮書。 
- 如需有關選取安全硬體的協助，請參閱 [適用于 IoT 部署的正確安全硬體](https://download.microsoft.com/download/C/0/5/C05276D6-E602-4BB1-98A4-C29C88E57566/The_right_secure_hardware_for_your_IoT_deployment_EN_US.pdf)。 