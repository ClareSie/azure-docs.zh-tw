---
title: 為 IoT 代理配置 Azure 安全中心*微軟文檔
description: 瞭解如何為 IoT 安全代理配置 Azure 安全中心，以便與 IoT 安全服務的 Azure 安全中心一起使用。
services: asc-for-iot
ms.service: asc-for-iot
documentationcenter: na
author: mlottner
manager: rkarlin
editor: ''
ms.assetid: f95c445a-4f0d-4198-9c6c-d01446473bd0
ms.subservice: asc-for-iot
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 02/18/2020
ms.author: mlottner
ms.openlocfilehash: 70396cdcaf8b6e2ac66619290eea35a7b260cd9a
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/27/2020
ms.locfileid: "77461244"
---
# <a name="tutorial-configure-security-agents"></a>教程：配置安全代理

本文介紹了 IoT 安全代理的 Azure 安全中心，並詳細介紹了如何更改和配置它們。 

> [!div class="checklist"]
> * 設定安全性代理程式
> * 通過編輯孿生屬性更改代理行為
> * 發現預設配置

## <a name="agents"></a>代理程式

IoT 安全代理 Azure 安全中心從 IoT 設備收集資料，並執行安全操作以減輕檢測到的漏洞。 使用一組可以自訂的模組孿生屬性，安全代理配置是可控的。 通常，對這些屬性的輔助更新並不常見。  

IoT 安全代理孿生設定物件的 Azure 安全中心是 JSON 格式物件。 設定物件是一組可控制的屬性，您可以定義這些屬性來控制代理的行為。 

這些配置可説明您針對所需的每個方案自訂代理。 例如，通過配置這些屬性，可以自動排除某些事件，或將功耗保持在最低水準。  

使用 Azure 安全中心進行 IoT 安全代理配置[架構](https://aka.ms/iot-security-github-module-schema)進行更改。  

## <a name="configuration-objects"></a>設定物件 

與每個 IoT 安全代理的 Azure 安全中心相關的屬性位於**Azureiot 安全**模組的代理設定物件（所需屬性部分）中。 

要修改配置，請創建和修改**Azureiot 模組**孿體標識內的此物件。 

如果**Azureiotsecurity**模組孿生中不存在代理設定物件，則所有安全代理屬性值都設置為預設值。 

```json
"desired": {
  "ms_iotn:urn_azureiot_Security_SecurityAgentConfiguration": {
  } 
}
```

## <a name="configuration-schema-and-validation"></a>配置架構和驗證 

請確保根據此[架構](https://aka.ms/iot-security-github-module-schema)驗證代理配置。 如果設定物件與架構不匹配，代理將不會啟動。

 
如果在代理運行時，設定物件更改為無效配置（配置與架構不匹配），則代理將忽略無效配置，並繼續使用當前配置。 

### <a name="configuration-validation"></a>配置驗證

IoT 安全代理 Azure 安全中心在**Azureiot 安全**模組孿生標識的報告屬性部分內報告其當前配置。
如果使用者未設置屬性，代理將報告所有可用屬性，則代理報告預設配置。

為了驗證配置，請將所需節上設置的值與報告節中報告的值進行比較。

如果所需屬性和報告屬性不匹配，則代理無法分析配置。

根據[架構](https://aka.ms/iot-security-github-module-schema)驗證所需的屬性，修復錯誤，並再次設置所需的屬性！

> [!NOTE]
> 如果代理無法解析所需的配置，將從代理觸發配置錯誤警報。
> 比較報告和所需部分以瞭解警報是否仍然適用

## <a name="editing-a-property"></a>編輯屬性 

所有自訂屬性都必須設置在**Azureiot 安全**模組孿生的代理設定物件內。
要使用預設屬性值，請從設定物件中刪除該屬性。

### <a name="setting-a-property"></a>設置屬性

1. 在 IoT 中心中，找到並選擇要更改的設備。

1. 按一下您的設備，然後按一下**Azureiot 安全**模組。

1. 按一下**模組標識孿生**。

1. 編輯要在安全模組中更改的屬性。
   
   例如，要將連接事件配置為高優先順序並每 7 分鐘收集一次高優先順序事件，請使用以下配置。
   
    ```json
    "desired": {
        "ms_iotn:urn_azureiot_Security_SecurityAgentConfiguration": {
            "highPriorityMessageFrequency": {
                "value": "PT7M"
            },
            "eventPriorityConnectionCreate": {
                "value": "High"
            }
        }
    }
    ```

1. 按一下 [儲存]****。

### <a name="using-a-default-value"></a>使用預設值

要使用預設屬性值，請從設定物件中刪除該屬性。

## <a name="default-properties"></a>預設屬性 

下表包含 IoT 安全代理 Azure 安全中心的可控制屬性。

預設值在[GitHub](https\://aka.ms/iot-security-module-default)中的正確架構中可用。

| 名稱| 狀態 | 有效值| 預設值| 描述 |
|----------|------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------|---------------|
|高優先順序消息頻率|必需：假 |有效值：ISO 8601 格式的持續時間 |預設值： PT7M |發送高優先順序消息之前的最大時間間隔。|
|低優先順序消息頻率 |必需：假|有效值：ISO 8601 格式的持續時間 |預設值： PT5H |發送低優先順序消息之前的最大時間。| 
|快照頻率 |要求： 假|有效值：ISO 8601 格式的持續時間 |預設值 PT13H |創建設備狀態快照的時間間隔。| 
|最大本機快取大小位元組 |必需：假 |有效值： |預設值： 2560000， 大於 8192 | 允許代理的消息緩存的最大存儲（以位元組為單位）。 在發送消息之前，允許在設備上存儲消息的最大空間量。| 
|最大消息大小位元組 |必需：假 |有效值：大於 8192 的正數，小於 262144 |預設值： 204800 |對雲消息的代理的最大允許大小。 此設置控制每條消息中發送的最大資料量。 |
|事件優先順序$[事件名稱] |必需：假 |有效值：高、低、關 |預設值： |每個代理生成的事件的優先順序 | 

### <a name="supported-security-events"></a>支援的安全事件

|事件名稱| PropertyName | 預設值| 快照事件| 詳細資訊狀態  |
|----------|------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------|---------------|
|診斷事件|事件優先順序診斷| 關閉| False| 代理相關診斷事件。 使用此事件進行詳細日誌記錄。| 
|組態錯誤 |事件優先順序配置錯誤 |低 |False |代理未能分析配置。 根據架構驗證配置。| 
|丟棄的事件統計資訊 |事件優先順序放棄事件統計資訊 |低 |True|代理相關事件統計資訊。 |
|連接的硬體|事件優先順序連接硬體 |低 |True |連接到設備的所有硬體的快照。|
|接聽連接埠|事件優先順序偵聽埠 |高 |True |設備上所有打開的偵聽埠的快照。|
|流程創建 |事件優先順序進程創建 |低 |False |審核設備上的流程創建。|
|進程終止|事件優先順序進程終止 |低 |False |審核設備上的進程終止。| 
|系統資訊 |事件優先順序系統資訊 |低 |True |系統資訊的快照（例如：作業系統或 CPU）。| 
|本地使用者| 事件優先順序本地使用者 |高 |True|系統中已註冊的本地使用者的快照。 |
|登入|  事件優先順序登錄 |高|False|審核設備的登錄事件（本地和遠端登入）。|
|連接創建 |事件優先順序連接創建|低|False|審核在設備創建和從設備創建的 TCP 連接。 |
|防火牆組態| 事件優先順序防火牆配置|低|True|設備防火牆配置的快照（防火牆規則）。 |
|作業系統基線| 事件優先順序OS基線| 低|True|設備作業系統基線檢查的快照。|
|
 

## <a name="next-steps"></a>後續步驟

- [瞭解 Azure 安全中心，瞭解 IoT 建議](concept-recommendations.md)
- [探索適用于 IoT 警報的 Azure 安全中心](concept-security-alerts.md)
- [存取未經處理的安全性資料](how-to-security-data-access.md)
