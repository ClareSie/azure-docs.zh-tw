---
title: 包含檔案
description: 包含檔案
services: virtual-machines
author: albecker1
ms.service: virtual-machines
ms.topic: include
ms.date: 07/07/2020
ms.author: albecker1
ms.custom: include file
ms.openlocfilehash: 65f6c239f34775efff6a2ea2e399064a7702606a
ms.sourcegitcommit: f8d2ae6f91be1ab0bc91ee45c379811905185d07
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/10/2020
ms.locfileid: "89663876"
---
![Dsv3 檔](media/vm-disk-performance/dsv3-documentation.jpg)

最大未快取 **的磁片輸送量** 是虛擬機器能夠處理的預設儲存體上限。 當您啟用主機快取時， **最大快** 取儲存體輸送量限制是個別的限制。 建立虛擬機器並連接磁片時，可以完成啟用主機快取。 您也可以調整以開啟和關閉主機快取現有 VM 上的磁片：

![主機快取](media/vm-disk-performance/host-caching.jpg)

您可以調整主機快取，以符合每個磁片的工作負載需求。 您可以將主機快取設定為唯讀的工作負載，這些工作負載只會針對讀取和寫入作業進行平衡的工作負載進行讀取作業和讀取/寫入工作負載。 如果您的工作負載不符合任何一種模式，您很可惜無法使用主機快取。 

讓我們繼續進行 Standard_D8s_v3 虛擬機器的範例。 但這次我們將在磁片上啟用主機快取，而現在 VM 的 IOPS 限制為 16000 IOPS。 連接至 VM 的三個基礎 P30 磁片可以處理 5000 IOPS。

設定：
- Standard_D8s_v3 
    - 快取的 IOPS：16000
    - 未快取的 IOPS：12800
- P30 OS 磁片 
    - IOPS：5000
    - 主機快取已啟用 
- 2 P30 資料磁片
    - IOPS：5000
    - 主機快取已啟用

![主機快取範例](media/vm-disk-performance/host-caching-example-without-remote.jpg)

現在，在啟用快取的情況下使用此 Standard_D8s_v3 虛擬機器的應用程式，會提出 15000 IOPS 的要求。 這些要求會細分為每個連接的基礎磁片的 5000 IOPS，且不會發生效能上限。

## <a name="combined-uncached-and-cached-limits"></a>結合未快取和快取的限制

虛擬機器的快取限制與其未快取的限制不同。 這表示您可以在連結至 vm 的磁片上啟用主機快取，同時也不會啟用其他磁片上的主機快取，讓您的虛擬機器能夠取得快取限制的總儲存體 IO 加上未快取的限制。 讓我們執行這項作業的範例，以協助鞏固這些限制的運作方式，我們將繼續進行 Standard_D8s_v3 的虛擬機器和高階磁片連接設定。

設定：
- Standard_D8s_v3 
    - 快取的 IOPS：16000
    - 未快取的 IOPS：12800
- P30 OS 磁片 
    - IOPS：5000
    - 主機快取已啟用 
- 2 P30 資料磁片 X 2
    - IOPS：5000
    - 主機快取已啟用
- 2 P30 資料磁片 X 2
    - IOPS：5000
    - 主機快取已停用

![使用遠端存放的主機快取範例](media/vm-disk-performance/host-caching-example-with-remote.jpg)

現在，在 Standard_D8s_v3 虛擬機器上執行的應用程式會提出 25000 IOPS 的要求。 此要求會細分為每個連接的基礎磁片的 5000 IOPS，其中3個磁片使用主機快取，而2個磁片不是。 由於使用主機快取的3是在16000的快取限制內，因此這些要求已順利完成，而且不會發生儲存體效能上限。 此外，由於2個未使用主機快取的磁片是在未快取的限制12800內，因此這些要求也會成功完成，而且不會發生任何上限。

## <a name="metrics-for-disk-performance"></a>磁片效能的計量
我們在 Azure 上有一些計量，可讓您深入瞭解虛擬機器和磁片的執行情況。 您可以透過 Azure 入口網站以視覺化方式觀看這些計量，或透過 API 呼叫來抓取這些計量。 計量會以一分鐘的間隔計算。 下列計量可讓您深入瞭解 VM 和磁片 IO 和輸送量效能：
- **Os 磁片佇列深度** –等候讀取或寫入 OS 磁片的目前未完成 IO 要求數目。
- **Os Disk Read Bytes/Sec** –從 OS 磁片讀取的位元組數目。
- **Os Disk Read operations/Sec** –從 OS 磁片讀取的輸入作業數（秒）。
- **Os Disk Write Bytes/Sec** –以秒為單位從 os 磁片寫入的位元組數目。
- **Os 磁片寫入作業數/秒** –從 OS 磁片以秒數寫入的輸出作業數目。
- **資料磁片佇列深度** –等候讀取或寫入資料磁片 (s 的目前未完成 IO 要求數目) 。
- **資料磁片讀取位元組數/秒** –從資料磁片 (s) 讀取的位元組數目。
- **資料磁片讀取作業數/秒** –從資料磁片 () 讀取的輸入作業數。
- **資料磁片寫入位元組數/秒** –從資料磁片 (s) 以秒為單位寫入的位元組數目。
- **資料磁片寫入作業數/秒** –從資料磁片 (s) 寫入的輸出作業數目。
- **磁片讀取位元組數/秒** –從所有連接到 VM 的磁片讀取的位元組總數。
- **磁片讀取作業數/秒** –從所有連接至 VM 的磁片讀取的輸入作業數目。
- **磁片寫入位元組數/秒** –從連接至 VM 的所有磁片以秒為單位寫入的位元組數目。
- **磁片寫入作業數/秒–每** 秒從連結至 VM 的所有磁片寫入的輸出作業數目。

## <a name="storage-io-utilization-metrics"></a>儲存體 IO 使用量計量
協助診斷磁片 IO 上限的計量：
- **資料磁片 Iops 耗用百分比** -透過布建的資料磁片 iops 完成的資料磁片 iops 所計算的百分比。 如果此數量為100%，則您的應用程式執行將會從您的資料磁片的 IOPS 限制，以 IO 為上限。
- **使用的資料磁片頻寬百分比** -透過布建的資料磁片輸送量完成的資料磁片輸送量所計算的百分比。 如果此數量為100%，則您的應用程式執行將會從您的資料磁片的頻寬限制，以 IO 為上限。
- **作業系統磁片 Iops 耗用百分比** -透過布建的 Os 磁片 iops 完成的 Os 磁片 iops 所計算的百分比。 如果此數量為100%，則您的應用程式將會從您的 OS 磁片的 IOPS 限制，以 IO 為上限。
- **作業系統磁片頻寬耗用百分比** -透過布建的 os 磁片輸送量完成的 os 磁片輸送量所計算的百分比。 如果此數量為100%，則您的應用程式執行將會是作業系統磁片的頻寬限制的 IO。