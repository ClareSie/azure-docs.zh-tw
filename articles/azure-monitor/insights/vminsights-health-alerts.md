---
title: '適用於 VM 的 Azure 監視器來賓健康情況警示 (預覽) '
description: 描述適用於 VM 的 Azure 監視器來賓健全狀況所建立的警示，包括如何啟用和設定通知。
ms.subservice: ''
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 11/10/2020
ms.openlocfilehash: 9bbb0be321e78317c52586454de3d49cb2f878c1
ms.sourcegitcommit: c157b830430f9937a7fa7a3a6666dcb66caa338b
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/17/2020
ms.locfileid: "94686664"
---
# <a name="azure-monitor-for-vms-guest-health-alerts-preview"></a>適用於 VM 的 Azure 監視器來賓健康情況警示 (預覽) 
適用於 VM 的 Azure 監視器來賓健康狀態可讓您依定期取樣的一組效能測量所定義，來查看虛擬機器的健康情況。 當虛擬機器或監視變更為狀況不良狀態時，可以建立警示。 您可以 [在 Azure 監視器中使用警示規則所建立](../platform/alerts-overview.md) 的警示來查看和管理這些警示，並選擇在建立新警示時主動收到通知。

## <a name="configure-alerts"></a>設定警示
當這項功能處於預覽狀態時，您無法建立適用於 VM 的 Azure 監視器來賓健康情況的明確警示規則。 根據預設，系統會為每個虛擬機器建立警示，而不會為每個監視建立警示。  這表示，如果監視變更為不影響虛擬機器目前狀態的狀態，則不會建立警示，因為虛擬機器狀態並未變更。 

您可以從 Azure 入口網站的虛擬機器設定中的 [ **警示狀態** ] 設定，停用特定虛擬機器或虛擬機器上特定監視的警示。 如需在 Azure 入口網站中設定監視的詳細資訊，請參閱 [適用於 VM 的 Azure 監視器來賓健康情況中設定監視 (預覽) ](vminsights-health-configure.md) 。 如需有關跨一組虛擬機器設定監視的詳細資訊，請參閱 [使用資料收集規則在適用於 VM 的 Azure 監視器來賓健康情況中設定監視 (預覽) ](vminsights-health-configure-dcr.md) 。

## <a name="alert-severity"></a>警示嚴重性
來賓健康情況所建立的警示嚴重性，會直接對應到虛擬機器或監視觸發警示的嚴重性。

| 監視狀態 | 警示嚴重性 |
|:---|:---|
| Critical | Sev1 |
| 警告  | Sev2 |
| Healthy  | Sev4 |

## <a name="alert-lifecycle"></a>警示生命週期
每個虛擬機器一旦變更為 **警告** 或 **重大** 狀態時，就會為每個虛擬機器建立一個 [Azure 警示](../platform/alerts-overview.md)。 從 [ **Azure 監視器**] 功能表中的 **警示** 或 Azure 入口網站的虛擬機器功能表中，查看警示。

當虛擬機器狀態變更時，如果警示已處於已 **引發** 狀態，則不會建立第二個警示，但會變更相同警示的嚴重性，使其符合虛擬機器的狀態。 例如，如果虛擬機器在 **警告** 警示已處於「已 **引發**」狀態時變更為「**重大** 狀態」，則該警示的嚴重性將會變更為 **Sev1**。 如果虛擬機器在 **Sev1** 警示已處於「已 **引發**」狀態時變更為「**警告**」狀態，該警示的嚴重性將會變更為 **Sev2**。 如果虛擬機器移回 **狀況良好** 狀態，則會解決警示，並將嚴重性變更為 **Sev4**。

## <a name="viewing-alerts"></a>檢視警示
使用 [Azure 入口網站中](../platform/alerts-overview.md#alerts-experience)的其他警示來查看適用於 VM 的 Azure 監視器來賓健康情況所建立的警示。 您可以從 [ **Azure 監視器**] 功能表選取 **警示**，以查看所有受監視資源的警示，或從虛擬機器的功能表中選取 [**警示**]，以只查看該虛擬機器的警示。

## <a name="alert-properties"></a>警示內容

### <a name="properties-in-the-azure-portal"></a>Azure 入口網站中的屬性
下表說明當您在 Azure 入口網站中查看時，警示的屬性。

| 屬性 | 描述 |
|:---|:---|
| 監視警示建立之前的狀態 | 第一次引發此警示之前，監視或虛擬機器的狀態。 |
| 監視警示建立時的狀態 | 當第一次引發警示時，監視或虛擬機器的狀態。 這是造成警示引發的狀態。 |
| 若要深入瞭解警示建立時的狀態轉換 | 連結至 VM 健康情況頁面，您可以在其中查看確切的狀態轉換。 此狀態轉換代表監視第一次從 **狀況良好** 狀態進入非狀況良好狀態時的實例。 |

例如，監視從 **狀況良好** 到 **嚴重** 的時間為 t0，且 **Sev1** 會引發新的警示。 然後，它會從 **重大** 到 **警告** 的時間 t1，警示嚴重性會更新為 **Sev2**。 它會在時間 t2 變成 **狀況良好** ，並解決警示。

警示屬性會在此整個順序中包含這些值。

- 監視警示建立之前的狀態：狀況良好
- 監視警示建立時的狀態：重大
- 若要深入瞭解建立警示時的狀態轉換：狀態轉換在時間 t0 時發生的導覽連結。


### <a name="properties-in-notifications"></a>通知中的屬性
下表說明通知中包含的警示屬性。

| 屬性 | 描述 |
|:---|:---|
| 先前的監視器狀態 | 監視或虛擬機器在變更狀態之前的狀態。 如果警示嚴重性更新觸發此通知，則此屬性代表嚴重性更新之前的狀態。 |
| 目前的監視器狀態 | 監視或虛擬機器變更狀態時的狀態。 如果警示嚴重性更新觸發此通知，則此屬性代表新的狀態。 |
| 深入瞭解此狀態轉換 | 連結至 VM 健康情況頁面，您可以在其中查看確切的狀態轉換。 此狀態轉換代表監視已變更觸發此通知之狀態的實例。 |

使用上述範例，每次通知都會有下列屬性。

時間 t0 時收到的通知
- 先前的監視狀態：狀況良好
- 目前的監視狀態：重大
- 若要深入瞭解此狀態轉換：狀態轉換的導覽連結發生于時間 t0。

在時間 t1 收到通知
- 先前的監視狀態：重大
- 目前的監視器狀態：警告
- 若要深入瞭解此狀態轉換：狀態轉換的導覽連結發生在時間 t1。

時間 t2 收到的通知
- 先前的監視器狀態：警告
- 目前的監視器狀態：狀況良好
- 若要深入瞭解此狀態轉換：狀態轉換的導覽連結發生于時間 t2。

## <a name="configure-notifications"></a>設定通知
若要主動通知來賓健全狀況所觸發的警示，請建立 [動作群組](../platform/action-groups.md) 來定義要執行的不同動作，例如傳送 SMS 訊息或啟動邏輯應用程式。 然後建立 [動作規則](../platform/alerts-action-rules.md) ，以指定監視和虛擬機器的範圍，並使用該動作群組。

在 [ **監視** ] 功能表的 [Azure 入口網站中，選取 [ **警示**]。  選取 [ **管理動作** ]，然後選取 [ **動作規則] (預覽)**。 

![新增動作規則](media/vminsights-health-alerts/action-rule-new.png)

按一下 [ **新增動作規則** ] 以建立新的規則。 按一下 [範圍] 旁的 [ **選取** ]，然後選取訂用帳戶、資源群組，或一或多個特定的虛擬機器。 系統只會針對落在範圍內的虛擬機器引發通知。

![動作規則範圍](media/vminsights-health-alerts/action-rule-scope.png)

按一下 [**篩選**] 旁的 [**新增**]。 建立 **監視服務等於 VM 深入解析-健全狀況** 的篩選準則。 新增其他篩選準則，以指定應該觸發通知的特定警示。 例如，您可以使用 **嚴重性** 來比對所有監視符合特定嚴重性的警示。

![動作規則篩選](media/vminsights-health-alerts/action-rule-filter.png)

在 [ **定義此範圍**] 中，選取 [ **動作群組** ]，然後選取要與監視器相關聯的動作群組。 指定規則的名稱，然後選取應儲存的資源群組。 按一下 [ **建立** ] 以建立規則。

![動作規則](media/vminsights-health-alerts/action-rule.png)


## <a name="next-steps"></a>後續步驟

- [在適用於 VM 的 Azure 監視器中啟用來賓健全狀況，並將代理程式上架。](vminsights-health-enable.md)
- [使用 Azure 入口網站設定監視。](vminsights-health-configure.md)
- [使用資料收集規則設定監視。](vminsights-health-configure-dcr.md)