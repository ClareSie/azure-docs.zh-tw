---
title: 調整查詢和索引工作負載的容量
titleSuffix: Azure Cognitive Search
description: 調整 Azure 認知搜尋中的磁碟分割和複本電腦資源，其中每個資源都是以計費搜尋單位來計價。
manager: nitinme
author: HeidiSteen
ms.author: heidist
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 03/30/2020
ms.openlocfilehash: 476af7dd40cd1f31d03f3bd80affac0ce10ef900
ms.sourcegitcommit: 62e1884457b64fd798da8ada59dbf623ef27fe97
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/26/2020
ms.locfileid: "88927199"
---
# <a name="adjust-capacity-in-azure-cognitive-search"></a>調整 Azure 認知搜尋中的容量

在 [提供搜尋服務](search-create-service-portal.md) 並鎖定特定定價層之前，請花幾分鐘的時間瞭解服務中複本和資料分割的角色，以及您可能如何調整服務以符合資源需求的尖峰和下降。

容量是 [您選擇](search-sku-tier.md) 的階層函式 (層會決定) 的硬體特性，以及投影工作負載所需的複本和資料分割組合。 視層級和調整大小而定，增加或減少容量可能需要15分鐘到數小時的時間。 

修改複本和分割區的配置時，建議使用 Azure 入口網站。 入口網站會對允許的組合強制執行限制，而這些組合仍低於層級的最大限制。 但是，如果您需要以腳本為基礎或以程式碼為基礎的布建方法， [Azure PowerShell](search-manage-powershell.md) 或 [管理 REST API](/rest/api/searchmanagement/services) 是替代的解決方案。

## <a name="terminology-replicas-and-partitions"></a>術語：複本和磁碟分割

|||
|-|-|
|*資料分割* | 為讀寫作業 (例如，在重建或重新整理索引時) 提供索引儲存體和 I/O。 每個分割區都有總計索引的共用。 如果您配置三個數據分割，則索引會分成三分之二。 |
|*複本* | 搜尋服務的執行個體，主要用來讓查詢作業達到負載平衡。 每個複本都是索引的一個複本。 如果您配置三個複本，則會有三個索引複本可用於服務查詢要求。|

## <a name="when-to-add-nodes"></a>新增節點的時機

一開始，服務會配置由一個資料分割和一個複本組成的基本資源層級。 

單一服務必須具有足夠的資源，才能處理所有工作負載 (編製索引和查詢)。 這兩個工作負載都不會在背景執行。 您可以針對查詢要求自然較不頻繁的時間排程索引編制，但服務也不會優先處理其中一個工作的優先順序。 此外，當服務或節點在內部更新時，特定數量的冗余會將查詢效能變得更平滑。

一般而言，搜尋應用程式所需的複本比分割區多，特別是當服務作業偏差查詢工作負載時。 [高可用性](#HA) 一節將會說明原因。

> [!NOTE]
> 加入更多複本或資料分割會增加執行服務的成本，而且可能會在排序結果的方式中帶來些許變化。 請務必檢查 [定價計算機](https://azure.microsoft.com/pricing/calculator/) ，以瞭解新增更多節點的計費含意。 [下圖](#chart)可協助您交叉參考特定設定所需的搜尋單位數目。 如需其他複本如何影響查詢處理的詳細資訊，請參閱 [排序結果](search-pagination-page-layout.md#ordering-results)。

## <a name="how-to-allocate-replicas-and-partitions"></a>如何配置複本和磁碟分割

1. 登入 [Azure 入口網站](https://portal.azure.com/)，然後選取搜尋服務。

1. 在 [ **設定**] 中，開啟 [ **調整** ] 頁面以修改複本和資料分割。 

   下列螢幕擷取畫面顯示以一個複本和分割區布建的標準服務。 底部的公式指出 (1) 所使用的搜尋單位數目。 如果單價為 $100 (不是真正的價格) ，執行這項服務的每月成本平均都會是 $100。

   ![顯示目前值的縮放頁面](media/search-capacity-planning/1-initial-values.png "顯示目前值的縮放頁面")

1. 使用滑杆來增加或減少分割區數目。 底部的公式會指出正在使用的搜尋單位數目。

   此範例會將容量加倍，每個複本都有兩個複本和資料分割。 請注意搜尋單位元數目;這現在是四個，因為計費公式是複本乘以資料分割 (2 x 2) 。 比起執行服務的成本倍倍以上的容量。 如果搜尋單位成本為 $100，則新的每月帳單現在會是 $400。

   如需每一層的目前每個單位成本，請造訪 [定價頁面](https://azure.microsoft.com/pricing/details/search/)。

   ![新增複本和磁碟分割](media/search-capacity-planning/2-add-2-each.png "新增複本和磁碟分割")

1. 按一下 [ **儲存** ] 以確認變更。

   ![確認調整和計費的變更](media/search-capacity-planning/3-save-confirm.png "確認調整和計費的變更")

   容量變更需要數小時的時間才能完成。 一旦啟動程式之後，您就無法取消，且不會對複本和資料分割調整進行即時監視。 不過，在進行變更時，仍會顯示下列訊息。

   ![入口網站中的狀態訊息](media/search-capacity-planning/4-updating.png "入口網站中的狀態訊息")

> [!NOTE]
> 服務在布建之後，即無法升級至較高的層級。 您必須在新層中建立搜尋服務，然後重新載入您的索引。 請參閱 [入口網站中的建立 Azure 認知搜尋服務](search-create-service-portal.md) ，以取得服務布建方面的協助。
>
> 此外，分割區和複本會以獨佔方式以及由服務在內部進行管理。 沒有處理器親和性的概念，或將工作負載指派給特定的節點。
>

<a id="chart"></a>

## <a name="partition-and-replica-combinations"></a>資料分割與複本組合

「基本」服務可以有不多不少 1 個分割區及最多 3 個複本，上限為 3 個 SU。 唯一可調整的資源是複本。 您至少需要 2 個複本，才能在查詢上達到高可用性。

所有標準和儲存體優化搜尋服務都可採用下列複本和磁碟分割組合，受限於 36-SU 的限制。 

|   | **1個分割區** | **2個磁碟分割** | **3 個資料分割** | **4 個資料分割** | **6個磁碟分割** | **12 個資料分割** |
| --- | --- | --- | --- | --- | --- | --- |
| **1 個複本** |1 SU |2 SU |3 SU |4 SU |6 SU |12 SU |
| **2 個複本** |2 SU |4 SU |6 SU |8 SU |12 SU |24 SU |
| **3 個複本** |3 SU |6 SU |9 SU |12 SU |18 SU |36 SU |
| **4 個複本** |4 SU |8 SU |12 SU |16 SU |24 SU |N/A |
| **5 個複本** |5 SU |10 SU |15 SU |20 SU |30 SU |N/A |
| **6 個複本** |6 SU |12 SU |18 SU |24 SU |36 SU |N/A |
| **12 個複本** |12 SU |24 SU |36 SU |N/A |N/A |N/A |

SU、定價和容量會在 Azure 網站上詳細說明。 如需詳細資訊，請參閱[定價詳細資料](https://azure.microsoft.com/pricing/details/search/)。

> [!NOTE]
> 複本數和資料分割數可整除 12 (明確來說就是 1、2、3、4、6、12)。 這是因為 Azure 認知搜尋會將每個索引預先分割成12個分區，以便在所有分割區的相等部分中散佈。 例如，如果您的服務有三個資料分割，而您建立了索引，則每個資料分割將會包含 4 個該索引的分區。 Azure 認知搜尋分區索引的方式是執行的詳細資料，未來的版本可能會變更。 雖然現在分區數為 12，但您不應預期未來該數字永遠都會是 12。
>

<a id="HA"></a>

## <a name="high-availability"></a>高可用性

由於相應增加非常快速簡單，我們通常建議您從一個資料分割和一或兩個複本開始，然後於查詢量增長時再相應增加。 查詢工作負載主要是在複本上執行。 如果您需要更多的輸送量或高可用性，可能會需要額外的複本。

針對高可用性的一般建議為：

* 針對唯讀工作負載 (查詢)，需有 2 個複本才能達到高可用性

* 針對讀寫工作負載 (查詢再加上新增、更新或刪除個別文件時的索引編製)，需有 3 個或更多個複本才能達到高可用性

Azure 認知搜尋的服務等級協定 (SLA) 的目標是查詢作業，以及包含新增、更新或刪除檔的索引更新。

基本層最多一個分割區和三個複本。 如果想要具備立即回應檢索和查詢輸送量需求波動的彈性，請考慮標準層的其中一個。  如果您發現儲存體需求的成長速度比查詢輸送量更快，請考慮其中一個儲存體優化層級。

## <a name="disaster-recovery"></a>災害復原

目前沒有任何內建的機制可進行災害復原。 因此新增資料分割或複本並不是達成災害復原目標的正確選擇。 最常見的方法是在其他區域中設定第二個搜尋服務，來新增服務等級的備援。 與索引重建期間的可用性一樣，重新導向或容錯移轉邏輯必須來自您的程式碼。

## <a name="estimate-replicas"></a>估計複本

在生產服務上，您應該配置三個複本以供 SLA 之用。 如果您遇到查詢效能緩慢的情況，您可以新增複本，以便讓索引的其他複本上線以支援更大的查詢工作負載，以及對多個複本的要求進行負載平衡。

我們不提供需要多少複本來容納查詢負載的指導方針。 查詢效能取決於查詢和競爭工作負載的複雜性。 雖然新增複本會明顯獲得更好的效能，但是最終結果並不會完全地呈線性關係：新增 3 個複本並不保證有 3 倍的輸送量。

如需評估解決方案 QPS 的指引，請參閱 [調整效能](search-performance-optimization.md)和 [監視查詢](search-monitor-queries.md)

## <a name="estimate-partitions"></a>估計磁碟分割

[您選擇的層級](search-sku-tier.md)會決定資料分割的大小和速度，而每一層都會針對符合各種案例的一組特性進行優化。 如果您選擇較高階的層級，您可能需要比使用 S1 更少的資料分割。 您必須透過自我導向測試回答的問題之一，就是，較大且較昂貴的資料分割是否可在布建于較低層的服務上，產生比兩個較便宜的資料分割更佳的效能。

要求近乎即時資料重新整理的搜尋應用程式，按比例需要比複本更多的資料分割數。 新增資料分割可將讀取/寫入作業分配到更大量的計算資源。 它也提供更多磁碟空間來儲存額外的索引和文件。

索引越大，查詢所需的時間就越長。 這麼一來，您可能會發現每個資料分割中每個累加式的增加在複本中都需要有較小但按比例的增加。 要將查詢執行速度提高到何種程度，需將您的查詢和查詢磁碟區複雜性納入考量。

## <a name="next-steps"></a>後續步驟

> [!div class="nextstepaction"]
> [選擇 Azure 認知搜尋的定價層](search-sku-tier.md)