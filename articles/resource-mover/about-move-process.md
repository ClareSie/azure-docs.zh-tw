---
title: 關於 Azure Resource Mover 中的移動程序
description: 了解使用 Azure Resource Mover 來跨區域移動資源的程序
author: rayne-wiselman
manager: evansma
ms.service: resource-move
ms.topic: overview
ms.date: 09/09/2020
ms.author: raynew
ms.openlocfilehash: 4d520f51717aa11dba55697d63852b17e0ba9cf0
ms.sourcegitcommit: 80b9c8ef63cc75b226db5513ad81368b8ab28a28
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/16/2020
ms.locfileid: "90604490"
---
# <a name="about-the-move-process"></a>關於移動程序

[Azure Resource Mover](overview.md) 可協助您跨 Azure 區域移動 Azure 資源。 本文摘要說明 Resource Mover 所使用的元件，並描述移動程序。 


## <a name="components"></a>元件

區域移動期間會使用這些元件。

**元件** | **詳細資料**
--- | ---
**Resource Mover** |  Resource Mover 會與 [Azure 資源提供者](https://docs.microsoft.com/azure/azure-resource-manager/management/resource-providers-and-types)配合，以協調如何在區域之間移動資源。 Resource Mover 會分析資源相依性，並在移動過程中維護和管理資源的狀態。 
**移動集合** |  移動集合是 [Azure Resource Manager](https://docs.microsoft.com/azure/azure-resource-manager/management/overview) 物件。<br/><br/> 在進行區域移動程序的期間，會針對訂用帳戶中由來源和目標區域組合而成的每個配對建立移動集合。 集合中包含所要移動資源的相關中繼資料和設定資訊。<br/><br/>新增至移動集合的資源必須位於相同的訂用帳戶中，但可以位於不同的資源群組中。 
**移動資源** | 當您將資源新增至移動集合時，Resource Mover 會將其視為移動資源來進行追蹤。<br/><br/> Resource Mover 會維護移動集合中所有移動資源的資訊，並讓來源和目標資源之間維持一對一關聯性。 
**Dependencies** (相依性) | Resource Mover 會驗證您新增至集合的資源，並檢查資源是否有任何不在移動集合中的相依性。<br/><br/> 識別資源的相依性之後，您可以將相依性新增至移動集合並加以移動，也可以選取目標區域中作為替代的現有資源。 您必須先解決所有相依性才能開始移動。 



## <a name="move-region-process"></a>移動區域程序 

![顯示移動步驟的圖表](./media/about-move-process/move-steps.png)

每個移動資源都會經歷所摘要列出的步驟。

**Step** | **詳細資料** | **狀態/問題**
--- | --- | --- 
**步驟 1：選取資源** | 選取資源。 資源會新增至移動集合。 | 資源狀態會移至*準備擱置*。<br/><br/> 如果資源具有相依性，*驗證相依性*會指出您必須將依存資源新增至移動集合。
**步驟 2：驗證相依性** | 啟動驗證程序。<br/><br/> 如果驗證顯示相依資源擱置中，請將其新增至移動集合。 <br/><br/> 新增所有相依資源 (即使您不想要移動這些資源也一樣)。 您稍後可以指定所要移動的資源應該改用目標區域中的不同資源。<br/><br/> 您要再次驗證，直到沒有任何未完成的相依性為止。 | 新增所有相依性且驗證成功之後，資源狀態會移至*準備擱置*，且沒有任何問題。
**步驟 3：準備** | 啟動準備程序。 準備步驟取決於您要移動的資源：<br/><br/> - **無狀態資源**：無狀態資源僅有設定資訊。 這些資源不需要連續複寫資料就能移動。 範例包括 Azure 虛擬網路 (VNet)、網路介面卡、負載平衡器和網路安全性群組。 對於這種類型的資源，準備程序會產生 Azure Resource Manager 範本。<br/><br/> - **具狀態資源**：具狀態資源同時具有設定資訊以及需要移動的資料。 範例包括 Azure VM 和 Azure SQL 資料庫。 每個資源的準備程序都不同。 程序中可能包括將來源資源複寫至目標區域。 | 啟動時，資源狀態會移至*準備進行中*。<br/><br/> 準備完成之後，資源狀態會移至*起始移動暫止*，且沒有任何問題。<br/><br/> 若程序失敗，狀態會移至*準備失敗*。
**步驟 4：起始移動** | 啟動移動程序。 移動方法視資源類型而定：<br/><br/> - **無狀態**：一般來說，無狀態資源的移動程序會在目標區域中部署匯入的範本。 此範本所依據的是來源資源設定，以及您對目標設定所做的任何手動編輯。<br/><br/> - **具狀態**：具狀態資源的移動程序可能牽涉到在目標區域中建立資源 (或啟用複製)。<br/><br/>  起始移動可能會導致來源資源停機 (此情況僅發生於具狀態資源)。 例如，VM 和 SQL。 | 啟動移動程序會讓狀態轉移至*正在起始移動*。<br/><br/> 成功起始移動程序會讓資源狀態移至*認可移動擱置*，且沒有任何問題。 <br/><br/> 移動程序不成功則會讓狀態移至*起始移動失敗*。
**步驟 5 選項 1：捨棄移動** | 初次移動之後，您可以決定是否要繼續進行完整移動。 如果不想繼續，則可以捨棄移動，Resource Mover 便會刪除在目標中建立的資源。 捨棄程序完成後，則會繼續進行具狀態資源的複寫程序。 此選項可用於進行測試。 | 捨棄資源會讓狀態移至*捨棄進行中*。<br/><br/> 若捨棄成功，則狀態會移至*起始移動擱置*，且沒有任何問題。<br/><br/> 若捨棄失敗，則狀態會移至*捨棄移動失敗*。 
**步驟 5 選項 2：認可移動** | 初始移動之後，如果您想要繼續進行完整移動，請確認目標區域中的資源，並於準備好時認可該移動。<br/><br/> 認可可能會導致 VM 或 SQL 之類的來源資源變得無法存取 (此情況僅發生於具狀態資源)。 | 如果您認可該移動，則資源狀態會移至「認可移動進行中」。<br/><br/> 認可成功之後，資源狀態會顯示*認可移動完成*，且沒有任何問題。<br/><br/> 若認可失敗，則狀態會移至*認可移動失敗*。
**步驟 6：刪除來源** | 認可移動並確認目標區域中的資源之後，您就可以刪除來源資源。 | 認可移動之後，資源狀態會移至*刪除來源擱置*。


## <a name="move-region-states"></a>移動區域狀態

移動程序有許多狀態，以及在每個狀態期間可能發生的問題。 流程圖會摘要列出這些內容。

![可能狀態和問題的流程圖](./media/about-move-process/process.png)


### <a name="dependency-analysis"></a>相依性分析

當您逐步進行移動程序時，系統可能會要求您在下列情況下驗證相依性：
- 資源使用不在移動集合中的相依資源。
- 移動集合中的相依資源有自己的相依性，但不在移動集合中。
- 您已修改資源的目標設定，因此必須重新驗證相依性。


### <a name="remove-resources"></a>移除資源

如果您不想要移動資源，則可將資源從移動集合中移除。 一般而言，這便會從集合中刪除資源，以及任何相關聯的動作或物件 (例如複寫或預存範本)。 移除資源時會發生什麼事取決於資源類型，以及刪除資源時的資源狀態。 [深入了解](remove-move-resources.md) 

## <a name="move-impact"></a>移動影響

此表格摘要列出跨區域移動時的影響。

**行為** | **跨區域**
--- | --- | --- 
**Data** | 會移動資源資料和中繼資料。<br/><br/> 會暫時儲存中繼資料以追蹤資源相依性和作業的狀態。
**Resource** | 來源資源會保持不變，以確保應用程式會繼續運作，並可在移動後選擇將其移除。<br/><br/> 在目標區域中建立資源。
**移動程序** | 需要手動介入和監視的多步驟程序。
**** 測試： | 測試移動非常重要，因為在移動之後，應用程式應在目標區域中繼續如預期般運作。
**停機** |  應該不會遺失資料，但會有一些停機時間來移動資源。



## <a name="next-steps"></a>後續步驟

將 Azure VM [移動](tutorial-move-region-virtual-machines.md)至其他區域。
將 Azure SQL 資源[移動](tutorial-move-region-sql.md)至其他區域。