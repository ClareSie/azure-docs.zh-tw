---
title: Azure 監視器日誌分析中的日誌查詢範圍 |微軟文檔
description: 描述 Azure 監視器日誌分析中日誌查詢的範圍和時間範圍。
ms.subservice: logs
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 06/25/2019
ms.openlocfilehash: 897eff62fcbab5996b6b9493bd825ae412aa4c3e
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/28/2020
ms.locfileid: "79249590"
---
# <a name="log-query-scope-and-time-range-in-azure-monitor-log-analytics"></a>Azure 監視器日誌分析中的日誌查詢範圍和時間範圍
在[Azure 門戶中的日誌分析中](get-started-portal.md)運行[日誌查詢](log-query-overview.md)時，查詢計算的資料集取決於您選擇的範圍和時間範圍。 本文介紹了範圍和時間範圍，以及如何根據您的要求設置每個範圍。 它還描述了不同類型的作用域的行為。


## <a name="query-scope"></a>查詢範圍
查詢範圍定義由查詢計算的記錄。 這通常包括單個日誌分析工作區或應用程式見解應用程式中的所有記錄。 日誌分析還允許您為特定受監視的 Azure 資源設置範圍。 這允許資源擁有者只關注其資料，即使該資源寫入多個工作區也是如此。

範圍始終顯示在日誌分析視窗的左上角。 圖示指示作用域是日誌分析工作區還是應用程式見解應用程式。 沒有圖示指示其他 Azure 資源。

![影響範圍](media/scope/scope.png)

範圍由開機記錄分析的方法確定，在某些情況下，您可以通過按一下它來更改作用域。 下表列出了所使用的不同類型的作用域以及每個作用域的不同詳細資訊。

| 查詢範圍 | 範圍中的記錄 | 如何選擇 | 更改範圍 |
|:---|:---|:---|:---|
| Log Analytics 工作區 | 日誌分析工作區中的所有記錄。 | 從 Azure**監視器**功能表或**日誌分析工作區功能表中選擇****"日誌**"。  | 可以將範圍更改為任何其他資源類型。 |
| 應用程式洞察應用程式 | 應用程式見解應用程式中的所有記錄。 | 從應用程式見解**的概述**頁面選擇**分析**。 | 只能將範圍更改為其他應用程式見解應用程式。 |
| 資源群組 | 資源組中所有資源創建的記錄。 可能包括來自多個日誌分析工作區的資料。 | 從資源組功能表中選擇 **"日誌**"。 | 無法更改範圍。|
| 訂用帳戶 | 訂閱中所有資源創建的記錄。 可能包括來自多個日誌分析工作區的資料。 | 從訂閱功能表中選擇 **"日誌**"。   | 無法更改範圍。 |
| 其他 Azure 資源 | 由資源創建的記錄。 可能包括來自多個日誌分析工作區的資料。  | 從資源功能表中選擇 **"日誌**"。<br>OR<br>從 Azure**監視器**功能表中選擇 **"日誌"，** 然後選擇新作用域。 | 只能將範圍更改為相同的資源類型。 |

### <a name="limitations-when-scoped-to-a-resource"></a>限定到資源時的限制

當查詢範圍是日誌分析工作區或應用程式見解應用程式時，門戶中的所有選項和所有查詢命令都可用。 但是，當限定到資源時，門戶中的以下選項不可用，因為它們與單個工作區或應用程式相關聯：

- 儲存
- 查詢總管
- 新增警示規則

當限定到資源時，不能在查詢中使用以下命令，因為查詢作用域將已經包含包含該資源或資源集資料的任何工作區：

- [應用程式](app-expression.md)
- [工作](workspace-expression.md)
 

## <a name="query-limits"></a>查詢限制
可能具有 Azure 資源將資料寫入多個日誌分析工作區的業務需求。 工作區不需要與資源位於同一區域，並且單個工作區可能從不同區域的資源收集資料。  

將範圍設置為資源或資源集是 Log Analytics 的一個特別強大的功能，因為它允許您在單個查詢中自動合併分散式資料。 如果需要從多個 Azure 區域的工作區檢索資料，但它可以顯著影響性能。

日誌分析通過在使用特定區域數量時發出警告或錯誤，有助於防止跨多個區域工作區的查詢導致開銷過大。 如果作用域包含 5 個或更多區域的工作區，則查詢將收到警告。 它仍然會運行，但可能需要過多的時間才能完成。

![查詢警告](media/scope/query-warning.png)

如果作用域包含 20 個或更多區域的工作區，則您的查詢將被阻止運行。 在這種情況下，系統將提示您減少工作區區域的數量，並嘗試再次執行查詢。 下拉清單將顯示查詢範圍內的所有區域，在嘗試再次執行查詢之前，應減少區域數。

![查詢失敗](media/scope/query-failed.png)


## <a name="time-range"></a>時間範圍
時間範圍指定根據創建記錄的時間為查詢計算的記錄集。 這是由工作區或應用程式中每個記錄的標準屬性定義的，如下表中指定的。

| Location | 屬性 |
|:---|:---|
| Log Analytics 工作區          | TimeGenerated |
| 應用程式洞察應用程式 | timestamp     |

通過從日誌分析視窗頂部的時間選取器中選擇時間範圍來設置時間範圍。  您可以選擇預定義的期間或選擇 **"自訂"** 來指定特定的時間範圍。

![時間選擇器](media/scope/time-picker.png)

如果在查詢中設置篩選器，該篩選器使用上表所示的標準時間屬性，則時間選取器將更改為 **"在查詢中設置**"，並且時間選取器將禁用。 在這種情況下，將篩選器放在查詢的頂部是最有效的，以便任何後續處理只需要使用篩選的記錄。

![篩選查詢](media/scope/query-filtered.png)

如果使用[工作區](workspace-expression.md)或[應用](app-expression.md)命令從其他工作區或應用程式檢索資料，則時間選取器的行為可能會有所不同。 如果作用域是日誌分析工作區，並且您使用**應用**，或者作用域是應用程式見解應用程式，並且您使用**工作區**，則日誌分析可能不理解篩選器中使用的屬性應確定時間篩選器。

在下面的示例中，作用域設置為日誌分析工作區。  查詢使用**工作區**從另一個日誌分析工作區檢索資料。 時間選取器更改為 **"在查詢中設置**"，因為它看到使用預期**時間生成**屬性的篩選器。

![使用工作區查詢](media/scope/query-workspace.png)

如果查詢使用**應用**從應用程式見解應用程式檢索資料，則日誌分析不會識別篩選器中**的時間戳記**屬性，並且時間選取器保持不變。 在這種情況下，將應用兩個篩選器。 在此示例中，查詢中僅包含過去 24 小時內創建的記錄，即使它在**where**子句中指定了 7 天。

![使用應用查詢](media/scope/query-app.png)

## <a name="next-steps"></a>後續步驟

- 流覽[有關在 Azure 門戶中使用日誌分析的教程](get-started-portal.md)。
- 流覽[一下有關編寫查詢的教程](get-started-queries.md)。
