---
title: Azure AD 連接:將組從一個林遷移到另一個林 |微軟文件
description: 本文介紹成功將組從一個林遷移到另一個林以進行 Azure AD 連接所需的步驟。
services: active-directory
author: billmath
manager: daveba
ms.service: active-directory
ms.topic: reference
ms.workload: identity
ms.date: 04/02/2020
ms.subservice: hybrid
ms.author: billmath
ms.collection: M365-identity-device-management
ms.openlocfilehash: 602c60de392afbff18bc141605a936636e48dbfe
ms.sourcegitcommit: ffc6e4f37233a82fcb14deca0c47f67a7d79ce5c
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/21/2020
ms.locfileid: "81729695"
---
# <a name="migrate-groups-from-one-forest-to-another-for-azure-ad-connect"></a>將群組從一個林遷移到另一個林,以便進行 Azure AD 連接

本文介紹成功將組從一個林遷移到另一個林,以便遷移的組物件與雲中的現有對象匹配所需的步驟。

## <a name="prerequisites"></a>Prerequisites

- Azure AD 連線版本 1.5.18.0 或更高版本
- 源錨屬性是`mS-DS-ConsistencyGuid`

從版本 1.5.18.0 開始,Azure AD Connect 已開始`mS-DS-ConsistencyGuid`支援對組使用。 如果`mS-DS-ConsistencyGuid`選擇作為源錨點屬性,並且該值在 AD 中填充,則`mS-DS-ConsistencyGuid`Azure AD Connect 使用的值作為不可變 Id。 否則,它將回退到`objectGUID`使用 。 但是,請注意,Azure AD 連接**不會**將該值`mS-DS-ConsistencyGuid`寫回 AD 中的屬性。

在跨林移動方案中,組物件從一個林(如 F1)移動到另一個林(如 F2),我們`mS-DS-ConsistencyGuid`需要將 值(如果`objectGUID`存在)或值從林 F1 中的物件複製`mS-DS-ConsistencyGuid`到 F2 中的物件 的屬性。 

請使用以下腳本作為指南,瞭解如何將單個組從林 F1 遷移到林 F2。 請隨意使用它作為為多個組執行遷移的指南。

首先,`objectGUID`我們獲取`mS-DS-ConsistencyGuid`林 F1 中的組物件 和。 這些屬性將匯出到 CSV 檔。
```
<#
DESCRIPTION
============
This script will take DN of a group as input.
It then copies the objectGUID and mS-DS-ConsistencyGuid values along with other attributes of the given group to a CSV file.

This CSV file can then be used as input to Export-Group script
#>
Param(
       [ValidateNotNullOrEmpty()]
       [string]
       $dn,

       [ValidateNotNullOrEmpty()]
       [string]
       $outputCsv
)

$defaultProperties = @('samAccountName', 'distinguishedName', 'objectGUID', 'mS-DS-ConsistencyGuid')
$group  = Get-ADGroup -Filter "DistinguishedName -eq '$dn'" -Properties $defaultProperties -ErrorAction Stop
$results = @()
if ($group -eq $null)
{
       Write-Error "Group not found"
}
else
{
       $objectGUIDValue = [GUID]$group.'objectGUID'
       $mSDSConsistencyGuidValue = "N/A"
       if ($group.'mS-DS-ConsistencyGuid' -ne $null)
       {
              $mSDSConsistencyGuidValue = [GUID]$group.'mS-DS-ConsistencyGuid'
       }
       $adgroup = New-Object -TypeName PSObject
       $adgroup | Add-Member -MemberType NoteProperty -Name samAccountName -Value $($group.'samAccountName')
       $adgroup | Add-Member -MemberType NoteProperty -Name distinguishedName -Value $($group.'distinguishedName')
       $adgroup | Add-Member -MemberType NoteProperty -Name objectGUID -Value $($objectGUIDValue)
       $adgroup | Add-Member -MemberType NoteProperty -Name mS-DS-ConsistencyGuid -Value $($mSDSConsistencyGuidValue)
       $results += $adgroup
}

Write-Host "Exporting group to output file"
$results | Export-Csv "$outputCsv" -NoTypeInformation

```

接下來,我們使用生成的輸出 CSV 檔`mS-DS-ConsistencyGuid`在林 F2 中的目標物件上標記屬性。


```
<#
DESCRIPTION
============
This script will take DN of a group as input and the CSV file that was generated by Import-Group script
It copies either the objectGUID or mS-DS-ConsistencyGuid value from CSV file to the given object.

#>
Param(
       [ValidateNotNullOrEmpty()]
       [string]
       $dn,

       [ValidateNotNullOrEmpty()]
       [string]
       $inputCsv
)

$group  = Get-ADGroup -Filter "DistinguishedName -eq '$dn'" -ErrorAction Stop
if ($group -eq $null)
{
       Write-Error "Group not found"
}

$csvFile = Import-Csv -Path $inputCsv -ErrorAction Stop
$msDSConsistencyGuid = $csvFile.'mS-DS-ConsistencyGuid'
$objectGuid = [GUID] $csvFile.'objectGUID'
$targetGuid = $msDSConsistencyGuid

if ($msDSConsistencyGuid -eq "N/A")
{
       $targetGuid = $objectGuid
}

Set-ADGroup -Identity $dn -Replace @{'mS-DS-ConsistencyGuid'=$targetGuid} -ErrorAction Stop

```

## <a name="next-steps"></a>後續步驟
深入了解 [整合內部部署身分識別與 Azure Active Directory](whatis-hybrid-identity.md)。
