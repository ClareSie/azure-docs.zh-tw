---
title: 使用「訓練 Wide & 深層推薦課程模組
titleSuffix: Azure Machine Learning
description: 瞭解如何使用「定型範圍 & 深層推薦課程模組來訓練建議模型。
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: reference
author: likebupt
ms.author: keli19
ms.date: 06/12/2020
ms.openlocfilehash: a548a1aa6b7c6382d00e218f1b61347002df2b38
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/09/2020
ms.locfileid: "90907784"
---
# <a name="train-wide--deep-recommender"></a>訓練 Wide & 深層推薦
本文說明如何使用 Azure Machine Learning 設計工具中的「 **訓練寬 & 深層推薦** 模組來定型建議模型。 此課程模組是以 Google 所建議的廣泛 & 深度學習為基礎。

「 **訓練寬 & 深度推薦** 模組會讀取使用者-專案-評等三合一的資料集，並選擇性地讀取某些使用者和專案功能。 它會傳回已定型的廣泛 & 深層推薦。  然後，您可以使用已定型的模型，透過「 [全分數」和「深度推薦](score-wide-and-deep-recommender.md) 」模組來產生評等預測或建議。  

## <a name="more-about-recommendation-models-and-the-wide--deep-recommender"></a>深入瞭解建議模型和廣泛的 & 深層推薦  

建議系統的主要目的是建議系統的*使用者*使用一或多個*專案*。 項目的範例可能是電影、餐廳、書籍或歌曲。 使用者可以是個人、人員群組或具有項目喜好設定的其他實體。  

Recommender 系統有兩種主要方法。 

+ 第一種是**以內容為基礎的**方法，其利用使用者和項目的特徵。 使用年齡和性別等屬性可描述使用者，而使用作者和製造者可以描述項目。 在社交配對網站上可以找到以內容為基礎的建議系統的典型範例。 
+ 第二種方法是**協同篩選**，該方法僅使用使用者和項目的識別項，並從使用者提供的項目評等 (疏鬆) 矩陣取得有關這些實體的隱含資訊。 我們可以從使用者所評等的項目以及從已評等相同項目的其他使用者了解使用者。  

廣泛 & 深層推薦結合了這些方法，並使用以內容為基礎的方法來進行共同作業篩選。 因此被視為**混合 Recommender**。 

運作方式：當使用者對系統來說相當新時，會利用使用者的功能資訊來改善預測，藉此解決已知的「冷啟動」問題。 不過，一旦向特定使用者收集足量的評等時，就可能根據其特定評比 (而不只是根據其特徵) 進行完全個人化的預測。 因此，可從以內容為基礎的建議順利轉換成以協同篩選為基礎的建議。 即使使用者或專案功能無法使用，寬 & 深層推薦仍會在其共同作業篩選模式下運作。  

如需有關廣泛 & 深層推薦及其基礎概率演算法的詳細資訊，請參閱相關的研究白皮書： [適用于推薦系統的廣泛 & 深度學習](https://arxiv.org/pdf/1606.07792.pdf)。  

## <a name="how-to-configure-train-wide--deep-recommender"></a>如何設定整個訓練 & 深層推薦  

+ [準備定型資料](#prepare-data)
+ [訓練模型](#train-the-model)

### <a name="prepare-data"></a>準備資料

在嘗試使用模組之前，您的資料必須是建議模型所預期的格式。 需要 **使用者-專案-評等三** 合一的訓練資料集，但您也可以在不同的資料集中包含使用者功能和專案功能 (如果有) 的話）。

#### <a name="required-dataset-of-user-item-ratings"></a>需要使用者-專案-評等的資料集

用於定型的輸入資料必須以正確的格式包含正確的資料類型： 

+ 第一個資料行必須包含使用者識別碼。
+ 第二個數據行必須包含專案識別碼。
+ 第三個數據行包含使用者-專案組的評等。 評等值必須是數數值型別。 

例如，一組一般的使用者-專案-評等可能如下所示：

|UserId|MovieId|分級|
|------------|-------------|------------|
|1|68646|10|
|223|31381|10|

#### <a name="user-features-dataset-optional"></a>使用者功能資料集 (選用) 

**使用者特徵**的資料集必須包含使用者的識別碼，並使用使用者-專案-評等資料集的第一個資料行中所提供的相同識別碼。 其餘的資料行可以包含可描述使用者的任何數目的功能。  

例如，一組一般的使用者功能看起來可能像這樣： 

|UserId|年齡|性別|Interest|Location|
|------------|--------------|-----------------------|---------------|------------|
|1|25|male| 戲劇    |歐洲|
|223|40|female|浪漫|亞洲|

#### <a name="item-features-dataset-optional"></a>專案特徵資料集 (選擇性) 

項目特徵的資料集必須包含其第一個資料行中的項目識別碼。 其餘的資料行可以包含專案的任意數目的描述性功能。  

例如，一組一般的專案功能可能如下所示：  

|MovieId|標題|原始語言|流派|Year|
|-------------|-------------|-------------------|-----------|---------------|
|68646|Godfather|英文|戲劇|1972|
|31381|離開風|英文|歷程記錄|1939|

### <a name="train-the-model"></a>將模型定型

1.  在設計工具中，將「 **訓練寬」和「深層推薦** 」模組新增至您的實驗，並將其連接到訓練資料集。  
  
2. 如果您有使用者功能和/或專案功能的個別資料集，請將它們連接到「 **定型寬」和「深層推薦** 」模組。  
  
    - **使用者功能資料集**：將描述使用者的資料集連接至第二個輸入。
    - **專案功能資料集**：將描述專案的資料集連接到第三個輸入。  
    
3.  **Epoch**：指出演算法應該處理整個定型資料的次數。 

    這個數位愈高，定型的程度愈高;不過，定型成本更多，而且可能會導致過度學習。

4. **批次大小**：輸入在一個定型步驟中使用的定型範例數目。 

     這個超參數可能會影響定型速度。 較高的批次大小會導致較少的時間成本 epoch，但可能會增加聚合時間。 如果批次太大而無法容納 GPU/CPU，可能會引發記憶體錯誤。

5.  **寬部分優化程式**：選取一個優化工具，以將漸層套用至模型的寬部分。

6.  **寬優化工具學習速率**：輸入介於0.0 和2.0 之間的數位，以定義寬部分優化工具的學習率。

    此超參數會判斷每個定型步驟的步驟大小，並移至最小的損失函式。 太大的學習率可能會導致學習跳過最小值，而太小的學習率可能會導致聚合問題。

7.  **交叉功能維度**：輸入所需的使用者識別碼和專案識別碼功能來輸入維度。 

    寬 & 深層推薦預設會對使用者識別碼和專案識別碼功能執行交叉乘積轉換。 交叉的結果會根據此數位進行雜湊，以確保維度。

8.  **深度元件優化器**：選取一個優化工具，以將漸層套用至模型的深度部分。

9.  **深度優化工具學習速率**：輸入介於0.0 和2.0 之間的數位，以定義深度部分優化工具的學習率。

10.  **使用者嵌入維度**：輸入整數以指定使用者識別碼內嵌的維度。

     寬 & 深層推薦會為寬部分和深度建立共用的使用者識別碼內嵌和專案識別碼內嵌。

11.  **專案內嵌維度**：輸入整數以指定專案識別碼內嵌的維度。

12.  **類別功能內嵌維度**：輸入整數以指定類別目錄功能內嵌的維度。

     在寬 & 深層推薦的深層元件中，會針對每個類別功能學會內嵌向量。 而這些內嵌向量會共用相同的維度。

13.  **隱藏單位**：輸入深層元件的隱藏節點數目。 每個圖層中的節點數目會以逗號分隔。 例如，依據型別 "1000500100"，您可以指定 deep 元件具有三個層級，第一個層級分別是1000節點、500節點和100節點。

14.  **啟用**函式：選取套用至每個圖層的一個啟用函式，預設值為 ReLU。

15.  後**置：輸入**介於0.0 和1.0 之間的數位，以判斷在定型期間，輸出會在每個圖層中下降的機率。

     正規化方法可防止來自過度學習的類神經網路。 此值的一個常見決策是從0.5 開始，這似乎接近最適合各種網路和工作的最佳方式。

16.  **批次**正規化：選取此選項，以在深層元件中的每個隱藏層之後使用批次正規化。

     Batch 正規化是在網路訓練期間對抗內部 covariate 移位問題的技術。 一般來說，它可以協助改善網路的速度、效能和穩定性。 

17.  執行管道。

##  <a name="technical-notes"></a>技術說明

廣泛 & 深層共同訓練廣泛的線性模型和深度類神經網路，以結合記住需求和一般化的優勢。 寬元件接受一組原始功能和功能轉換，以記住功能互動。 使用較少的特徵設計，深層元件會透過低維度的密集功能內嵌，一般化為未可見的功能組合。 

在廣泛 & 深層推薦的執行中，模組會使用預設的模型結構。 寬元件會採用使用者識別碼和專案識別碼的使用者內嵌、專案內嵌和交叉乘積轉換來作為輸入。 針對模型的深度部分，會針對每個類別特徵學會內嵌向量。 這些向量會與其他數值特性向量一起輸送至深層饋送轉寄類神經網路。 寬部分和深度的組合是藉由將最終輸出記錄檔的機率加總，以做為預測，最後移至共同定型的一個常見損失函數。


## <a name="next-steps"></a>後續步驟

請參閱 Azure Machine Learning [可用的模組集合](module-reference.md) 。 
