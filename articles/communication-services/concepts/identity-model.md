---
title: 身分識別模型
titleSuffix: An Azure Communication Services concept
description: 瞭解身分識別和存取權杖
author: tomaschladek
manager: nmurav
services: azure-communication-services
ms.author: tchladek
ms.date: 10/26/2020
ms.topic: conceptual
ms.service: azure-communication-services
ms.openlocfilehash: f172bfcb6e4f11520eb9082052968626efe6fecb
ms.sourcegitcommit: 8e7316bd4c4991de62ea485adca30065e5b86c67
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/17/2020
ms.locfileid: "94651238"
---
# <a name="identity-model"></a>身分識別模型

Azure 通訊服務是身分識別中立的服務。 這項設計提供多項優點：

- 從您的身分識別管理系統重複使用現有的身分識別
- 提供整合案例的彈性
- 讓您的身分識別在 Azure 通訊服務中保持私密

與其複製您的系統中的資訊，您將會維護商務案例所需的對應關聯性。 例如，您可以對應身分識別1:1、1： N、N：1、N:M。 外部識別碼（例如電話號碼、使用者、裝置、應用程式和 Guid）無法用於 Azure 通訊服務中的身分識別。 針對 Azure 通訊服務身分識別所產生的存取權杖會用來存取基本專案，例如聊天或呼叫。

## <a name="identity"></a>身分識別

您可以使用 Azure 通訊服務管理程式庫來建立身分識別。 身分識別會作為交談中的識別碼。 它是用來建立存取權杖。 相同的身分識別可能會在多個裝置上參與多個同時會話。 身分識別可能同時有多個作用中存取權杖。 

刪除身分識別、資源或訂用帳戶會使其所有存取權杖失效。 此動作也會刪除針對身分識別所儲存的所有資料。 已刪除的身分識別無法建立新的存取權杖，也無法存取先前儲存的資料 (例如，) 的聊天訊息。 

您不需支付所擁有的身分識別數目。 相反地，您需支付使用基本專案的費用。 您的身分識別數目不需要限制您將應用程式的身分識別對應到 Azure 通訊服務身分識別的方式。 

有了對應的自由，就是隱私權責任。 如果使用者想要從您的系統中刪除，則您需要刪除與該使用者相關聯的所有身分識別。

Azure 通訊服務不提供匿名使用者的特殊身分識別。 它不會保留使用者和身分識別之間的對應，也無法判斷身分識別是否為匿名。 您可以設計符合您需求的身分識別概念。 建議您為每個應用程式上的每個匿名使用者建立新的身分識別。 

擁有有效存取權杖的任何人都可以存取目前的身分識別內容。 例如，使用者可以存取他們所傳送的聊天訊息。 存取權僅限於屬於存取權杖一部分的範圍。 如需詳細資訊，請參閱本文中的「 [存取權杖](#access-tokens) 」一節。

### <a name="identity-mapping"></a>身分識別對應

Azure 通訊服務不會複寫 Azure 身分識別管理系統的功能。 它不提供客戶使用客戶專屬身分識別的方式。 例如，客戶無法使用電話號碼或電子郵件地址。 相反地，Azure 通訊服務會提供唯一識別碼。 您可以將這些唯一的識別碼指派給您應用程式的身分識別。 Azure 通訊服務不會儲存任何可能會顯示使用者實際身分識別的資訊。

若要避免在系統中重複資訊，請規劃如何將使用者從身分識別網域對應到 Azure 通訊服務身分識別。 您可以遵循任何種類的模式。 例如，您可以使用1:1、1： N、N：1或 M:N。 決定單一使用者是否對應到單一身分識別或多個身分識別。 

建立新的身分識別時，請將其對應儲存至您應用程式的使用者或使用者。 因為身分識別需要存取權杖才能使用基本，所以您的應用程式使用者或使用者必須知道身分識別。

如果您使用關係資料庫來儲存使用者資訊，則可以根據對應案例來調整您的設計。 在對應1:1 或 N：1的案例中，您可能會想要將資料行加入至 `CommunicationServicesId` 資料表，以儲存您的 Azure 通訊服務身分識別。 在使用關聯性1： N 或 N:M 的案例中，您可以考慮在關係資料庫中建立個別的資料表。

## <a name="access-tokens"></a>存取權杖

存取權杖是 (JWT) 的 JSON Web 權杖，可用來存取 Azure 通訊服務基本專案。 發出的存取權杖具有完整性保護。 也就是說，它的宣告在發行之後就無法變更。 因此，手動變更屬性（例如身分識別、到期或範圍）將會使存取權杖失效。 如果基本專案搭配不正確權杖使用，則會拒絕對基本專案的存取。 

存取權杖的屬性為：
* 身份。
* Expiration。
* 範圍。

存取權杖的有效時間一律為24小時。 過期之後，存取權杖將會失效，且無法用來存取任何基本。 

身分識別需要一種方式，從伺服器端服務要求新的存取權杖。 *Scope* 參數定義可使用的一組非空白基本。 Azure 通訊服務支援下列適用于存取權杖的範圍。

|名稱|說明|
|---|---|
|聊天|  授與參與聊天的能力|
|VoIP|  授與呼叫身分識別和電話號碼的能力|


若要在到期時間之前撤銷存取權杖，請使用 Azure 通訊服務管理程式庫。 權杖撤銷不會立即生效。 傳播最多需要15分鐘的時間。 移除身分識別、資源或訂用帳戶會撤銷所有存取權杖。 

如果您想要移除使用者存取特定功能的能力，請撤銷所有存取權杖。 然後發出新的存取權杖，其中包含一組更有限的範圍。

在 Azure 通訊服務中，存取金鑰的輪替會撤銷使用先前的存取金鑰所建立的所有作用中存取權杖。 所有身分識別都會失去 Azure 通訊服務的存取權，而且必須發出新的存取權杖。 

建議您在伺服器端服務中發出存取權杖，而不是在用戶端的應用程式中發出。 原因是發出需要存取金鑰或受控識別。 基於安全性理由，不建議與用戶端的應用程式共用存取金鑰。 

用戶端應用程式應該使用可驗證用戶端的信任服務端點。 端點應該會代表其發出存取權杖。 如需詳細資訊，請參閱 [用戶端和伺服器架構](./client-and-server-architecture.md)。

如果您將存取權杖快取到備份存放區，我們建議使用加密。 存取權杖是機密資料。 它可用於惡意活動（如果未受保護）。 擁有存取權杖的使用者可以啟動 SDK 並存取 API。 可存取的 API 只會根據存取權杖擁有的範圍受到限制。 建議您發出只具有所需範圍的存取權杖。

## <a name="next-steps"></a>後續步驟

* 如需存取權杖管理的簡介，請參閱 [建立和管理存取權杖](https://docs.microsoft.com/azure/communication-services/quickstarts/access-tokens)。
* 如需驗證的簡介，請參閱 [向 Azure 通訊服務驗證](https://docs.microsoft.com/azure/communication-services/concepts/authentication)。
* 如需資料落地和隱私權的簡介，請參閱 [區域可用性和資料存放區](https://docs.microsoft.com/azure/communication-services/concepts/privacy)。
