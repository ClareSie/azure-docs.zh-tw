---
title: Azure SignalR Service 的效能指南
description: Azure SignalR 服務的性能和基準概述。 規劃容量時要考慮的關鍵指標。
author: sffamily
ms.service: signalr
ms.topic: conceptual
ms.date: 11/13/2019
ms.author: zhshang
ms.openlocfilehash: 68cad32be177fa20794399157fca89e87c2f8f59
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/27/2020
ms.locfileid: "74157661"
---
# <a name="performance-guide-for-azure-signalr-service"></a>Azure SignalR Service 的效能指南

使用 Azure SignalR 服務的主要優點之一是易於擴展 SignalR 應用程式。 在大規模方案中，性能是一個重要因素。 

在本指南中，我們將介紹影響 SignalR 應用程式性能的因素。 我們將描述不同用例方案中的典型性能。 最後，我們將介紹可用於生成性能報告的環境和工具。

## <a name="term-definitions"></a>詞彙定義

*入站*：傳入到 Azure SignalR 服務的消息。

*出站*：來自 Azure SignalR 服務的傳出消息。

*頻寬*：1 秒內所有消息的總大小。

*預設模式*：創建 Azure SignalR 服務實例時的預設工作模式。 Azure SignalR 服務希望應用伺服器在接受任何用戶端連接之前與其建立連接。

*無伺服器模式*：Azure SignalR 服務僅接受用戶端連接的模式。 不允許伺服器連接。

## <a name="overview"></a>總覽

Azure SignalR 服務為不同的性能容量定義了七個標準層。 本指南回答了以下問題：

-   每個層的典型 Azure SignalR 服務性能是什麼？

-   Azure SignalR 服務是否滿足我對消息輸送量的要求（例如，每秒發送 100，000 條消息）？

-   對於我的具體情況，哪個層適合我？ 或者如何選擇正確的層？

-   哪種應用伺服器（VM 大小）適合我？ 我應該部署多少個？

為了回答這些問題，本指南首先對影響績效的因素給出了高級說明。 然後，它說明了典型用例每個層的最大入站和出站消息：**回聲**、**廣播**、**發送到組**和**發送到連接**（對等聊天）。

本指南無法涵蓋所有方案（以及不同的用例、消息大小、消息發送模式等）。 但它提供了一些方法來説明您：

- 評估對入站或出站郵件的大致要求。
- 通過檢查性能表查找正確的層。

## <a name="performance-insight"></a>性能洞察

本節介紹績效評估方法，然後列出影響績效的所有因素。 最後，它提供了説明您評估性能要求的方法。

### <a name="methodology"></a>方法

*輸送量*和*延遲*是性能檢查的兩個典型方面。 對於 Azure SignalR 服務，每個 SKU 層都有自己的輸送量限制策略。 當 99% 的消息的延遲小於 1 秒時，該策略將*允許的最大輸送量（入站和出站頻寬）* 定義為達到的最大輸送量。

延遲是從發送消息的連接到從 Azure SignalR 服務接收回應訊息的時間跨度。 讓我們以**回聲**為例。 每個用戶端連接在郵件中添加時間戳記。 應用伺服器的中心將原始消息發送回用戶端。 因此，每個用戶端連接都可以輕鬆計算傳播延遲。 廣播**中的每條消息**、**發送到組**和**發送到連接**時都附加時間戳記。

要類比數千個併發用戶端連接，在 Azure 中的虛擬私人網路絡中創建多個 VM。 所有這些 VM 都連接到同一 Azure SignalR 服務實例。

在 Azure SignalR 服務的預設模式下，應用伺服器 VM 部署在同一虛擬私人網路絡中，與用戶端 VM 相同。 所有用戶端 VM 和應用伺服器 VM 都部署在同一區域的同一網路中，以避免跨區域延遲。

### <a name="performance-factors"></a>效能因素

從理論上講，Azure SignalR 服務容量受計算資源（CPU、記憶體和網路）的限制。 例如，與 Azure SignalR 服務的更多連接會導致服務使用更多記憶體。 對於較大的消息流量（例如，每條消息大於 2，048 位元組），Azure SignalR 服務需要花費更多的 CPU 週期來處理流量。 同時，Azure 網路頻寬還對最大流量施加了限制。

傳輸類型是影響性能的另一個因素。 這三種類型是[WebSocket、](https://en.wikipedia.org/wiki/WebSocket)[伺服器-發送事件](https://en.wikipedia.org/wiki/Server-sent_events)和[長輪詢](https://en.wikipedia.org/wiki/Push_technology)。 

WebSocket 是一種通過單個 TCP 連接的雙向和全雙工通訊協定。 伺服器-發送事件是一種單向協定，用於將消息從伺服器推送到用戶端。 長輪詢要求用戶端通過 HTTP 要求定期輪詢來自伺服器的資訊。 對於相同條件下的相同 API，WebSocket 具有最佳性能，伺服器發送事件速度較慢，長輪詢最慢。 預設情況下，Azure SignalR 服務建議 WebSocket。

消息路由成本也會限制性能。 Azure SignalR 服務充當消息路由器的角色，該路由器將消息從一組用戶端或伺服器路由到其他用戶端或伺服器。 不同的方案或 API 需要不同的路由策略。 

對於**回顯**，用戶端向自身發送消息，路由目標也是本身。 此模式具有最低的路由成本。 但對於**廣播**、**發送到組**和**發送到連接**，Azure SignalR 服務需要通過內部分散式資料結構查找目標連接。 這種額外的處理使用更多的 CPU、記憶體和網路頻寬。 因此，性能變慢。

在預設模式下，應用伺服器也可能成為某些方案的瓶頸。 Azure SignalR SDK 必須調用集線器，同時通過活動訊號與每個用戶端保持即時連接。

在無伺服器模式下，用戶端通過 HTTP 發佈發送消息，這不如 WebSocket 有效。

另一個因素是協定：JSON和[消息包](https://msgpack.org/index.html)。 MessagePack 的大小較小，交付速度比 JSON 快。 不過，MessagePack 可能無法提高性能。 Azure SignalR 服務的性能對協定不敏感，因為它不會在消息從用戶端轉發到伺服器期間解碼消息負載，反之亦然。

總之，以下因素會影響入站和出站容量：

-   SKU 層（CPU/記憶體）

-   連線數目

-   訊息大小

-   消息發送速率

-   傳輸類型（WebSocket、伺服器發送事件或長輪詢）

-   用例方案（路由成本）

-   應用伺服器和服務連接（在伺服器模式下）


### <a name="finding-a-proper-sku"></a>查找適當的 SKU

如何評估入站/出站容量或查找適合特定用例的層？

假設應用伺服器足夠強大，而不是性能瓶頸。 然後，檢查每個層的最大入站和出站頻寬。

#### <a name="quick-evaluation"></a>快速評估

讓我們首先通過假設一些預設設置來簡化評估： 

- 傳輸類型為 WebSocket。
- 消息大小為 2，048 位元組。
- 每 1 秒發送一條消息。
- Azure SignalR 服務處於預設模式。

每個層都有自己的最大入站頻寬和出站頻寬。 入站或出站連接超過限制後，無法保證流暢的使用者體驗。

**Echo**提供最大的入站頻寬，因為它具有最低的路由成本。 **廣播**定義最大出站消息頻寬。

*不要*超過以下兩個表中突出顯示的值。

|       Echo                        | 單元1 | 單元2 | 單元5 | 單元10 | 單元20 | 單元 50 | 單元100 |
|-----------------------------------|-------|-------|-------|--------|--------|--------|---------|
| 連接                       | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| **入站頻寬** | **2 MBps**    | **4 MBps**    | **10 MBps**   | **20 MBps**    | **40 MBps**    | **100 MBps**   | **200 MBps**    |
| 出站頻寬 | 2 MBps   | 4 MBps   | 10 MBps  | 20 MBps   | 40 MBps   | 100 MBps  | 200 MBps   |


|     廣播             | 單元1 | 單元2 | 單元5  | 單元10 | 單元20 | 單元 50  | 單元100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| 連接               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000  | 100,000 |
| 入站頻寬  | 4 KBps   | 4 KBps   | 4 KBps    | 4 KBps    | 4 KBps    | 4 KBps     | 4 KBps    |
| **出站頻寬** | **4 MBps**    | **8 MBps**    | **20 MBps**    | **40 MBps**    | **80 MBps**    | **200 MBps**    | **400 MBps**   |

*入站頻寬*和*出站頻寬*是每秒的總消息大小。  以下是它們的公式：
```
  inboundBandwidth = inboundConnections * messageSize / sendInterval
  outboundBandwidth = outboundConnections * messageSize / sendInterval
```

- *入站連接*：發送消息的連接數。

- *出站連接*：接收消息的連接數。

- *消息大小*： 單個消息的大小（平均值）。 小於 1，024 位元組的小消息會影響性能，類似于 1，024 位元組的消息。

- *發送間隔*：發送一條消息的時間。 通常每條消息 1 秒，這意味著每秒發送一條消息。 間隔較小意味著在時間段內發送更多消息。 例如，每條消息 0.5 秒意味著每秒發送兩條消息。

- *連接*：每個層的 Azure SignalR 服務的已提交最大閾值。 如果連接數量進一步增加，它將受到連接限制的影響。

#### <a name="evaluation-for-complex-use-cases"></a>複雜用例的評估

##### <a name="bigger-message-size-or-different-sending-rate"></a>更大的消息大小或不同的發送速率

實際用例更為複雜。 它可能發送大於 2，048 位元組的消息，或者發送消息速率不是每秒一條消息。 讓我們以 Unit100 的廣播為例，瞭解如何評估其性能。

下表顯示了**廣播**的實際用例。 但是消息大小、連接計數和消息發送速率與上一節中假設的不同。 問題是，如果我們只知道其中兩個專案，我們如何推導其中任何一項（消息大小、連接計數或消息發送速率）。

| 廣播  | 訊息大小 | 每秒入站郵件數 | 連接 | 發送間隔 |
|---|---------------------|--------------------------|-------------|-------------------------|
| 1 | 20 KB                | 1                        | 100,000     | 5 秒                      |
| 2 | 256 KB               | 1                        | 8,000       | 5 秒                      |

以下公式易於根據前面的公式推斷：

```
outboundConnections = outboundBandwidth * sendInterval / messageSize
```

對於 Unit100，最大出站頻寬為上一表的 400 MB。 對於 20 KB 的消息大小，最大出站連接應為 400 MB \* 5 / 20 KB = 100，000，與實際值匹配。

##### <a name="mixed-use-cases"></a>混合用例

實際用例通常將四個基本用例混合在一起：**回聲**、**廣播**、**發送到組**和**發送到連接**。 用於評估容量的方法包括：

1. 將混合用例劃分為四個基本用例。
1. 分別使用上述公式計算入站和出站消息頻寬的最大。
1. 並求頻寬計算，以獲得總的最大入站/出站頻寬。 

然後從最大入站/出站頻寬表中拾取正確的層。

> [!NOTE]
> 對於向數百或數千個小組發送消息，或向彼此發送消息的數千個用戶端，路由成本將佔據主導地位。 考慮此影響。

對於向用戶端發送消息的用例，請確保應用伺服器*不是*瓶頸。 以下"案例研究"部分提供有關需要多少應用伺服器以及應配置多少伺服器連接的指南。

## <a name="case-study"></a>案例研究

以下各節介紹 WebSocket 傳輸的四個典型用例：**回聲**、**廣播**、**發送到組**和**發送到連接**。 對於每個方案，該部分列出 Azure SignalR 服務的當前入站和出站容量。 它還解釋了影響性能的主要因素。

在預設模式下，應用伺服器使用 Azure SignalR 服務創建五個伺服器連接。 預設情況下，應用伺服器使用 Azure SignalR 服務 SDK。 在以下效能測試結果中，伺服器連接增加到 15（或更多用於廣播和向大型組發送消息）。

不同的用例對應用伺服器有不同的要求。 **廣播**需要少量的應用伺服器。 **回聲**或**發送到連接**需要許多應用伺服器。

在所有用例中，預設消息大小為 2，048 位元組，消息發送間隔為 1 秒。

### <a name="default-mode"></a>預設模式

用戶端、Web 應用伺服器和 Azure SignalR 服務在預設模式下涉及。 每個用戶端代表單個連接。

#### <a name="echo"></a>Echo

首先，Web 應用連接到 Azure SignalR 服務。 其次，許多用戶端連接到 Web 應用，Web 應用使用訪問權杖和終結點將用戶端重定向到 Azure SignalR 服務。 然後，用戶端使用 Azure SignalR 服務建立 WebSocket 連接。

在所有用戶端建立連接後，它們開始每秒向特定中心發送包含時間戳記的消息。 中心將消息回回其原始用戶端。 每個用戶端在收到回顯波消息時計算延遲。

在下圖中，5 到 8（紅色突出顯示的流量）位於迴圈中。 該迴圈運行為預設持續時間（5 分鐘），並獲取所有消息延遲的統計資訊。

![回聲用例的流量](./media/signalr-concept-performance/echo.png)

**回聲**的行為確定最大入站頻寬等於最大出站頻寬。 如需詳細資訊，請參閱下表。

|       Echo                        | 單元1 | 單元2 | 單元5 | 單元10 | 單元20 | 單元 50 | 單元100 |
|-----------------------------------|-------|-------|-------|--------|--------|--------|---------|
| 連接                       | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 每秒入站/出站消息 | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 入站/出站頻寬 | 2 MBps   | 4 MBps   | 10 MBps  | 20 MBps   | 40 MBps   | 100 MBps  | 200 MBps   |

在此用例中，每個用戶端調用應用伺服器中定義的中心。 中心只是調用在原始用戶端中定義的方法。 此集線器是**用於回聲**的最羽量級集線器。

```
        public void Echo(IDictionary<string, object> data)
        {
            Clients.Client(Context.ConnectionId).SendAsync("RecordLatency", data);
        }
```

即使對於這個簡單的集線器，隨著**回顯**入站消息負載的增加，應用伺服器上的流量壓力也十分突出。 此流量壓力需要許多大型 SKU 層的應用伺服器。 下表列出了每個層的應用伺服器計數。


|    Echo          | 單元1 | 單元2 | 單元5 | 單元10 | 單元20 | 單元 50 | 單元100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 連接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 應用伺服器計數 | 2     | 2     | 2     | 3      | 3      | 10     | 20      |

> [!NOTE]
> 應用伺服器的用戶端連接數、消息大小、消息發送速率、SKU 層和 CPU/記憶體會影響**回顯**器的整體性能。

#### <a name="broadcast"></a>廣播

對於**廣播**，當 Web 應用收到消息時，它將廣播給所有用戶端。 要廣播的用戶端越多，所有用戶端的消息流量就越多。 請參閱下圖。

![廣播用例的流量](./media/signalr-concept-performance/broadcast.png)

少數用戶端正在廣播。 入站消息頻寬較小，但出站頻寬巨大。 出站消息頻寬會隨著用戶端連接或廣播速率的增加而增加。

下表匯總了最大用戶端連接、入站/出站消息計數和頻寬。

|     廣播             | 單元1 | 單元2 | 單元5  | 單元10 | 單元20 | 單元 50  | 單元100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| 連接               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000  | 100,000 |
| 每秒入站郵件數  | 2     | 2     | 2      | 2      | 2      | 2       | 2       |
| 每秒出站消息 | 2,000 | 4,000 | 10,000 | 20,000 | 40,000 | 100,000 | 200,000 |
| 入站頻寬  | 4 KBps   | 4 KBps   | 4 KBps    | 4 KBps    | 4 KBps    | 4 KBps     | 4 KBps     |
| 出站頻寬 | 4 MBps   | 8 MBps   | 20 MBps   | 40 MBps   | 80 MBps   | 200 MBps   | 400 MBps   |

發佈消息的廣播用戶端不超過四個。 與**Echo**相比，他們需要較少的應用伺服器，因為入站消息量很小。 兩個應用伺服器足以同時考慮 SLA 和性能。 但是，您應該增加預設伺服器連接以避免不平衡，尤其是對於 Unit50 和 Unit100。

|   廣播      | 單元1 | 單元2 | 單元5 | 單元10 | 單元20 | 單元 50 | 單元100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 連接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 應用伺服器計數 | 2     | 2     | 2     | 2      | 2      | 2      | 2       |

> [!NOTE]
> 將每個應用伺服器上的預設伺服器連接從 5 增加到 40，以避免與 Azure SignalR 服務可能存在不平衡的伺服器連接。
>
> 用戶端連接編號、消息大小、消息發送速率和 SKU 層會影響**廣播**的總體性能。

#### <a name="send-to-group"></a>發送到組

**發送到組**用例具有類似的**廣播**流量模式。 區別在於，用戶端在使用 Azure SignalR 服務建立 WebSocket 連接後，必須先加入組，然後才能向特定組發送消息。 下圖說明瞭流量流。

![發送到組用例的流量](./media/signalr-concept-performance/sendtogroup.png)

組成員和組計數是影響績效的兩個因素。 為了簡化分析，我們定義了兩種組：

- **小組**：每個組有 10 個連接。 組數等於（最大連接計數）/10。 例如，對於 Unit1，如果有 1，000 個連接計數，則我們有 1000 / 10 = 100 個組。

- **大組**：組數總是 10。 組成員計數等於 （最大連接計數） / 10。 例如，對於 Unit1，如果存在 1，000 個連接計數，則每個組具有 1000 / 10 = 100 個成員。

**發送到組**會為 Azure SignalR 服務帶來路由成本，因為它必須通過分散式資料結構查找目標連接。 隨著發送連接的增加，成本也會增加。

##### <a name="small-group"></a>小組

路由成本對於向許多小組發送消息非常重要。 目前，Azure SignalR 服務實現達到單元 50 的路由成本限制。 添加更多的 CPU 和記憶體不起作用，因此 Unit100 無法通過設計進一步改進。 如果您需要更多入站頻寬，請聯繫客戶支援。

|   發送到小組     | 單元1 | 單元2 | 單元5  | 單元10 | 單元20 | 單元 50 | 單元100 |
|---------------------------|-------|-------|--------|--------|--------|--------|---------|
| 連接               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000 | 100,000
| 組成員計數        | 10    | 10    | 10     | 10     | 10     | 10     | 10 
| 群組計數               | 100   | 200   | 500    | 1,000  | 2,000  | 5,000  | 10,000 
| 每秒入站郵件數  | 200   | 400   | 1,000  | 2,500  | 4,000  | 7,000  | 7,000   |
| 入站頻寬  | 400 KBps  | 800 KBps  | 2 MBps     | 5 MBps     | 8 MBps     | 14 MBps    | 14 MBps     |
| 每秒出站消息 | 2,000 | 4,000 | 10,000 | 25,000 | 40,000 | 70,000 | 70,000  |
| 出站頻寬 | 4 MBps    | 8 MBps    | 20 MBps    | 50 MBps     | 80 MBps    | 140 MBps   | 140 MBps    |

許多用戶端連接都在調用中心，因此應用伺服器編號對性能也至關重要。 下表列出了建議的應用伺服器計數。

|  發送到小組   | 單元1 | 單元2 | 單元5 | 單元10 | 單元20 | 單元 50 | 單元100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 連接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 應用伺服器計數 | 2     | 2     | 2     | 3      | 3      | 10     | 20      |

> [!NOTE]
> 應用伺服器的用戶端連接數、消息大小、消息發送速率、路由成本、SKU 層和 CPU/記憶體會影響**發送到小組**的總體性能。

##### <a name="big-group"></a>大集團

對於**發送到大組**，出站頻寬成為瓶頸之前達到路由成本限制。 下表列出了最大出站頻寬，這幾乎與**廣播**的出站頻寬相同。

|    發送到大群組      | 單元1 | 單元2 | 單元5  | 單元10 | 單元20 | 單元 50  | 單元100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| 連接               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000  | 100,000
| 組成員計數        | 100   | 200   | 500    | 1,000  | 2,000  | 5,000   | 10,000 
| 群組計數               | 10    | 10    | 10     | 10     | 10     | 10      | 10
| 每秒入站郵件數  | 20    | 20    | 20     | 20     | 20     | 20      | 20      |
| 入站頻寬  | 80 KBps   | 40 KBps   | 40 KBps    | 20 KBps    | 40 KBps    | 40 KBps     | 40 KBps     |
| 每秒出站消息 | 2,000 | 4,000 | 10,000 | 20,000 | 40,000 | 100,000 | 200,000 |
| 出站頻寬 | 8 MBps    | 8 MBps    | 20 MBps    | 40 MBps    | 80 MBps    | 200 MBps    | 400 MBps    |

發送連接計數不超過 40。 應用伺服器上的負擔很小，因此建議的 Web 應用數量很小。

|  發送到大群組  | 單元1 | 單元2 | 單元5 | 單元10 | 單元20 | 單元 50 | 單元100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 連接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 應用伺服器計數 | 2     | 2     | 2     | 2      | 2      | 2      | 2       |

> [!NOTE]
> 將每個應用伺服器上的預設伺服器連接從 5 增加到 40，以避免與 Azure SignalR 服務可能存在不平衡的伺服器連接。
> 
> 用戶端連接編號、消息大小、消息發送速率、路由成本和 SKU 層會影響**發送到大組**的總體性能。

#### <a name="send-to-connection"></a>發送到連接

在**發送到連接**用例中，當用戶端建立到 Azure SignalR 服務的連接時，每個用戶端都會調用一個特殊的中心來獲取自己的連接 ID。 性能基準收集所有連接標識，洗牌它們，並將其重新分配給所有用戶端作為發送目標。 用戶端會一直將消息發送到目標連接，直到效能測試完成。

![發送到用戶端用例的流量](./media/signalr-concept-performance/sendtoclient.png)

**發送到連接**的路由成本類似于**發送到小組**的成本。

隨著連接數量的增加，路由成本會限制整體性能。 單元 50 已達到限制。 因此，Unit100 無法進一步改進。

下表是運行到**連接**基準的多輪之後的統計摘要。

|   發送到連接   | 單元1 | 單元2 | 單元5 | 單元10 | 單元20 | 單元 50          | 單元100         |
|------------------------------------|-------|-------|-------|--------|--------|-----------------|-----------------|
| 連接                        | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000          | 100,000         |
| 每秒入站/出站消息 | 1,000 | 2,000 | 5,000 | 8,000  | 9,000  | 20,000 | 20,000 |
| 入站/出站頻寬 | 2 MBps    | 4 MBps    | 10 MBps   | 16 MBps    | 18 MBps    | 40 MBps       | 40 MBps       |

此用例需要應用伺服器端的高負載。 請參閱下表中建議的應用伺服器計數。

|  發送到連接  | 單元1 | 單元2 | 單元5 | 單元10 | 單元20 | 單元 50 | 單元100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 連接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 應用伺服器計數 | 2     | 2     | 2     | 3      | 3      | 10     | 20      |

> [!NOTE]
> 應用伺服器的用戶端連接數、消息大小、消息發送速率、路由成本、SKU 層和 CPU/記憶體會影響**發送到連接**的整體性能。

#### <a name="aspnet-signalr-echo-broadcast-and-send-to-small-group"></a>ASP.NET信號R回波、廣播和發送到小組

Azure 信號R 服務為ASP.NET信號R提供相同的性能容量。 

效能測試使用[標準服務方案 S3](https://azure.microsoft.com/pricing/details/app-service/windows/)中的 Azure Web 應用來ASP.NET信號R。

下表給出了ASP.NET信號R**回波**的建議 Web 應用計數。

|   Echo           | 單元1 | 單元2 | 單元5 | 單元10 | 單元20 | 單元 50 | 單元100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 連接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 應用伺服器計數 | 2     | 2     | 4     | 4      | 8      | 32      | 40       |

下表給出了ASP.NET信號R**廣播**的建議 Web 應用計數。

|  廣播       | 單元1 | 單元2 | 單元5 | 單元10 | 單元20 | 單元 50 | 單元100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 連接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 應用伺服器計數 | 2     | 2     | 2     | 2      | 2      | 2      | 2       |

下表給出了ASP.NET信號R**發送到小組**的建議 Web 應用計數。

|  發送到小組     | 單元1 | 單元2 | 單元5 | 單元10 | 單元20 | 單元 50 | 單元100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 連接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 應用伺服器計數 | 2     | 2     | 4     | 4      | 8      | 32      | 40       |

### <a name="serverless-mode"></a>無伺服器模式

用戶端和 Azure SignalR 服務處於無伺服器模式。 每個用戶端代表單個連接。 用戶端通過 REST API 將消息發送到其他用戶端，或向所有人廣播訊息。

通過 REST API 發送高密度消息不如使用 WebSocket 高效。 它要求您每次構建新的 HTTP 連接，這是無伺服器模式下的額外成本。

#### <a name="broadcast-through-rest-api"></a>通過 REST API 廣播
所有用戶端都使用 Azure SignalR 服務建立 WebSocket 連接。 然後，一些用戶端開始通過 REST API 進行廣播。 消息發送（入站）全部通過 HTTP Post，與 WebSocket 相比效率不高。

|   通過 REST API 廣播     | 單元1 | 單元2 | 單元5  | 單元10 | 單元20 | 單元 50  | 單元100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| 連接               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000  | 100,000 |
| 每秒入站郵件數  | 2     | 2     | 2      | 2      | 2      | 2       | 2       |
| 每秒出站消息 | 2,000 | 4,000 | 10,000 | 20,000 | 40,000 | 100,000 | 200,000 |
| 入站頻寬  | 4 KBps    | 4 KBps    | 4 KBps     | 4 KBps     | 4 KBps     | 4 KBps      | 4 KBps      |
| 出站頻寬 | 4 MBps    | 8 MBps    | 20 MBps    | 40 MBps    | 80 MBps    | 200 MBps    | 400 MBps    |

#### <a name="send-to-user-through-rest-api"></a>通過 REST API 向使用者發送
基準在用戶端開始連接到 Azure SignalR 服務之前，會為所有用戶端分配使用者名。 用戶端與 Azure SignalR 服務建立 WebSocket 連接後，它們開始通過 HTTP Post 向其他人發送消息。

|   通過 REST API 向使用者發送 | 單元1 | 單元2 | 單元5  | 單元10 | 單元20 | 單元 50  | 單元100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| 連接               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000  | 100,000 |
| 每秒入站郵件數  | 300   | 600   | 900    | 1,300  | 2,000  | 10,000  | 18,000  |
| 每秒出站消息 | 300   | 600   | 900    | 1,300  | 2,000  | 10,000  | 18,000 |
| 入站頻寬  | 600 KBps  | 1.2 MBps  | 1.8 MBps   | 2.6 MBps   | 4 MBps     | 10 MBps     | 36 MBps    |
| 出站頻寬 | 600 KBps  | 1.2 MBps  | 1.8 MBps   | 2.6 MBps   | 4 MBps     | 10 MBps     | 36 MBps    |

## <a name="performance-test-environments"></a>效能測試環境

對於前面列出的所有用例，我們在 Azure 環境中進行了效能測試。 我們最多使用 50 個用戶端 VM 和 20 個應用伺服器 VM。 以下是一些詳細資料：

- 用戶端 VM 大小：標準DDS2V2（2 個 vCPU，7G 記憶體）

- 應用伺服器 VM 大小：標準F4sV2（4 個 vCPU，8G 記憶體）

- Azure SignalR SDK 伺服器連接： 15

## <a name="performance-tools"></a>效能工具

您可以在[GitHub](https://github.com/Azure/azure-signalr-bench/)上查找 Azure SignalR 服務的性能工具。

## <a name="next-steps"></a>後續步驟

在本文中，您得到了 Azure SignalR 服務在典型用例方案中的性能的概述。

要獲取有關服務內部和擴展的詳細資訊，請閱讀以下指南：

* [Azure SignalR Service 內部項目](signalr-concept-internals.md)
* [Azure 信號R 服務擴展](signalr-howto-scale-multi-instances.md)
