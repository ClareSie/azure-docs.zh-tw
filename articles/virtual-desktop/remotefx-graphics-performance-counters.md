---
title: 診斷圖形性能問題 遠端桌面 - Azure
description: 本文介紹如何在遠端桌面協定會話中使用 RemoteFX 圖形計數器來診斷 Windows 虛擬桌面中圖形的性能問題。
services: virtual-desktop
author: Heidilohr
ms.service: virtual-desktop
ms.topic: troubleshooting
ms.date: 05/23/2019
ms.author: helohr
manager: lizross
ms.openlocfilehash: 84cee86dbddff77f6142925eec01889cf793a466
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/28/2020
ms.locfileid: "79127564"
---
# <a name="diagnose-graphics-performance-issues-in-remote-desktop"></a>診斷遠端桌面中的圖形性能問題

為了診斷遠端會話的體驗品質問題，已在效能監視器的"遠端FX圖形"部分下提供了計數器。 本文可説明您在這些計數器遠端桌面協定 （RDP） 會話期間查明和修復與圖形相關的性能瓶頸。

## <a name="find-your-remote-session-name"></a>查找遠端會話名稱

您需要遠端會話名稱來標識圖形效能計數器。 按照本節中的說明來標識每個計數器的實例。

1. 從遠端會話打開 Windows 命令提示。
2. 運行**qwinsta**命令並找到會話名稱。
    - 如果您的會話託管在多會話虛擬機器 （VM） 中：每個計數器的實例尾碼為與綴會話名稱相同的數位，如"rdp-tcp 37"。
    - 如果您的會話託管在支援虛擬圖形處理單元 （vGPU） 的 VM 中：每個計數器的實例存儲在伺服器上，而不是存儲在 VM 中。 您的計數器實例包括 VM 名稱，而不是會話名稱中的數位，例如"Win8 企業 VM"。

>[!NOTE]
> 雖然計數器的名稱中有 RemoteFX，但它們在 vGPU 方案中也包含遠端桌面圖形。

## <a name="access-performance-counters"></a>訪問效能計數器

確定遠端會話名稱後，請按照這些說明收集遠端會話的 RemoteFX 圖形效能計數器。

1. 選擇 **"啟動** > **管理工具** > **效能監視器**"。
2. 在 **"效能監視器"** 對話方塊中，**展開監視工具**，選擇**效能監視器**，然後選擇"**添加**"。
3. 在"**添加計數器"** 對話方塊中，從 **"可用計數器"** 清單中展開 RemoteFX 圖形部分。
4. 選擇要監視的計數器。
5. 在**所選物件的實例**清單中，選擇要監視所選計數器的特定實例，然後選擇 **"添加**"。 要選擇所有可用的計數器實例，請選擇 **"所有實例**"。
6. 添加計數器後，選擇 **"確定**"。

選定的效能計數器將顯示在"效能監視器"螢幕上。

>[!NOTE]
>主機上的每個活動會話都有其每個效能計數器的實例。

## <a name="diagnose-issues"></a>診斷問題

與圖形相關的性能問題通常分為四類：

- 低畫面播放速率
- 隨機攤位
- 高輸入延遲
- 幀品質差

### <a name="addressing-low-frame-rate-random-stalls-and-high-input-latency"></a>解決低畫面播放速率、隨機停滯和高輸入延遲

首先檢查輸出幀/秒計數器。 它測量提供給用戶端的幀數。 如果此值小於輸入幀/秒計數器，則跳過幀。 要識別瓶頸，請使用跳過的幀/秒計數器。

跳過/秒的幀計數器有三種類型：

- 跳過/秒的幀（伺服器資源不足）
- 跳過/秒的幀（網路資源不足）
- 跳過/秒的幀（用戶端資源不足）

對於任何跳過的幀/秒計數器的較高值意味著問題與計數器跟蹤的資源有關。 例如，如果用戶端不解碼和以伺服器提供幀的相同速率呈現幀，則跳過的幀/秒（用戶端資源不足）計數器將很高。

如果輸出幀/秒計數器與輸入幀/秒計數器匹配，但您仍然注意到異常延遲或延遲，則平均編碼時間可能是罪魁禍首。 編碼是在單會話 （vGPU） 方案中的伺服器上和多會話方案中的 VM 上發生的同步過程。 平均編碼時間應低於 33 毫秒。 如果平均編碼時間低於 33 毫秒，但仍存在性能問題，則可能應用或作業系統有問題。

有關診斷應用相關問題的詳細資訊，請參閱[使用者輸入延遲效能計數器](/windows-server/remote/remote-desktop-services/rds-rdsh-performance-counters/)。

由於 RDP 支援 33 ms 的平均編碼時間，因此它支援高達 30 幀/秒的輸入畫面播放速率。 請注意，33 ms 是支援的最大畫面播放速率。 在許多情況下，使用者經歷的畫面播放速率將較低，具體取決於源向 RDP 提供幀的頻率。 例如，觀看視頻等任務需要 30 幀/秒的完整輸入畫面播放速率，但計算密集型任務（如不常編輯文檔）導致輸入幀/秒的值要低得多，並且使用者體驗品質不會降低。

### <a name="addressing-poor-frame-quality"></a>解決幀品質差的問題

使用幀品質計數器診斷幀品質問題。 此計數器表示輸出幀的品質，作為源幀品質的百分比。 品質損失可能是由於 RemoteFX 造成的，或者可能是圖形源固有的。 如果 RemoteFX 導致品質損失，則問題可能是缺少網路或伺服器資源來發送高保真內容。

## <a name="mitigation"></a>降低

如果伺服器資源導致瓶頸，請嘗試以下方法之一來提高性能：

- 減少每個主機的會話數。
- 增加伺服器上的記憶體和計算資源。
- 斷開連接的解析度。

如果網路資源導致瓶頸，請嘗試以下方法之一來提高每個會話的網路可用性：

- 減少每個主機的會話數。
- 使用頻寬較高的網路。
- 斷開連接的解析度。

如果用戶端資源導致瓶頸，請嘗試以下方法之一來提高性能：

- 安裝最新的遠端桌面用戶端。
- 增加用戶端電腦上的記憶體和計算資源。

> [!NOTE]
> 我們目前不支援源幀/秒計數器。 目前，源幀/秒計數器將始終顯示 0。

## <a name="next-steps"></a>後續步驟

- 要創建 GPU 優化的 Azure 虛擬機器，請參閱[為 Windows 虛擬桌面環境配置圖形處理單元 （GPU） 加速](configure-vm-gpu.md)。
- 有關故障排除和升級跟蹤的概述，請參閱[故障排除概述、回饋和支援](troubleshoot-set-up-overview.md)。
- 要瞭解有關該服務的更多資訊，請參閱[Windows 桌面環境](environment-setup.md)。
