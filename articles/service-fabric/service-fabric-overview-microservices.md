---
title: Azure 上的微服務簡介
description: 概述在現代應用程式開發中，為何使用微服務方法建置雲端應用程式很重要，以及 Azure Service Fabric 如何提供平台以達成此目標。
ms.topic: conceptual
ms.date: 01/07/2020
ms.custom: sfrev
ms.openlocfilehash: af18a6cb45808c0af5ec2782a3fd2100e3b7bf99
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/27/2020
ms.locfileid: "75750626"
---
# <a name="why-use-a-microservices-approach-to-building-applications"></a>為什麼使用微服務方法來構建應用程式

對於軟體發展人員來說，將應用程式分解到元件部分並不是什麼新鮮事。 通常，使用分層方法，包括後端存儲、中介層業務邏輯和前端使用者介面 （UI）。 過去幾年*中，* 開發人員正在為雲構建分散式應用程式。因此，開發人員正在構建分散式應用程式。

以下是一些不斷變化的業務需求：

* 大規模構建和運營的服務，可覆蓋新地理區域的客戶。
* 更快地交付特性和功能，以敏捷的方式回應客戶需求。
* 提高資源使用率來降低成本。

這些商務需求會影響我們「如何」 ** 建置應用程式。

有關 Azure 微服務方法的詳細資訊，請參閱[微服務：由雲提供支援的應用程式革命](https://azure.microsoft.com/blog/microservices-an-application-revolution-powered-by-the-cloud/)。

## <a name="monolithic-vs-microservices-design-approach"></a>單片式與微服務設計方法

應用程式會隨著時間而演化。 成功的應用程式因為有實用性而演化。 不成功的應用程式不會發展，最終被棄用。 下面是一個問題：您對今天的要求瞭解多少，以及將來的需求是什麼？ 例如，假設您正在為公司中的部門構建報告應用程式。 您確定該應用程式僅適用于公司範圍，並且報告不會保留很長時間。 您的方法將不同于構建向數千萬客戶提供視頻內容的服務。

有時，把東西從門裡拿出來作為概念的證明是推動因素。 您知道應用程式可以在以後重新設計。 過度工程的東西是毫無意義的，永遠不會被使用。 另一方面，當公司為雲構建時，期望是增長和使用。 增長和規模是不可預測的。 我們希望快速進行原型設計，同時知道我們正走在一條能夠應對未來成功的道路上。 這是精簡的創業方法：建置、測量、學習及反覆執行。

在用戶端/伺服器時代，我們傾向于專注于在每個層中使用特定技術構建分層應用程式。 一詞*單一*應用程式已經出現來描述這些方法。 介面通常存在於各層之間，而在各層內的元件之間採用更緊密結合的設計。 開發人員設計和分解類，這些類已編譯到庫中，並連結到幾個可執行檔和 DLL。

整體設計方法具有優勢。 單片應用程式的設計通常更簡單，並且元件之間的調用速度更快，因為這些調用通常是通過進程間通信 （IPC） 進行。 此外，每個人都測試單個產品，這往往是更高效地利用人力資源。 缺點是分層層之間存在緊密的耦合，並且無法縮放單個元件。 如果您需要執行修復或升級，您必須等待其他人完成測試。 敏捷是很難的。

微服務解決了這些缺點，並更符合前面的業務需求。 但他們也有福利和負債。 微服務的優點在於其通常會封裝較簡單的商務功能，因此您可以獨立地對它們進行相應增加或減少、測試、部署，以及管理。 微服務方法的一個重要好處是，團隊更多地受業務場景而非技術驅動。 較小的團隊根據客戶方案開發微服務，並使用他們想要使用的任何技術。

換句話說，組織不需要為了維護微服務應用程式而將技術標準化。 擁有服務的個別團隊可以根據團隊的專業知識，或什麼是最適合所要解決的問題，各自發揮所長。 實際上，最好使用一組推薦的技術，如特定的 NoSQL 存儲或 Web 應用程式框架。

微服務的缺點是必須管理更獨立的實體，並處理更複雜的部署和版本控制。 微服務之間的網路流量增加，相應的網路延遲也增加。 大量閒聊、精細的服務可能會導致性能噩夢。 如果沒有工具來説明您查看這些依賴項，就很難看到整個系統。

標準通過指定如何通信和容忍服務所需的內容，而不是剛性合同，使微服務方法發揮作用。 在設計中預先定義這些協定非常重要，因為服務彼此獨立更新。 另一個在設計微服務方法時出現的描述是「細緻的服務導向架構 (SOA)」。

***最簡單的是，微服務設計方法是關於服務分離的聯合，對每個和商定的通信標準進行獨立更改。***

隨著更多雲應用程式的產生，人們發現，將整體應用程式分解為獨立、以方案為中心的服務是一種更好的長期方法。

## <a name="comparison-between-application-development-approaches"></a>應用程式開發方法的比較

![Service Fabric 平台應用程式開發][Image1]

1) 單片應用程式包含特定于域的功能，通常分為 Web、業務和資料等功能層。

2) 通過在多個伺服器/虛擬機器/容器上克隆單個應用程式來擴展整體應用程式。

3) 微服務應用程式會將個別功能分隔成個別較小的服務。

4) 微服務方法可獨立部署每個服務而相應放大，跨伺服器/虛擬機器/容器建立這些服務的執行個體。

使用微服務方法進行設計並不適合所有專案，但它確實與前面描述的業務目標更緊密地一致。 如果您知道以後有機會將代碼重新編寫到微服務設計中，則從整體方法開始可能有意義。 較常見的情況是您從單體式應用程式開始著手，然後從需要更高調整性或靈活度的功能領域開始，分階段緩慢地將它拆解。

使用微服務方法時，可以編寫許多小型服務的應用程式。 這些服務在跨電腦群集中部署的容器中運行。 較小的團隊開發一個側重于方案的服務，並獨立測試、版本、部署和擴展每個服務，以便整個應用程式能夠發展。

## <a name="what-is-a-microservice"></a>什麼是微服務？

有不同的微服務定義。 但是，微服務的大多數特徵被廣泛接受：

* 封裝客戶或商務案例。 你解決什麼問題？
* 由小型工程團隊開發。
* 使用任何框架以任何程式設計語言編寫。
* 由代碼和可選狀態組成，這兩種狀態都是獨立版本控制、部署和縮放的。
* 透過定義完善的介面和通訊協定，與其他微服務互動。
* 具有用於解析其位置的唯一名稱 （URL）。
* 在失敗時維持一致且可用的。

綜上所述：

***微服務應用程式是由獨立控制版本和可調整的客戶焦點式服務所組成，這些服務透過標準通訊協定和定義完善的介面彼此通訊。***

### <a name="written-in-any-programming-language-using-any-framework"></a>使用任何框架以任何程式設計語言編寫

作為開發人員，我們希望根據我們的技能和所創造的服務的需求自由選擇語言或框架。 對於某些服務，您可能看重C++的性能優勢高於其他任何服務。 對於其他人來說，從 C# 或 JAVA 獲得託管開發的便利性可能更為重要。 在某些情況下，您可能需要使用特定的合作夥伴庫、資料存儲技術或方法向用戶端公開服務。

選擇技術後，需要考慮服務的操作或生命週期管理和擴展。

### <a name="allows-code-and-state-to-be-independently-versioned-deployed-and-scaled"></a>允許獨立控制版本、部署及調整的程式碼和狀態

無論您如何編寫微服務，代碼以及可選的狀態都應獨立部署、升級和擴展。 這個問題很難解決，因為它歸結于您選擇的技術。 對於縮放，瞭解如何對代碼和狀態進行分區（或分片）是具有挑戰性的。 當代碼和狀態使用不同的技術（這在目前很常見）時，微服務的部署腳本需要能夠同時擴展它們。 這種分離還與敏捷性和靈活性有關，因此您可以升級某些微服務，而無需同時升級所有這些微服務。

讓我們暫時回到整體和微服務方法的比較。 此圖顯示了存儲狀態的方法的差異：

#### <a name="state-storage-for-the-two-approaches"></a>這兩種方法的狀態存儲

![Service Fabric 平台狀態儲存體][Image2]

***在左側，單一方法具有單個資料庫和特定技術層。***

***右側的微服務方法具有互連微服務圖，其中狀態通常限定為微服務，並且使用各種技術。***

在單體式方法中，應用程式通常會使用單一資料庫。 使用一個資料庫的優點是它位於單個位置，因此易於部署。 每個元件可以有單一資料表來儲存其狀態。 挑戰之處在於團隊必須嚴格區分狀態。 不可避免的是，有人會嘗試將列添加到現有客戶表，在表之間進行聯接，並在存儲層創建依賴項。 發生這種情況後，您無法調整個別的元件。

在微服務方法中，每個服務都會管理並儲存自己的狀態。 每個服務負責同時調整程式碼和狀態，以滿足服務的需求。 缺點是，當您需要創建應用程式資料的視圖或查詢時，需要跨多個狀態存儲進行查詢。 此問題通常由單獨的微服務解決，該服務跨微服務集合生成視圖。 如果需要對資料運行多個即興查詢，應考慮將每個微服務的資料寫入資料倉儲服務以進行離線分析。

微服務是可版本化的。 微服務的不同版本可以並行運行。 較新版本的微服務可能在升級期間失敗，需要回滾到早期版本。 版本控制對 A/B 測試也很有説明，因為不同的使用者會體驗不同的服務版本。 例如，通常為一組特定客戶升級微服務以測試新功能，然後再更廣泛地推出。

### <a name="interacts-with-other-microservices-over-well-defined-interfaces-and-protocols"></a>透過定義完善的介面和通訊協定，與其他微服務互動

在過去 10 年中，已發佈大量資訊，描述面向服務的體系結構中的通訊模式。 一般而言，服務通訊使用 REST 方法，並搭配 HTTP 和 TCP 通訊協定及 XML 或 JSON 做為序列化格式。 從介面的角度來看，它是關於採用 Web 設計方法。 但是，沒有什麼可以阻止您使用二進位協定或您自己的資料格式。 請注意，如果這些協定和格式不公開可用，使用者將更難使用您的微服務。

### <a name="has-a-unique-name-url-used-to-resolve-its-location"></a>具有可用來解析位置的唯一名稱 (URL)

只要您的微服務正在執行，就必須是可定址的。 如果您正在考慮電腦以及運行特定微服務的電腦，情況可能會很快變壞。

就像 DNS 會解析特定電腦的特定 URL 一樣，微服務需要有唯一的名稱，其目前所在的位置才可被探索。 微服務需要獨立于其運行的基礎結構的可定址名稱。 這表示服務的部署方式與探索方式之間會有互動，因為需要有服務登錄。 當電腦發生故障時，註冊表服務需要告訴您服務移動到何處。

### <a name="remains-consistent-and-available-in-the-presence-of-failures"></a>失敗時維持一致且可用

處理非預期的失敗是最難解決的問題之一，特別是在分散式系統中。 我們作為開發人員編寫的許多代碼都用於處理異常。 在測試期間，我們還將大部分時間花在異常處理上。 該過程比編寫代碼來處理失敗更涉及。 當運行微服務的電腦出現故障時會發生什麼情況？ 您需要檢測故障，這是一個棘手的問題本身。 但是，您還需要重新開機微服務。

為了可用性，微服務需要對故障具有彈性，並能夠在另一台電腦上重新開機。 除了這些彈性要求外，資料不應丟失，並且資料需要保持一致。

如果在應用程式升級期間發生失敗，會使復原性很難達成。 在搭配部署系統一起運作時，微服務不需要復原。 它需要確定是否可以繼續前進到較新版本或回滾到以前的版本以保持一致狀態。 您需要考慮幾個問題，例如是否有足夠的電腦來繼續向前發展以及如何恢復以前版本的微服務。 要做出這些決策，您需要微服務來發出運行狀況資訊。

### <a name="reports-health-and-diagnostics"></a>報告狀況和診斷

這似乎是顯而易見的，而且經常被忽視，但微服務需要報告其運行狀況和診斷。 否則，您從操作角度對其運行狀況知之甚少。 相互關聯一組獨立服務上的診斷事件，並處理電腦時間差異以了解事件順序，是一件非常具挑戰性的任務。 與您透過同意的通訊協定和資料格式來與微服務互動相同，您需要將健康情況和診斷事件的記錄方式標準化，因為這些事件最後會被放入事件存放區中以供查詢和檢視。 使用微服務方法，不同的團隊需要就單個日誌記錄格式達成一致。 需要有一致的方法可檢視整個應用程式中的診斷事件。

狀況與診斷不同。 健全狀況是指微服務報告其目前狀態，以便採取適當的行動。 使用升級和部署機制來維護可用性是一個很好例子。 儘管由於進程崩潰或電腦重新開機，服務當前可能不正常，但該服務可能仍可運行。 您最不需要的就是通過啟動升級使情況變得更糟。 最好的方法是首先調查或留出時間讓微服務恢復。 微服務的健全狀況事件可協助我們做出明智的決策，實際上有助於建立自我修復的服務。

## <a name="guidance-for-designing-microservices-on-azure"></a>在 Azure 上設計微服務的指導

有關在[Azure 上設計和構建微服務](https://docs.microsoft.com/azure/architecture/microservices/)的指導，請訪問 Azure 體系結構中心。

## <a name="service-fabric-as-a-microservices-platform"></a>Service Fabric 做為微服務平台

當 Microsoft 從提供盒裝產品（通常是單片產品）過渡到提供服務時，Azure 服務結構應運而生。 構建和操作大型服務（如 Azure SQL 資料庫和 Azure Cosmos DB）的體驗塑造了服務結構。 隨著更多服務採用該平臺，該平臺會隨著時間而演變。 Service Fabric 不僅必須在 Azure 中執行，也必須在獨立式 Windows Server 部署中執行。

***Service Fabric 的目標是解決構建和運行服務的難題，並有效地使用基礎結構資源，以便團隊可以使用微服務方法解決業務問題。***

Service Fabric 透過提供下列項目，來協助您使用微服務方法建置應用程式：

* 一個提供系統服務的平台 - 這些服務可進行部署、升級、偵測及重新啟動失敗的服務、探索服務、路由傳送訊息、管理狀態，以及監視健康情況。
* 部署在容器中運行的應用程式或作為進程運行的應用程式的能力。 Service Fabric 是一個容器和處理序協調者。
* 高效的程式設計 API 可説明您將應用程式構建為微服務[：ASP.NET核心、可靠參與者和可靠服務](service-fabric-choose-framework.md)。 例如，您可以取得健康情況和診斷資訊，或利用內建的高可用性。

***Service Fabric 對如何構建服務不可知，您可以使用任何技術。但它確實提供了內置的程式設計 API，使構建微服務變得更加容易。***

### <a name="migrating-existing-applications-to-service-fabric"></a>將現有的應用程式移轉到 Service Fabric

Service Fabric 允許您重用現有代碼，並將其與新微服務進行現代化改造。 應用程式現代化有五個階段，您可以在任何階段啟動和停止。 階段包括：

1) 開始使用傳統單體式應用程式。  
2) 遷移。 使用容器或來賓可執行檔在 Service Fabric 中託管現有代碼。  
3) 現代化。 將新的微服務與現有的容器化代碼一起添加。  
4) 創新。 根據需求將整體應用程式分解為微服務。  
5) 將應用程式轉換為微服務。 轉換現有的單片應用程式或構建新的綠地應用程式。

![遷移到微服務][Image3]

請記住，您可以在*任何這些階段開始和停止*。 你不必進入下一階段。 

讓我們看一下每個階段的示例。

**遷移**  
出於兩個原因，許多公司正在將現有的單片應用程式遷移到容器中：

* 成本降低，原因包括整合和刪除現有硬體，或由於以更高密度運行應用程式。
* 開發和操作之間的一致部署協定。

降低成本非常簡單。 在 Microsoft，許多現有應用程式正在被集裝箱化，從而節省了數百萬美元。 一致的部署更難評估，但同樣重要。 這意味著開發人員可以選擇適合他們的技術，但操作將只接受一種部署和管理應用程式的方法。 它減輕了操作，使其不必處理支援不同技術的複雜性，而不迫使開發人員只選擇某些技術。 從本質上講，每個應用程式都被容器化為自包含的部署映射。

許多組織都在此停止。 它們已經具有容器的優點，而 Service Fabric 提供了完整的管理體驗，包括部署、升級、版本控制、回滾和運行狀況監視。

**現代化**  
現代化是在現有容器化代碼旁邊添加新服務。 如果要編寫新代碼，最好在微服務路徑下邁出一小步。 這可能意味著添加新的 REST API 終結點或新的業務邏輯。 通過這種方式，您可以開始構建新的微服務並練習開發和部署它們。

**創新**  
微服務方式能容納持續變更的商務需求。 在此階段，您需要決定是開始將整體應用程式拆分為服務，還是進行創新。 此處的一個典型示例是，當您用作工作流佇列的資料庫成為處理瓶頸時。 隨著工作流程要求數目的增加，將需要分配工作來進行調整。 以未擴展或需要更頻繁地更新的應用程式的特定部分為例，並將其拆分為微服務並進行創新。

**將應用程式轉換為微服務**  
在此階段，您的應用程式完全由（或拆分為）微服務組成。 為了達到這一點，您已經踏上了微服務之旅。 您可以從這裡開始，但如果沒有微服務平臺來説明您，則需要大量投資。

### <a name="are-microservices-right-for-my-application"></a>微服務適合我的應用程式嗎？

可能。 在 Microsoft，由於業務原因，越來越多的團隊開始為雲構建，其中許多團隊意識到了採用類似微服務的方法的好處。 例如，必應多年來一直在使用微服務。 對於其他團隊而言，微服務方法很新穎。 團隊發現在他們的核心強項之外，還有需要解決的困難問題。 這就是為什麼 Service Fabric 作為建築服務技術獲得牽引力的原因。

Service Fabric 的目標是減少構建微服務應用程式的複雜性，這樣您就不必進行那麼多昂貴的重新設計。 從小規模開始、需要時調整、淘汰服務、加入新服務，並隨客戶使用情況而演化。 我們也知道，為了讓微服務更易於為大部分開發人員所接受，還有許多其他尚待解決的問題。 容器和參與者程式設計模型是朝該方向邁出的小步驟的示例。 我們確信，將出現更多的創新，使微服務方法更容易。

## <a name="next-steps"></a>後續步驟

* [微服務︰採用雲端技術的應用程式革命](https://azure.microsoft.com/blog/microservices-an-application-revolution-powered-by-the-cloud/)
* [Azure 體系結構中心：在 Azure 上構建微服務](https://docs.microsoft.com/azure/architecture/microservices/)
* [Azure Service Fabric 應用程式與叢集最佳做法](service-fabric-best-practices-overview.md)
* [Service Fabric 術語概觀](service-fabric-technical-overview.md)

[Image1]: media/service-fabric-overview-microservices/monolithic-vs-micro.png
[Image2]: media/service-fabric-overview-microservices/statemonolithic-vs-micro.png
[Image3]: media/service-fabric-overview-microservices/microservices-migration.png
