---
title: 多租戶和內容隔離
titleSuffix: Azure Cognitive Search
description: 在使用 Azure 認知搜索時,瞭解多租戶 SaaS 應用程式的常見設計模式。
manager: nitinme
author: LiamCavanagh
ms.author: liamca
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 11/04/2019
ms.openlocfilehash: d8e453336005f3389f67e9571fac438bfc340c1b
ms.sourcegitcommit: 980c3d827cc0f25b94b1eb93fd3d9041f3593036
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/02/2020
ms.locfileid: "80549018"
---
# <a name="design-patterns-for-multitenant-saas-applications-and-azure-cognitive-search"></a>多租戶 SaaS 應用程式和 Azure 認知搜尋的設計模式
多租用戶應用程式是為不能查看或共用任何其他租用戶之資料的租用戶提供相同服務和功能的應用程式，其中租用戶的數目並無限制。 本文件討論使用 Azure 認知搜索構建的多租戶應用程式的租戶隔離策略。

## <a name="azure-cognitive-search-concepts"></a>Azure 認知搜尋概念
作為搜索即服務解決方案,Azure 認知搜索允許開發人員向應用程式添加豐富的搜索體驗,而無需管理任何基礎結構或成為資訊檢索專家。 資料會上傳至服務，然後儲存在雲端。 使用對 Azure 認知搜索 API 的簡單請求,可以修改和搜尋數據。 如需此服務的概觀，請參閱 [這篇文章](https://aka.ms/whatisazsearch)。 在討論設計模式之前,瞭解 Azure 認知搜索中的一些概念非常重要。

### <a name="search-services-indexes-fields-and-documents"></a>搜尋服務、索引、欄位及文件
使用 Azure 認知搜尋時,一個訂閱*搜尋服務*。 當數據上載到 Azure 認知搜索時,數據存儲在搜索服務中的*索引*中。 單一服務內可能會有好幾個索引。 若要使用熟悉的資料庫概念，搜尋服務可以比喻為資料庫，而服務內的索引則可比喻為資料庫內的資料表。

搜尋服務內的每個索引都有自己的結構描述，此結構描述是由一些可自訂的「欄位」 ** 所定義。 數據以單個*文檔*的形式添加到 Azure 認知搜索索引中。 每個文件都必須上傳至特定的索引，並且必須符合該索引的結構描述。 使用 Azure 認知搜索搜尋數據時,會針對特定索引發出全文搜索查詢。  若要將這些概念比喻成資料庫的概念，則欄位可以比喻為資料表中的資料行，而文件則可以比喻為資料列。

### <a name="scalability"></a>延展性
標準[定價層](https://azure.microsoft.com/pricing/details/search/)中的任何 Azure 認知搜尋服務都可以以兩個維度進行擴展:存儲和可用性。

* ** 來增加搜尋服務的儲存體。
* ** 可被新增到服務中，以增加搜尋服務所能處理的要求輸送量。

新增及移除資料分割和複本將可讓搜尋服務的容量，隨著應用程式要求的資料量和流量成長。 為了讓搜尋服務達到讀取 [SLA](https://azure.microsoft.com/support/legal/sla/search/v1_0/)，它將需要兩個複本。 為了讓服務達到讀寫 [SLA](https://azure.microsoft.com/support/legal/sla/search/v1_0/)，它將需要三個複本。

### <a name="service-and-index-limits-in-azure-cognitive-search"></a>Azure 認知搜尋中的服務和索引限制
Azure 認知搜索中有幾個不同的[定價層](https://azure.microsoft.com/pricing/details/search/),每個層都有不同的[限制和配額](search-limits-quotas-capacity.md)。 這些限制當中有些在服務層級，有些在索引層級，有些則是在資料分割層級。

|  | 基本 | Standard1 | Standard2 | Standard3 | Standard3 HD |
| --- | --- | --- | --- | --- | --- |
| 每項服務的複本數目上限 |3 |12 |12 |12 |12 |
| 每項服務的資料分割數目上限 |1 |12 |12 |12 |3 |
| 每項服務的搜尋單位數目上限 (複本數*資料分割數) |3 |36 |36 |36 |36 (最多 3 個資料分割) |
| 每項服務的儲存體上限 |2 GB |300 GB |1.2 TB |2.4 TB |600 GB |
| 每個資料分割的儲存體上限 |2 GB |25 GB |100 GB |200 GB |200 GB |
| 每項服務的索引數目上限 |5 |50 |200 |200 |3000 (最多 1000 個索引/資料分割) |

#### <a name="s3-high-density"></a>S3 高密度
在 Azure 認知搜索的 S3 定價層中,有一個選項用於專為多租戶方案設計的高密度 (HD) 模式。 在許多情況下，必須在單一服務下支援大量較小的租用戶，才能達到簡化和成本效益的好處。

S3 HD 會以使用資料分割相應放大索引的能力換取在單一服務中裝載更多索引的能力，來允許在單一搜尋服務的管理下封裝許多小型索引。

S3 服務旨在承載固定數量的索引(最大 200 個),並允許每個索引在將新分區添加到服務時水準縮放大小。 將分區添加到 S3 HD 服務會增加服務可以承載的最大索引數。 單個 S3HD 索引的理想最大大小約為 50 - 80 GB,儘管系統對每個索引沒有硬大小限制。

## <a name="considerations-for-multitenant-applications"></a>多租用戶應用程式的考量
多租用戶應用程式必須有效地將資源分散到各個租用戶中，同時又在各個租用戶之間保留某種程度的隱私性。 設計這類應用程式的架構時，有幾個考量︰

* *租用戶隔離︰* 應用程式開發人員需要採取適當措施，以確保沒有任何租用戶能夠在未經授權或不需要的情況下存取其他租用戶的資料。 除了資料隱私性的觀點以外，租用戶隔離策略還需要有效的共用資源管理，以及對吵雜鄰居的防範。
* *雲端資源成本︰* 與任何其他應用程式一樣，軟體解決方案作為多租用戶應用程式的元件，必須保有成本競爭力。
* *操作輕鬆︰* 開發多租用戶架構時，對應用程式的作業與複雜性的影響是很重要的考量。 Azure 認知搜索具有[99.9%的SLA。](https://azure.microsoft.com/support/legal/sla/search/v1_0/)
* *遍佈全球︰* 多租用戶應用程式可能需要有效地為分散在全球各地的租用戶提供服務。
* *延展性︰* 應用程式開發人員需要考慮到要如何讓應用程式不要太複雜，而又要能設計應用程式來依租用戶數目及租用戶資料和工作負載大小做調整。

Azure 認知搜索提供了一些邊界,可用於隔離租戶的數據和工作負荷。

## <a name="modeling-multitenancy-with-azure-cognitive-search"></a>使用 Azure 認知搜尋對多租戶建模
在多租用戶案例的情況中，應用程式開發人員會使用一或多個搜尋服務，然後將其租用戶劃分到服務、索引或兩者。 Azure 認知搜索在建模多租戶方案時具有一些常見模式:

1. *每個租用戶都使用專屬索引︰* 每個租用戶在與其他租用戶共用的搜尋服務內都有自己的索引。
2. *每個租戶的服務:* 每個租戶都有自己的專用 Azure 認知搜索服務,提供最高級別的數據和工作負載分離。
3. *兩者混合︰* 針對較大且較活躍的租用戶會指派專用服務，而針對較小的租用戶則會在共用服務內指派個別的索引。

## <a name="1-index-per-tenant"></a>1. 每個租戶的索引
![「每個租用戶都使用專屬索引」模型的圖解](./media/search-modeling-multitenant-saas-applications/azure-search-index-per-tenant.png)

在按租戶索引模型中,多個租戶佔用單個 Azure 認知搜索服務,其中每個租戶都有自己的索引。

租戶實現數據隔離,因為所有搜索請求和文檔操作都在 Azure 認知搜索中的索引級別發出。 在應用程式層中，有需求感知，可將各個租用戶的流量導向到適當的索引，同時也管理所有租用戶的服務層級資源。

「每個租用戶都使用專屬索引」模型有一個關鍵屬性，就是能夠讓應用程式開發人員在應用程式的租用戶之間過度訂閱搜尋服務的容量。 如果租用戶的工作負載分配不平均，系統可以將最佳的租用戶組合分散到搜尋服務的各個索引，以因應一些非常活躍、耗用大量資源的租用戶需求，而同時仍為為數眾多但較不活躍的租用戶提供服務。 取捨的結果是如果每個租用戶同時都非常活躍，此模型便無法處理。

每個租戶的索引模型為可變成本模型提供了基礎,其中整個 Azure 認知搜索服務是預先購買的,然後填充了租戶。 這可讓您將未使用的容量指定給試用版和免費帳戶。

對遍佈全球的應用程式來說，「每個租用戶都使用專屬索引」模型可能不是最有效率的模型。 如果應用程式的租用戶遍佈全球，每個區域可能就都需要個別的服務，而可能導致在各個區域產生重複的成本。

Azure 認知搜索允許單個索引的規模和要增長的索引總數。 如果選擇了適當的定價層，當服務內的個別索引在儲存體或流量方面成長得太大時，將可為整個搜尋服務新增資料分割和複本。

如果單一服務的索引總數成長得太大，則必須佈建另一個服務來容納新的租用戶。 如果在添加新服務時必須在搜索服務之間移動索引,則索引中的數據必須從一個索引手動複製到另一個索引,因為 Azure 認知搜索不允許移動索引。

## <a name="2-service-per-tenant"></a>2. 每個租戶的服務
![「每個租用戶都使用專屬服務」模型的圖解](./media/search-modeling-multitenant-saas-applications/azure-search-service-per-tenant.png)

在「每個租用戶都使用專屬服務」架構中，每個租用戶都有自己的搜尋服務。

在此模型中，應用程式可針對其租用戶達到最大程度的隔離。 每項服務除了有個別的 API 金鑰之外，還有專用的儲存體和輸送量來處理搜尋要求。

如果應用程式的每個租用戶具有較大的使用量，或是租用戶之間的工作負載變化小，「每個租用戶都使用專屬服務」模型就是相當適當的選擇，因為資源不會在各個租用戶的工作負載之間共用。

每個租用戶都使用專屬服務模型也提供可預測、固定成本模型的優點。 整個搜尋服務在有租用戶填入之前，並不需要預先做任何投資，不過，每一租用戶的成本會高於「每個租用戶都使用專屬索引」模型。

對遍佈全球的應用程式來說，「每個租用戶都使用專屬服務」模型是一個有效率的選擇。 當租用戶的地理位置相當分散時，讓每個租用戶的服務在適當的區域中相當簡單。

當個別租用戶的成長速度超出其服務所能處理的範圍時，調整此模式的挑戰便隨之產生。 Azure 認知搜索當前不支援升級搜索服務的定價層,因此所有數據都必須手動複製到新服務。

## <a name="3-mixing-both-models"></a>3. 混合兩種型號
建立多租用戶模型的另一種模式是將「每個租用戶都使用專屬索引」與「每個租用戶都使用專屬服務」策略混合。

透過混合這兩種模式，應用程式的最大租用戶便可以佔用專用服務，而為數眾多的較不活躍且較小的租用戶則可以在共用服務中佔用索引。 此模型可確保最大租用戶可以從服務一直享有高效能，同時又可協助保護較小的租用戶不受任何吵雜的鄰居干擾。

不過，實作此策略需要有遠見來預測哪些租用戶需要的是專用服務，而哪些租用戶需要的是共用服務中的索引。 當產生管理這兩個多租用戶模型的需求時，應用程式複雜性也隨之增加。

## <a name="achieving-even-finer-granularity"></a>達到更精細的細微度
上述設計模式用於在 Azure 認知搜索中建模多租戶方案,假定一個統一的範圍,其中每個租戶都是應用程式的整個實例。 不過，應用程式有時可能是處理許多較小的範圍。

如果「每個租用戶都使用專屬服務」和「每個租用戶都使用專屬索引」模型的範圍不夠小，您可以建立索引模型來達到更精細的細微程度。

若要讓單一索引針對不同的用戶端端點有不同的行為，您可以在索引中新增欄位來為每個可能的用戶端指定特定的值。 每次用戶端調用 Azure 認知搜尋以查詢或修改索引時,用戶端應用程式的代碼都會使用 Azure 認知搜索的[篩選](https://msdn.microsoft.com/library/azure/dn798921.aspx)功能在查詢時指定該欄位的適當值。

此方法可用來實現個別使用者帳戶的功能、分隔權限等級，甚至是完全分隔應用程式。

> [!NOTE]
> 使用上述方法來設定單一索引，為多個租用戶提供服務，進而影響搜尋結果的相關性。 搜尋相關性分數是在索引層級範圍計算，而不是在租用戶層級範圍計算，因此所有租用戶的資料都會併入相關性分數的基礎統計資料 (例如詞彙頻率)。
> 
> 

## <a name="next-steps"></a>後續步驟
對於許多應用程序來說,Azure 認知搜索是一個引人注目的選擇。 在評估多租戶應用程式的各種設計模式時,請考慮[各種定價層](https://azure.microsoft.com/pricing/details/search/)和相應的[服務限制](search-limits-quotas-capacity.md),以最佳定製 Azure 認知搜索,以適應各種大小的應用程式工作負載和體系結構。

有關 Azure 認知搜尋和多租戶方案的任何問題都可以定azuresearch_contact@microsoft.com向到 。

